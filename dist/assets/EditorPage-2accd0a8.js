var e=Object.defineProperty,t=(t,n,i)=>(((t,n,i)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i})(t,"symbol"!=typeof n?n+"":n,i),i);import{_ as n,j as i}from"./index-024e1406.js";import{c as s,g as a,r,b as o,a as l}from"./react-vendor-773f2c06.js";import{h as c,i as A,T as d,j as h,k as u,l as p,m as g,n as m,b,o as f,p as v,q as y,d as w,r as C,s as x,t as I,V as E,u as S,v as B,I as Q,w as j,O as M,x as D,y as T,z as R,L as O,E as k,R as L,N as P,G as F,J as N,K as _,Q as G,U,X as z,Y as H,f as q,Z as K,_ as W,$ as V,a0 as Y,a1 as J,P as X,a2 as Z,a3 as $,a4 as ee,a5 as te,a6 as ne,a7 as ie,a8 as se,a9 as ae,aa as re,ab as oe,ac as le,ad as ce,ae as Ae,af as de,ag as he,ah as ue,ai as pe,aj as ge,ak as me,al as be,am as fe,an as ve,ao as ye,ap as we,aq as Ce,ar as xe,as as Ie,at as Ee,au as Se,av as Be,aw as Qe,ax as je,ay as Me,az as De,aA as Te,aB as Re,aC as Oe,aD as ke,H as Le,F as Pe,aE as Fe,aF as Ne,aG as _e,aH as Ge,aI as Ue,aJ as ze,B as He,aK as qe,aL as Ke,aM as We,aN as Ve,aO as Ye,g as Je,aP as Xe,e as Ze,aQ as $e,aR as et,aS as tt,aT as nt,aU as it,aV as st,aW as at,aX as rt,aY as ot,C as lt,aZ as ct,a_ as At,a$ as dt,b0 as ht,b1 as ut,b2 as pt,b3 as gt,b4 as mt,b5 as bt,b6 as ft,b7 as vt,b8 as yt,b9 as wt,ba as Ct,bb as xt,bc as It,bd as Et,be as St,bf as Bt,bg as Qt,bh as jt,bi as Mt,S as Dt,W as Tt,A as Rt,c as Ot,bj as kt,bk as Lt,bl as Pt,bm as Ft,bn as Nt,bo as _t,M as Gt,bp as Ut,bq as zt}from"./three-989b717a.js";import{c as Ht}from"./state-55578a0b.js";import{R as qt}from"./three-stdlib-87f034b1.js";import{u as Kt}from"./router-34a0800b.js";function Wt(e){let t,n,i,s=-1,a=0;for(let c=0;c<e.length;++c){const r=e[c];if(void 0===t&&(t=r.array.constructor),t!==r.array.constructor)return null;if(void 0===n&&(n=r.itemSize),n!==r.itemSize)return null;if(void 0===i&&(i=r.normalized),i!==r.normalized)return null;if(-1===s&&(s=r.gpuType),s!==r.gpuType)return null;a+=r.count*n}const r=new t(a),o=new A(r,n,i);let l=0;for(let c=0;c<e.length;++c){const t=e[c];if(t.isInterleavedBufferAttribute){const e=l/n;for(let i=0,s=t.count;i<s;i++)for(let a=0;a<n;a++){const n=t.getComponent(i,a);o.setComponent(i+e,a,n)}}else r.set(t.array,l);l+=t.count*n}return void 0!==s&&(o.gpuType=s),o}function Vt(e,t){if(t===d)return e;if(t===h||t===u){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const i=n.count-2,s=[];if(t===h)for(let e=1;e<=i;e++)s.push(n.getX(0)),s.push(n.getX(e)),s.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(s.push(n.getX(e)),s.push(n.getX(e+1)),s.push(n.getX(e+2))):(s.push(n.getX(e+2)),s.push(n.getX(e+1)),s.push(n.getX(e)));s.length;const a=e.clone();return a.setIndex(s),a.clearGroups(),a}return e}class Yt extends p{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new tn(e)}),this.register(function(e){return new nn(e)}),this.register(function(e){return new hn(e)}),this.register(function(e){return new un(e)}),this.register(function(e){return new pn(e)}),this.register(function(e){return new an(e)}),this.register(function(e){return new rn(e)}),this.register(function(e){return new on(e)}),this.register(function(e){return new ln(e)}),this.register(function(e){return new en(e)}),this.register(function(e){return new cn(e)}),this.register(function(e){return new sn(e)}),this.register(function(e){return new dn(e)}),this.register(function(e){return new An(e)}),this.register(function(e){return new Zt(e)}),this.register(function(e){return new gn(e)}),this.register(function(e){return new mn(e)})}load(e,t,n,i){const s=this;let a;if(""!==this.resourcePath)a=this.resourcePath;else if(""!==this.path){const t=g.extractUrlBase(e);a=g.resolveURL(t,this.path)}else a=g.extractUrlBase(e);this.manager.itemStart(e);const r=function(t){i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)},o=new m(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(n){try{s.parse(n,a,function(n){t(n),s.manager.itemEnd(e)},r)}catch(i){r(i)}},n,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let s;const a={},r={},o=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===bn){try{a[Xt.KHR_BINARY_GLTF]=new yn(e)}catch(c){return void(i&&i(c))}s=JSON.parse(a[Xt.KHR_BINARY_GLTF].content)}else s=JSON.parse(o.decode(e))}else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Kn(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let A=0;A<this.pluginCallbacks.length;A++){const e=this.pluginCallbacks[A](l);e.name,r[e.name]=e,a[e.name]=!0}if(s.extensionsUsed)for(let A=0;A<s.extensionsUsed.length;++A){const e=s.extensionsUsed[A],t=s.extensionsRequired||[];switch(e){case Xt.KHR_MATERIALS_UNLIT:a[e]=new $t;break;case Xt.KHR_DRACO_MESH_COMPRESSION:a[e]=new wn(s,this.dracoLoader);break;case Xt.KHR_TEXTURE_TRANSFORM:a[e]=new Cn;break;case Xt.KHR_MESH_QUANTIZATION:a[e]=new xn;break;default:t.indexOf(e)>=0&&r[e]}}l.setExtensions(a),l.setPlugins(r),l.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,t,i,s)})}}function Jt(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Xt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Zt{constructor(e){this.parser=e,this.name=Xt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let r;const o=new b(16777215);void 0!==a.color&&o.setRGB(a.color[0],a.color[1],a.color[2],f);const l=void 0!==a.range?a.range:0;switch(a.type){case"directional":r=new w(o),r.target.position.set(0,0,-1),r.add(r.target);break;case"point":r=new y(o),r.distance=l;break;case"spot":r=new v(o),r.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,r.angle=a.spot.outerConeAngle,r.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return r.position.set(0,0,0),r.decay=2,_n(r,a),void 0!==a.intensity&&(r.intensity=a.intensity),r.name=t.createUniqueName(a.name||"light_"+e),i=Promise.resolve(r),t.cache.add(n,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],s=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then(function(e){return n._getNodeRef(t.cache,s,e)})}}let $t=class{constructor(){this.name=Xt.KHR_MATERIALS_UNLIT}getMaterialType(){return C}extendParams(e,t,n){const i=[];e.color=new b(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],f),e.opacity=t[3]}void 0!==s.baseColorTexture&&i.push(n.assignTexture(e,"map",s.baseColorTexture,x))}return Promise.all(i)}},en=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}},tn=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&s.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(s.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new E(e,e)}return Promise.all(s)}},nn=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}},sn=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&s.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&s.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}},an=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new b(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(void 0!==a.sheenColorFactor){const e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],f)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&s.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,x)),void 0!==a.sheenRoughnessTexture&&s.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}},rn=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&s.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}},on=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&s.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return t.attenuationColor=(new b).setRGB(r[0],r[1],r[2],f),Promise.all(s)}},ln=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}},cn=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&s.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return t.specularColor=(new b).setRGB(r[0],r[1],r[2],f),void 0!==a.specularColorTexture&&s.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,x)),Promise.all(s)}},An=class{constructor(e){this.parser=e,this.name=Xt.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&s.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}},dn=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?I:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&s.push(n.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}};class hn{constructor(e){this.parser=e,this.name=Xt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class un{constructor(e){this.parser=e,this.name=Xt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],r=i.images[a.source];let o=n.textureLoader;if(r.uri){const e=n.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class pn{constructor(e){this.parser=e,this.name=Xt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],r=i.images[a.source];let o=n.textureLoader;if(r.uri){const e=n.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then(function(s){if(s)return n.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class gn{constructor(e){this.name=Xt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const n=e.byteOffset||0,i=e.byteLength||0,a=e.count,r=e.byteStride,o=new Uint8Array(t,n,i);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(a,r,o,e.mode,e.filter).then(function(e){return e.buffer}):s.ready.then(function(){const t=new ArrayBuffer(a*r);return s.decodeGltfBuffer(new Uint8Array(t),a,r,o,e.mode,e.filter),t})})}return null}}let mn=class{constructor(e){this.name=Xt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const i=t.meshes[n.mesh];for(const o of i.primitives)if(o.mode!==Bn.TRIANGLES&&o.mode!==Bn.TRIANGLE_STRIP&&o.mode!==Bn.TRIANGLE_FAN&&void 0!==o.mode)return null;const s=n.extensions[this.name].attributes,a=[],r={};for(const o in s)a.push(this.parser.getDependency("accessor",s[o]).then(e=>(r[o]=e,r[o])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{const t=e.pop(),n=t.isGroup?t.children:[t],i=e[0].count,s=[];for(const a of n){const e=new S,t=new B,n=new ae,o=new B(1,1,1),l=new Q(a.geometry,a.material,i);for(let s=0;s<i;s++)r.TRANSLATION&&t.fromBufferAttribute(r.TRANSLATION,s),r.ROTATION&&n.fromBufferAttribute(r.ROTATION,s),r.SCALE&&o.fromBufferAttribute(r.SCALE,s),l.setMatrixAt(s,e.compose(t,n,o));for(const i in r)if("_COLOR_0"===i){const e=r[i];l.instanceColor=new j(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&a.geometry.setAttribute(i,r[i]);M.prototype.copy.call(l,a),this.parser.assignFinalMaterial(l),s.push(l)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]}))}};const bn="glTF",fn=1313821514,vn=5130562;class yn{constructor(e){this.name=Xt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==bn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,s=new DataView(e,12);let a=0;for(;a<i;){const t=s.getUint32(a,!0);a+=4;const i=s.getUint32(a,!0);if(a+=4,i===fn){const i=new Uint8Array(e,12+a,t);this.content=n.decode(i)}else if(i===vn){const n=12+a;this.body=e.slice(n,n+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class wn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Xt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,r={},o={},l={};for(const c in a){const e=Tn[c]||c.toLowerCase();r[e]=a[c]}for(const c in e.attributes){const t=Tn[c]||c.toLowerCase();if(void 0!==a[c]){const i=n.accessors[e.attributes[c]],s=Qn[i.componentType];l[t]=s.name,o[t]=!0===i.normalized}}return t.getDependency("bufferView",s).then(function(e){return new Promise(function(t,n){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const n=e.attributes[t],i=o[t];void 0!==i&&(n.normalized=i)}t(e)},r,l,f,n)})})}}class Cn{constructor(){this.name=Xt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class xn{constructor(){this.name=Xt.KHR_MESH_QUANTIZATION}}class In extends ye{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let a=0;a!==i;a++)t[a]=n[s+a];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,r=this.valueSize,o=2*r,l=3*r,c=i-t,A=(n-t)/c,d=A*A,h=d*A,u=e*l,p=u-l,g=-2*h+3*d,m=h-d,b=1-g,f=m-d+A;for(let v=0;v!==r;v++){const e=a[p+v+r],t=a[p+v+o]*c,n=a[u+v+r],i=a[u+v]*c;s[v]=b*e+f*t+g*n+m*i}return s}}const En=new ae;class Sn extends In{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return En.fromArray(s).normalize().toArray(s),s}}const Bn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Qn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},jn={9728:P,9729:O,9984:re,9985:oe,9986:le,9987:k},Mn={33071:ce,33648:Ae,10497:L},Dn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Tn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Rn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},On={CUBICSPLINE:void 0,LINEAR:ie,STEP:de},kn="OPAQUE",Ln="MASK",Pn="BLEND";function Fn(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new G({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:he})),e.DefaultMaterial}function Nn(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function _n(e,t){void 0!==t.extras&&"object"==typeof t.extras&&Object.assign(e.userData,t.extras)}function Gn(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}}}function Un(e){let t;const n=e.extensions&&e.extensions[Xt.KHR_DRACO_MESH_COMPRESSION];if(t=n?"draco:"+n.bufferView+":"+n.indices+":"+zn(n.attributes):e.indices+":"+zn(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,s=e.targets.length;i<s;i++)t+=":"+zn(e.targets[i]);return t}function zn(e){let t="";const n=Object.keys(e).sort();for(let i=0,s=n.length;i<s;i++)t+=n[i]+":"+e[n[i]]+";";return t}function Hn(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const qn=new S;class Kn{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Jt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=-1,s=!1,a=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;n=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=n&&t?parseInt(t[1],10):-1,s=e.indexOf("Firefox")>-1,a=s?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||n&&i<17||s&&a<98?this.textureLoader=new D(this.options.manager):this.textureLoader=new T(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new m(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){const a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};return Nn(s,a,i),_n(a,i),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){for(const e of a.scenes)e.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[i,a]of e.children.entries())s(a,t.children[i])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Xt.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,s){n.load(g.resolveURL(t.uri,i.path),e,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=Dn[i.type],t=Qn[i.componentType],n=!0===i.normalized,s=new t(i.count*e);return Promise.resolve(new A(s,e,n))}const s=[];return void 0!==i.bufferView?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(e){const s=e[0],a=Dn[i.type],r=Qn[i.componentType],o=r.BYTES_PER_ELEMENT,l=o*a,c=i.byteOffset||0,d=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let u,p;if(d&&d!==l){const e=Math.floor(c/d),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(n);l||(u=new r(s,e*d,i.count*d/o),l=new R(u,d/o),t.cache.add(n,l)),p=new ue(l,a,c%d/o,h)}else u=null===s?new r(i.count*a):new r(s,c,i.count*a),p=new A(u,a,h);if(void 0!==i.sparse){const t=Dn.SCALAR,n=Qn[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new n(e[1],o,i.sparse.count*t),d=new r(e[2],l,i.sparse.count*a);null!==s&&(p=new A(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,i=c.length;e<i;e++){const t=c[e];if(p.setX(t,d[e*a]),a>=2&&p.setY(t,d[e*a+1]),a>=3&&p.setZ(t,d[e*a+2]),a>=4&&p.setW(t,d[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p})}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e].source,s=t.images[i];let a=this.textureLoader;if(s.uri){const e=n.manager.getHandler(s.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const i=this,s=this.json,a=s.textures[e],r=s.images[t],o=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,n).then(function(t){t.flipY=!1,t.name=a.name||r.name||"",""===t.name&&"string"==typeof r.uri&&!1===r.uri.startsWith("data:image/")&&(t.name=r.uri);const n=(s.samplers||{})[a.sampler]||{};return t.magFilter=jn[n.magFilter]||O,t.minFilter=jn[n.minFilter]||k,t.wrapS=Mn[n.wrapS]||L,t.wrapT=Mn[n.wrapT]||L,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==P&&t.minFilter!==O,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){const n=this,i=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const a=i.images[e],r=self.URL||self.webkitURL;let o=a.uri||"",l=!1;if(void 0!==a.bufferView)o=n.getDependency("bufferView",a.bufferView).then(function(e){l=!0;const t=new Blob([e],{type:a.mimeType});return o=r.createObjectURL(t),o});else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then(function(e){return new Promise(function(n,i){let a=n;!0===t.isImageBitmapLoader&&(a=function(e){const t=new pe(e);t.needsUpdate=!0,n(t)}),t.load(g.resolveURL(e,s.path),a,void 0,i)})}).then(function(e){var t;return!0===l&&r.revokeObjectURL(o),_n(e,a),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e}).catch(function(e){throw e});return this.sourceCache[e]=c,c}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(void 0!==n.texCoord&&n.texCoord>0&&((a=a.clone()).channel=n.texCoord),s.extensions[Xt.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[Xt.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=s.associations.get(a);a=s.extensions[Xt.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),s.associations.set(a,t)}}return void 0!==i&&(a.colorSpace=i),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new F,N.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new _,N.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,this.cache.add(e,t)),n=t}if(i||s||a){let e="ClonedMaterial:"+n.uuid+":";i&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),s&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}e.material=n}getMaterialType(){return G}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let a;const r={},o=[];if((s.extensions||{})[Xt.KHR_MATERIALS_UNLIT]){const e=i[Xt.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),o.push(e.extendParams(r,s,t))}else{const n=s.pbrMetallicRoughness||{};if(r.color=new b(1,1,1),r.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;r.color.setRGB(e[0],e[1],e[2],f),r.opacity=e[3]}void 0!==n.baseColorTexture&&o.push(t.assignTexture(r,"map",n.baseColorTexture,x)),r.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,r.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(o.push(t.assignTexture(r,"metalnessMap",n.metallicRoughnessTexture)),o.push(t.assignTexture(r,"roughnessMap",n.metallicRoughnessTexture))),a=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),o.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,r)})))}!0===s.doubleSided&&(r.side=U);const l=s.alphaMode||kn;if(l===Pn?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,l===Ln&&(r.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&a!==C&&(o.push(t.assignTexture(r,"normalMap",s.normalTexture)),r.normalScale=new E(1,1),void 0!==s.normalTexture.scale)){const e=s.normalTexture.scale;r.normalScale.set(e,e)}if(void 0!==s.occlusionTexture&&a!==C&&(o.push(t.assignTexture(r,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(r.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&a!==C){const e=s.emissiveFactor;r.emissive=(new b).setRGB(e[0],e[1],e[2],f)}return void 0!==s.emissiveTexture&&a!==C&&o.push(t.assignTexture(r,"emissiveMap",s.emissiveTexture,x)),Promise.all(o).then(function(){const n=new a(r);return s.name&&(n.name=s.name),_n(n,s),t.associations.set(n,{materials:e}),s.extensions&&Nn(i,n,s),n})}createUniqueName(e){const t=z.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(e){return n[Xt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return Wn(n,e,t)})}const a=[];for(let r=0,o=e.length;r<o;r++){const n=e[r],o=Un(n),l=i[o];if(l)a.push(l.promise);else{let e;e=n.extensions&&n.extensions[Xt.KHR_DRACO_MESH_COMPRESSION]?s(n):Wn(new c,n,t),i[o]={primitive:n,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],a=s.primitives,r=[];for(let o=0,l=a.length;o<l;o++){const e=void 0===a[o].material?Fn(this.cache):this.getDependency("material",a[o].material);r.push(e)}return r.push(t.loadGeometries(a)),Promise.all(r).then(function(n){const r=n.slice(0,n.length-1),o=n[n.length-1],l=[];for(let A=0,d=o.length;A<d;A++){const n=o[A],c=a[A];let d;const p=r[A];if(c.mode===Bn.TRIANGLES||c.mode===Bn.TRIANGLE_STRIP||c.mode===Bn.TRIANGLE_FAN||void 0===c.mode)d=!0===s.isSkinnedMesh?new H(n,p):new q(n,p),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),c.mode===Bn.TRIANGLE_STRIP?d.geometry=Vt(d.geometry,u):c.mode===Bn.TRIANGLE_FAN&&(d.geometry=Vt(d.geometry,h));else if(c.mode===Bn.LINES)d=new K(n,p);else if(c.mode===Bn.LINE_STRIP)d=new W(n,p);else if(c.mode===Bn.LINE_LOOP)d=new V(n,p);else{if(c.mode!==Bn.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new Y(n,p)}Object.keys(d.geometry.morphAttributes).length>0&&Gn(d,s),d.name=t.createUniqueName(s.name||"mesh_"+e),_n(d,s),c.extensions&&Nn(i,d,c),t.assignFinalMaterial(d),l.push(d)}for(let i=0,s=l.length;i<s;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return s.extensions&&Nn(i,l[0],s),l[0];const c=new J;s.extensions&&Nn(i,c,s),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new X(Z.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new $(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),_n(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,s=t.joints.length;i<s;i++)n.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(e){const t=e.pop(),n=e,i=[],s=[];for(let a=0,r=n.length;a<r;a++){const e=n[a];if(e){i.push(e);const n=new S;null!==t&&n.fromArray(t.array,16*a),s.push(n)}}return new ee(i,s)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,a=[],r=[],o=[],l=[],c=[];for(let A=0,d=i.channels.length;A<d;A++){const e=i.channels[A],t=i.samplers[e.sampler],n=e.target,s=n.node,d=void 0!==i.parameters?i.parameters[t.input]:t.input,h=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==n.node&&(a.push(this.getDependency("node",s)),r.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",h)),l.push(t),c.push(n))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],i=e[1],a=e[2],r=e[3],o=e[4],l=[];for(let s=0,c=t.length;s<c;s++){const e=t[s],c=i[s],A=a[s],d=r[s],h=o[s];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const u=n._createAnimationTracks(e,c,A,d,h);if(u)for(let t=0;t<u.length;t++)l.push(u[t])}return new te(s,void 0,l)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,n=this.json.nodes[e],i=t._loadNodeShallow(e),s=[],a=n.children||[];for(let o=0,l=a.length;o<l;o++)s.push(t.getDependency("node",a[o]));const r=void 0===n.skin?Promise.resolve(null):t.getDependency("skin",n.skin);return Promise.all([i,Promise.all(s),r]).then(function(e){const t=e[0],n=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,qn)});for(let s=0,a=n.length;s<a;s++)t.add(n[s]);return t})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=t.nodes[e],a=s.name?i.createUniqueName(s.name):"",r=[],o=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&r.push(o),void 0!==s.camera&&r.push(i.getDependency("camera",s.camera).then(function(e){return i._getNodeRef(i.cameraCache,s.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){r.push(e)}),this.nodeCache[e]=Promise.all(r).then(function(t){let r;if(r=!0===s.isBone?new ne:t.length>1?new J:1===t.length?t[0]:new M,r!==t[0])for(let e=0,n=t.length;e<n;e++)r.add(t[e]);if(s.name&&(r.userData.name=s.name,r.name=a),_n(r,s),s.extensions&&Nn(n,r,s),void 0!==s.matrix){const e=new S;e.fromArray(s.matrix),r.applyMatrix4(e)}else void 0!==s.translation&&r.position.fromArray(s.translation),void 0!==s.rotation&&r.quaternion.fromArray(s.rotation),void 0!==s.scale&&r.scale.fromArray(s.scale);return i.associations.has(r)||i.associations.set(r,{}),i.associations.get(r).nodes=e,r}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new J;n.name&&(s.name=i.createUniqueName(n.name)),_n(s,n),n.extensions&&Nn(t,s,n);const a=n.nodes||[],r=[];for(let o=0,l=a.length;o<l;o++)r.push(i.getDependency("node",a[o]));return Promise.all(r).then(function(e){for(let t=0,n=e.length;t<n;t++)s.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[n,s]of i.associations)(n instanceof N||n instanceof pe)&&t.set(n,s);return e.traverse(e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)}),t})(s),s})}_createAnimationTracks(e,t,n,i,s){const a=[],r=e.name?e.name:e.uuid,o=[];let l;switch(Rn[s.path]===Rn.weights?e.traverse(function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)}):o.push(r),Rn[s.path]){case Rn.weights:l=me;break;case Rn.rotation:l=be;break;case Rn.position:case Rn.scale:l=ge;break;default:if(1===n.itemSize)l=me;else l=ge}const c=void 0!==i.interpolation?On[i.interpolation]:ie,A=this._getArrayFromAccessor(n);for(let d=0,h=o.length;d<h;d++){const e=new l(o[d]+"."+Rn[s.path],t.array,A,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),a.push(e)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Hn(t.constructor),n=new Float32Array(t.length);for(let i=0,s=t.length;i<s;i++)n[i]=t[i]*e;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof be?Sn:In)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Wn(e,t,n){const i=t.attributes,s=[];function a(t,i){return n.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const r in i){const t=Tn[r]||r.toLowerCase();t in e.attributes||s.push(a(i[r],t))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});s.push(i)}return se.workingColorSpace,_n(e,t),function(e,t,n){const i=t.attributes,s=new fe;if(void 0===i.POSITION)return;{const e=n.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return;if(s.set(new B(t[0],t[1],t[2]),new B(a[0],a[1],a[2])),e.normalized){const t=Hn(Qn[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new B,t=new B;for(let i=0,s=a.length;i<s;i++){const s=a[i];if(void 0!==s.POSITION){const i=n.json.accessors[s.POSITION],a=i.min,r=i.max;if(void 0!==a&&void 0!==r){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(r[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(r[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(r[2]))),i.normalized){const e=Hn(Qn[i.componentType]);t.multiplyScalar(e)}e.max(t)}}}s.expandByVector(e)}e.boundingBox=s;const r=new ve;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=r}(e,t,n),Promise.all(s).then(function(){return void 0!==t.targets?function(e,t,n){let i=!1,s=!1,a=!1;for(let c=0,A=t.length;c<A;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(s=!0),void 0!==e.COLOR_0&&(a=!0),i&&s&&a)break}if(!i&&!s&&!a)return Promise.resolve(e);const r=[],o=[],l=[];for(let c=0,A=t.length;c<A;c++){const A=t[c];if(i){const t=void 0!==A.POSITION?n.getDependency("accessor",A.POSITION):e.attributes.position;r.push(t)}if(s){const t=void 0!==A.NORMAL?n.getDependency("accessor",A.NORMAL):e.attributes.normal;o.push(t)}if(a){const t=void 0!==A.COLOR_0?n.getDependency("accessor",A.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l)]).then(function(t){const n=t[0],r=t[1],o=t[2];return i&&(e.morphAttributes.position=n),s&&(e.morphAttributes.normal=r),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}const Vn=new WeakMap;class Yn extends p{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new m(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,e=>{this.parse(e,t,i)},n,i)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,x,n).catch(n)}decodeDracoFile(e,t,n,i,s=f,a=()=>{}){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:s};return this.decodeGeometry(e,r).then(t).catch(a)}decodeGeometry(e,t){const n=JSON.stringify(t);if(Vn.has(e)){const t=Vn.get(e);if(t.key===n)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=e.byteLength,r=this._getWorker(s,a).then(n=>(i=n,new Promise((n,a)=>{i._callbacks[s]={resolve:n,reject:a},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return r.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),Vn.set(e,{key:n,promise:r}),r}_createGeometry(e){const t=new c;e.index&&t.setIndex(new A(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,a=i.array,r=i.itemSize,o=new A(a,r);"color"===s&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=a instanceof Float32Array==!1),t.setAttribute(s,o)}return t}_assignVertexColorSpace(e,t){if(t!==x)return;const n=new b;for(let i=0,s=e.count;i<s;i++)n.fromBufferAttribute(e,i),se.toWorkingColorSpace(n,x),e.setXYZ(i,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new m(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((t,i)=>{n.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=Jn.toString(),s=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const n=t.data;switch(n.type){case"decode":e._callbacks[n.id].resolve(n);break;case"error":e._callbacks[n.id].reject(n)}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Jn(){let e,t;function n(e,t,n,i,s,a){const r=a.num_components(),o=n.num_points()*r,l=o*s.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),A=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,a,c,l,A);const d=new s(e.HEAPF32.buffer,A,o).slice();return e._free(A),{name:i,array:d,itemSize:r}}onmessage=function(i){const s=i.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const i=s.buffer,a=s.taskConfig;t.then(e=>{const t=e.draco,r=new t.Decoder;try{const e=function(e,t,i,s){const a=s.attributeIDs,r=s.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(i,i.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const A={index:null,attributes:[]};for(const d in a){const i=self[r[d]];let l,c;if(s.useUniqueIDs)c=a[d],l=t.GetAttributeByUniqueId(o,c);else{if(c=t.GetAttributeId(o,e[a[d]]),-1===c)continue;l=t.GetAttribute(o,c)}const h=n(e,t,o,d,i,l);"color"===d&&(h.vertexColorSpace=s.vertexColorSpace),A.attributes.push(h)}c===e.TRIANGULAR_MESH&&(A.index=function(e,t,n){const i=n.num_faces(),s=3*i,a=4*s,r=e._malloc(a);t.GetTrianglesUInt32Array(n,a,r);const o=new Uint32Array(e.HEAPF32.buffer,r,s).slice();return e._free(r),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),A}(t,r,new Int8Array(i),a),o=e.attributes.map(e=>e.array.buffer);e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:e},o)}catch(o){self.postMessage({type:"error",id:s.id,error:o.message})}finally{t.destroy(r)}})}}}class Xn{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:t,msg:n,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(n,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=n,this.workers[i].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Zn=9,$n=15,ei=16,ti=22,ni=37,ii=43,si=76,ai=83,ri=97,oi=100,li=103,ci=109,Ai=165,di=166,hi=1000066e3;class ui{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class pi{constructor(e,t,n,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}const gi=[171,75,84,88,32,50,48,187,13,10,26,10];function mi(e){return(new TextDecoder).decode(e)}let bi,fi,vi;const yi={env:{emscripten_notify_memory_growth:function(e){vi=new Uint8Array(fi.exports.memory.buffer)}}};class wi{init(){return bi||(bi="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Ci).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,yi)).then(this._init):WebAssembly.instantiate(Buffer.from(Ci,"base64"),yi).then(this._init),bi)}_init(e){fi=e.instance,yi.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!fi)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=fi.exports.malloc(n);vi.set(e,i),t=t||Number(fi.exports.ZSTD_findDecompressedSize(i,n));const s=fi.exports.malloc(t),a=fi.exports.ZSTD_decompress(s,t,i,n),r=vi.slice(s,s+a);return fi.exports.free(i),fi.exports.free(s),r}}const Ci="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",xi=new WeakMap;let Ii;class Ei extends p{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Xn,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new m(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new m(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const i=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([e,t])=>{const n=Ei.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Ei.EngineFormat),"let _EngineType = "+JSON.stringify(Ei.EngineType),"let _TranscoderFormat = "+JSON.stringify(Ei.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ei.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})})}return this.transcoderPending}load(e,t,n,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new m(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(e,e=>{this.parse(e,t,i)},n,i)}parse(e,t,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(xi.has(e)){return xi.get(e).promise.then(t).catch(n)}this._createTexture(e).then(e=>t?t(e):null).catch(n)}_createTextureFrom(e,t){const{type:n,error:i,data:{faces:s,width:a,height:r,format:o,type:l,dfdFlags:c}}=e;if("error"===n)return Promise.reject(i);let A;if(6===t.faceCount)A=new we(s,o,l);else{const e=s[0].mipmaps;A=t.layerCount>1?new Ce(e,a,r,t.layerCount,o,l):new xe(e,a,r,o,l)}return A.minFilter=1===s[0].mipmaps.length?O:k,A.magFilter=O,A.generateMipmaps=!1,A.needsUpdate=!0,A.colorSpace=ji(t),A.premultiplyAlpha=!!(1&c),A}async _createTexture(e,t={}){const n=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,gi.length);if(t[0]!==gi[0]||t[1]!==gi[1]||t[2]!==gi[2]||t[3]!==gi[3]||t[4]!==gi[4]||t[5]!==gi[5]||t[6]!==gi[6]||t[7]!==gi[7]||t[8]!==gi[8]||t[9]!==gi[9]||t[10]!==gi[10]||t[11]!==gi[11])throw new Error("Missing KTX 2.0 identifier.");const n=new ui,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new pi(e,gi.length,i,!0);n.vkFormat=s._nextUint32(),n.typeSize=s._nextUint32(),n.pixelWidth=s._nextUint32(),n.pixelHeight=s._nextUint32(),n.pixelDepth=s._nextUint32(),n.layerCount=s._nextUint32(),n.faceCount=s._nextUint32();const a=s._nextUint32();n.supercompressionScheme=s._nextUint32();const r=s._nextUint32(),o=s._nextUint32(),l=s._nextUint32(),c=s._nextUint32(),A=s._nextUint64(),d=s._nextUint64(),h=new pi(e,gi.length+i,3*a*8,!0);for(let R=0;R<a;R++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const u=new pi(e,r,o,!0),p={vendorId:u._skip(4)._nextUint16(),descriptorType:u._nextUint16(),versionNumber:u._nextUint16(),descriptorBlockSize:u._nextUint16(),colorModel:u._nextUint8(),colorPrimaries:u._nextUint8(),transferFunction:u._nextUint8(),flags:u._nextUint8(),texelBlockDimension:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],bytesPlane:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],samples:[]},g=(p.descriptorBlockSize/4-6)/4;for(let R=0;R<g;R++){const e={bitOffset:u._nextUint16(),bitLength:u._nextUint8(),channelType:u._nextUint8(),samplePosition:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=u._nextInt32(),e.sampleUpper=u._nextInt32()):(e.sampleLower=u._nextUint32(),e.sampleUpper=u._nextUint32()),p.samples[R]=e}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(p);const m=new pi(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),i=mi(t);if(n.keyValue[i]=m._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){const e=mi(n.keyValue[i]);n.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}m._skip(e%4?4-e%4:0)}if(d<=0)return n;const b=new pi(e,A,d,!0),f=b._nextUint16(),v=b._nextUint16(),y=b._nextUint32(),w=b._nextUint32(),C=b._nextUint32(),x=b._nextUint32(),I=[];for(let R=0;R<a;R++)I.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const E=A+b._offset,S=E+y,B=S+w,Q=B+C,j=new Uint8Array(e.buffer,e.byteOffset+E,y),M=new Uint8Array(e.buffer,e.byteOffset+S,w),D=new Uint8Array(e.buffer,e.byteOffset+B,C),T=new Uint8Array(e.buffer,e.byteOffset+Q,x);return n.globalData={endpointCount:f,selectorCount:v,imageDescs:I,endpointsData:j,selectorsData:M,tablesData:D,extendedData:T},n}(new Uint8Array(e)),i=n.vkFormat===hi&&167===n.dataFormatDescriptor[0].colorModel;if(!(0===n.vkFormat||i&&!this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===Bi[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let n;2===e.supercompressionScheme&&(Ii||(Ii=new Promise(async e=>{const t=new wi;await t.init(),e(t)})),n=await Ii);const i=[];for(let a=0;a<e.levels.length;a++){const s=Math.max(1,e.pixelWidth>>a),r=Math.max(1,e.pixelHeight>>a),o=e.pixelDepth?Math.max(1,e.pixelDepth>>a):0,l=e.levels[a];let c,A;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=n.decode(l.levelData,l.uncompressedByteLength)}A=Qi[t]===Pe?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):Qi[t]===Le?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,i.push({data:A,width:s,height:r,depth:o})}let s;if(Si.has(Bi[t]))s=0===e.pixelDepth?new Fe(i[0].data,e.pixelWidth,e.pixelHeight):new Ne(i[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new xe(i,e.pixelWidth,e.pixelHeight)}return s.mipmaps=i,s.type=Qi[t],s.format=Bi[t],s.colorSpace=ji(e),s.needsUpdate=!0,Promise.resolve(s)}(n);const s=t,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:s},[e])).then(e=>this._createTextureFrom(e.data,n));return xi.set(e,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}Ei.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},Ei.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},Ei.EngineFormat={RGBAFormat:Ie,RGBA_ASTC_4x4_Format:Ee,RGB_BPTC_UNSIGNED_Format:Se,RGBA_BPTC_Format:Be,RGBA_ETC2_EAC_Format:Qe,RGBA_PVRTC_4BPPV1_Format:je,RGBA_S3TC_DXT5_Format:Me,RGB_ETC1_Format:De,RGB_ETC2_Format:Te,RGB_PVRTC_4BPPV1_Format:Re,RGBA_S3TC_DXT1_Format:Oe},Ei.EngineType={UnsignedByteType:ke,HalfFloatType:Le,FloatType:Pe},Ei.BasisWorker=function(){let e,t,n;const i=_EngineFormat,s=_EngineType,a=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(i){const a=i.data;switch(a.type){case"init":e=a.config,o=a.transcoderBinary,t=new Promise(e=>{n={wasmBinary:o,onRuntimeInitialized:e},BASIS(n)}).then(()=>{n.initializeBasis(),n.KTX2File});break;case"transcode":t.then(()=>{try{const{faces:t,buffers:i,width:o,height:d,hasAlpha:h,format:u,type:p,dfdFlags:g}=function(t){const i=new n.KTX2File(new Uint8Array(t));function a(){i.close(),i.delete()}if(!i.isValid())throw a(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let o;if(i.isUASTC())o=r.UASTC;else if(i.isETC1S())o=r.ETC1S;else{if(!i.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");o=r.UASTC_HDR}const d=i.getWidth(),h=i.getHeight(),u=i.getLayers()||1,p=i.getLevels(),g=i.getFaces(),m=i.getHasAlpha(),b=i.getDFDFlags(),{transcoderFormat:f,engineFormat:v,engineType:y}=function(t,n,i,s){const a=l[t];for(let r=0;r<a.length;r++){const o=a[r];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(s&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!c(n)||!c(i)))continue;return{transcoderFormat:o.transcoderFormat[s?1:0],engineFormat:o.engineFormat[s?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(o,d,h,m);if(!d||!h||!p)throw a(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!i.startTranscoding())throw a(),new Error("THREE.KTX2Loader: .startTranscoding failed");const w=[],C=[];for(let e=0;e<g;e++){const t=[];for(let n=0;n<p;n++){const r=[];let o,l;for(let t=0;t<u;t++){const c=i.getImageLevelInfo(n,t,e);0===e&&0===n&&0===t&&(c.origWidth%4!=0||c.origHeight),p>1?(o=c.origWidth,l=c.origHeight):(o=c.width,l=c.height);let A=new Uint8Array(i.getImageTranscodedSizeInBytes(n,t,0,f));const d=i.transcodeImage(A,n,t,e,f,0,-1,-1);if(y===s.HalfFloatType&&(A=new Uint16Array(A.buffer,A.byteOffset,A.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!d)throw a(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(A)}const c=A(r);t.push({data:c,width:o,height:l}),C.push(c.buffer)}w.push({mipmaps:t,width:d,height:h,format:v,type:y})}return a(),{faces:w,buffers:C,width:d,height:h,hasAlpha:m,dfdFlags:b,format:v,type:y}}(a.buffer);self.postMessage({type:"transcode",id:a.id,data:{faces:t,width:o,height:d,hasAlpha:h,format:u,type:p,dfdFlags:g}},i)}catch(t){self.postMessage({type:"error",id:a.id,error:t.message})}})}var o});const o=[{if:"astcSupported",basisFormat:[r.UASTC],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[s.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[s.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC1,a.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[s.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[s.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[s.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[s.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[r.UASTC_HDR],transcoderFormat:[a.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[s.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.RGBA32,a.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[s.UnsignedByteType,s.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[r.UASTC_HDR],transcoderFormat:[a.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[s.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[r.ETC1S]:o.filter(e=>e.basisFormat.includes(r.ETC1S)).sort((e,t)=>e.priorityUASTC-t.priorityUASTC),[r.UASTC]:o.filter(e=>e.basisFormat.includes(r.UASTC)).sort((e,t)=>e.priorityUASTC-t.priorityUASTC),[r.UASTC_HDR]:o.filter(e=>e.basisFormat.includes(r.UASTC_HDR)).sort((e,t)=>e.priorityHDR-t.priorityHDR)};function c(e){return e<=2||!(e&e-1)&&0!==e}function A(e){if(1===e.length)return e[0];let t=0;for(let s=0;s<e.length;s++){t+=e[s].byteLength}const n=new Uint8Array(t);let i=0;for(let s=0;s<e.length;s++){const t=e[s];n.set(t,i),i+=t.byteLength}return n}};const Si=new Set([Ie,Ge,Ue]),Bi={[ci]:Ie,[ri]:Ie,[ni]:Ie,[ii]:Ie,[li]:Ge,[ai]:Ge,[ei]:Ge,[ti]:Ge,[oi]:Ue,[si]:Ue,[$n]:Ue,[Zn]:Ue,[hi]:Ee,[di]:ze,[Ai]:ze},Qi={[ci]:Pe,[ri]:Le,[ni]:ke,[ii]:ke,[li]:Pe,[ai]:Le,[ei]:ke,[ti]:ke,[oi]:Pe,[si]:Le,[$n]:ke,[Zn]:ke,[hi]:Le,[di]:ke,[Ai]:ke};function ji(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?x:f:10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(t.colorPrimaries,_e)}var Mi=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var n,i=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",s=WebAssembly.instantiate(a(i),{}).then(function(e){(n=e.instance).exports.__wasm_call_ctors()});function a(e){for(var n=new Uint8Array(e.length),i=0;i<e.length;++i){var s=e.charCodeAt(i);n[i]=s>96?s-97:s>64?s-39:s+4}var a=0;for(i=0;i<e.length;++i)n[a++]=n[i]<60?t[n[i]]:64*(n[i]-60)+n[++i];return n.buffer.slice(0,a)}function r(e,t,i,s,a,r){var o=n.exports.sbrk,l=i+3&-4,c=o(l*s),A=o(a.length),d=new Uint8Array(n.exports.memory.buffer);d.set(a,A);var h=e(c,i,s,A,a.length);if(0==h&&r&&r(c,l,s),t.set(d.subarray(c,c+i*s)),o(c-o(0)),0!=h)throw new Error("Malformed buffer data: "+h)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],A=0;function d(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var n=e.data;t.pending-=n.count,t.requests[n.id][n.action](n.value),delete t.requests[n.id]},t}function h(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+r.toString()+u.toString(),n=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(n),o=0;o<e;++o)c[o]=d(s);URL.revokeObjectURL(s)}function u(e){s.then(function(){var t=e.data;try{var i=new Uint8Array(t.count*t.size);r(n.exports[t.mode],i,t.count,t.size,t.source,n.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:i},[i.buffer])}catch(s){self.postMessage({id:t.id,count:t.count,action:"reject",value:s})}})}return{ready:s,supported:!0,useWorkers:function(e){h(e)},decodeVertexBuffer:function(e,t,i,s,a){r(n.exports.meshopt_decodeVertexBuffer,e,t,i,s,n.exports[o[a]])},decodeIndexBuffer:function(e,t,i,s){r(n.exports.meshopt_decodeIndexBuffer,e,t,i,s)},decodeIndexSequence:function(e,t,i,s){r(n.exports.meshopt_decodeIndexSequence,e,t,i,s)},decodeGltfBuffer:function(e,t,i,s,a,c){r(n.exports[l[a]],e,t,i,s,n.exports[o[c]])},decodeGltfBufferAsync:function(e,t,i,a,d){return c.length>0?function(e,t,n,i,s){for(var a=c[0],r=1;r<c.length;++r)c[r].pending<a.pending&&(a=c[r]);return new Promise(function(r,o){var l=new Uint8Array(n),c=A++;a.pending+=e,a.requests[c]={resolve:r,reject:o},a.object.postMessage({id:c,count:e,size:t,source:l,mode:i,filter:s},[l.buffer])})}(e,t,i,l[a],o[d]):s.then(function(){var s=new Uint8Array(e*t);return r(n.exports[l[a]],s,e,t,i,n.exports[o[d]]),s})}}}();let Di=null,Ti=null,Ri=!1;function Oi(e){try{if(!e)return;Ti||(Ti=(new Ei).setTranscoderPath("/libs/basis/")),Ri||(Ti.detectSupport(e),Ri=!0)}catch{}}function ki(){Di||(Di=new Yn,Di.setDecoderPath("/libs/draco/")),Ti||(Ti=(new Ei).setTranscoderPath("/libs/basis/"));const e=new Yt;try{e.setDRACOLoader(Di)}catch{}try{e.setKTX2Loader(Ti)}catch{}try{e.setMeshoptDecoder(Mi)}catch{}return e}var Li={exports:{}};const Pi=s(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Fi,Ni,_i;Ni=void 0,_i=function(e){return Ni||(Ni=new Promise(function(n,i){var s,a=void 0!==e?e:{},r=a.onAbort;a.onAbort=function(e){i(new Error(e)),r&&r(e)},a.postRun=a.postRun||[],a.postRun.push(function(){n(a)}),Fi=void 0,s||(s=void 0!==a?a:{});var o="object"==typeof window,l="undefined"!=typeof WorkerGlobalScope,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;s.onRuntimeInitialized=function(){function e(e,t){switch(typeof t){case"boolean":X(e,t?1:0);break;case"number":U(e,t);break;case"string":K(e,t,-1,-1);break;case"object":if(null===t)H(e);else if(null!=t.length){var n=ft(t,bt);Y(e,n,t.length,-1),Et(n)}else Z(e,"Wrong API use : tried to return a value of an unknown type ("+t+").",-1);break;default:H(e)}}function t(e,t){for(var n=[],i=0;i<e;i+=1){var s=z(t+4*i,"i32"),a=P(s);if(1===a||2===a)s=G(s);else if(3===a)s=N(s);else if(4===a){s=F(a=s),a=_(a);for(var r=new Uint8Array(s),o=0;o<s;o+=1)r[o]=w[a+o];s=r}else s=null;n.push(s)}return n}function n(e,t){this.Qa=e,this.db=t,this.Oa=1,this.lb=[]}function i(e,t){if(this.db=t,t=te(e)+1,this.eb=It(t),null===this.eb)throw Error("Unable to allocate memory for the SQL string");ne(e,C,this.eb,t),this.kb=this.eb,this.Za=this.pb=null}function a(e){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=e){var t=this.filename,n="/",i=t;if(n&&(n="string"==typeof n?n:xe(n),i=t?J(n+"/"+t):n),i=function(e,t=438){return _e(e,4095&t|32768,0)}(i,t=Ae(!0,!0)),e){if("string"==typeof e){n=Array(e.length);for(var s=0,a=e.length;s<a;++s)n[s]=e.charCodeAt(s);e=n}Ve(i,146|t),et(n=Je(i,577),e,0,e.length,0),Xe(n),Ve(i,t)}}this.handleError(l(this.filename,r)),this.db=z(r,"i32"),ee(this.db),this.fb={},this.Sa={}}var r=jt(4),o=s.cwrap,l=o("sqlite3_open","number",["string","number"]),c=o("sqlite3_close_v2","number",["number"]),A=o("sqlite3_exec","number",["number","string","number","number","number"]),d=o("sqlite3_changes","number",["number"]),h=o("sqlite3_prepare_v2","number",["number","string","number","number","number"]),u=o("sqlite3_sql","string",["number"]),p=o("sqlite3_normalized_sql","string",["number"]),g=o("sqlite3_prepare_v2","number",["number","number","number","number","number"]),m=o("sqlite3_bind_text","number",["number","number","number","number","number"]),b=o("sqlite3_bind_blob","number",["number","number","number","number","number"]),f=o("sqlite3_bind_double","number",["number","number","number"]),v=o("sqlite3_bind_int","number",["number","number","number"]),y=o("sqlite3_bind_parameter_index","number",["number","string"]),x=o("sqlite3_step","number",["number"]),I=o("sqlite3_errmsg","string",["number"]),E=o("sqlite3_column_count","number",["number"]),S=o("sqlite3_data_count","number",["number"]),B=o("sqlite3_column_double","number",["number","number"]),Q=o("sqlite3_column_text","string",["number","number"]),j=o("sqlite3_column_blob","number",["number","number"]),M=o("sqlite3_column_bytes","number",["number","number"]),D=o("sqlite3_column_type","number",["number","number"]),T=o("sqlite3_column_name","string",["number","number"]),R=o("sqlite3_reset","number",["number"]),O=o("sqlite3_clear_bindings","number",["number"]),k=o("sqlite3_finalize","number",["number"]),L=o("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),P=o("sqlite3_value_type","number",["number"]),F=o("sqlite3_value_bytes","number",["number"]),N=o("sqlite3_value_text","string",["number"]),_=o("sqlite3_value_blob","number",["number"]),G=o("sqlite3_value_double","number",["number"]),U=o("sqlite3_result_double","",["number","number"]),H=o("sqlite3_result_null","",["number"]),K=o("sqlite3_result_text","",["number","string","number","number"]),Y=o("sqlite3_result_blob","",["number","number","number","number"]),X=o("sqlite3_result_int","",["number","number"]),Z=o("sqlite3_result_error","",["number","string","number"]),$=o("sqlite3_aggregate_context","number",["number","number"]),ee=o("RegisterExtensionFunctions","number",["number"]),se=o("sqlite3_update_hook","number",["number","number","number"]);n.prototype.bind=function(e){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(e)?this.Cb(e):null==e||"object"!=typeof e||this.Db(e)},n.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var e=x(this.Qa);switch(e){case 100:return!0;case 101:return!1;default:throw this.db.handleError(e)}},n.prototype.wb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),B(this.Qa,e)},n.prototype.Gb=function(e){if(null==e&&(e=this.Oa,this.Oa+=1),e=Q(this.Qa,e),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(e)},n.prototype.Hb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),Q(this.Qa,e)},n.prototype.getBlob=function(e){null==e&&(e=this.Oa,this.Oa+=1);var t=M(this.Qa,e);e=j(this.Qa,e);for(var n=new Uint8Array(t),i=0;i<t;i+=1)n[i]=w[e+i];return n},n.prototype.get=function(e,t){t=t||{},null!=e&&this.bind(e)&&this.step(),e=[];for(var n=S(this.Qa),i=0;i<n;i+=1)switch(D(this.Qa,i)){case 1:var s=t.useBigInt?this.Gb(i):this.wb(i);e.push(s);break;case 2:e.push(this.wb(i));break;case 3:e.push(this.Hb(i));break;case 4:e.push(this.getBlob(i));break;default:e.push(null)}return e},n.prototype.getColumnNames=function(){for(var e=[],t=E(this.Qa),n=0;n<t;n+=1)e.push(T(this.Qa,n));return e},n.prototype.getAsObject=function(e,t){e=this.get(e,t),t=this.getColumnNames();for(var n={},i=0;i<t.length;i+=1)n[t[i]]=e[i];return n},n.prototype.getSQL=function(){return u(this.Qa)},n.prototype.getNormalizedSQL=function(){return p(this.Qa)},n.prototype.run=function(e){return null!=e&&this.bind(e),this.step(),this.reset()},n.prototype.sb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),e=ie(e);var n=ft(e,bt);this.lb.push(n),this.db.handleError(m(this.Qa,t,n,e.length-1,0))},n.prototype.Bb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1);var n=ft(e,bt);this.lb.push(n),this.db.handleError(b(this.Qa,t,n,e.length,0))},n.prototype.rb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),this.db.handleError((e===(0|e)?v:f)(this.Qa,t,e))},n.prototype.Eb=function(e){null==e&&(e=this.Oa,this.Oa+=1),b(this.Qa,e,0,0,0)},n.prototype.tb=function(e,t){switch(null==t&&(t=this.Oa,this.Oa+=1),typeof e){case"string":return void this.sb(e,t);case"number":return void this.rb(e,t);case"bigint":return void this.sb(e.toString(),t);case"boolean":return void this.rb(e+0,t);case"object":if(null===e)return void this.Eb(t);if(null!=e.length)return void this.Bb(e,t)}throw"Wrong API use : tried to bind a value of an unknown type ("+e+")."},n.prototype.Db=function(e){var t=this;return Object.keys(e).forEach(function(n){var i=y(t.Qa,n);0!==i&&t.tb(e[n],i)}),!0},n.prototype.Cb=function(e){for(var t=0;t<e.length;t+=1)this.tb(e[t],t+1);return!0},n.prototype.reset=function(){return this.freemem(),0===O(this.Qa)&&0===R(this.Qa)},n.prototype.freemem=function(){for(var e;void 0!==(e=this.lb.pop());)Et(e)},n.prototype.free=function(){this.freemem();var e=0===k(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,e},i.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var e=Mt(),t=jt(4);q(r),q(t);try{this.db.handleError(g(this.db.db,this.kb,-1,r,t)),this.kb=z(t,"i32");var i=z(r,"i32");return 0===i?(this.mb(),{done:!0}):(this.Za=new n(i,this.db),this.db.fb[i]=this.Za,{value:this.Za,done:!1})}catch(s){throw this.pb=V(this.kb),this.mb(),s}finally{Qt(e)}},i.prototype.mb=function(){Et(this.eb),this.eb=null},i.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:V(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(i.prototype[Symbol.iterator]=function(){return this}),a.prototype.run=function(e,t){if(!this.db)throw"Database closed";if(t){e=this.prepare(e,t);try{e.step()}finally{e.free()}}else this.handleError(A(this.db,e,0,0,r));return this},a.prototype.exec=function(e,t,i){if(!this.db)throw"Database closed";var s=Mt(),a=null;try{var o=mt(e),l=jt(4);for(e=[];0!==z(o,"i8");){q(r),q(l),this.handleError(g(this.db,o,-1,r,l));var c=z(r,"i32");if(o=z(l,"i32"),0!==c){var A=null;for(a=new n(c,this),null!=t&&a.bind(t);a.step();)null===A&&(A={columns:a.getColumnNames(),values:[]},e.push(A)),A.values.push(a.get(null,i));a.free()}}return e}catch(d){throw a&&a.free(),d}finally{Qt(s)}},a.prototype.each=function(e,t,n,i,s){"function"==typeof t&&(i=n,n=t,t=void 0),e=this.prepare(e,t);try{for(;e.step();)n(e.getAsObject(null,s))}finally{e.free()}if("function"==typeof i)return i()},a.prototype.prepare=function(e,t){if(q(r),this.handleError(h(this.db,e,-1,r,0)),0===(e=z(r,"i32")))throw"Nothing to prepare";var i=new n(e,this);return null!=t&&i.bind(t),this.fb[e]=i},a.prototype.iterateStatements=function(e){return new i(e,this)},a.prototype.export=function(){Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(yt),this.Sa={},this.handleError(c(this.db));var e=function(e){var t,n=Je(e,n||0);e=Ke(e).size;var i=new Uint8Array(e);return $e(n,i,0,e,0),t=i,Xe(n),t}(this.filename);return this.handleError(l(this.filename,r)),this.db=z(r,"i32"),ee(this.db),e},a.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(yt),this.Sa={},this.Ya&&(yt(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),qe("/"+this.filename),this.db=null)},a.prototype.handleError=function(e){if(0===e)return null;throw e=I(this.db),Error(e)},a.prototype.getRowsModified=function(){return d(this.db)},a.prototype.create_function=function(n,i){Object.prototype.hasOwnProperty.call(this.Sa,n)&&(yt(this.Sa[n]),delete this.Sa[n]);var s=wt(function(n,s,a){s=t(s,a);try{var r=i.apply(null,s)}catch(o){return void Z(n,o,-1)}e(n,r)},"viii");return this.Sa[n]=s,this.handleError(L(this.db,n,i.length,1,0,s,0,0,0)),this},a.prototype.create_aggregate=function(n,i){var s=i.init||function(){return null},a=i.finalize||function(e){return e},r=i.step;if(!r)throw"An aggregate function must have a step function in "+n;var o={};Object.hasOwnProperty.call(this.Sa,n)&&(yt(this.Sa[n]),delete this.Sa[n]),i=n+"__finalize",Object.hasOwnProperty.call(this.Sa,i)&&(yt(this.Sa[i]),delete this.Sa[i]);var l=wt(function(e,n,i){var a=$(e,1);Object.hasOwnProperty.call(o,a)||(o[a]=s()),n=t(n,i),n=[o[a]].concat(n);try{o[a]=r.apply(null,n)}catch(l){delete o[a],Z(e,l,-1)}},"viii"),c=wt(function(t){var n=$(t,1);try{var i=a(o[n])}catch(s){return delete o[n],void Z(t,s,-1)}e(t,i),delete o[n]},"vi");return this.Sa[n]=l,this.Sa[i]=c,this.handleError(L(this.db,n,r.length-1,1,0,0,l,c,0)),this},a.prototype.updateHook=function(e){this.Ya&&(se(this.db,0,0),yt(this.Ya),this.Ya=void 0),e&&(this.Ya=wt(function(t,n,i,s,a){switch(n){case 18:t="insert";break;case 23:t="update";break;case 9:t="delete";break;default:throw"unknown operationCode in updateHook callback: "+n}if(i=i?W(C,i):"",s=s?W(C,s):"",a>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";e(t,i,s,Number(a))},"viiiij"),se(this.db,this.Ya,0))},s.Database=a};var A,d,h={...s},u="./this.program",p=(e,t)=>{throw t},g="";if(c){var m=Pi;g=__dirname+"/",d=e=>(e=D(e)?new URL(e):e,m.readFileSync(e)),A=async e=>(e=D(e)?new URL(e):e,m.readFileSync(e,void 0)),!s.thisProgram&&1<process.argv.length&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),Fi.exports=s,p=(e,t)=>{throw process.exitCode=e,t}}else(o||l)&&(l?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),l&&(d=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),A=async e=>{if(D(e))return new Promise((t,n)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?t(i.response):n(i.status)},i.onerror=n,i.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)});var b=s.print||function(){}.bind(),f=s.printErr||function(){}.bind();Object.assign(s,h),h=null,s.thisProgram&&(u=s.thisProgram);var v,y,w,C,x,I,E,S,B,Q,j=s.wasmBinary,M=!1,D=e=>e.startsWith("file://");function T(){var e=v.buffer;s.HEAP8=w=new Int8Array(e),s.HEAP16=x=new Int16Array(e),s.HEAPU8=C=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAP32=I=new Int32Array(e),s.HEAPU32=E=new Uint32Array(e),s.HEAPF32=S=new Float32Array(e),s.HEAPF64=Q=new Float64Array(e),s.HEAP64=B=new BigInt64Array(e),s.HEAPU64=new BigUint64Array(e)}var R,O=0,k=null;function L(e){var t;throw null==(t=s.onAbort)||t.call(s,e),f(e="Aborted("+e+")"),M=!0,new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info.")}async function P(e,t){try{var n=await async function(e){if(!j)try{var t=await A(e);return new Uint8Array(t)}catch{}if(e==R&&j)e=new Uint8Array(j);else{if(!d)throw"both async and sync fetching of the wasm failed";e=d(e)}return e}(e);return await WebAssembly.instantiate(n,t)}catch(i){f(`failed to asynchronously prepare wasm: ${i}`),L(i)}}class F{constructor(e){t(this,"name","ExitStatus"),this.message=`Program terminated with exit(${e})`,this.status=e}}var N=e=>{for(;0<e.length;)e.shift()(s)},_=[],G=[],U=()=>{var e=s.preRun.shift();G.unshift(e)};function z(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return w[e];case"i16":return x[e>>1];case"i32":return I[e>>2];case"i64":return B[e>>3];case"float":return S[e>>2];case"double":return Q[e>>3];case"*":return E[e>>2];default:L(`invalid type for getValue: ${t}`)}}var H=s.noExitRuntime||!0;function q(e){var t="i32";switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":w[e]=0;break;case"i16":x[e>>1]=0;break;case"i32":I[e>>2]=0;break;case"i64":B[e>>3]=BigInt(0);break;case"float":S[e>>2]=0;break;case"double":Q[e>>3]=0;break;case"*":E[e>>2]=0;break;default:L(`invalid type for setValue: ${t}`)}}var K="undefined"!=typeof TextDecoder?new TextDecoder:void 0,W=(e,t=0,n=NaN)=>{var i=t+n;for(n=t;e[n]&&!(n>=i);)++n;if(16<n-t&&e.buffer&&K)return K.decode(e.subarray(t,n));for(i="";t<n;){var s=e[t++];if(128&s){var a=63&e[t++];if(192==(224&s))i+=String.fromCharCode((31&s)<<6|a);else{var r=63&e[t++];65536>(s=224==(240&s)?(15&s)<<12|a<<6|r:(7&s)<<18|a<<12|r<<6|63&e[t++])?i+=String.fromCharCode(s):(s-=65536,i+=String.fromCharCode(55296|s>>10,56320|1023&s))}}else i+=String.fromCharCode(s)}return i},V=(e,t)=>e?W(C,e,t):"",Y=(e,t)=>{for(var n=0,i=e.length-1;0<=i;i--){var s=e[i];"."===s?e.splice(i,1):".."===s?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},J=e=>{var t="/"===e.charAt(0),n="/"===e.slice(-1);return(e=Y(e.split("/").filter(e=>!!e),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},X=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.slice(0,-1)),e+t):"."},Z=e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],$=e=>{($=(()=>{if(c){var e=Pi;return t=>e.randomFillSync(t)}return e=>crypto.getRandomValues(e)})())(e)},ee=[],te=e=>{for(var t=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);127>=i?t++:2047>=i?t+=2:55296<=i&&57343>=i?(t+=4,++n):t+=3}return t},ne=(e,t,n,i)=>{if(!(0<i))return 0;var s=n;i=n+i-1;for(var a=0;a<e.length;++a){var r=e.charCodeAt(a);if(55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++a)),127>=r){if(n>=i)break;t[n++]=r}else{if(2047>=r){if(n+1>=i)break;t[n++]=192|r>>6}else{if(65535>=r){if(n+2>=i)break;t[n++]=224|r>>12}else{if(n+3>=i)break;t[n++]=240|r>>18,t[n++]=128|r>>12&63}t[n++]=128|r>>6&63}t[n++]=128|63&r}}return t[n]=0,n-s},ie=(e,t)=>{var n=Array(te(e)+1);return e=ne(e,n,0,n.length),t&&(n.length=e),n},se=[];function ae(e,t){se[e]={input:[],output:[],cb:t},Fe(e,re)}var re={open(e){var t=se[e.node.rdev];if(!t)throw new ve(43);e.tty=t,e.seekable=!1},close(e){e.tty.cb.fsync(e.tty)},fsync(e){e.tty.cb.fsync(e.tty)},read(e,t,n,i){if(!e.tty||!e.tty.cb.xb)throw new ve(60);for(var s=0,a=0;a<i;a++){try{var r=e.tty.cb.xb(e.tty)}catch(o){throw new ve(29)}if(void 0===r&&0===s)throw new ve(6);if(null==r)break;s++,t[n+a]=r}return s&&(e.node.atime=Date.now()),s},write(e,t,n,i){if(!e.tty||!e.tty.cb.qb)throw new ve(60);try{for(var s=0;s<i;s++)e.tty.cb.qb(e.tty,t[n+s])}catch(a){throw new ve(29)}return i&&(e.node.mtime=e.node.ctime=Date.now()),s}},oe={xb(){e:{if(!ee.length){var e=null;if(c){var t=Buffer.alloc(256),n=0,i=process.stdin.fd;try{n=m.readSync(i,t,0,256)}catch(s){if(!s.toString().includes("EOF"))throw s;n=0}0<n&&(e=t.slice(0,n).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&null!==(e=window.prompt("Input: "))&&(e+="\n");if(!e){e=null;break e}ee=ie(e,!0)}e=ee.shift()}return e},qb(e,t){null===t||10===t?(b(W(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){var t;0<(null==(t=e.output)?void 0:t.length)&&(b(W(e.output)),e.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},le={qb(e,t){null===t||10===t?(f(W(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){var t;0<(null==(t=e.output)?void 0:t.length)&&(f(W(e.output)),e.output=[])}},ce={Wa:null,Xa:()=>ce.createNode(null,"/",16895,0),createNode(e,t,n,i){if(24576==(61440&n)||4096==(61440&n))throw new ve(63);return ce.Wa||(ce.Wa={dir:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua,lookup:ce.La.lookup,hb:ce.La.hb,rename:ce.La.rename,unlink:ce.La.unlink,rmdir:ce.La.rmdir,readdir:ce.La.readdir,symlink:ce.La.symlink},stream:{Va:ce.Ma.Va}},file:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua},stream:{Va:ce.Ma.Va,read:ce.Ma.read,write:ce.Ma.write,ib:ce.Ma.ib,jb:ce.Ma.jb}},link:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua,readlink:ce.La.readlink},stream:{}},ub:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua},stream:Pe}}),Qe((n=Be(e,t,n,i)).mode)?(n.La=ce.Wa.dir.node,n.Ma=ce.Wa.dir.stream,n.Na={}):32768==(61440&n.mode)?(n.La=ce.Wa.file.node,n.Ma=ce.Wa.file.stream,n.Ra=0,n.Na=null):40960==(61440&n.mode)?(n.La=ce.Wa.link.node,n.Ma=ce.Wa.link.stream):8192==(61440&n.mode)&&(n.La=ce.Wa.ub.node,n.Ma=ce.Wa.ub.stream),n.atime=n.mtime=n.ctime=Date.now(),e&&(e.Na[t]=n,e.atime=e.mtime=e.ctime=n.atime),n},Sb:e=>e.Na?e.Na.subarray?e.Na.subarray(0,e.Ra):new Uint8Array(e.Na):new Uint8Array(0),La:{Ta(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Qe(e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.Ra:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},Ua(e,t){for(var n of["mode","atime","mtime","ctime"])null!=t[n]&&(e[n]=t[n]);void 0!==t.size&&(t=t.size,e.Ra!=t&&(0==t?(e.Na=null,e.Ra=0):(n=e.Na,e.Na=new Uint8Array(t),n&&e.Na.set(n.subarray(0,Math.min(t,e.Ra))),e.Ra=t)))},lookup(){throw ce.vb},hb:(e,t,n,i)=>ce.createNode(e,t,n,i),rename(e,t,n){try{var i=Se(t,n)}catch(a){}if(i){if(Qe(e.mode))for(var s in i.Na)throw new ve(55);Ee(i)}delete e.parent.Na[e.name],t.Na[n]=e,e.name=n,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.Na[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var n,i=Se(e,t);for(n in i.Na)throw new ve(55);delete e.Na[t],e.ctime=e.mtime=Date.now()},readdir:e=>[".","..",...Object.keys(e.Na)],symlink:(e,t,n)=>((e=ce.createNode(e,t,41471,0)).link=n,e),readlink(e){if(40960!=(61440&e.mode))throw new ve(28);return e.link}},Ma:{read(e,t,n,i,s){var a=e.node.Na;if(s>=e.node.Ra)return 0;if(8<(e=Math.min(e.node.Ra-s,i))&&a.subarray)t.set(a.subarray(s,s+e),n);else for(i=0;i<e;i++)t[n+i]=a[s+i];return e},write(e,t,n,i,s,a){if(t.buffer===w.buffer&&(a=!1),!i)return 0;if((e=e.node).mtime=e.ctime=Date.now(),t.subarray&&(!e.Na||e.Na.subarray)){if(a)return e.Na=t.subarray(n,n+i),e.Ra=i;if(0===e.Ra&&0===s)return e.Na=t.slice(n,n+i),e.Ra=i;if(s+i<=e.Ra)return e.Na.set(t.subarray(n,n+i),s),i}a=s+i;var r=e.Na?e.Na.length:0;if(r>=a||(a=Math.max(a,r*(1048576>r?2:1.125)>>>0),0!=r&&(a=Math.max(a,256)),r=e.Na,e.Na=new Uint8Array(a),0<e.Ra&&e.Na.set(r.subarray(0,e.Ra),0)),e.Na.subarray&&t.subarray)e.Na.set(t.subarray(n,n+i),s);else for(a=0;a<i;a++)e.Na[s+a]=t[n+a];return e.Ra=Math.max(e.Ra,s+i),i},Va(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.node.mode)&&(t+=e.node.Ra),0>t)throw new ve(28);return t},ib(e,t,n,i,s){if(32768!=(61440&e.node.mode))throw new ve(43);if(e=e.node.Na,2&s||!e||e.buffer!==w.buffer){s=!0,i=65536*Math.ceil(t/65536);var a=St(65536,i);if(a&&C.fill(0,a,a+i),!(i=a))throw new ve(48);e&&((0<n||n+t<e.length)&&(e=e.subarray?e.subarray(n,n+t):Array.prototype.slice.call(e,n,n+t)),w.set(e,i))}else s=!1,i=e.byteOffset;return{Kb:i,Ab:s}},jb:(e,t,n,i)=>(ce.Ma.write(e,t,0,i,n,!1),0)}},Ae=(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},de=null,he={},ue=[],pe=1,ge=null,me=!1,be=!0,fe={},ve=class{constructor(e){t(this,"name","ErrnoError"),this.Pa=e}},ye=class{constructor(){t(this,"gb",{}),t(this,"node",null)}get flags(){return this.gb.flags}set flags(e){this.gb.flags=e}get position(){return this.gb.position}set position(e){this.gb.position=e}},we=class{constructor(e,n,i,s){t(this,"La",{}),t(this,"Ma",{}),t(this,"ab",null),e||(e=this),this.parent=e,this.Xa=e.Xa,this.id=pe++,this.name=n,this.mode=i,this.rdev=s,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(e){e?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(e){e?this.mode|=146:this.mode&=-147}};function Ce(e,t={}){if(!e)throw new ve(44);t.nb??(t.nb=!0),"/"===e.charAt(0)||(e="//"+e);var n=0;e:for(;40>n;n++){e=e.split("/").filter(e=>!!e);for(var i=de,s="/",a=0;a<e.length;a++){var r=a===e.length-1;if(r&&t.parent)break;if("."!==e[a])if(".."===e[a])s=X(s),i=i.parent;else{s=J(s+"/"+e[a]);try{i=Se(i,e[a])}catch(o){if(44===(null==o?void 0:o.Pa)&&r&&t.Jb)return{path:s};throw o}if(!i.ab||r&&!t.nb||(i=i.ab.root),40960==(61440&i.mode)&&(!r||t.$a)){if(!i.La.readlink)throw new ve(52);"/"===(i=i.La.readlink(i)).charAt(0)||(i=X(s)+"/"+i),e=i+"/"+e.slice(a+1).join("/");continue e}}}return{path:s,node:i}}throw new ve(32)}function xe(e){for(var t;;){if(e===e.parent)return e=e.Xa.zb,t?"/"!==e[e.length-1]?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function Ie(e,t){for(var n=0,i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i)|0;return(e+n>>>0)%ge.length}function Ee(e){var t=Ie(e.parent.id,e.name);if(ge[t]===e)ge[t]=e.bb;else for(t=ge[t];t;){if(t.bb===e){t.bb=e.bb;break}t=t.bb}}function Se(e,t){var n=Qe(e.mode)?(n=Me(e,"x"))?n:e.La.lookup?0:2:54;if(n)throw new ve(n);for(n=ge[Ie(e.id,t)];n;n=n.bb){var i=n.name;if(n.parent.id===e.id&&i===t)return n}return e.La.lookup(e,t)}function Be(e,t,n,i){return t=Ie((e=new we(e,t,n,i)).parent.id,e.name),e.bb=ge[t],ge[t]=e}function Qe(e){return 16384==(61440&e)}function je(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function Me(e,t){return be?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2}function De(e,t){if(!Qe(e.mode))return 54;try{return Se(e,t),20}catch(n){}return Me(e,"wx")}function Te(e,t,n){try{var i=Se(e,t)}catch(s){return s.Pa}if(e=Me(e,"wx"))return e;if(n){if(!Qe(i.mode))return 54;if(i===i.parent||"/"===xe(i))return 10}else if(Qe(i.mode))return 31;return 0}function Re(e){if(!e)throw new ve(63);return e}function Oe(e){if(!(e=ue[e]))throw new ve(8);return e}function ke(e,t=-1){if(e=Object.assign(new ye,e),-1==t)e:{for(t=0;4096>=t;t++)if(!ue[t])break e;throw new ve(33)}return e.fd=t,ue[t]=e}function Le(e,t,n){var i=null==e?void 0:e.Ma.Ua;e=i?e:t,i??(i=t.La.Ua),Re(i),i(e,n)}var Pe={open(e){var t,n;e.Ma=he[e.node.rdev].Ma,null==(n=(t=e.Ma).open)||n.call(t,e)},Va(){throw new ve(70)}};function Fe(e,t){he[e]={Ma:t}}function Ne(e,t){var n="/"===t;if(n&&de)throw new ve(10);if(!n&&t){var i=Ce(t,{nb:!1});if(t=i.path,(i=i.node).ab)throw new ve(10);if(!Qe(i.mode))throw new ve(54)}t={type:e,Wb:{},zb:t,Ib:[]},(e=e.Xa(t)).Xa=t,t.root=e,n?de=e:i&&(i.ab=t,i.Xa&&i.Xa.Ib.push(t))}function _e(e,t,n){var i=Ce(e,{parent:!0}).node;if(!(e=Z(e)))throw new ve(28);if("."===e||".."===e)throw new ve(20);var s=De(i,e);if(s)throw new ve(s);if(!i.La.hb)throw new ve(63);return i.La.hb(i,e,t,n)}function Ge(e,t=511){return _e(e,1023&t|16384,0)}function Ue(e,t,n){void 0===n&&(n=t,t=438),_e(e,8192|t,n)}function ze(e,t){if(!((...e)=>{for(var t="",n=!1,i=e.length-1;-1<=i&&!n;i--){if("string"!=typeof(n=0<=i?e[i]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,n="/"===n.charAt(0)}return(n?"/":"")+(t=Y(t.split("/").filter(e=>!!e),!n).join("/"))||"."})(e))throw new ve(44);var n=Ce(t,{parent:!0}).node;if(!n)throw new ve(44);var i=De(n,t=Z(t));if(i)throw new ve(i);if(!n.La.symlink)throw new ve(63);n.La.symlink(n,t,e)}function He(e){var t=Ce(e,{parent:!0}).node,n=Se(t,e=Z(e)),i=Te(t,e,!0);if(i)throw new ve(i);if(!t.La.rmdir)throw new ve(63);if(n.ab)throw new ve(10);t.La.rmdir(t,e),Ee(n)}function qe(e){var t=Ce(e,{parent:!0}).node;if(!t)throw new ve(44);var n=Se(t,e=Z(e)),i=Te(t,e,!1);if(i)throw new ve(i);if(!t.La.unlink)throw new ve(63);if(n.ab)throw new ve(10);t.La.unlink(t,e),Ee(n)}function Ke(e,t){return Re((e=Ce(e,{$a:!t}).node).La.Ta)(e)}function We(e,t,n,i){Le(e,t,{mode:4095&n|-4096&t.mode,ctime:Date.now(),Fb:i})}function Ve(e,t){We(null,e="string"==typeof e?Ce(e,{$a:!0}).node:e,t)}function Ye(e,t,n){if(Qe(t.mode))throw new ve(31);if(32768!=(61440&t.mode))throw new ve(28);var i=Me(t,"w");if(i)throw new ve(i);Le(e,t,{size:n,timestamp:Date.now()})}function Je(e,t,n=438){if(""===e)throw new ve(44);if("string"==typeof t){var i={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(void 0===i)throw Error(`Unknown file open mode: ${t}`);t=i}if(n=64&t?4095&n|32768:0,"object"==typeof e)i=e;else{var a=e.endsWith("/");i=(e=Ce(e,{$a:!(131072&t),Jb:!0})).node,e=e.path}var r=!1;if(64&t)if(i){if(128&t)throw new ve(20)}else{if(a)throw new ve(31);i=_e(e,511|n,0),r=!0}if(!i)throw new ve(44);if(8192==(61440&i.mode)&&(t&=-513),65536&t&&!Qe(i.mode))throw new ve(54);if(!r&&(a=i?40960==(61440&i.mode)?32:Qe(i.mode)&&("r"!==je(t)||576&t)?31:Me(i,je(t)):44))throw new ve(a);return 512&t&&!r&&Ye(null,a="string"==typeof(a=i)?Ce(a,{$a:!0}).node:a,0),t&=-131713,(a=ke({node:i,path:xe(i),flags:t,seekable:!0,position:0,Ma:i.Ma,Lb:[],error:!1})).Ma.open&&a.Ma.open(a),r&&Ve(i,511&n),!s.logReadFiles||1&t||e in fe||(fe[e]=1),a}function Xe(e){if(null===e.fd)throw new ve(8);e.ob&&(e.ob=null);try{e.Ma.close&&e.Ma.close(e)}catch(t){throw t}finally{ue[e.fd]=null}e.fd=null}function Ze(e,t,n){if(null===e.fd)throw new ve(8);if(!e.seekable||!e.Ma.Va)throw new ve(70);if(0!=n&&1!=n&&2!=n)throw new ve(28);e.position=e.Ma.Va(e,t,n),e.Lb=[]}function $e(e,t,n,i,s){if(0>i||0>s)throw new ve(28);if(null===e.fd)throw new ve(8);if(1==(2097155&e.flags))throw new ve(8);if(Qe(e.node.mode))throw new ve(31);if(!e.Ma.read)throw new ve(28);var a=void 0!==s;if(a){if(!e.seekable)throw new ve(70)}else s=e.position;return t=e.Ma.read(e,t,n,i,s),a||(e.position+=t),t}function et(e,t,n,i,s){if(0>i||0>s)throw new ve(28);if(null===e.fd)throw new ve(8);if(!(2097155&e.flags))throw new ve(8);if(Qe(e.node.mode))throw new ve(31);if(!e.Ma.write)throw new ve(28);e.seekable&&1024&e.flags&&Ze(e,0,2);var a=void 0!==s;if(a){if(!e.seekable)throw new ve(70)}else s=e.position;return t=e.Ma.write(e,t,n,i,s,void 0),a||(e.position+=t),t}function tt(e,t,n){e=J("/dev/"+e);var i=Ae(!!t,!!n);tt.yb??(tt.yb=64);var s=tt.yb++<<8;Fe(s,{open(e){e.seekable=!1},close(){var e;(null==(e=null==n?void 0:n.buffer)?void 0:e.length)&&n(10)},read(e,n,i,s){for(var a=0,r=0;r<s;r++){try{var o=t()}catch(l){throw new ve(29)}if(void 0===o&&0===a)throw new ve(6);if(null==o)break;a++,n[i+r]=o}return a&&(e.node.atime=Date.now()),a},write(e,t,i,s){for(var a=0;a<s;a++)try{n(t[i+a])}catch(r){throw new ve(29)}return s&&(e.node.mtime=e.node.ctime=Date.now()),a}}),Ue(e,i,s)}function nt(e,t,n){if("/"===t.charAt(0))return t;if(e=-100===e?"/":Oe(e).path,0==t.length){if(!n)throw new ve(44);return e}return e+"/"+t}function it(e,t){I[e>>2]=t.dev,I[e+4>>2]=t.mode,E[e+8>>2]=t.nlink,I[e+12>>2]=t.uid,I[e+16>>2]=t.gid,I[e+20>>2]=t.rdev,B[e+24>>3]=BigInt(t.size),I[e+32>>2]=4096,I[e+36>>2]=t.blocks;var n=t.atime.getTime(),i=t.mtime.getTime(),s=t.ctime.getTime();return B[e+40>>3]=BigInt(Math.floor(n/1e3)),E[e+48>>2]=n%1e3*1e6,B[e+56>>3]=BigInt(Math.floor(i/1e3)),E[e+64>>2]=i%1e3*1e6,B[e+72>>3]=BigInt(Math.floor(s/1e3)),E[e+80>>2]=s%1e3*1e6,B[e+88>>3]=BigInt(t.ino),0}var st,at,rt,ot=void 0,lt=()=>{var e=I[+ot>>2];return ot+=4,e},ct=0,At=[0,31,60,91,121,152,182,213,244,274,305,335],dt=[0,31,59,90,120,151,181,212,243,273,304,334],ht={},ut=e=>{var t;y=e,H||0<ct||(null==(t=s.onExit)||t.call(s,e),M=!0),p(e,new F(e))},pt={},gt=()=>{if(!st){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(e in pt)void 0===pt[e]?delete t[e]:t[e]=pt[e];var n=[];for(e in t)n.push(`${e}=${t[e]}`);st=n}return st},mt=e=>{var t=te(e)+1,n=jt(t);return ne(e,C,n,t),n},bt=0,ft=(e,t)=>(t=1==t?jt(e.length):It(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),C.set(e,t),t),vt=[],yt=e=>{at.delete(rt.get(e)),rt.set(e,null),vt.push(e)},wt=(e,t)=>{if(!at){at=new WeakMap;var n=rt.length;if(at)for(var i=0;i<0+n;i++){var s=rt.get(i);s&&at.set(s,i)}}if(n=at.get(e)||0)return n;if(vt.length)n=vt.pop();else{try{rt.grow(1)}catch(l){if(!(l instanceof RangeError))throw l;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}n=rt.length-1}try{rt.set(n,e)}catch(l){if(!(l instanceof TypeError))throw l;if("function"==typeof WebAssembly.Function){var a=WebAssembly.Function;i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},s={parameters:[],results:"v"==t[0]?[]:[i[t[0]]]};for(var r=1;r<t.length;++r)s.parameters.push(i[t[r]]);t=new a(s,e)}else{i=[1],s=t.slice(0,1),t=t.slice(1),r={i:127,p:127,j:126,f:125,d:124,e:111},i.push(96);var o=t.length;for(a of(128>o?i.push(o):i.push(o%128|128,o>>7),t))i.push(r[a]);"v"==s?i.push(0):i.push(1,r[s]),t=[0,97,115,109,1,0,0,0,1],128>(a=i.length)?t.push(a):t.push(a%128|128,a>>7),t.push(...i),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}rt.set(n,t)}return at.set(e,n),n};ge=Array(4096),Ne(ce,"/"),Ge("/tmp"),Ge("/home"),Ge("/home/web_user"),function(){Ge("/dev"),Fe(259,{read:()=>0,write:(e,t,n,i)=>i,Va:()=>0}),Ue("/dev/null",259),ae(1280,oe),ae(1536,le),Ue("/dev/tty",1280),Ue("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,n=()=>(0===t&&($(e),t=e.byteLength),e[--t]);tt("random",n),tt("urandom",n),Ge("/dev/shm"),Ge("/dev/shm/tmp")}(),function(){Ge("/proc");var e=Ge("/proc/self");Ge("/proc/self/fd"),Ne({Xa(){var t=Be(e,"fd",16895,73);return t.Ma={Va:ce.Ma.Va},t.La={lookup(e,t){var n=Oe(e=+t);return(e={parent:null,Xa:{zb:"fake"},La:{readlink:()=>n.path},id:e+1}).parent=e},readdir:()=>Array.from(ue.entries()).filter(([,e])=>e).map(([e])=>e.toString())},t}},"/proc/self/fd")}(),ce.vb=new ve(44),ce.vb.stack="<generic error, no stack>";var Ct,xt={a:(e,t,n,i)=>L(`Assertion failed: ${e?W(C,e):""}, at: `+[t?t?W(C,t):"":"unknown filename",n,i?i?W(C,i):"":"unknown function"]),i:function(e,t){try{return Ve(e=e?W(C,e):"",t),0}catch(n){if("ErrnoError"!==n.name)throw n;return-n.Pa}},L:function(e,t,n){try{if(t=nt(e,t=t?W(C,t):""),-8&n)return-28;var i=Ce(t,{$a:!0}).node;return i?(e="",4&n&&(e+="r"),2&n&&(e+="w"),1&n&&(e+="x"),e&&Me(i,e)?-2:0):-44}catch(s){if("ErrnoError"!==s.name)throw s;return-s.Pa}},j:function(e,t){try{var n=Oe(e);return We(n,n.node,t,!1),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},h:function(e){try{var t=Oe(e);return Le(t,t.node,{timestamp:Date.now(),Fb:!1}),0}catch(n){if("ErrnoError"!==n.name)throw n;return-n.Pa}},b:function(e,t,n){ot=n;try{var i=Oe(e);switch(t){case 0:var s=lt();if(0>s)break;for(;ue[s];)s++;return function(e,t=-1){var n,i;return null==(i=null==(n=(e=ke(e,t)).Ma)?void 0:n.Rb)||i.call(n,e),e}(i,s).fd;case 1:case 2:case 13:case 14:return 0;case 3:return i.flags;case 4:return s=lt(),i.flags|=s,0;case 12:return s=lt(),x[s+0>>1]=2,0}return-28}catch(a){if("ErrnoError"!==a.name)throw a;return-a.Pa}},g:function(e,t){try{var n=Oe(e),i=n.node,s=n.Ma.Ta;return e=s?n:i,s??(s=i.La.Ta),Re(s),it(t,s(e))}catch(a){if("ErrnoError"!==a.name)throw a;return-a.Pa}},H:function(e,t){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var n=Oe(e);if(0>t||!(2097155&n.flags))throw new ve(28);return Ye(n,n.node,t),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},G:function(e,t){try{if(0===t)return-28;var n=te("/")+1;return t<n?-68:(ne("/",C,e,t),n)}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},K:function(e,t){try{return it(t,Ke(e=e?W(C,e):"",!0))}catch(n){if("ErrnoError"!==n.name)throw n;return-n.Pa}},C:function(e,t,n){try{return Ge(t=nt(e,t=t?W(C,t):""),n),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},J:function(e,t,n,i){try{t=t?W(C,t):"";var s=256&i;return t=nt(e,t,4096&i),it(n,s?Ke(t,!0):Ke(t))}catch(a){if("ErrnoError"!==a.name)throw a;return-a.Pa}},x:function(e,t,n,i){ot=i;try{return Je(t=nt(e,t=t?W(C,t):""),n,i?lt():0).fd}catch(s){if("ErrnoError"!==s.name)throw s;return-s.Pa}},v:function(e,t,n,i){try{if(t=nt(e,t=t?W(C,t):""),0>=i)return-28;var s=Ce(t).node;if(!s)throw new ve(44);if(!s.La.readlink)throw new ve(28);var a=s.La.readlink(s),r=Math.min(i,te(a)),o=w[n+r];return ne(a,C,n,i+1),w[n+r]=o,r}catch(l){if("ErrnoError"!==l.name)throw l;return-l.Pa}},u:function(e){try{return He(e=e?W(C,e):""),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},f:function(e,t){try{return it(t,Ke(e=e?W(C,e):""))}catch(n){if("ErrnoError"!==n.name)throw n;return-n.Pa}},r:function(e,t,n){try{return t=nt(e,t=t?W(C,t):""),0===n?qe(t):512===n?He(t):L("Invalid flags passed to unlinkat"),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},q:function(e,t,n){try{t=nt(e,t=t?W(C,t):"",!0);var i,s,a=Date.now();if(n){var r=E[n>>2]+4294967296*I[n+4>>2],o=I[n+8>>2];i=1073741823==o?a:1073741822==o?null:1e3*r+o/1e6,r=E[(n+=16)>>2]+4294967296*I[n+4>>2],s=1073741823==(o=I[n+8>>2])?a:1073741822==o?null:1e3*r+o/1e6}else s=i=a;if(null!==(s??i)){e=i;var l=Ce(t,{$a:!0}).node;Re(l.La.Ua)(l,{atime:e,mtime:s})}return 0}catch(c){if("ErrnoError"!==c.name)throw c;return-c.Pa}},m:()=>L(""),l:()=>{H=!1,ct=0},A:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),e=new Date(1e3*e),I[t>>2]=e.getSeconds(),I[t+4>>2]=e.getMinutes(),I[t+8>>2]=e.getHours(),I[t+12>>2]=e.getDate(),I[t+16>>2]=e.getMonth(),I[t+20>>2]=e.getFullYear()-1900,I[t+24>>2]=e.getDay();var n=e.getFullYear();I[t+28>>2]=(0!=n%4||0==n%100&&0!=n%400?dt:At)[e.getMonth()]+e.getDate()-1|0,I[t+36>>2]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var i=new Date(e.getFullYear(),0,1).getTimezoneOffset();I[t+32>>2]=0|(n!=i&&e.getTimezoneOffset()==Math.min(i,n))},y:function(e,t,n,i,s,a,r){s=-9007199254740992>s||9007199254740992<s?NaN:Number(s);try{if(isNaN(s))return 61;var o=Oe(i);if(2&t&&!(2&n)&&2!=(2097155&o.flags))throw new ve(2);if(1==(2097155&o.flags))throw new ve(2);if(!o.Ma.ib)throw new ve(43);if(!e)throw new ve(28);var l=o.Ma.ib(o,e,s,t,n),c=l.Kb;return I[a>>2]=l.Ab,E[r>>2]=c,0}catch(A){if("ErrnoError"!==A.name)throw A;return-A.Pa}},z:function(e,t,n,i,s,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{var r=Oe(s);if(2&n){if(n=a,32768!=(61440&r.node.mode))throw new ve(43);if(!(2&i)){var o=C.slice(e,e+t);r.Ma.jb&&r.Ma.jb(r,o,n,t,i)}}}catch(l){if("ErrnoError"!==l.name)throw l;return-l.Pa}},n:(e,t)=>{if(ht[e]&&(clearTimeout(ht[e].id),delete ht[e]),!t)return 0;var n=setTimeout(()=>{delete ht[e],(e=>{if(!M)try{if(e(),!(H||0<ct))try{y=e=y,ut(e)}catch(t){t instanceof F||"unwind"==t||p(1,t)}}catch(t){t instanceof F||"unwind"==t||p(1,t)}})(()=>Bt(e,performance.now()))},t);return ht[e]={id:n,Xb:t},0},B:(e,t,n,i)=>{var s=(new Date).getFullYear(),a=new Date(s,0,1).getTimezoneOffset();s=new Date(s,6,1).getTimezoneOffset(),E[e>>2]=60*Math.max(a,s),I[t>>2]=Number(a!=s),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(a),t=t(s),s<a?(ne(e,C,n,17),ne(t,C,i,17)):(ne(e,C,i,17),ne(t,C,n,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:e=>{var t=C.length;if(2147483648<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var i=t*(1+.2/n);i=Math.min(i,e+100663296);e:{i=(Math.min(2147483648,65536*Math.ceil(Math.max(e,i)/65536))-v.buffer.byteLength+65535)/65536|0;try{v.grow(i),T();var s=1;break e}catch(a){}s=void 0}if(s)return!0}return!1},E:(e,t)=>{var n=0;return gt().forEach((i,s)=>{var a=t+n;for(s=E[e+4*s>>2]=a,a=0;a<i.length;++a)w[s++]=i.charCodeAt(a);w[s]=0,n+=i.length+1}),0},F:(e,t)=>{var n=gt();E[e>>2]=n.length;var i=0;return n.forEach(e=>i+=e.length+1),E[t>>2]=i,0},e:function(e){try{return Xe(Oe(e)),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},p:function(e,t){try{var n=Oe(e);return w[t]=n.tty?2:Qe(n.mode)?3:40960==(61440&n.mode)?7:4,x[t+2>>1]=0,B[t+8>>3]=BigInt(0),B[t+16>>3]=BigInt(0),0}catch(i){if("ErrnoError"!==i.name)throw i;return i.Pa}},w:function(e,t,n,i){try{e:{var s=Oe(e);e=t;for(var a,r=t=0;r<n;r++){var o=E[e>>2],l=E[e+4>>2];e+=8;var c=$e(s,w,o,l,a);if(0>c){var A=-1;break e}if(t+=c,c<l)break;void 0!==a&&(a+=c)}A=t}return E[i>>2]=A,0}catch(d){if("ErrnoError"!==d.name)throw d;return d.Pa}},D:function(e,t,n,i){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var s=Oe(e);return Ze(s,t,n),B[i>>3]=BigInt(s.position),s.ob&&0===t&&0===n&&(s.ob=null),0}catch(a){if("ErrnoError"!==a.name)throw a;return a.Pa}},I:function(e){var t;try{var n=Oe(e);return(null==(t=n.Ma)?void 0:t.fsync)?n.Ma.fsync(n):0}catch(i){if("ErrnoError"!==i.name)throw i;return i.Pa}},t:function(e,t,n,i){try{e:{var s=Oe(e);e=t;for(var a,r=t=0;r<n;r++){var o=E[e>>2],l=E[e+4>>2];e+=8;var c=et(s,w,o,l,a);if(0>c){var A=-1;break e}if(t+=c,c<l)break;void 0!==a&&(a+=c)}A=t}return E[i>>2]=A,0}catch(d){if("ErrnoError"!==d.name)throw d;return d.Pa}},k:ut};!async function(){var e;function t(e){var t;return Ct=e.exports,v=Ct.M,T(),rt=Ct.O,O--,null==(t=s.monitorRunDependencies)||t.call(s,O),0==O&&k&&(e=k,k=null,e()),Ct}O++,null==(e=s.monitorRunDependencies)||e.call(s,O);var n={a:xt};s.instantiateWasm?new Promise(e=>{s.instantiateWasm(n,(n,i)=>{t(n),e(n.exports)})}):(R??(R=s.locateFile?s.locateFile("sql-wasm.wasm",g):g+"sql-wasm.wasm"),t((await async function(e){var t=R;if(!j&&"function"==typeof WebAssembly.instantiateStreaming&&!D(t)&&!c)try{var n=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(n,e)}catch(i){f(`wasm streaming compile failed: ${i}`),f("falling back to ArrayBuffer instantiation")}return P(t,e)}(n)).instance))}(),s._sqlite3_free=e=>(s._sqlite3_free=Ct.P)(e),s._sqlite3_value_text=e=>(s._sqlite3_value_text=Ct.Q)(e),s._sqlite3_prepare_v2=(e,t,n,i,a)=>(s._sqlite3_prepare_v2=Ct.R)(e,t,n,i,a),s._sqlite3_step=e=>(s._sqlite3_step=Ct.S)(e),s._sqlite3_reset=e=>(s._sqlite3_reset=Ct.T)(e),s._sqlite3_exec=(e,t,n,i,a)=>(s._sqlite3_exec=Ct.U)(e,t,n,i,a),s._sqlite3_finalize=e=>(s._sqlite3_finalize=Ct.V)(e),s._sqlite3_column_name=(e,t)=>(s._sqlite3_column_name=Ct.W)(e,t),s._sqlite3_column_text=(e,t)=>(s._sqlite3_column_text=Ct.X)(e,t),s._sqlite3_column_type=(e,t)=>(s._sqlite3_column_type=Ct.Y)(e,t),s._sqlite3_errmsg=e=>(s._sqlite3_errmsg=Ct.Z)(e),s._sqlite3_clear_bindings=e=>(s._sqlite3_clear_bindings=Ct._)(e),s._sqlite3_value_blob=e=>(s._sqlite3_value_blob=Ct.$)(e),s._sqlite3_value_bytes=e=>(s._sqlite3_value_bytes=Ct.aa)(e),s._sqlite3_value_double=e=>(s._sqlite3_value_double=Ct.ba)(e),s._sqlite3_value_int=e=>(s._sqlite3_value_int=Ct.ca)(e),s._sqlite3_value_type=e=>(s._sqlite3_value_type=Ct.da)(e),s._sqlite3_result_blob=(e,t,n,i)=>(s._sqlite3_result_blob=Ct.ea)(e,t,n,i),s._sqlite3_result_double=(e,t)=>(s._sqlite3_result_double=Ct.fa)(e,t),s._sqlite3_result_error=(e,t,n)=>(s._sqlite3_result_error=Ct.ga)(e,t,n),s._sqlite3_result_int=(e,t)=>(s._sqlite3_result_int=Ct.ha)(e,t),s._sqlite3_result_int64=(e,t)=>(s._sqlite3_result_int64=Ct.ia)(e,t),s._sqlite3_result_null=e=>(s._sqlite3_result_null=Ct.ja)(e),s._sqlite3_result_text=(e,t,n,i)=>(s._sqlite3_result_text=Ct.ka)(e,t,n,i),s._sqlite3_aggregate_context=(e,t)=>(s._sqlite3_aggregate_context=Ct.la)(e,t),s._sqlite3_column_count=e=>(s._sqlite3_column_count=Ct.ma)(e),s._sqlite3_data_count=e=>(s._sqlite3_data_count=Ct.na)(e),s._sqlite3_column_blob=(e,t)=>(s._sqlite3_column_blob=Ct.oa)(e,t),s._sqlite3_column_bytes=(e,t)=>(s._sqlite3_column_bytes=Ct.pa)(e,t),s._sqlite3_column_double=(e,t)=>(s._sqlite3_column_double=Ct.qa)(e,t),s._sqlite3_bind_blob=(e,t,n,i,a)=>(s._sqlite3_bind_blob=Ct.ra)(e,t,n,i,a),s._sqlite3_bind_double=(e,t,n)=>(s._sqlite3_bind_double=Ct.sa)(e,t,n),s._sqlite3_bind_int=(e,t,n)=>(s._sqlite3_bind_int=Ct.ta)(e,t,n),s._sqlite3_bind_text=(e,t,n,i,a)=>(s._sqlite3_bind_text=Ct.ua)(e,t,n,i,a),s._sqlite3_bind_parameter_index=(e,t)=>(s._sqlite3_bind_parameter_index=Ct.va)(e,t),s._sqlite3_sql=e=>(s._sqlite3_sql=Ct.wa)(e),s._sqlite3_normalized_sql=e=>(s._sqlite3_normalized_sql=Ct.xa)(e),s._sqlite3_changes=e=>(s._sqlite3_changes=Ct.ya)(e),s._sqlite3_close_v2=e=>(s._sqlite3_close_v2=Ct.za)(e),s._sqlite3_create_function_v2=(e,t,n,i,a,r,o,l,c)=>(s._sqlite3_create_function_v2=Ct.Aa)(e,t,n,i,a,r,o,l,c),s._sqlite3_update_hook=(e,t,n)=>(s._sqlite3_update_hook=Ct.Ba)(e,t,n),s._sqlite3_open=(e,t)=>(s._sqlite3_open=Ct.Ca)(e,t);var It=s._malloc=e=>(It=s._malloc=Ct.Da)(e),Et=s._free=e=>(Et=s._free=Ct.Ea)(e);s._RegisterExtensionFunctions=e=>(s._RegisterExtensionFunctions=Ct.Fa)(e);var St=(e,t)=>(St=Ct.Ga)(e,t),Bt=(e,t)=>(Bt=Ct.Ha)(e,t),Qt=e=>(Qt=Ct.Ia)(e),jt=e=>(jt=Ct.Ja)(e),Mt=()=>(Mt=Ct.Ka)();if(s.stackSave=()=>Mt(),s.stackRestore=e=>Qt(e),s.stackAlloc=e=>jt(e),s.cwrap=(e,t,n,i)=>{var a=!n||n.every(e=>"number"===e||"boolean"===e);return"string"!==t&&a&&!i?s["_"+e]:(...i)=>((e,t,n,i)=>{var a={string:e=>{var t=0;return null!=e&&0!==e&&(t=mt(e)),t},array:e=>{var t=jt(e.length);return w.set(e,t),t}};e=s["_"+e];var r,o=[],l=0;if(i)for(var c=0;c<i.length;c++){var A=a[n[c]];A?(0===l&&(l=Mt()),o[c]=A(i[c])):o[c]=i[c]}return n=e(...o),r=n,0!==l&&Qt(l),"string"===t?r?W(C,r):"":"boolean"===t?!!r:r})(e,t,n,i)},s.addFunction=wt,s.removeFunction=yt,s.UTF8ToString=V,s.ALLOC_NORMAL=bt,s.allocate=ft,s.allocateUTF8OnStack=mt,s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);0<s.preInit.length;)s.preInit.pop()();return function e(){function t(){var e;if(s.calledRun=!0,!M){var t,n;if(s.noFSInit||me||(me=!0,i??(i=s.stdin),t??(t=s.stdout),n??(n=s.stderr),i?tt("stdin",i):ze("/dev/tty","/dev/stdin"),t?tt("stdout",null,t):ze("/dev/tty","/dev/stdout"),n?tt("stderr",null,n):ze("/dev/tty1","/dev/stderr"),Je("/dev/stdin",0),Je("/dev/stdout",1),Je("/dev/stderr",1)),Ct.N(),be=!1,null==(e=s.onRuntimeInitialized)||e.call(s),s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;){var i=s.postRun.shift();_.unshift(i)}N(_)}}if(0<O)k=e;else{if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)U();N(G),0<O?k=e:s.setStatus?(s.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>s.setStatus(""),1),t()},1)):t()}}(),a}))},(Fi=Li).exports=_i,Fi.exports.default=_i;const Gi=a(Li.exports),Ui="sqlite_db",zi="sqlite";let Hi=null,qi=null,Ki=null;const Wi="Web3DModelEditorDB",Vi="customMeshes",Yi="sqlite_legacy_migrated_v1",Ji="sqlite_maps_migrated_v1";function Xi(e){let t="";for(let n=0;n<e.length;n+=32768){const i=e.subarray(n,Math.min(n+32768,e.length));t+=String.fromCharCode.apply(null,Array.from(i))}return btoa(t)}function Zi(e){return e instanceof Uint8Array?Xi(e):Xi(new Uint8Array(e))}function $i(e){if(!e)return new Uint8Array(0);const t=atob(e),n=t.length,i=new Uint8Array(n);for(let s=0;s<n;s++)i[s]=t.charCodeAt(s);return i}function es(){return new Promise((e,t)=>{const n=indexedDB.open("Web3DModelEditorSQLite",1);n.onupgradeneeded=()=>{const e=n.result;e.objectStoreNames.contains(zi)||e.createObjectStore(zi)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async function ts(){const e=await async function(e){try{const t=await es();return await new Promise((n,i)=>{const s=t.transaction(zi,"readonly").objectStore(zi).get(e);s.onsuccess=()=>n(s.result||null),s.onerror=()=>i(s.error)})}catch{return null}}(Ui);if(e)try{const t=await(e.arrayBuffer?e.arrayBuffer():e);return new Uint8Array(t)}catch{}try{const e=localStorage.getItem(Ui);return e?Uint8Array.from(atob(e),e=>e.charCodeAt(0)):null}catch{return null}}async function ns(){try{const e=qi.export();await async function(e,t){try{const n=await es();return await new Promise((i,s)=>{const a=n.transaction(zi,"readwrite").objectStore(zi).put(t,e);a.onsuccess=()=>i(),a.onerror=()=>s(a.error)})}catch(n){}}(Ui,new Blob([e],{type:"application/octet-stream"}));try{const t=Zi(e);localStorage.setItem(Ui,t)}catch{}}catch(e){}}function is(e){let t=!1;try{(function(e,t,n){try{const i=e.prepare(`PRAGMA table_info(${t});`);for(;i.step();){const e=i.getAsObject();if(String(e.name)===String(n))return i.free(),!0}i.free()}catch{}return!1})(e,"custom_meshes","thumbnail_str")||(e.exec("ALTER TABLE custom_meshes ADD COLUMN thumbnail_str TEXT;"),t=!0)}catch(n){}return t}async function ss(){if(qi){try{is(qi)&&as()}catch{}return qi}return Ki||(Ki=(async()=>{Hi=await Gi({locateFile:e=>e.endsWith("sql-wasm.wasm")?"/assets/sql-wasm-0734155c.wasm":e});const e=await ts();qi=e?new Hi.Database(e):new Hi.Database,qi.exec("\nCREATE TABLE IF NOT EXISTS app_settings (\n  key TEXT PRIMARY KEY,\n  value TEXT\n);\nCREATE TABLE IF NOT EXISTS custom_meshes (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  -- Deprecated: data_b64 / thumbnail_b64 kept for backward-compat; new flow stores blobs in IDB\n  data_b64 TEXT,\n  thumbnail_b64 TEXT,\n  -- Optional lightweight string metadata for thumbnail (e.g. mime or note)\n  thumbnail_str TEXT,\n  created_at INTEGER\n);\nCREATE TABLE IF NOT EXISTS saved_maps (\n  name TEXT PRIMARY KEY,\n  data_json TEXT,\n  version INTEGER,\n  updated_at INTEGER\n);\n");try{is(qi)&&as()}catch{}try{localStorage.getItem(Yi)||(await async function(){if("undefined"==typeof indexedDB)return;const e=await new Promise(e=>{const t=indexedDB.open(Wi);t.onerror=()=>e(null),t.onsuccess=()=>{const n=t.result;try{if(!n.objectStoreNames||!n.objectStoreNames.contains(Vi))return e([]);const t=n.transaction(Vi,"readonly"),i=t.objectStore(Vi).getAll();i.onsuccess=()=>e(i.result||[]),i.onerror=()=>e(null)}catch(i){e([])}}});if(!e||!Array.isArray(e)||0===e.length)return;for(const t of e)try{await cs({id:t.id,name:t.name,glbData:t.glbData,thumbnail:t.thumbnail})}catch{}}(),localStorage.setItem(Yi,"1"),as())}catch(t){}try{localStorage.getItem(Ji)||(await async function(){try{const e=Object.keys(localStorage||{}).filter(e=>e.startsWith("map_"));if(0===e.length)return;for(const t of e)try{const e=localStorage.getItem(t);if(!e)continue;const n=JSON.parse(e);if(!n||"object"!=typeof n)continue;"__version"in n||(n.__version=1);const i=t.substring(4);await ds(i,n,n.__version||1)}catch{}}catch{}}(),localStorage.setItem(Ji,"1"),as())}catch(t){}return qi})()),Ki}function as(){qi&&ns()}async function rs(e,t){const n=await ss(),i=JSON.stringify(t??null),s=n.prepare("INSERT INTO app_settings(key, value) VALUES(?, ?)\nON CONFLICT(key) DO UPDATE SET value=excluded.value");s.run([e,i]),s.free(),as()}async function os(e){const t=(await ss()).prepare("SELECT value FROM app_settings WHERE key = ?");let n=null;if(t.step())try{n=JSON.parse(t.getAsObject().value)}catch{n=null}return t.free(),n}async function ls(){const e=await ss(),t=[];let n;try{n=e.prepare("SELECT id, name, data_b64, thumbnail_b64, thumbnail_str, created_at FROM custom_meshes ORDER BY created_at ASC")}catch{n=e.prepare("SELECT id, name, data_b64, thumbnail_b64, created_at FROM custom_meshes ORDER BY created_at ASC")}for(;n.step();){const e=n.getAsObject();t.push({id:e.id,name:e.name,glbData:e.data_b64?$i(e.data_b64).buffer:null,thumbnail:e.thumbnail_b64||e.thumbnail_str||null,createdAt:e.created_at})}return n.free(),t}async function cs(e){const t=await ss(),{id:n,name:i,data:s,glbData:a,thumbnail:r,thumbnailStr:o}=e,l=s||a||null,c=l?Zi(l instanceof Uint8Array?l:new Uint8Array(l)):null,A="string"==typeof r?r:null,d="string"==typeof o?o:null,h=Date.now();let u;try{u=t.prepare("INSERT INTO custom_meshes(id, name, data_b64, thumbnail_b64, thumbnail_str, created_at) VALUES(?, ?, ?, ?, ?, ?)\nON CONFLICT(id) DO UPDATE SET name=excluded.name, data_b64=excluded.data_b64, thumbnail_b64=excluded.thumbnail_b64, thumbnail_str=excluded.thumbnail_str"),u.run([n,i??"",c,A,d,h]),u.free()}catch{u=t.prepare("INSERT INTO custom_meshes(id, name, data_b64, thumbnail_b64, created_at) VALUES(?, ?, ?, ?, ?)\nON CONFLICT(id) DO UPDATE SET name=excluded.name, data_b64=excluded.data_b64, thumbnail_b64=excluded.thumbnail_b64"),u.run([n,i??"",c,A,h]),u.free()}as()}async function As(e){const t=(await ss()).prepare("DELETE FROM custom_meshes WHERE id = ?");t.run([e]),t.free(),as()}async function ds(e,t,n=1){const i=await ss(),s=Date.now();let a=null;try{a=JSON.stringify(t??{})}catch{a="{}"}const r=i.prepare("INSERT INTO saved_maps(name, data_json, version, updated_at) VALUES(?, ?, ?, ?)\nON CONFLICT(name) DO UPDATE SET data_json=excluded.data_json, version=excluded.version, updated_at=excluded.updated_at");r.run([String(e||""),a,Number.isFinite(n)?n:1,s]),r.free(),as()}const hs=Object.freeze(Object.defineProperty({__proto__:null,customMeshesDelete:As,customMeshesGetAll:ls,customMeshesUpsert:cs,getDB:ss,mapsDelete:async function(e){const t=(await ss()).prepare("DELETE FROM saved_maps WHERE name = ?");t.run([String(e||"")]),t.free(),as()},mapsGet:async function(e){const t=(await ss()).prepare("SELECT data_json, version, updated_at FROM saved_maps WHERE name = ?");let n=null;if(t.step()){const e=t.getAsObject();try{n=JSON.parse(e.data_json||"{}")}catch{n=null}n&&"object"==typeof n&&!("__version"in n)&&(n.__version=Number.isFinite(e.version)?e.version:1)}return t.free(),n},mapsList:async function(){const e=(await ss()).prepare("SELECT name, version, updated_at FROM saved_maps ORDER BY updated_at DESC"),t=[];for(;e.step();)t.push(e.getAsObject());return e.free(),t},mapsUpsert:ds,persist:as,settingsGet:os,settingsSet:rs},Symbol.toStringTag,{value:"Module"})),us="web3dEditor.settings.v1",ps=(e,t)=>{return{...e,...(n=t,"[object Object]"===Object.prototype.toString.call(n)?t:{})};var n};const gs={isWireframe:!1,isGridSnap:!1,isGridVisible:!0,gizmoSpace:"world",gizmoSize:.5,snapMove:1,snapRotateDeg:5,snapScale:.01,cameraPanSpeed:10,cameraOrbitSpeed:10,cameraZoomSpeed:.5,isPostProcessingEnabled:!1},ms={showLibrary:!1,showAssets:!0,isPostProcessingPanelOpen:!1,showHDRI:!1,isViewGizmoSettingsOpen:!1,dragUseSelectionForDnD:!1},bs={},fs={},vs={hdriSettings:{currentHDRI:{name:"기본 배경",type:"none"},hdriIntensity:1,hdriRotation:0,sunLightEnabled:!0,sunIntensity:1,timeOfDay:12,sunAzimuth:0,sunElevation:45,sunColor:"#ffffff"},postProcessing:{enabled:!1,preset:"default"},toneMapping:{enabled:!0,mapping:"ACESFilmic",exposure:1},safeMode:{enabled:!1,pixelRatio:1},rendererAA:"msaa",renderMode:"continuous"},ys={__version:1,viewGizmo:{...gs},ui:{...ms},editor:{...bs},game:{...fs},environment:{...vs}};function ws(e){const t=ps(ys,e);return t.viewGizmo=ps(gs,t.viewGizmo),t.ui=ps(ms,t.ui),t.editor=ps(bs,t.editor),t.game=ps(fs,t.game),t.environment=ps(vs,t.environment),t}function Cs(e){const t=e||{},n=t.currentHDRI||null,i=n?{name:n.name,type:n.type,url:n.url||void 0}:null;return{hdriIntensity:Number.isFinite(t.hdriIntensity)?t.hdriIntensity:vs.hdriSettings.hdriIntensity,hdriRotation:Number.isFinite(t.hdriRotation)?t.hdriRotation:vs.hdriSettings.hdriRotation,sunLightEnabled:!!t.sunLightEnabled,sunIntensity:Number.isFinite(t.sunIntensity)?t.sunIntensity:vs.hdriSettings.sunIntensity,timeOfDay:Number.isFinite(t.timeOfDay)?t.timeOfDay:vs.hdriSettings.timeOfDay,sunAzimuth:Number.isFinite(t.sunAzimuth)?t.sunAzimuth:vs.hdriSettings.sunAzimuth,sunElevation:Number.isFinite(t.sunElevation)?t.sunElevation:vs.hdriSettings.sunElevation,sunColor:"string"==typeof t.sunColor?t.sunColor:vs.hdriSettings.sunColor,currentHDRI:i}}async function xs(){try{const e=await os();if(e&&"object"==typeof e)return ws(e)}catch{}return{...ys}}async function Is(e){const t=ws(e||{});try{await rs(us,t)}catch{}return!0}async function Es(e){const t=await xs();return null==t?void 0:t[e]}async function Ss(e,t){const n=await xs();return Is({...n,[e]:ps((null==n?void 0:n[e])||{},t||{})})}function Bs(e,t,n,i=150){if(!e||"function"!=typeof e.getState||"function"!=typeof e.subscribe)return()=>{};if("function"!=typeof n)return()=>{};let s=n(e.getState());const a=function(e,t=200){let n=null;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}(e=>{try{Ss(t,e)}catch{}},i);return e.subscribe(e=>{try{const t=n(e);((e,t)=>{if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const s of n)if(e[s]!==t[s])return!1;return!0})(t,s)||(s=t,a(t))}catch{}})}function Qs(e){return Bs(e,"viewGizmo",e=>({isWireframe:!!e.isWireframe,isGridSnap:!!e.isGridSnap,isGridVisible:!!e.isGridVisible,gizmoSpace:e.gizmoSpace||"world",gizmoSize:Number.isFinite(e.gizmoSize)?e.gizmoSize:1,snapMove:Number.isFinite(e.snapMove)?e.snapMove:1,snapRotateDeg:Number.isFinite(e.snapRotateDeg)?e.snapRotateDeg:15,snapScale:Number.isFinite(e.snapScale)?e.snapScale:.1,isPostProcessingEnabled:!!e.isPostProcessingEnabled,cameraPanSpeed:Number.isFinite(e.cameraPanSpeed)?e.cameraPanSpeed:50,cameraOrbitSpeed:Number.isFinite(e.cameraOrbitSpeed)?e.cameraOrbitSpeed:100,cameraZoomSpeed:Number.isFinite(e.cameraZoomSpeed)?e.cameraZoomSpeed:.3}),150)}async function js(){const e=await Es("viewGizmo");return ps(gs,e||{})}async function Ms(){const e=await Es("environment");return ps(vs,e||{})}async function Ds(e){return Ss("environment",e)}function Ts(e){return Bs(e,"environment",e=>{var t,n;return{hdriSettings:Cs(e.hdriSettings),postProcessing:{enabled:!!e.isPostProcessingEnabled,preset:e.postProcessingPreset||"default"},safeMode:{enabled:!!(null==(t=e.safeMode)?void 0:t.enabled),pixelRatio:Number((null==(n=e.safeMode)?void 0:n.pixelRatio)??1)}}},200)}const Rs=Object.freeze(Object.defineProperty({__proto__:null,defaultAppSettings:ys,defaultEditorSettings:bs,defaultEnvironmentSettings:vs,defaultGameSettings:fs,defaultUISettings:ms,defaultViewGizmoConfig:gs,getAppSettingsAsync:xs,loadEnvironmentSettingsAsync:Ms,loadSettingsSectionAsync:Es,loadViewGizmoConfigAsync:js,sanitizeHDRISettings:Cs,saveAppSettingsAsync:Is,saveEnvironmentSettingsAsync:Ds,saveSettingsSectionAsync:Ss,startEnvironmentAutoPersist:Ts,startSettingsAutoPersist:Bs,startViewGizmoConfigAutoPersist:Qs},Symbol.toStringTag,{value:"Module"})),Os="glb",ks="thumb",Ls="blobstores_migrated_v1";function Ps(){return new Promise((e,t)=>{const n=indexedDB.open("Web3DModelEditorBlobs",1);n.onupgradeneeded=()=>{const e=n.result;e.objectStoreNames.contains(Os)||e.createObjectStore(Os),e.objectStoreNames.contains(ks)||e.createObjectStore(ks)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async function Fs(e,t,n){const i=await Ps();return await new Promise((s,a)=>{const r=i.transaction(e,"readwrite").objectStore(e).put(n,t);r.onsuccess=()=>s(),r.onerror=()=>a(r.error)})}async function Ns(e,t){const n=await Ps();return await new Promise((i,s)=>{const a=n.transaction(e,"readonly").objectStore(e).get(t);a.onsuccess=()=>i(a.result??null),a.onerror=()=>s(a.error)})}async function _s(e,t){const n=await Ps();return await new Promise((i,s)=>{const a=n.transaction(e,"readwrite").objectStore(e).delete(t);a.onsuccess=()=>i(),a.onerror=()=>s(a.error)})}const Gs=async()=>{try{await async function(){try{if(localStorage.getItem(Ls))return;const e=await ls();for(const t of e)if(t.glbData&&t.glbData.byteLength||"string"==typeof t.thumbnail&&t.thumbnail.startsWith("data:")){if(t.glbData&&await Fs(Os,t.id,new Blob([t.glbData],{type:"model/gltf-binary"})),"string"==typeof t.thumbnail&&t.thumbnail.startsWith("data:")){const e=await(await fetch(t.thumbnail)).blob();await Fs(ks,t.id,e)}await cs({id:t.id,name:t.name,thumbnailStr:null})}localStorage.setItem(Ls,"1")}catch(e){}}();const e=await ls(),t=[];for(const n of e){const e=await Ns(Os,n.id),i=await Ns(ks,n.id);t.push({id:n.id,name:n.name,glbData:e?await e.arrayBuffer():n.glbData??null,thumbnail:i||n.thumbnail||null,createdAt:n.createdAt})}return t}catch(e){return[]}},Us=async e=>{if(await cs({id:e.id,name:e.name,thumbnailStr:null}),e.glbData){const t=e.glbData instanceof Uint8Array?e.glbData:new Uint8Array(e.glbData);await Fs(Os,e.id,new Blob([t],{type:"model/gltf-binary"}))}if(e.thumbnail)if(e.thumbnail instanceof Blob)await Fs(ks,e.id,e.thumbnail);else if("string"==typeof e.thumbnail)try{const t=await(await fetch(e.thumbnail)).blob();await Fs(ks,e.id,t)}catch(t){}},zs=async e=>{await As(e),await _s(Os,e),await _s(ks,e)},Hs=async()=>{try{const e=localStorage.getItem("customMeshes");if(!e)return!1;const t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return localStorage.removeItem("customMeshes"),!1;for(const n of t)await Us(n);return localStorage.removeItem("customMeshes"),!0}catch(e){return!1}},qs=Object.freeze(Object.defineProperty({__proto__:null,idbAddCustomMesh:Us,idbDeleteCustomMesh:zs,idbGetAllCustomMeshes:Gs,idbGetCustomMesh:async e=>{try{const t=(await ls()||[]).find(t=>t.id===e)||null;let i=await Ns(Os,e),s=await Ns(ks,e);if(!i&&!(null==t?void 0:t.glbData)){const t=await async function(e){try{const t=(await ls()||[]).find(t=>t.id===e);if(!t)return!1;let n=!1;if(t.glbData){const i=t.glbData instanceof Uint8Array?t.glbData:new Uint8Array(t.glbData);await Fs(Os,e,new Blob([i],{type:"model/gltf-binary"})),n=!0}if("string"==typeof t.thumbnail&&t.thumbnail.startsWith("data:"))try{const i=await(await fetch(t.thumbnail)).blob();await Fs(ks,e,i),n=!0}catch{}return n}catch(t){return!1}}(e);t&&(i=await Ns(Os,e),s=await Ns(ks,e))}if(!i)try{const{migrateLocalStorageCustomMeshesToIDB:t}=await n(()=>Promise.resolve().then(()=>qs),void 0);await t()&&(i=await Ns(Os,e),s||(s=await Ns(ks,e)))}catch{}return t||i?{id:e,name:(null==t?void 0:t.name)??"",glbData:i||((null==t?void 0:t.glbData)??null),thumbnail:s||((null==t?void 0:t.thumbnail)??null),createdAt:(null==t?void 0:t.createdAt)??Date.now()}:null}catch(t){return null}},migrateLocalStorageCustomMeshesToIDB:Hs},Symbol.toStringTag,{value:"Module"})),Ks={...(null==vs?void 0:vs.hdriSettings)||{}},Ws=(e,t={x:0,y:0,z:0})=>{if(!e&&0!==e)return{...t};if(Array.isArray(e)){const[n=t.x,i=t.y,s=t.z]=e;return{x:n,y:i,z:s}}if("object"==typeof e){return{x:Number.isFinite(e.x)?e.x:t.x,y:Number.isFinite(e.y)?e.y:t.y,z:Number.isFinite(e.z)?e.z:t.z}}return{...t}},Vs=e=>{if(!e||"object"!=typeof e)return e;const t={...e};return t.position=Ws(e.position,{x:0,y:0,z:0}),t.rotation=Ws(e.rotation,{x:0,y:0,z:0}),t.scale=Ws(e.scale,{x:1,y:1,z:1}),t},Ys=Ht((e,t)=>{var i,s;const a={...gs},r={...ms};return(async()=>{try{const t=await Promise.allSettled([js(),Es("ui"),Ms()]);try{if("fulfilled"===t[0].status&&t[0].value){const n=t[0].value;e(e=>({isWireframe:!!n.isWireframe,isGridSnap:!!n.isGridSnap,isGridVisible:!!n.isGridVisible,gizmoSpace:n.gizmoSpace||"world",gizmoSize:Number.isFinite(n.gizmoSize)?n.gizmoSize:e.gizmoSize,snapMove:Number.isFinite(n.snapMove)?n.snapMove:e.snapMove,snapRotateDeg:Number.isFinite(n.snapRotateDeg)?n.snapRotateDeg:e.snapRotateDeg,snapScale:Number.isFinite(n.snapScale)?n.snapScale:e.snapScale,cameraPanSpeed:Number.isFinite(n.cameraPanSpeed)?n.cameraPanSpeed:e.cameraPanSpeed,cameraOrbitSpeed:Number.isFinite(n.cameraOrbitSpeed)?n.cameraOrbitSpeed:e.cameraOrbitSpeed,cameraZoomSpeed:Number.isFinite(n.cameraZoomSpeed)?n.cameraZoomSpeed:e.cameraZoomSpeed,isPostProcessingEnabled:!!n.isPostProcessingEnabled}))}}finally{try{e({viewReady:!0})}catch{}}try{if("fulfilled"===t[1].status&&t[1].value){const n=t[1].value;e({showLibrary:!!n.showLibrary,showAssets:!!n.showAssets,isPostProcessingPanelOpen:!!n.isPostProcessingPanelOpen,showHDRI:!!n.showHDRI,isViewGizmoSettingsOpen:!!n.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!n.dragUseSelectionForDnD})}}finally{try{e({uiReady:!0})}catch{}}try{if("fulfilled"===t[2].status&&t[2].value){const n=t[2].value;e(e=>{var t,i;return{isPostProcessingEnabled:!!((null==(t=n.postProcessing)?void 0:t.enabled)??e.isPostProcessingEnabled),postProcessingPreset:(null==(i=n.postProcessing)?void 0:i.preset)||e.postProcessingPreset,safeMode:{...e.safeMode,...n.safeMode||{}},rendererAA:n.rendererAA||e.rendererAA,renderMode:n.renderMode||e.renderMode,hdriSettings:n.hdriSettings?{...e.hdriSettings,...n.hdriSettings}:e.hdriSettings}})}}finally{try{e({envReady:!0})}catch{}}}catch{try{e({viewReady:!0,uiReady:!0,envReady:!0})}catch{}}})(),{scene:null,camera:null,renderer:null,_historyPast:[],_historyFuture:[],_batchActive:!1,_batchBuffer:[],canUndo:!1,canRedo:!1,selectedObject:null,selectedIds:[],transformMode:"translate",isWireframe:!!a.isWireframe,isGridSnap:!!a.isGridSnap,isGridVisible:!!a.isGridVisible,gridSize:1,gizmoSpace:a.gizmoSpace||"world",gizmoSize:Number.isFinite(a.gizmoSize)?a.gizmoSize:.5,snapMove:Number.isFinite(a.snapMove)?a.snapMove:1,snapRotateDeg:Number.isFinite(a.snapRotateDeg)?a.snapRotateDeg:5,snapScale:Number.isFinite(a.snapScale)?a.snapScale:.01,cameraPanSpeed:Number.isFinite(a.cameraPanSpeed)?a.cameraPanSpeed:10,cameraOrbitSpeed:Number.isFinite(a.cameraOrbitSpeed)?a.cameraOrbitSpeed:10,cameraZoomSpeed:Number.isFinite(a.cameraZoomSpeed)?a.cameraZoomSpeed:.5,hdriSettings:{currentHDRI:{name:"기본 배경",type:"none"},hdriIntensity:1,hdriRotation:0,sunLightEnabled:!0,sunIntensity:1,timeOfDay:12,sunAzimuth:0,sunElevation:45,sunColor:"#ffffff",...Ks},sunLightRef:null,dropIndicator:{easing:"easeInOutQuad",inMs:200,outMs:220,maxOpacity:.6},postProcessingManager:null,viewReady:!1,uiReady:!1,envReady:!1,isPostProcessingEnabled:!!(null==(i=null==vs?void 0:vs.postProcessing)?void 0:i.enabled),postProcessingPreset:(null==(s=null==vs?void 0:vs.postProcessing)?void 0:s.preset)||"default",safeMode:{enabled:!1,pixelRatio:1,notes:"Disables FXAA/SSAO and forces pixelRatio to 1.0 to reduce VRAM."},vramEstimateMB:0,stats:{fps:0,objects:0,vertices:0,triangles:0},rendererAA:(null==vs?void 0:vs.rendererAA)||"msaa",renderMode:(null==vs?void 0:vs.renderMode)||"continuous",savedObjects:new Map,customMeshes:[],objects:[],walls:[],annotations:[],clipboard:null,showLibrary:!!r.showLibrary,showAssets:!!r.showAssets,isPostProcessingPanelOpen:!!r.isPostProcessingPanelOpen,showHDRI:!!r.showHDRI,isViewGizmoSettingsOpen:!!r.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!r.dragUseSelectionForDnD,setShowLibrary:t=>e({showLibrary:!!t}),setShowAssets:t=>e({showAssets:!!t}),setIsPostProcessingPanelOpen:t=>e({isPostProcessingPanelOpen:!!t}),setShowHDRI:t=>e({showHDRI:!!t}),setIsViewGizmoSettingsOpen:t=>e({isViewGizmoSettingsOpen:!!t}),setDragUseSelectionForDnD:t=>e({dragUseSelectionForDnD:!!t}),setSelectedObject:t=>e({selectedObject:t}),setSelectedIds:t=>e({selectedIds:Array.isArray(t)?Array.from(new Set(t)):[]}),setTransformMode:t=>e({transformMode:t}),toggleWireframe:()=>e(e=>({isWireframe:!e.isWireframe})),toggleGridSnap:()=>e(e=>({isGridSnap:!e.isGridSnap})),toggleGridVisible:()=>e(e=>({isGridVisible:!e.isGridVisible})),setGridSize:t=>e({gridSize:t}),toggleGizmoSpace:()=>e(e=>({gizmoSpace:"world"===e.gizmoSpace?"local":"world"})),setGizmoSize:t=>e({gizmoSize:Math.max(.1,Math.min(5,Number(t)||1))}),setSnapMove:t=>e({snapMove:Math.max(.001,Math.min(1e3,Number(t)||1))}),setSnapRotateDeg:t=>e({snapRotateDeg:Math.max(.1,Math.min(360,Number(t)||15))}),setSnapScale:t=>e({snapScale:Math.max(.001,Math.min(100,Number(t)||.1))}),setCameraPanSpeed:t=>e({cameraPanSpeed:Math.max(1,Math.min(500,Number(t)||50))}),setCameraOrbitSpeed:t=>e({cameraOrbitSpeed:Math.max(1,Math.min(1e3,Number(t)||100))}),setCameraZoomSpeed:t=>e({cameraZoomSpeed:Math.max(.01,Math.min(5,Number(t)||.3))}),rehydrateViewGizmoConfig:async()=>{try{const t=await js();e({isWireframe:!!t.isWireframe,isGridSnap:!!t.isGridSnap,isGridVisible:!!t.isGridVisible,gizmoSpace:t.gizmoSpace||"world",gizmoSize:Number.isFinite(t.gizmoSize)?t.gizmoSize:.5,snapMove:Number.isFinite(t.snapMove)?t.snapMove:1,snapRotateDeg:Number.isFinite(t.snapRotateDeg)?t.snapRotateDeg:5,snapScale:Number.isFinite(t.snapScale)?t.snapScale:.01,isPostProcessingEnabled:!!t.isPostProcessingEnabled,cameraPanSpeed:Number.isFinite(t.cameraPanSpeed)?t.cameraPanSpeed:10,cameraOrbitSpeed:Number.isFinite(t.cameraOrbitSpeed)?t.cameraOrbitSpeed:10,cameraZoomSpeed:Number.isFinite(t.cameraZoomSpeed)?t.cameraZoomSpeed:.5})}catch{}},useBlenderControls:!0,setUseBlenderControls:t=>e({useBlenderControls:!!t}),updateHDRISettings:t=>e(e=>({hdriSettings:{...e.hdriSettings,...t}})),setSunLightRef:t=>e({sunLightRef:t}),updateDropIndicator:t=>e(e=>({dropIndicator:{...e.dropIndicator,...t}})),setPostProcessingManager:t=>e({postProcessingManager:t}),setRendererAA:n=>{var i;const s=["msaa","fxaa","none"].includes(n)?n:"msaa";e({rendererAA:s});try{Ds({rendererAA:s})}catch{}try{const e=t().postProcessingManager;e&&e.setEffectEnabled("fxaa","fxaa"===s&&!(null==(i=t().safeMode)?void 0:i.enabled))}catch{}},setRenderMode:t=>{const n=["continuous","on-demand"].includes(t)?t:"continuous";e({renderMode:n});try{Ds({renderMode:n})}catch{}},togglePostProcessingEnabled:()=>e(e=>({isPostProcessingEnabled:!e.isPostProcessingEnabled})),setPostProcessingPreset:t=>e({postProcessingPreset:t||"default"}),setStats:t=>e(e=>({stats:{...e.stats,...t}})),toggleSafeMode:n=>{const i=void 0!==n?!!n:!t().safeMode.enabled,s={...t().safeMode,enabled:i};e({safeMode:s});try{const e=t().postProcessingManager;e&&(e.setEffectEnabled("fxaa",!i),e.setEffectEnabled("ssao",!i),e.handleResize(window.innerWidth,window.innerHeight))}catch{}try{const e=t().renderer;if(e){const n=i?t().safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);e.setPixelRatio(n)}}catch{}try{t().estimateVRAMUsage()}catch{}try{Ds({safeMode:{enabled:t().safeMode.enabled,pixelRatio:t().safeMode.pixelRatio}})}catch{}},setSafeModePixelRatio:n=>{const i=Math.max(.5,Math.min(2,Number(n)||1)),s={...t().safeMode,pixelRatio:i};e({safeMode:s});try{const e=t().renderer;e&&t().safeMode.enabled&&e.setPixelRatio(i)}catch{}try{const e=t().postProcessingManager;e&&e.handleResize(window.innerWidth,window.innerHeight)}catch{}try{t().estimateVRAMUsage()}catch{}try{Ds({safeMode:{enabled:t().safeMode.enabled,pixelRatio:i}})}catch{}},estimateVRAMUsage:(n={})=>{var i,s,a,r,o;const l=n.width||window.innerWidth,c=n.height||window.innerHeight;let A=1;try{A=(null==(s=null==(i=t().renderer)?void 0:i.getPixelRatio)?void 0:s.call(i))||window.devicePixelRatio||1}catch{}const d=Math.max(1,Math.floor(l*A)),h=Math.max(1,Math.floor(c*A));let u=d*h*8;try{const e=t().postProcessingManager,n=t().isPostProcessingEnabled;if(e&&n){u+=d*h*8;const t=(null==(a=e.getSettings)?void 0:a.call(e))||{};(null==(r=t.ssao)?void 0:r.enabled)&&(u+=d*h*2*4),(null==(o=t.fxaa)?void 0:o.enabled)&&(u+=d*h*4)}}catch{}const p=Math.round(u/1048576);return e({vramEstimateMB:p}),p},initializeHDRISettings:()=>!1,saveHDRISettings:async()=>{const{hdriSettings:e}=t();try{const{sanitizeHDRISettings:t}=await n(()=>Promise.resolve().then(()=>Rs),void 0),i=t(e);await Ds({hdriSettings:i})}catch{}},addAsset:(t,n)=>e(e=>{const i=new Map(e.savedObjects);return i.set(t,n),{savedObjects:i}}),addCustomMesh:async t=>{try{await Us(t),e(e=>({customMeshes:[...e.customMeshes,t]}))}catch(n){try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"저장에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}catch{}}},deleteCustomMesh:async t=>{try{await zs(t),e(e=>({customMeshes:e.customMeshes.filter(e=>e.id!==t)}))}catch(n){try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}catch{}}},loadCustomMeshes:t=>e(()=>({customMeshes:(Array.isArray(t)?t:[]).map(e=>({...e,type:"custom"}))})),updateObjectTransform:(n,i)=>e(e=>{const s=Vs(i),a=e.objects.find(e=>e.id===n),r=a?{...a,...s}:null,o=e.objects.map(e=>e.id===n?{...e,...s}:e);if(a){const e={type:"transform",id:n,before:Xs(a),after:Xs(r)},{_pushHistory:i}=t();i(e)}return{objects:o}}),addObject:n=>e(e=>{const i=Vs(n),s=Object.prototype.hasOwnProperty.call(i,"parentId")?i.parentId??null:null;let a=i.order;if(!Number.isFinite(a)){a=e.objects.filter(e=>(e.parentId??null)===s).reduce((e,t)=>Number.isFinite(t.order)?Math.max(e,t.order):e,-1)+1}const r={...i,parentId:s,order:a},o=[...e.objects,r],l={type:"add",object:Js(r)},{_pushHistory:c}=t();return c(l),{objects:o}}),removeObject:n=>e(e=>{if(n.isSystemObject)return e;const i=e.objects.filter(e=>e!==n),s={type:"remove",object:Js(n)},{_pushHistory:a}=t();return a(s),{objects:i,selectedObject:e.selectedObject===n?null:e.selectedObject}}),removeObjectById:n=>e(e=>{const i=e.objects.find(e=>e.id===n);if(!i)return{};if(i.isSystemObject)return{};const{_pushHistory:s}=t(),a=e.objects.filter(e=>e.parentId===n);let r=e.objects;for(const t of a){const e=t.parentId??null,n=i.parentId??null;e!==n&&(s({type:"reparent",id:t.id,before:{parentId:e},after:{parentId:n}}),r=r.map(e=>e.id===t.id?{...e,parentId:n}:e))}s({type:"remove",object:Js(i)});return{objects:r.filter(e=>e.id!==n),annotations:(e.annotations||[]).filter(e=>e.ownerId!==n),selectedObject:e.selectedObject&&("object"==typeof e.selectedObject?e.selectedObject.id:e.selectedObject)===n?null:e.selectedObject}}),setParent:(n,i)=>e(e=>{const s=e.objects.find(e=>e.id===n);if(!s)return{};const a=s.parentId??null,r=i??null;if(a===r)return{};const o={type:"reparent",id:n,before:{parentId:a},after:{parentId:r}},{_pushHistory:l}=t();l(o);const c=e.objects.filter(e=>(e.parentId??null)===r&&e.id!==n).reduce((e,t)=>Number.isFinite(t.order)?Math.max(e,t.order):e,-1)+1;return{objects:e.objects.map(e=>e.id===n?{...e,parentId:r,order:c}:e)}}),reorderSiblings:(t,n)=>e(e=>{if(!Array.isArray(n))return{};const i=new Map(n.map((e,t)=>[e,t]));return{objects:e.objects.map(e=>(e.parentId??null)!==(t??null)?e:i.has(e.id)?{...e,order:i.get(e.id)}:e)}}),addWall:t=>e(e=>({walls:[...e.walls,t]})),removeWall:t=>e(e=>({walls:e.walls.filter(e=>e.id!==t)})),updateObject:(n,i)=>e(e=>{const s=e.objects.find(e=>e.id===n),a=Vs(i),r=e.objects.map(e=>e.id===n?{...e,...a}:e);if(s){const e={type:"update",id:n,before:Zs(s,a),after:a},{_pushHistory:i}=t();i(e)}return{objects:r}}),copyObject:n=>{var i,s,a,r,o;if(!n)return;if(n.isObject3D){t();const l=null==(i=n.userData)?void 0:i.id;if(l){const{updateObjectTransform:e}=t();e(l,{position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})}const c=t().objects.find(e=>e.id===l),A={name:`${n.name}_copy`,type:(null==c?void 0:c.type)||(null==(s=n.userData)?void 0:s.type)||"basic",geometry:(null==c?void 0:c.geometry)||(null==(a=n.userData)?void 0:a.geometry)||"BoxGeometry",params:(null==c?void 0:c.params)||(null==(r=n.userData)?void 0:r.params)||[1,1,1],uuid:n.uuid,..."glb"===(null==c?void 0:c.type)&&{url:c.url,customMeshId:c.customMeshId,file:void 0},position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z},visible:n.visible,material:(null==c?void 0:c.material)||(null==(o=n.userData)?void 0:o.material)||{type:"MeshStandardMaterial",color:16711680},originalObject:n};return void e({clipboard:A})}if(n.isSystemObject)return;const l={...n,id:void 0,name:`${n.name}_copy`};e({clipboard:l})},pasteObject:()=>{var n,i,s,a,r,o,l,c,A;const d=t();if(!d.clipboard)return null;const h={...d.clipboard,id:Date.now(),position:{x:(null==(n=d.clipboard.position)?void 0:n.x)||0,y:(null==(i=d.clipboard.position)?void 0:i.y)||0,z:(null==(s=d.clipboard.position)?void 0:s.z)||0},rotation:{x:(null==(a=d.clipboard.rotation)?void 0:a.x)||0,y:(null==(r=d.clipboard.rotation)?void 0:r.y)||0,z:(null==(o=d.clipboard.rotation)?void 0:o.z)||0},scale:{x:(null==(l=d.clipboard.scale)?void 0:l.x)||1,y:(null==(c=d.clipboard.scale)?void 0:c.y)||1,z:(null==(A=d.clipboard.scale)?void 0:A.z)||1}},u=[...d.objects,h];return e({objects:u,selectedObject:h.id}),h},hasClipboardData:()=>null!==t().clipboard,clearClipboard:()=>e({clipboard:null}),deleteSelectedObject:()=>{const n=t();if(!n.selectedObject)return;const i="object"==typeof n.selectedObject?n.selectedObject.id:n.selectedObject;if(!i)return;const s=n.objects.find(e=>e.id===i);if(!s)return;if(s.isSystemObject)return;const a=n.objects.filter(e=>e.id!==i),r={type:"remove",object:Js(s)},{_pushHistory:o}=t();o(r);const l=(n.annotations||[]).filter(e=>e.ownerId!==i);e({objects:a,annotations:l,selectedObject:null})},updateWall:(t,n)=>e(e=>({walls:e.walls.map(e=>e.id===t?{...e,...n}:e)})),toggleObjectVisibility:n=>e(e=>{const i=!1===n.visible,s=e.objects.map(e=>e.id===n.id?{...e,visible:i}:e),a={type:"update",id:n.id,before:{visible:n.visible},after:{visible:i}},{_pushHistory:r}=t();r(a);return{objects:s,walls:e.walls.map(e=>e.id===n.id?{...e,visible:i}:e)}}),toggleObjectFreeze:n=>e(e=>{const i=!0!==n.frozen,s=e.objects.map(e=>e.id===n.id?{...e,frozen:i}:e),a={type:"update",id:n.id,before:{frozen:n.frozen},after:{frozen:i}},{_pushHistory:r}=t();r(a);return{objects:s,walls:e.walls.map(e=>e.id===n.id?{...e,frozen:i}:e)}}),renameObject:(n,i)=>e(e=>{const s=e.objects.find(e=>e.id===n),a=e.objects.map(e=>e.id===n?{...e,name:i}:e);if(s){const e={type:"update",id:n,before:{name:s.name},after:{name:i}},{_pushHistory:a}=t();a(e)}return{objects:a,walls:e.walls.map(e=>e.id===n?{...e,name:i}:e)}}),syncSceneToState:()=>{const n=t(),i=n.scene;if(!i)return!1;const s=new Map;try{i.traverse(e=>{var t;const n=null==(t=null==e?void 0:e.userData)?void 0:t.id;n&&s.set(n,e)})}catch{}const a=n.objects.map(e=>{const t=Vs(e),n=s.get(e.id);if(!n||!n.isObject3D)return t;const i={...t,position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}};try{const t=e.type,s="light"===t?e.lightType:"directional_light"===t?"directional":"point_light"===t?"point":"spot_light"===t?"spot":null;n.isLight&&s&&("number"==typeof n.intensity&&(i.intensity=n.intensity),n.color&&"function"==typeof n.color.getHex&&(i.color=n.color.getHex()),i.castShadow=!!n.castShadow,"point"!==s&&"spot"!==s||("number"==typeof n.distance&&(i.distance=n.distance),"number"==typeof n.decay&&(i.decay=n.decay)),"spot"===s&&("number"==typeof n.angle&&(i.angle=n.angle),"number"==typeof n.penumbra&&(i.penumbra=n.penumbra)))}catch{}return i});return e({objects:a}),!0},saveMap:async(e,i)=>{var s;const a=t();try{null==(s=a.syncSceneToState)||s.call(a)}catch{}const r=a.objects.map(e=>{if("glb"===(null==e?void 0:e.type)){const{glbData:t,...n}=e||{};return{...n}}return e});let o=i;try{if(!o){const e=a.camera;o=e?{camera:{type:e.type,position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},zoom:"number"==typeof e.zoom?e.zoom:void 0},viewport:{isWireframe:!!a.isWireframe,isGridSnap:!!a.isGridSnap,isGridVisible:!!a.isGridVisible,gizmoSpace:a.gizmoSpace,gizmoSize:a.gizmoSize,snapMove:a.snapMove,snapRotateDeg:a.snapRotateDeg,snapScale:a.snapScale,rendererAA:a.rendererAA,renderMode:a.renderMode,isPostProcessingEnabled:!!a.isPostProcessingEnabled,postProcessingPreset:a.postProcessingPreset,safeMode:{...a.safeMode},hdriSettings:{...a.hdriSettings}}}:void 0}}catch{}const l={__version:1,walls:a.walls,objects:r,annotations:Array.isArray(a.annotations)?a.annotations:[],viewState:o||void 0};let c=!1;try{const{mapsUpsert:t}=await n(()=>Promise.resolve().then(()=>hs),void 0);await t(String(e||""),l,l.__version),c=!0}catch(A){}try{localStorage.setItem(`map_${e}`,JSON.stringify(l))}catch{}},getMapData:async e=>{try{const{mapsGet:t}=await n(()=>Promise.resolve().then(()=>hs),void 0),i=await t(String(e||""));if(i)return i}catch{}try{const t=localStorage.getItem(`map_${e}`);if(!t)return null;const n=JSON.parse(t);return n&&!("__version"in n)&&(n.__version=1),n}catch{return null}},listMaps:async()=>{const e=[];try{const{mapsList:t}=await n(()=>Promise.resolve().then(()=>hs),void 0),i=await t();Array.isArray(i)&&e.push(...i)}catch{}try{const t=Object.keys(localStorage||{}).filter(e=>e.startsWith("map_")),n=new Set(e.map(e=>String(e.name)));for(const i of t){const t=i.substring(4);n.has(t)||e.push({name:t,version:1,updated_at:null})}}catch{}return e.sort((e,t)=>(t.updated_at||0)-(e.updated_at||0)),e},deleteMap:async e=>{const t=String(e||"");try{const{mapsDelete:e}=await n(()=>Promise.resolve().then(()=>hs),void 0);await e(t);try{localStorage.removeItem(`map_${t}`)}catch{}return!0}catch{try{localStorage.removeItem(`map_${t}`)}catch{}return!1}},loadMap:async i=>{let s=null;try{const{mapsGet:e}=await n(()=>Promise.resolve().then(()=>hs),void 0);s=await e(String(i||""))}catch{}if(!s){const e=localStorage.getItem(`map_${i}`);if(e)try{s=JSON.parse(e)}catch{s=null}}if(s){"__version"in s||(s.__version=1);const n=(s.objects||[]).map(e=>{var t,n,i,s,a,r,o,l,c;const A=Vs(e);if("glb"===(null==A?void 0:A.type)&&(!A.glbData||"object"!=typeof A.glbData||Array.isArray(A.glbData)||A.glbData instanceof ArrayBuffer||A.glbData instanceof Uint8Array||delete A.glbData),(null==A?void 0:A.type)||(A.url||A.file?A.type="glb":A.geometry&&A.params?A.type="basic":A.size&&A.material&&(A.type="cube")),"glb"!==(null==A?void 0:A.type)||A.url||A.file||A.customMeshId||A.glbData||((null==(n=null==(t=A.userData)?void 0:t.originalData)?void 0:n.id)&&(A.customMeshId=A.userData.originalData.id),!A.customMeshId&&(null==(i=A.userData)?void 0:i.customMeshId)&&(A.customMeshId=A.userData.customMeshId),!A.customMeshId&&(null==(s=A.userData)?void 0:s.url)&&(A.url=A.userData.url)),"mesh"===(null==A?void 0:A.type)&&!A.geometry&&!A.params&&("basic"===(null==(a=A.userData)?void 0:a.type)||(null==(r=A.userData)?void 0:r.geometry))){const e=(null==(o=A.userData)?void 0:o.originalName)||A.name||"",t=String(e).toLowerCase();let n=null==(l=A.userData)?void 0:l.geometry,i=null==(c=A.userData)?void 0:c.params;n||(t.includes("정육면체")||t.includes("box")?(n="BoxGeometry",i=[1,1,1]):t.includes("구체")||t.includes("sphere")?(n="SphereGeometry",i=[.5,32,16]):t.includes("원기둥")||t.includes("cylinder")?(n="CylinderGeometry",i=[.5,.5,1,32]):t.includes("원뿔")||t.includes("cone")?(n="ConeGeometry",i=[.5,1,32]):t.includes("평면")||t.includes("plane")?(n="PlaneGeometry",i=[1,1]):(t.includes("도넛")||t.includes("torus"))&&(n="TorusGeometry",i=[.5,.2,16,100])),n&&(A.type="basic",A.geometry=n,A.params=i||[])}const d=Object.prototype.hasOwnProperty.call(A,"parentId")?A.parentId??null:null;let h=A.order;return Number.isFinite(h)||(h=0),{...A,parentId:d,order:h}}),i=(s.walls||[]).map(Vs),a=Array.isArray(s.annotations)?s.annotations.map(e=>({id:(null==e?void 0:e.id)||`ann_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,ownerId:(null==e?void 0:e.ownerId)??null,text:"string"==typeof(null==e?void 0:e.text)?e.text:"",local:Ws(null==e?void 0:e.local,{x:0,y:0,z:0})})):[];e(()=>({walls:i,objects:n,annotations:a}));try{const n=s.viewState;if(n){const i={};if(n.viewport){const e=n.viewport;i.isWireframe=!!e.isWireframe,i.isGridSnap=!!e.isGridSnap,i.isGridVisible=!!e.isGridVisible,i.gizmoSpace=e.gizmoSpace||t().gizmoSpace,Number.isFinite(e.gizmoSize)&&(i.gizmoSize=e.gizmoSize),Number.isFinite(e.snapMove)&&(i.snapMove=e.snapMove),Number.isFinite(e.snapRotateDeg)&&(i.snapRotateDeg=e.snapRotateDeg),Number.isFinite(e.snapScale)&&(i.snapScale=e.snapScale),e.rendererAA&&(i.rendererAA=e.rendererAA),e.renderMode&&(i.renderMode=e.renderMode),i.isPostProcessingEnabled=!!e.isPostProcessingEnabled,e.postProcessingPreset&&(i.postProcessingPreset=e.postProcessingPreset),e.safeMode&&(i.safeMode={...t().safeMode,...e.safeMode}),e.hdriSettings&&(i.hdriSettings={...t().hdriSettings,...e.hdriSettings})}Object.keys(i).length>0&&e(i)}}catch{}return!0}return!1},clearMap:()=>{const n=t();e({objects:(n.objects||[]).filter(e=>e.isSystemObject),walls:[],annotations:[],selectedObject:null,selectedIds:[]});try{const e=t().scene;if(e){const n=new Set((t().objects||[]).map(e=>e.id)),i=[];e.traverse(e=>{var t,s,a;if(null==(t=null==e?void 0:e.userData)?void 0:t.isSystemObject)return;if(null==(s=null==e?void 0:e.userData)?void 0:s.isSelectionOutline)return;const r=null==(a=null==e?void 0:e.userData)?void 0:a.id;r&&n.has(r)||i.push(e)}),i.forEach(t=>{try{t.parent?t.parent.remove(t):e.remove(t)}catch{}})}}catch{}try{window.dispatchEvent(new CustomEvent("annotationsCleared"))}catch{}},addAnnotation:t=>e(e=>{const n=(null==t?void 0:t.id)||`ann_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,i=(null==t?void 0:t.ownerId)??null,s="string"==typeof(null==t?void 0:t.text)?t.text:"",a=Ws(null==t?void 0:t.local,{x:0,y:0,z:0});return{annotations:[...e.annotations||[],{id:n,ownerId:i,text:s,local:a}]}}),removeAnnotation:t=>e(e=>({annotations:(e.annotations||[]).filter(e=>e.id!==t)})),setAnnotations:t=>e({annotations:Array.isArray(t)?t.map(e=>({id:(null==e?void 0:e.id)||`ann_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,ownerId:(null==e?void 0:e.ownerId)??null,text:"string"==typeof(null==e?void 0:e.text)?e.text:"",local:Ws(null==e?void 0:e.local,{x:0,y:0,z:0})})):[]}),pruneOrphanSceneObjects:()=>{try{const e=t().scene;if(!e)return;const n=new Set((t().objects||[]).map(e=>e.id)),i=[];e.traverse(e=>{var t,s,a;if(null==(t=null==e?void 0:e.userData)?void 0:t.isSystemObject)return;if(null==(s=null==e?void 0:e.userData)?void 0:s.isSelectionOutline)return;const r=null==(a=null==e?void 0:e.userData)?void 0:a.id;if(!r||!n.has(r)){const t=(e.name||"").toLowerCase();if(t.includes("transformcontrols")||t.includes("gizmo")||t.includes("helper"))return;i.push(e)}}),i.forEach(t=>{try{t.parent?t.parent.remove(t):e.remove(t)}catch{}})}catch{}},setScene:(t,n,i)=>e({scene:t,camera:n,renderer:i}),_pushHistory:n=>{const{_batchActive:i,_historyPast:s}=t();if(i)return void e(e=>({_batchBuffer:[...e._batchBuffer,n]}));const a=[...s,n];e({_historyPast:a,_historyFuture:[],canUndo:a.length>0,canRedo:!1})},beginBatch:()=>e({_batchActive:!0,_batchBuffer:[]}),endBatch:()=>e(e=>{if(!e._batchActive)return{};const t=e._batchBuffer;if(0===t.length)return{_batchActive:!1,_batchBuffer:[]};const n={type:"batch",entries:t},i=[...e._historyPast,n];return{_batchActive:!1,_batchBuffer:[],_historyPast:i,_historyFuture:[],canUndo:i.length>0,canRedo:!1}}),undo:()=>{const n=t(),i=[...n._historyPast];if(0===i.length)return!1;try{n.setSelectedObject&&n.setSelectedObject(null),n.setSelectedIds&&n.setSelectedIds([])}catch{}const s=i.pop();$s(s,e,t);const a=[...n._historyFuture,s];return e({_historyPast:i,_historyFuture:a,canUndo:i.length>0,canRedo:a.length>0}),!0},redo:()=>{const n=t(),i=[...n._historyFuture];if(0===i.length)return!1;try{n.setSelectedObject&&n.setSelectedObject(null),n.setSelectedIds&&n.setSelectedIds([])}catch{}const s=i.pop();ea(s,e,t);const a=[...n._historyPast,s];return e({_historyFuture:i,_historyPast:a,canUndo:a.length>0,canRedo:i.length>0}),!0}}});try{Qs(Ys)}catch{}try{Ts(Ys)}catch{}try{Bs(Ys,"ui",e=>({showLibrary:!!e.showLibrary,showAssets:!!e.showAssets,isPostProcessingPanelOpen:!!e.isPostProcessingPanelOpen,showHDRI:!!e.showHDRI,isViewGizmoSettingsOpen:!!e.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!e.dragUseSelectionForDnD}),120)}catch{}function Js(e){if(!e||"object"!=typeof e)return e;const t={...e};return"glbData"in t&&delete t.glbData,"file"in t&&delete t.file,t}function Xs(e){return{position:Ws(e.position,{x:0,y:0,z:0}),rotation:Ws(e.rotation,{x:0,y:0,z:0}),scale:Ws(e.scale,{x:1,y:1,z:1})}}function Zs(e,t){const n={},i=["name","visible","frozen","parentId","position","rotation","scale"];for(const s of i)s in t&&(n[s]="position"===s||"rotation"===s||"scale"===s?Ws(e[s],"scale"===s?{x:1,y:1,z:1}:{x:0,y:0,z:0}):e[s]);return n}function $s(e,t,n){var i;if(e)switch(e.type){case"part-transform":{const t=n().scene;if(!t)break;const i=Array.isArray(e.parts)&&e.parts.length>0?e.parts:e.part&&e.before&&e.after?[{uuid:e.part.uuid,before:e.before}]:[];for(const n of i){const i=n.uuid,s=n.before||e.before;if(!i||!s)continue;let a=null;if(t.traverse(e=>{a||e.uuid!==i||(a=e)}),a&&a.isObject3D)try{a.position.set(s.position.x,s.position.y,s.position.z),a.rotation.set(s.rotation.x,s.rotation.y,s.rotation.z),a.scale.set(s.scale.x,s.scale.y,s.scale.z),a.updateMatrix(),a.updateMatrixWorld(!0)}catch{}}break}case"batch":for(let i=e.entries.length-1;i>=0;i--)$s(e.entries[i],t,n);break;case"reparent":{const i=n(),s=e.id,a=e.before;if(!s||!a)break;t({objects:i.objects.map(e=>e.id===s?{...e,parentId:a.parentId??null}:e)});break}case"add":{const s=null==(i=e.object)?void 0:i.id;if(!s)break;t({objects:n().objects.filter(e=>e.id!==s)});break}case"remove":{const i=n(),s=e.object;if(!s)break;t({objects:[...i.objects,Vs(s)]});break}case"update":case"transform":{const i=n(),s=e.id,a=e.before;if(!s||!a)break;t({objects:i.objects.map(e=>e.id===s?{...e,...Vs(a)}:e)});break}}}function ea(e,t,n){var i;if(e)switch(e.type){case"part-transform":{const t=n().scene;if(!t)break;const i=Array.isArray(e.parts)&&e.parts.length>0?e.parts:e.part&&e.before&&e.after?[{uuid:e.part.uuid,after:e.after}]:[];for(const n of i){const i=n.uuid,s=n.after||e.after;if(!i||!s)continue;let a=null;if(t.traverse(e=>{a||e.uuid!==i||(a=e)}),a&&a.isObject3D)try{a.position.set(s.position.x,s.position.y,s.position.z),a.rotation.set(s.rotation.x,s.rotation.y,s.rotation.z),a.scale.set(s.scale.x,s.scale.y,s.scale.z),a.updateMatrix(),a.updateMatrixWorld(!0)}catch{}}break}case"batch":for(let i=0;i<e.entries.length;i++)ea(e.entries[i],t,n);break;case"reparent":{const i=n(),s=e.id,a=e.after;if(!s||!a)break;t({objects:i.objects.map(e=>e.id===s?{...e,parentId:a.parentId??null}:e)});break}case"add":{const i=n(),s=e.object;if(!s)break;t({objects:[...i.objects,Vs(s)]});break}case"remove":{const s=null==(i=e.object)?void 0:i.id;if(!s)break;t({objects:n().objects.filter(e=>e.id!==s)});break}case"update":case"transform":{const i=n(),s=e.id,a=e.after;if(!s||!a)break;t({objects:i.objects.map(e=>e.id===s?{...e,...Vs(a)}:e)});break}}}const ta=new qe,na=new B,ia=new B,sa=new ae,aa={X:new B(1,0,0),Y:new B(0,1,0),Z:new B(0,0,1)},ra={type:"change"},oa={type:"mouseDown",mode:null},la={type:"mouseUp",mode:null},ca={type:"objectChange"};class Aa extends Ke{constructor(e,t=null){super(void 0,t);const n=new Da(this);this._root=n;const i=new Ta;this._gizmo=i,n.add(i);const s=new Ra;this._plane=s,n.add(s);const a=this;function r(e,t){let n=t;Object.defineProperty(a,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,s[e]=t,i[e]=t,a.dispatchEvent({type:e+"-changed",value:t}),a.dispatchEvent(ra))}}),a[e]=t,s[e]=t,i[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0),r("minX",-1/0),r("maxX",1/0),r("minY",-1/0),r("maxY",1/0),r("minZ",-1/0),r("maxZ",1/0);const o=new B,l=new B,c=new ae,A=new ae,d=new B,h=new ae,u=new B,p=new B,g=new B,m=new B;r("worldPosition",o),r("worldPositionStart",l),r("worldQuaternion",c),r("worldQuaternionStart",A),r("cameraPosition",d),r("cameraQuaternion",h),r("pointStart",u),r("pointEnd",p),r("rotationAxis",g),r("rotationAngle",0),r("eye",m),this._offset=new B,this._startNorm=new B,this._endNorm=new B,this._cameraScale=new B,this._parentPosition=new B,this._parentQuaternion=new ae,this._parentQuaternionInv=new ae,this._parentScale=new B,this._worldScaleStart=new B,this._worldQuaternionInv=new ae,this._worldScale=new B,this._positionStart=new B,this._quaternionStart=new ae,this._scaleStart=new B,this._getPointer=da.bind(this),this._onPointerDown=ua.bind(this),this._onPointerHover=ha.bind(this),this._onPointerMove=pa.bind(this),this._onPointerUp=ga.bind(this),null!==t&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;null!==e&&ta.setFromCamera(e,this.camera);const t=ma(this._gizmo.picker[this.mode],ta);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&(null==e||0===e.button)&&null!==this.axis){null!==e&&ta.setFromCamera(e,this.camera);const t=ma(this._plane,ta,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,oa.mode=this.mode,this.dispatchEvent(oa)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let s=this.space;if("scale"===n?s="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(s="world"),void 0===i||null===t||!1===this.dragging||null!==e&&-1!==e.button)return;null!==e&&ta.setFromCamera(e,this.camera);const a=ma(this._plane,ta,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===s&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===s&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===s&&(i.position.applyQuaternion(sa.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===s&&(i.parent&&i.position.add(na.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(na.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),ia.set(e,e,e)}else na.copy(this.pointStart),ia.copy(this.pointEnd),na.applyQuaternion(this._worldQuaternionInv),ia.applyQuaternion(this._worldQuaternionInv),ia.divide(na),-1===t.search("X")&&(ia.x=1),-1===t.search("Y")&&(ia.y=1),-1===t.search("Z")&&(ia.z=1);i.scale.copy(this._scaleStart).multiply(ia),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(na.setFromMatrixPosition(this.camera.matrixWorld));let n=!1;"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(na.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(aa[t]),na.copy(aa[t]),"local"===s&&na.applyQuaternion(this.worldQuaternion),na.cross(this.eye),0===na.length()?n=!0:this.rotationAngle=this._offset.dot(na.normalize())*e),("E"===t||n)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===s&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(sa.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(sa.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ra),this.dispatchEvent(ca)}}pointerUp(e){null!==e&&0!==e.button||(this.dragging&&null!==this.axis&&(la.mode=this.mode,this.dispatchEvent(la)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ra),this.dispatchEvent(ca),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ta}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function da(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function ha(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function ua(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function pa(e){this.enabled&&this.pointerMove(this._getPointer(e))}function ga(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function ma(e,t,n){const i=t.intersectObject(e,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||n)return i[s];return!1}const ba=new $e,fa=new B(0,1,0),va=new B(0,0,0),ya=new S,wa=new ae,Ca=new ae,xa=new B,Ia=new S,Ea=new B(1,0,0),Sa=new B(0,1,0),Ba=new B(0,0,1),Qa=new B,ja=new B,Ma=new B;class Da extends M{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;void 0!==t.object&&(t.object.updateMatrixWorld(),null===t.object.parent||t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class Ta extends M{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new C({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new _({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const s=e.clone();s.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const r=e.clone();r.color.setHex(255);const o=e.clone();o.color.setHex(16711680),o.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const A=e.clone();A.color.setHex(255),A.opacity=.5;const d=e.clone();d.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25;e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const p=new We(0,.04,.1,12);p.translate(0,.05,0);const g=new He(.08,.08,.08);g.translate(0,.04,0);const m=new c;m.setAttribute("position",new Ve([0,0,0,1,0,0],3));const b=new We(.0075,.0075,.5,3);function f(e,t){const n=new Xe(e,.0075,3,64,t*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}b.translate(0,.25,0);const v={X:[[new q(p,s),[.5,0,0],[0,0,-Math.PI/2]],[new q(p,s),[-.5,0,0],[0,0,Math.PI/2]],[new q(b,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new q(p,a),[0,.5,0]],[new q(p,a),[0,-.5,0],[Math.PI,0,0]],[new q(b,a)]],Z:[[new q(p,r),[0,0,.5],[Math.PI/2,0,0]],[new q(p,r),[0,0,-.5],[-Math.PI/2,0,0]],[new q(b,r),null,[Math.PI/2,0,0]]],XYZ:[[new q(new Ye(.1,0),d.clone()),[0,0,0]]],XY:[[new q(new He(.15,.15,.01),A.clone()),[.15,.15,0]]],YZ:[[new q(new He(.15,.15,.01),o.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},y={X:[[new q(new We(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new q(new We(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new q(new We(.2,0,.6,4),n),[0,.3,0]],[new q(new We(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new q(new We(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new q(new We(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new q(new Ye(.2,0),n)]],XY:[[new q(new He(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new q(new He(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},w={START:[[new q(new Ye(.01,2),i),null,null,null,"helper"]],END:[[new q(new Ye(.01,2),i),null,null,null,"helper"]],DELTA:[[new W(function(){const e=new c;return e.setAttribute("position",new Ve([0,0,0,1,1,1],3)),e}(),i),null,null,null,"helper"]],X:[[new W(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new W(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new W(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},x={XYZE:[[new q(f(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new q(f(.5,.5),s)]],Y:[[new q(f(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new q(f(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new q(f(.75,1),h),null,[0,Math.PI/2,0]]]},I={AXIS:[[new W(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new q(new Je(.25,10,8),n)]],X:[[new q(new Xe(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new q(new Xe(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new q(new Xe(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new q(new Xe(.75,.1,2,24),n)]]},S={X:[[new q(g,s),[.5,0,0],[0,0,-Math.PI/2]],[new q(b,s),[0,0,0],[0,0,-Math.PI/2]],[new q(g,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new q(g,a),[0,.5,0]],[new q(b,a)],[new q(g,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new q(g,r),[0,0,.5],[Math.PI/2,0,0]],[new q(b,r),[0,0,0],[Math.PI/2,0,0]],[new q(g,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new q(new He(.15,.15,.01),A),[.15,.15,0]]],YZ:[[new q(new He(.15,.15,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new q(new He(.1,.1,.1),d.clone())]]},B={X:[[new q(new We(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new q(new We(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new q(new We(.2,0,.6,4),n),[0,.3,0]],[new q(new We(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new q(new We(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new q(new We(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new q(new He(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new q(new He(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new q(new He(.2,.2,.2),n),[0,0,0]]]},Q={X:[[new W(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new W(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new W(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function j(e){const t=new M;for(const n in e)for(let i=e[n].length;i--;){const s=e[n][i][0].clone(),a=e[n][i][1],r=e[n][i][2],o=e[n][i][3],l=e[n][i][4];s.name=n,s.tag=l,a&&s.position.set(a[0],a[1],a[2]),r&&s.rotation.set(r[0],r[1],r[2]),o&&s.scale.set(o[0],o[1],o[2]),s.updateMatrix();const c=s.geometry.clone();c.applyMatrix4(s.matrix),s.geometry=c,s.renderOrder=1/0,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(v)),this.add(this.gizmo.rotate=j(x)),this.add(this.gizmo.scale=j(S)),this.add(this.picker.translate=j(y)),this.add(this.picker.rotate=j(E)),this.add(this.picker.scale=j(B)),this.add(this.helper.translate=j(w)),this.add(this.helper.rotate=j(I)),this.add(this.helper.scale=j(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Ca;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let i=0;i<n.length;i++){const e=n[i];let s;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),s=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(s*this.size/4),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const n=.99,i=.2;"X"===e.name&&Math.abs(fa.copy(Ea).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"===e.name&&Math.abs(fa.copy(Sa).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"===e.name&&Math.abs(fa.copy(Ba).applyQuaternion(t).dot(this.eye))>n&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(fa.copy(Ba).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(fa.copy(Ea).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(fa.copy(Sa).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)}else"rotate"===this.mode&&(wa.copy(t),fa.copy(this.eye).applyQuaternion(sa.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(ya.lookAt(this.eye,va,Sa)),"X"===e.name&&(sa.setFromAxisAngle(Ea,Math.atan2(-fa.y,fa.z)),sa.multiplyQuaternions(wa,sa),e.quaternion.copy(sa)),"Y"===e.name&&(sa.setFromAxisAngle(Sa,Math.atan2(fa.x,fa.z)),sa.multiplyQuaternions(wa,sa),e.quaternion.copy(sa)),"Z"===e.name&&(sa.setFromAxisAngle(Ba,Math.atan2(fa.y,fa.x)),sa.multiplyQuaternions(wa,sa),e.quaternion.copy(sa)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(t){return e.name===t}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}else e.visible=!1,"AXIS"===e.name?(e.visible=!!this.axis,"X"===this.axis&&(sa.setFromEuler(ba.set(0,0,0)),e.quaternion.copy(t).multiply(sa),Math.abs(fa.copy(Ea).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(sa.setFromEuler(ba.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(sa),Math.abs(fa.copy(Sa).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(sa.setFromEuler(ba.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(sa),Math.abs(fa.copy(Ba).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(sa.setFromEuler(ba.set(0,Math.PI/2,0)),fa.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(ya.lookAt(va,fa,Sa)),e.quaternion.multiply(sa),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),na.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),na.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(na),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld(e)}}class Ra extends q{constructor(){super(new Ze(1e5,1e5,2,2),new C({visible:!1,wireframe:!0,side:U,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Qa.copy(Ea).applyQuaternion("local"===t?this.worldQuaternion:Ca),ja.copy(Sa).applyQuaternion("local"===t?this.worldQuaternion:Ca),Ma.copy(Ba).applyQuaternion("local"===t?this.worldQuaternion:Ca),fa.copy(ja),this.mode){case"translate":case"scale":switch(this.axis){case"X":fa.copy(this.eye).cross(Qa),xa.copy(Qa).cross(fa);break;case"Y":fa.copy(this.eye).cross(ja),xa.copy(ja).cross(fa);break;case"Z":fa.copy(this.eye).cross(Ma),xa.copy(Ma).cross(fa);break;case"XY":xa.copy(Ma);break;case"YZ":xa.copy(Qa);break;case"XZ":fa.copy(Ma),xa.copy(ja);break;case"XYZ":case"E":xa.set(0,0,0)}break;default:xa.set(0,0,0)}0===xa.length()?this.quaternion.copy(this.cameraQuaternion):(Ia.lookAt(na.set(0,0,0),xa,fa),this.quaternion.setFromRotationMatrix(Ia)),super.updateMatrixWorld(e)}}class Oa{constructor(e,t,n=null){this.camera=e,this.renderer=t,this.onCameraChange=n,this.initialPosition=e.position.clone(),this.initialTarget=new B(0,0,0),this.cameraTarget=new B(0,0,0),this.spherical=new et,this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget)),this._tempVector1=new B,this._tempVector2=new B,this._tempVector3=new B,this._panSpeed=50,this._orbitSpeed=100,this._zoomSpeed=.3}resetCamera(){this.camera.position.copy(this.initialPosition),this.cameraTarget.copy(this.initialTarget),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}toggleProjection(){const e=this.camera,t=e.position.clone(),n=this.cameraTarget.clone();if(e.isPerspectiveCamera){const e=t.distanceTo(n),i=window.innerWidth/window.innerHeight,s=.5*e,a=new $(s*i/-2,s*i/2,s/2,s/-2,.1,1e3);a.position.copy(t),a.lookAt(n),a.updateMatrixWorld(),this.camera=a}else{const e=new X(75,window.innerWidth/window.innerHeight,.1,1e3);e.position.copy(t),e.lookAt(n),e.updateMatrixWorld(),this.camera=e}return this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget)),this.onCameraChange&&this.onCameraChange(this.camera),this.camera}setView(e){const t=this.camera.position.distanceTo(this.cameraTarget),n=this.cameraTarget.clone();let i=new B;switch(e){case"front":i.set(n.x,n.y,n.z+t);break;case"side":i.set(n.x+t,n.y,n.z);break;case"top":i.set(n.x,n.y+t,n.z);break;case"bottom":i.set(n.x,n.y-t,n.z);break;default:return}this.camera.position.copy(i),this.camera.lookAt(n),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}pan(e,t){const n=this._panSpeed,i=new B,s=new B;i.setFromMatrixColumn(this.camera.matrix,0),s.setFromMatrixColumn(this.camera.matrix,1);const a=n*(this.camera.position.distanceTo(this.cameraTarget)/50),r=new B;r.add(i.clone().multiplyScalar(-e*a)),r.add(s.clone().multiplyScalar(-t*a)),this.camera.position.add(r),this.cameraTarget.add(r),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}updateRotationCenterAfterPan(e,t=[]){const n=new qe,i=new E(0,0);n.setFromCamera(i,this.camera);const s=n.intersectObjects(t,!0);if(s.length>0){const e=s[0].point;this.cameraTarget.copy(e)}else{const e=new B;e.setFromMatrixColumn(this.camera.matrix,2).negate();const t=this.camera.position.clone().add(e.multiplyScalar(50));this.cameraTarget.copy(t)}this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}orbit(e,t){const n=this._orbitSpeed;this.spherical.theta-=e*n*.01,this.spherical.phi+=t*n*.01,this.spherical.phi=Math.max(.1,Math.min(Math.PI-.1,this.spherical.phi));const i=new B;i.setFromSpherical(this.spherical),i.add(this.cameraTarget),this.camera.position.copy(i),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld()}zoom(e){const t=Math.max(.01,this._zoomSpeed),n=e>0?1+t:1/(1+t);if(this.camera.isPerspectiveCamera){this.spherical.radius*=n,this.spherical.radius=Math.max(1,Math.min(1e3,this.spherical.radius));const e=new B;e.setFromSpherical(this.spherical),e.add(this.cameraTarget),this.camera.position.copy(e),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld()}else if(this.camera.isOrthographicCamera){const e=(this.camera.right-this.camera.left)*n,t=(this.camera.top-this.camera.bottom)*n,i=2e3,s=.1,a=Math.max(s,Math.min(i,e)),r=Math.max(s,Math.min(i,t));this.camera.left=-a/2,this.camera.right=a/2,this.camera.top=r/2,this.camera.bottom=-r/2,this.camera.updateProjectionMatrix()}}setSpeeds({pan:e,orbit:t,zoom:n}={}){Number.isFinite(e)&&(this._panSpeed=e),Number.isFinite(t)&&(this._orbitSpeed=t),Number.isFinite(n)&&(this._zoomSpeed=n)}focusOnObject(e){if(!e)return;const t=(new fe).setFromObject(e),n=t.getCenter(new B),i=t.getSize(new B),s=Math.max(i.x,i.y,i.z);let a;if(this.camera.isPerspectiveCamera){const e=this.camera.fov*(Math.PI/180);a=1.5*Math.abs(s/Math.sin(e/2))}else a=2*s;this.cameraTarget.copy(n);const r=new B;r.subVectors(this.camera.position,this.cameraTarget).normalize(),this.camera.position.copy(n).add(r.multiplyScalar(a)),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}handleResize(){if(this.camera.isPerspectiveCamera)this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();else if(this.camera.isOrthographicCamera){const e=window.innerWidth/window.innerHeight,t=(this.camera.top-this.camera.bottom)*e;this.camera.left=-t/2,this.camera.right=t/2,this.camera.updateProjectionMatrix()}}setTarget(e){this.cameraTarget.copy(e),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}getCamera(){return this.camera}getTarget(){return this.cameraTarget.clone()}}class ka{constructor(e,t,n,i){this.scene=e,this.camera=t,this.renderer=n,this.editorStore=i,this.gizmoScene=null,this.selectedObjects=[],this.lastSelectedObject=null,this.selectableObjects=[],this.raycaster=new qe,this.selectionBox=null,this.createSelectionBox(),this.transformControls=null,this.gizmoMode="translate",this.isDragging=!1,this.snapEnabled=!1,this.gridSize=1,this.tempGroup=null,this.tempGroupCenter=new B,this.initialTransformStates=new Map,this.initializeTransformControls(),this._pendingTransformUpdates=new Map,this._rafScheduled=!1,this.postProcessingManager=null}_requestRender(){try{"undefined"!=typeof window&&"function"==typeof window.__requestRender&&window.__requestRender()}catch{}}_shouldUseFallbackOutline(){return!0}forceHideGizmoLines(){var e,t,n;try{const i=null==(t=null==(e=this.transformControls)?void 0:e.getHelper)?void 0:t.call(e);if(!i||!i.isObject3D)return;const s=this.gizmoScene||this.scene;i.parent!==s&&(i.parent&&i.parent.remove(i),s.add(i));const a=[];null==(n=i.traverse)||n.call(i,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,n=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||n)&&a.push(e)}),a.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const n=e.material;Array.isArray(n)?n.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==n?void 0:n.dispose)&&n.dispose()}catch{}})}catch{}}setGizmoScene(e){var t,n,i,s;this.gizmoScene=e;try{const a=null==(n=null==(t=this.transformControls)?void 0:t.getHelper)?void 0:n.call(t);if(a&&a.isObject3D&&e){try{const e=null==(s=null==(i=a.children)?void 0:i.find)?void 0:s.call(i,e=>"helper"===e.name);e&&(e.visible=!1);const t=e=>{var t;const n=[];null==(t=e.traverse)||t.call(e,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,i=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||i)&&n.push(e)}),n.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const n=e.material;Array.isArray(n)?n.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==n?void 0:n.dispose)&&n.dispose()}catch{}})};t(a),a.onBeforeRender=()=>{try{e&&(e.visible=!1),t(a)}catch{}}}catch{}a.parent&&a.parent.remove(a),e.add(a)}}catch{}}setPostProcessingManager(e){this.postProcessingManager=e}_syncOutlineWithSelection(){if(!this.postProcessingManager)return;const e=this.selectedObjects&&this.selectedObjects.length>0?[...this.selectedObjects]:[];try{this.postProcessingManager.setOutlineSelectedObjects(e);const t=this.lastSelectedObject&&e.includes(this.lastSelectedObject)?[this.lastSelectedObject]:e.length?[e[e.length-1]]:[];this.postProcessingManager.setOutlineActiveObjects(t)}catch{}}isInSceneGraph(e){if(!e)return!1;let t=e;for(;t;){if(t===this.scene||t===this.gizmoScene)return!0;t=t.parent}return!1}validateTransformAttachment(){if(!this.transformControls||!this.transformControls.object)return;if(this.isDragging)return;const e=this.transformControls.object;if(!this.isInSceneGraph(e)){try{this.transformControls.detach()}catch{}this.editorStore.getState().setSelectedObject(null)}}createTempGroup(){if(this.selectedObjects.length<=1)return this.clearTempGroup(),null;this.clearTempGroup(),this.tempGroup=new J,this.tempGroup.name="TempSelectionGroup",this.tempGroup.userData.isTempGroup=!0,this.calculateGroupCenter(),this.tempGroup.position.copy(this.tempGroupCenter);const e=this.gizmoScene||this.scene;try{e.add(this.tempGroup)}catch{}return this.tempGroup}calculateGroupCenter(){if(0===this.selectedObjects.length)return void this.tempGroupCenter.set(0,0,0);const e=new fe;this.selectedObjects.forEach(t=>{if(t){const n=(new fe).setFromObject(t);e.union(n)}}),e.getCenter(this.tempGroupCenter)}clearTempGroup(){if(this.tempGroup){try{this.tempGroup.parent&&this.tempGroup.parent.remove(this.tempGroup)}catch{}this.tempGroup=null}}saveInitialTransformStates(){this.initialTransformStates.clear();for(const e of this.selectedObjects)e&&e.position&&e.rotation&&e.scale&&this.initialTransformStates.set(e,{position:e.position.clone(),rotation:e.rotation.clone(),scale:e.scale.clone()});this.tempGroup&&this.selectedObjects.length>1&&this.initialTransformStates.set(this.tempGroup,{position:this.tempGroup.position.clone(),rotation:this.tempGroup.rotation.clone(),scale:this.tempGroup.scale.clone()})}applyTransformToSelectedObjects(){if(!this.tempGroup||!this.transformControls.object||this.selectedObjects.length<=1)return;const e={position:this.tempGroup.position.clone(),rotation:this.tempGroup.rotation.clone(),scale:this.tempGroup.scale.clone()},t=this.initialTransformStates.get(this.tempGroup);if(t)for(const n of this.selectedObjects)if(n){const i=this.initialTransformStates.get(n);i&&this.applyRelativeTransformFromGroup(n,e,t,i)}}applyRelativeTransformFromGroup(e,t,n,i){switch(this.transformControls.getMode()){case"translate":const s=(new B).subVectors(t.position,n.position);e.position.copy(i.position).add(s);break;case"rotate":const a=(new ae).setFromEuler(new $e(n.rotation.x,n.rotation.y,n.rotation.z)),r=(new ae).setFromEuler(new $e(t.rotation.x,t.rotation.y,t.rotation.z)),o=(new ae).multiplyQuaternions(r,a.invert()),l=(new B).subVectors(i.position,n.position);l.applyQuaternion(o),e.position.copy(t.position).add(l);const c=(new ae).setFromEuler(new $e(i.rotation.x,i.rotation.y,i.rotation.z));e.quaternion.multiplyQuaternions(o,c);break;case"scale":const A=new B(t.scale.x/n.scale.x,t.scale.y/n.scale.y,t.scale.z/n.scale.z),d=(new B).subVectors(i.position,n.position);d.multiply(A),e.position.copy(t.position).add(d),e.scale.copy(i.scale).multiply(A)}}applyRelativeTransform(e,t,n,i){switch(this.transformControls.getMode()){case"translate":const s=(new B).subVectors(t.position,n.position);e.position.copy(i.position).add(s);break;case"rotate":const a=new $e(t.rotation.x-n.rotation.x,t.rotation.y-n.rotation.y,t.rotation.z-n.rotation.z);e.rotation.copy(i.rotation),e.rotation.x+=a.x,e.rotation.y+=a.y,e.rotation.z+=a.z;break;case"scale":const r=new B(t.scale.x/n.scale.x,t.scale.y/n.scale.y,t.scale.z/n.scale.z);e.scale.copy(i.scale).multiply(r)}}initializeTransformControls(){var e,t;try{this.transformControls=new Aa(this.camera,this.renderer.domElement);try{const e=this.editorStore.getState();Number.isFinite(null==e?void 0:e.gizmoSize)&&this.transformControls.setSize(e.gizmoSize);const t=!!(null==e?void 0:e.isGridSnap),n=Number.isFinite(null==e?void 0:e.gridSize)?e.gridSize:1,i=Number.isFinite(null==e?void 0:e.snapMove)?e.snapMove:n,s=Number.isFinite(null==e?void 0:e.snapRotateDeg)?Z.degToRad(e.snapRotateDeg):Z.degToRad(15),a=Number.isFinite(null==e?void 0:e.snapScale)?e.snapScale:.1;t?(this.transformControls.setTranslationSnap(i||n||1),this.transformControls.setRotationSnap(s),this.transformControls.setScaleSnap(a)):(this.transformControls.setTranslationSnap(null),this.transformControls.setRotationSnap(null),this.transformControls.setScaleSnap(null))}catch{}this.transformControls.addEventListener("dragging-changed",e=>{var t,n,i,s,a,r;if(this.isDragging=e.value,e.value){this.saveInitialTransformStates();try{const e=null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t);(null==e?void 0:e.beginBatch)&&e.beginBatch()}catch{}}else{try{null==(i=this.flushPendingTransformUpdates)||i.call(this)}catch{}this.initialTransformStates.clear();try{const e=null==(a=null==(s=this.editorStore)?void 0:s.getState)?void 0:a.call(s),t=null==e?void 0:e.updateObjectTransform;if(t){const e=this.selectedObjects&&this.selectedObjects.length>0?this.selectedObjects:this.lastSelectedObject?[this.lastSelectedObject]:[];for(const n of e){const e=null==(r=null==n?void 0:n.userData)?void 0:r.id;e&&t(e,{position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})}}(null==e?void 0:e.endBatch)&&e.endBatch()}catch{}}}),this.transformControls.addEventListener("change",()=>{var e,t;this.applyTransformToSelectedObjects();try{const n=this.selectedObjects&&this.selectedObjects.length>0?this.selectedObjects:this.lastSelectedObject?[this.lastSelectedObject]:[];try{"rotate"===(null==(t=(e=this.transformControls).getMode)?void 0:t.call(e))&&n.forEach(e=>{var t;if(e&&e.isLight&&(e.isSpotLight||e.isDirectionalLight)&&e.target)try{const n=new B,i=new B;e.getWorldPosition(n),e.getWorldDirection(i);let s=0;try{s=e.target.getWorldPosition(new B).distanceTo(n)}catch{}(!Number.isFinite(s)||s<.001)&&(s=10);const a=n.clone().add(i.multiplyScalar(s));e.target.position.copy(a),e.target.updateMatrixWorld(!0),(null==(t=e.userData)?void 0:t.lightHelper)&&"function"==typeof e.userData.lightHelper.update&&e.userData.lightHelper.update()}catch{}})}catch{}n.forEach(e=>this.scheduleTransformUpdate(e))}catch{}}),this.transformControls.setSize(1);const n=this.transformControls.getHelper();if(n instanceof M){try{const i=null==(t=null==(e=n.children)?void 0:e.find)?void 0:t.call(e,e=>"helper"===e.name);i&&(i.visible=!1);const s=e=>{var t;const n=[];null==(t=e.traverse)||t.call(e,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,i=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||i)&&n.push(e)}),n.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const n=e.material;Array.isArray(n)?n.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==n?void 0:n.dispose)&&n.dispose()}catch{}})};s(n),n.onBeforeRender=()=>{try{i&&(i.visible=!1),s(n)}catch{}}}catch{}n.renderOrder=999;(this.gizmoScene||this.scene).add(n);try{const e=()=>{var e,t,i;try{const s=null==(t=null==(e=n.children)?void 0:e.find)?void 0:t.call(e,e=>"helper"===e.name);s&&(s.visible=!1);const a=[];null==(i=n.traverse)||i.call(n,e=>{const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,n=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||n)&&a.push(e)}),a.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const n=e.material;Array.isArray(n)?n.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==n?void 0:n.dispose)&&n.dispose()}catch{}})}catch{}};this.transformControls.addEventListener("change",e),this.transformControls.addEventListener("dragging-changed",e),this.transformControls.addEventListener("mouseDown",e),this.transformControls.addEventListener("mouseUp",e),this.transformControls.addEventListener("objectChange",e)}catch{}}}catch(n){this.transformControls=null}}scheduleTransformUpdate(e){var t,n,i,s,a,r,o,l,c;if(!e)return;const A=null==(t=e.userData)?void 0:t.id;if(A){try{if(e.isLight&&(null==(n=e.userData)?void 0:n.lightHelper)){const t=e.userData.lightHelper;try{e.updateMatrixWorld(!0)}catch{}try{null==(s=null==(i=e.target)?void 0:i.updateMatrixWorld)||s.call(i,!0)}catch{}"function"==typeof t.update&&t.update()}else if(null==(a=e.userData)?void 0:a.isLightTarget){let t=null;try{const n=null==(r=e.userData)?void 0:r.ownerId;n?this.scene.traverse(e=>{var i;!t&&(null==e?void 0:e.isLight)&&(null==(i=e.userData)?void 0:i.id)===n&&(t=e)}):this.scene.traverse(n=>{!t&&(null==n?void 0:n.isLight)&&n.target===e&&(t=n)})}catch{}if((null==(o=null==t?void 0:t.userData)?void 0:o.lightHelper)&&"function"==typeof t.userData.lightHelper.update){try{t.updateMatrixWorld(!0)}catch{}try{null==(c=null==(l=t.target)?void 0:l.updateMatrixWorld)||c.call(l,!0)}catch{}t.userData.lightHelper.update()}}}catch{}this._pendingTransformUpdates.set(A,{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}),this._rafScheduled||(this._rafScheduled=!0,requestAnimationFrame(()=>this.flushPendingTransformUpdates()))}}flushPendingTransformUpdates(){var e,t,n,i;if(this._rafScheduled=!1,this._pendingTransformUpdates&&0!==this._pendingTransformUpdates.size){try{const n=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:t.call(e),i=null==n?void 0:n.updateObjectTransform;if(i)for(const[e,t]of this._pendingTransformUpdates.entries())i(e,t)}catch{}try{null==(i=null==(n=this.selectedObjects)?void 0:n.forEach)||i.call(n,e=>{var t;(null==e?void 0:e.isLight)&&(null==(t=e.userData)?void 0:t.lightHelper)&&"function"==typeof e.userData.lightHelper.update&&e.userData.lightHelper.update()})}catch{}this._pendingTransformUpdates.clear()}}createSelectionBox(){this.selectionBox=document.createElement("div"),this.selectionBox.style.position="absolute",this.selectionBox.style.border="2px dashed #007acc",this.selectionBox.style.backgroundColor="rgba(0, 122, 204, 0.1)",this.selectionBox.style.pointerEvents="none",this.selectionBox.style.display="none",this.selectionBox.style.zIndex="1000",document.body.appendChild(this.selectionBox)}isObjectValidForSelection(e){var t,n;if(!e||!e.visible||!e.isObject3D)return!1;const i=this.editorStore.getState(),s=(null==(t=e.userData)?void 0:t.id)??(null==(n=e.userData)?void 0:n.ownerId),a=i.objects.find(e=>e.id===s)||i.walls.find(e=>e.id===s);return!a||!a.frozen}_promoteToCanonical(e){if(!e||!e.userData)return e;const t=!!e.userData.id,n=e.userData.ownerId;if(!t&&null!=n){let t=e;for(;t;){if(t.userData&&t.userData.id===n)return t;t=t.parent}}return e}selectSingleObject(e){var t,n;if((e=this._promoteToCanonical(e))&&this.isObjectValidForSelection(e)){this.cleanupSelectedObjects(),this.deselectAllObjects(),this.selectedObjects=[e],this.lastSelectedObject=e,this.editorStore.getState().setSelectedObject(e);try{const i=this.editorStore.getState(),s=(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(n=null==e?void 0:e.userData)?void 0:n.ownerId);(null==i?void 0:i.setSelectedIds)&&i.setSelectedIds(null!=s?[s]:[])}catch{}if(this.clearTempGroup(),this.transformControls&&e.parent){let t=!1,n=e;for(;n.parent;)if(n=n.parent,n===this.scene){t=!0;break}t&&(this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}this._syncOutlineWithSelection();try{this.addSelectionOutline(e),this.updateSelectionOutline(e)}catch{}this._requestRender()}}selectMultipleObjects(e,t=!1){if(e&&Array.isArray(e)){t||this.deselectAllObjects();for(let t of e)if(t=this._promoteToCanonical(t),t&&!this.selectedObjects.includes(t)){this.selectedObjects.push(t),this.lastSelectedObject=t;try{this.addSelectionOutline(t),this.updateSelectionOutline(t)}catch{}}if(this.selectedObjects.length>1){const e=this.createTempGroup();if(e&&this.transformControls){e.parent===(this.gizmoScene||this.scene)&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}}else if(1===this.selectedObjects.length){this.clearTempGroup();const e=this.selectedObjects[0];e&&this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}try{const e=this.editorStore.getState(),t=this.selectedObjects.map(e=>{var t,n;return(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(n=null==e?void 0:e.userData)?void 0:n.ownerId)}).filter(e=>null!=e);(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds(t)}catch{}this._syncOutlineWithSelection(),this._requestRender()}}toggleObjectSelection(e){if(!e)return;e=this._promoteToCanonical(e);const t=this.selectedObjects.indexOf(e);if(t>-1)if(this.selectedObjects.splice(t,1),this.removeSelectionOutline(e),this.lastSelectedObject===e&&(this.lastSelectedObject=this.selectedObjects.length>0?this.selectedObjects[this.selectedObjects.length-1]:null),this.selectedObjects.length>1){const e=this.createTempGroup();e&&this.transformControls&&e.parent===this.scene&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else if(1===this.selectedObjects.length){this.clearTempGroup();const e=this.selectedObjects[0];e&&this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else this.clearTempGroup(),this.editorStore.getState().setSelectedObject(null),this.lastSelectedObject=null,this.transformControls&&this.transformControls.detach();else{this.selectedObjects.push(e),this.lastSelectedObject=e;try{this.addSelectionOutline(e),this.updateSelectionOutline(e)}catch{}if(this.selectedObjects.length>1){const e=this.createTempGroup();if(e&&this.transformControls){e.parent===(this.gizmoScene||this.scene)&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}}else this.clearTempGroup(),this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}try{const e=this.editorStore.getState(),t=this.selectedObjects.map(e=>{var t,n;return(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(n=null==e?void 0:e.userData)?void 0:n.ownerId)}).filter(e=>null!=e);(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds(t)}catch{}this._syncOutlineWithSelection(),this._requestRender()}deselectAllObjects(){if(this.transformControls)try{this.transformControls.detach()}catch(e){}this.clearTempGroup(),this.cleanupSelectedObjects();for(const t of this.selectedObjects)if(t)try{this.removeSelectionOutline(t)}catch(e){}this.selectedObjects=[],this.lastSelectedObject=null,this.editorStore.getState().setSelectedObject(null);try{const e=this.editorStore.getState();(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds([])}catch{}this._syncOutlineWithSelection(),this._requestRender()}cleanupSelectedObjects(){this.isDragging||(this.selectedObjects.length,this.selectedObjects=this.selectedObjects.filter(e=>this.isObjectValidForSelection(e)&&this.isInSceneGraph(e)),!this.lastSelectedObject||this.isObjectValidForSelection(this.lastSelectedObject)&&this.isInSceneGraph(this.lastSelectedObject)||(this.lastSelectedObject=this.selectedObjects.length>0?this.selectedObjects[this.selectedObjects.length-1]:null),this.validateTransformAttachment())}handleObjectSelection(e,t=!1){if(this.isDragging)return;this.raycaster.setFromCamera(e,this.camera);let n=[];try{n=this.raycaster.intersectObjects(this.selectableObjects,!0)}catch{n=[]}if((!n||0===n.length)&&this.scene)try{const e=this.raycaster.intersectObjects(this.scene.children,!0),t=e=>{let t=e;for(;t;){if(this.selectableObjects.includes(t))return t;t=t.parent}return null};for(const i of e){const e=t(i.object);if(e){n=[{object:e}];break}}}catch{}if(n&&n.length>0){let e=n[0].object;for(;e&&e.parent&&!this.selectableObjects.includes(e);)e=e.parent;if(!e||!this.selectableObjects.includes(e)||!this.isObjectValidForSelection(e))return void(t||this.isDragging||this.deselectAllObjects());t?this.toggleObjectSelection(e):this.selectSingleObject(e)}else t||this.isDragging||this.deselectAllObjects()}getObjectsInArea(e,t){const n=[],i=Math.min(e.x,t.x),s=Math.max(e.x,t.x),a=Math.min(e.y,t.y),r=Math.max(e.y,t.y);for(const o of this.selectableObjects){if(!this.isObjectValidForSelection(o))continue;const e=new B;o.getWorldPosition(e),e.project(this.camera),e.x>=i&&e.x<=s&&e.y>=a&&e.y<=r&&n.push(o)}return n}addSelectionOutline(e){var t;e&&((null==(t=e.userData)?void 0:t.isSelectionOutline)||this._shouldUseFallbackOutline()&&(e.isGroup||e.children&&e.children.length>0?this.addSelectionOutlineToGroup(e):this.addSelectionOutlineToSingleMesh(e)))}addSelectionOutlineToGroup(e){e&&e.traverse&&e.traverse(t=>{var n;t&&t.isMesh&&t!==e&&!(null==(n=t.userData)?void 0:n.isSelectionOutline)&&this.addSelectionOutlineToSingleMesh(t)})}addSelectionOutlineToSingleMesh(e){var t,n,i;try{if(!e||!e.isMesh)return;if(null==(t=e.userData)?void 0:t.isSelectionOutline)return;if(!this._shouldUseFallbackOutline())return;if(e.userData||(e.userData={}),e.userData.outlineObject){try{const t=e.userData.outlineObject;t&&t.parent!==e&&(t.parent&&t.parent.remove(t),e.add(t))}catch{}return}const s=(null==(i=null==(n=e.geometry)?void 0:n.clone)?void 0:i.call(n))||null;if(!s)return;try{s.attributes&&s.attributes.normal||s.computeVertexNormals()}catch{}const a=this.lastSelectedObject===e||1===this.selectedObjects.length&&this.selectedObjects[0]===e,r=new C({color:a?16765952:16742912,side:tt,transparent:!1,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});try{s.computeBoundingSphere()}catch{}const o=s.boundingSphere?s.boundingSphere.radius:1,l=Math.max(.002,.005*o);r.onBeforeCompile=e=>{e.uniforms.uOutlineThickness={value:l},e.vertexShader=e.vertexShader.replace("#include <common>","#include <common>\nuniform float uOutlineThickness;").replace("#include <begin_vertex>","#include <begin_vertex>\n  vec3 worldNormal = normalize(mat3(modelMatrix) * normal);\n  transformed += worldNormal * uOutlineThickness;"),r.userData.shader=e};const c=new q(s,r);c.name="SelectionOutline",c.userData=c.userData||{},c.userData.isSelectionOutline=!0,c.userData.isSystemObject=!0;try{c.layers.mask=e.layers.mask}catch{}try{c.renderOrder=(e.renderOrder||0)+.001}catch{}e.add(c),e.userData.outlineObject=c}catch{}}removeSelectionOutline(e){e&&(e.isGroup||e.children&&e.children.length>0?this.removeSelectionOutlineFromGroup(e):this.removeSelectionOutlineFromMesh(e))}removeSelectionOutlineFromGroup(e){if(e&&e.traverse){try{e.traverse(t=>{var n;t&&t.isMesh&&t!==e&&!(null==(n=t.userData)?void 0:n.isSelectionOutline)&&this.removeSelectionOutlineFromMesh(t)})}catch(t){}e.userData&&delete e.userData.outlineChildren}}removeSelectionOutlineFromMesh(e){if(e&&e.userData&&!e.userData.isSelectionOutline){if(e.userData.outlineObject){if(e.userData.outlineObject.parent&&e.userData.outlineObject.parent.remove(e.userData.outlineObject),e.userData.outlineObject.geometry){if(this.isDragging)return;e.userData.outlineObject.geometry.dispose()}e.userData.outlineObject.material&&e.userData.outlineObject.material.dispose(),delete e.userData.outlineObject}e.material&&void 0!==e.userData.originalEmissive&&(e.material.emissive.copy(e.userData.originalEmissive),e.material.emissiveIntensity=e.userData.originalEmissiveIntensity,delete e.userData.originalEmissive,delete e.userData.originalEmissiveIntensity)}}updateSelectionOutline(e){var t;(null==(t=e.userData)?void 0:t.isSelectionOutline)||this._shouldUseFallbackOutline()&&(e.isGroup||e.children&&e.children.length>0?this.updateSelectionOutlineForGroup(e):this.updateSelectionOutlineForMesh(e))}updateSelectionOutlineForGroup(e){e&&e.traverse&&e.traverse(t=>{var n;t&&t.isMesh&&t!==e&&!(null==(n=t.userData)?void 0:n.isSelectionOutline)&&this.updateSelectionOutlineForMesh(t)})}updateSelectionOutlineForMesh(e){var t,n;if(!e||!e.isMesh)return;if(null==(t=e.userData)?void 0:t.isSelectionOutline)return;if(!this._shouldUseFallbackOutline())return;const i=null==(n=e.userData)?void 0:n.outlineObject;if(i)try{const t=this.lastSelectedObject===e||1===this.selectedObjects.length&&this.selectedObjects[0]===e?16765952:16742912;i.material&&i.material.color&&i.material.color.setHex(t)}catch{}}updateAllSelectionOutlines(){this.isDragging||this.cleanupSelectedObjects(),this._syncOutlineWithSelection();if(this._shouldUseFallbackOutline()){for(const e of this.selectedObjects)if(e){try{this.addSelectionOutline(e)}catch{}try{this.updateSelectionOutline(e)}catch{}}}else for(const e of this.selectedObjects)if(e)try{this.removeSelectionOutline(e)}catch{}}setGizmoMode(e){if(!this.transformControls)return;this.gizmoMode=e,this.transformControls.setMode(e);const t=this.editorStore.getState();t.setTransformMode&&t.setTransformMode(e);const n=this.editorStore.getState().selectedObject;n&&!this.transformControls.object&&this.transformControls.attach(n)}setGridSnap(e,t=1){if(this.transformControls)if(e){const e=this.editorStore.getState(),n=Number.isFinite(null==e?void 0:e.snapMove)?e.snapMove:t,i=Number.isFinite(null==e?void 0:e.snapRotateDeg)?Z.degToRad(e.snapRotateDeg):Z.degToRad(15),s=Number.isFinite(null==e?void 0:e.snapScale)?e.snapScale:.1;this.transformControls.setTranslationSnap(n||t),this.transformControls.setRotationSnap(i),this.transformControls.setScaleSnap(s)}else this.transformControls.setTranslationSnap(null),this.transformControls.setRotationSnap(null),this.transformControls.setScaleSnap(null)}updateGizmoSize(){var e;try{const t=null==(e=this.editorStore.getState())?void 0:e.gizmoSize;this.transformControls&&Number.isFinite(t)&&this.transformControls.setSize(t)}catch{}}updateGridSnap(){const e=this.editorStore.getState();this.setGridSnap(e.isGridSnap,e.gridSize)}updateGizmoSpace(){const e=this.editorStore.getState();this.transformControls&&this.transformControls.setSpace(e.gizmoSpace)}isChildOf(e,t){let n=e.parent;for(;n;){if(n===t)return!0;n=n.parent}return!1}updateCamera(e){this.camera=e,this.transformControls&&(this.transformControls.camera=e)}addSelectableObject(e){this.selectableObjects.includes(e)||this.selectableObjects.push(e)}removeSelectableObject(e){const t=this.selectableObjects.indexOf(e);t>-1&&this.selectableObjects.splice(t,1)}updateSelectableObjects(e){this.selectableObjects=[...e]}showSelectionBox(e,t,n,i){this.selectionBox.style.display="block",this.selectionBox.style.left=e+"px",this.selectionBox.style.top=t+"px",this.selectionBox.style.width=n+"px",this.selectionBox.style.height=i+"px"}hideSelectionBox(){this.selectionBox.style.display="none"}getSelectedObjects(){return[...this.selectedObjects]}getSelectableObjects(){return[...this.selectableObjects]}getTransformControls(){return this.transformControls}isDraggingGizmo(){return this.isDragging}dispose(){var e,t;if(this.clearTempGroup(),this.transformControls){try{const n=null==(t=(e=this.transformControls).getHelper)?void 0:t.call(e);n&&n.parent&&n.parent.remove(n)}catch{}this.transformControls.dispose()}this.selectionBox&&this.selectionBox.parentNode&&this.selectionBox.parentNode.removeChild(this.selectionBox)}}class La{constructor(e,t,n){this.objectSelector=e,this.editorStore=t,this.keyboardController=n,this.state={mode:"translate",space:"world",snapEnabled:!1,gridSize:1},this.registerKeyboardActions(),this.applyInitialSettings()}registerKeyboardActions(){this.keyboardController&&(this.keyboardController.registerTransformActions({setMode:e=>this.setTransformMode(e),toggleSpace:()=>this.toggleSpace(),toggleSnap:()=>this.toggleGridSnap()}),this.keyboardController.registerRotationActions({rotateX:e=>this.rotateSelectedX(e),rotateY:e=>this.rotateSelectedY(e),rotateZ:e=>this.rotateSelectedZ(e),resetRotation:()=>this.resetSelectedRotation()}),this.keyboardController.registerSelectionActions({deselectAll:()=>this.deselectAll(),selectAll:()=>this.selectAll()}),this.keyboardController.registerObjectActions({deleteSelected:()=>this.deleteSelected(),duplicateSelected:()=>this.duplicateSelected(),groupSelected:()=>this.groupSelected(),ungroupSelected:()=>this.ungroupSelected()}),this.keyboardController.registerSystemActions({undo:()=>this.undo(),redo:()=>this.redo()}))}setTransformMode(e){var t;return!(!this.isValidMode(e)||!this.objectSelector)&&(this.state.mode,this.state.mode=e,this.objectSelector.setGizmoMode(e),"rotate"===e&&this.setupQuaternionRotation(),(null==(t=this.editorStore)?void 0:t.getState().setTransformMode)&&this.editorStore.getState().setTransformMode(e),!0)}toggleSpace(){var e;return!!(null==(e=this.objectSelector)?void 0:e.transformControls)&&(this.state.space,this.state.space="world"===this.state.space?"local":"world",this.objectSelector.transformControls.setSpace(this.state.space),!0)}toggleGridSnap(){return!!this.objectSelector&&(this.state.snapEnabled=!this.state.snapEnabled,this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),!0)}setGridSize(e){return!(!this.objectSelector||!this.isValidGridSize(e))&&(this.state.gridSize,this.state.gridSize=e,this.state.snapEnabled&&this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),!0)}deselectAll(){var e;return!!this.objectSelector&&(null==(e=this.objectSelector.selectedObjects)||e.length,this.objectSelector.deselectAllObjects(),!0)}selectAll(){if(!this.objectSelector)return!1;const e=this.objectSelector.getSelectableObjects();return!!(e&&e.length>0)&&(this.objectSelector.selectMultipleObjects(e),!0)}deleteSelected(){var e,t,n,i,s,a,r,o,l,c;if(!this.objectSelector||!this.hasSelectedObjects())return!1;const A=[...this.objectSelector.selectedObjects];try{null==(i=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:(n=t.call(e)).beginBatch)||i.call(n)}catch{}A.map(e=>{var t,n;return(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(n=null==e?void 0:e.userData)?void 0:n.ownerId)}).filter(Boolean);const d=null==(a=null==(s=this.editorStore)?void 0:s.getState)?void 0:a.call(s);this.deselectAll(),A.forEach(e=>{var t,n;this.removeObjectFromScene(e);const i=(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(n=null==e?void 0:e.userData)?void 0:n.ownerId);i&&(null==d?void 0:d.removeObjectById)&&d.removeObjectById(i)});try{null==(c=null==(o=null==(r=this.editorStore)?void 0:r.getState)?void 0:(l=o.call(r)).endBatch)||c.call(l)}catch{}return!0}duplicateSelected(){var e,t,n,i,s,a,r,o,l,c;if(!this.objectSelector||!this.hasSelectedObjects())return!1;const A=[...this.objectSelector.selectedObjects],d=[];try{null==(i=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:(n=t.call(e)).beginBatch)||i.call(n)}catch{}const h=null==(a=null==(s=this.editorStore)?void 0:s.getState)?void 0:a.call(s);A.forEach(e=>{var t,n,i,s,a;const r=this.cloneObject(e);if(r){d.push(r);const o=null==(t=r.userData)?void 0:t.id;o&&(null==h?void 0:h.addObject)&&h.addObject({id:o,name:r.name||`Object_${o}`,type:(null==(n=null==e?void 0:e.userData)?void 0:n.type)||"basic",parentId:(null==(i=null==e?void 0:e.userData)?void 0:i.id)?(null==(a=null==(s=e.parent)?void 0:s.userData)?void 0:a.id)??null:null,position:{x:r.position.x,y:r.position.y,z:r.position.z},rotation:{x:r.rotation.x,y:r.rotation.y,z:r.rotation.z},scale:{x:r.scale.x,y:r.scale.y,z:r.scale.z},visible:!1!==r.visible})}}),d.length>0&&this.selectObjects(d);try{null==(c=null==(o=null==(r=this.editorStore)?void 0:r.getState)?void 0:(l=o.call(r)).endBatch)||c.call(l)}catch{}return d}groupSelected(){var e,t,n,i,s,a,r,o,l,c,A,d,h;if(!this.objectSelector||(null==(e=this.objectSelector.selectedObjects)?void 0:e.length)<2)return!1;const u=[...this.objectSelector.selectedObjects];try{null==(s=null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:(i=n.call(t)).beginBatch)||s.call(i)}catch{}const p=this.createGroup(u);if(p){this.selectObjects([p]);try{null==(l=null==(r=null==(a=this.editorStore)?void 0:a.getState)?void 0:(o=r.call(a)).endBatch)||l.call(o)}catch{}return p}try{null==(h=null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:(d=A.call(c)).endBatch)||h.call(d)}catch{}return!1}ungroupSelected(){var e,t,n,i,s,a,r,o,l,c,A,d,h;if(!this.objectSelector||1!==(null==(e=this.objectSelector.selectedObjects)?void 0:e.length))return!1;const u=this.objectSelector.selectedObjects[0];if(!this.isGroup(u))return!1;try{null==(s=null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:(i=n.call(t)).beginBatch)||s.call(i)}catch{}const p=this.ungroupObject(u);if(p.length>0){this.selectObjects(p);try{null==(l=null==(r=null==(a=this.editorStore)?void 0:a.getState)?void 0:(o=r.call(a)).endBatch)||l.call(o)}catch{}return p}try{null==(h=null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:(d=A.call(c)).endBatch)||h.call(d)}catch{}return!1}applyInitialSettings(){this.objectSelector&&(this.objectSelector.setGizmoMode(this.state.mode),this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),this.objectSelector.isMagnetEnabled=this.state.magnetEnabled,this.objectSelector.showMagnetRays=this.state.magnetRaysVisible,this.objectSelector.transformControls&&(this.objectSelector.transformControls.setSpace(this.state.space),this.setupQuaternionRotation()))}setupQuaternionRotation(){var e;if(!(null==(e=this.objectSelector)?void 0:e.transformControls))return;const t=this.objectSelector.transformControls;"rotate"===this.state.mode&&(t.rotationSnap=Math.PI/12,this.setupRotationEventListeners())}setupRotationEventListeners(){var e;if(!(null==(e=this.objectSelector)?void 0:e.transformControls))return;const t=this.objectSelector.transformControls;t.addEventListener("objectChange",()=>{"rotate"===t.getMode()&&this.hasSelectedObjects()&&this.onQuaternionRotationChange()})}onQuaternionRotationChange(){const e=this.objectSelector.selectedObjects;e.forEach((e,t)=>{e.quaternion.normalize(),e.updateMatrix(),e.updateMatrixWorld()}),e.length>0&&this.getSelectedObjectRotation(e[0])}updateObjectSelector(e){this.objectSelector=e,this.applyInitialSettings()}getState(){var e,t;return{...this.state,selectedObjectsCount:(null==(t=null==(e=this.objectSelector)?void 0:e.selectedObjects)?void 0:t.length)||0,hasSelection:this.hasSelectedObjects()}}applySettings(e){e.mode&&e.mode!==this.state.mode&&this.setTransformMode(e.mode),e.space&&e.space!==this.state.space&&this.toggleSpace(),void 0!==e.snapEnabled&&e.snapEnabled!==this.state.snapEnabled&&this.toggleGridSnap(),e.gridSize&&e.gridSize!==this.state.gridSize&&this.setGridSize(e.gridSize)}rotateSelectedObjects(e){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(t=>{this.applyQuaternionRotation(t,e)}),!0}applyQuaternionRotation(e,t){e&&(e.quaternion.multiplyQuaternions(t,e.quaternion),e.updateMatrix())}rotateSelectedX(e){const t=Z.degToRad(e),n=(new ae).setFromAxisAngle(new B(1,0,0),t);return this.rotateSelectedObjects(n)}rotateSelectedY(e){const t=Z.degToRad(e),n=(new ae).setFromAxisAngle(new B(0,1,0),t);return this.rotateSelectedObjects(n)}rotateSelectedZ(e){const t=Z.degToRad(e),n=(new ae).setFromAxisAngle(new B(0,0,1),t);return this.rotateSelectedObjects(n)}rotateSelectedAroundAxis(e,t){if(!e||0===e.length())return!1;const n=e.clone().normalize(),i=Z.degToRad(t),s=(new ae).setFromAxisAngle(n,i);return this.rotateSelectedObjects(s)}rotateSelectedByEuler(e,t,n,i="XYZ"){const s=new $e(Z.degToRad(e),Z.degToRad(t),Z.degToRad(n),i),a=(new ae).setFromEuler(s);return this.rotateSelectedObjects(a)}rotateSelectedToLookAt(e){if(!this.hasSelectedObjects()||!e)return!1;return this.objectSelector.selectedObjects.forEach(t=>{(new B).subVectors(e,t.position).normalize();const n=new S;n.lookAt(t.position,e,new B(0,1,0));const i=(new ae).setFromRotationMatrix(n);t.quaternion.copy(i),t.updateMatrix()}),!0}resetSelectedRotation(){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(e=>{e.quaternion.set(0,0,0,1),e.updateMatrix()}),!0}getSelectedObjectRotation(e=null){const t=e||this.objectSelector.selectedObjects[0];if(!t)return null;const n=(new $e).setFromQuaternion(t.quaternion,"XYZ");return{x:Z.radToDeg(n.x),y:Z.radToDeg(n.y),z:Z.radToDeg(n.z),quaternion:t.quaternion.clone()}}rotateSelectedInWorldSpace(e){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(t=>{const n=new ae;if(t.getWorldQuaternion(n),n.premultiply(e),t.parent){const e=new ae;t.parent.getWorldQuaternion(e),e.invert(),t.quaternion.multiplyQuaternions(e,n)}else t.quaternion.copy(n);t.updateMatrix()}),!0}rotateSelectedAroundPoint(e,t){if(!this.hasSelectedObjects()||!e)return!1;return this.objectSelector.selectedObjects.forEach(n=>{const i=n.position.clone().sub(e);i.applyQuaternion(t),n.position.copy(e).add(i),n.quaternion.multiplyQuaternions(t,n.quaternion),n.updateMatrix()}),!0}isValidMode(e){return["translate","rotate","scale"].includes(e)}isValidGridSize(e){return"number"==typeof e&&e>0&&e<=100}hasSelectedObjects(){var e,t;return(null==(t=null==(e=this.objectSelector)?void 0:e.selectedObjects)?void 0:t.length)>0}isGroup(e){var t;return!0===(null==(t=null==e?void 0:e.userData)?void 0:t.isGroup)||"Group"===(null==e?void 0:e.type)}removeObjectFromScene(e){e&&e.parent&&(e.parent.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))}cloneObject(e){if(!e)return null;const t=e.clone();return t.position.x+=1,t.position.z+=1,t.userData={...e.userData,id:`${e.userData.id}_copy_${Date.now()}`},e.parent.add(t),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(t),t}createGroup(e){var t,n,i;if(!e||e.length<2)return null;const s=new J;s.name=`Group_${Date.now()}`,s.userData={id:`group_${Date.now()}`,type:"group",isGroup:!0};e[0].parent.add(s),e.forEach(e=>{if(e&&e.parent){const t=e.matrixWorld.clone();s.add(e),e.matrix.copy(t),e.matrix.premultiply(s.matrixWorld.clone().invert()),e.matrix.decompose(e.position,e.quaternion,e.scale)}}),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(s);try{const a=null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t);if((null==a?void 0:a.addObject)&&a.addObject({id:s.userData.id,name:s.name,type:"group",position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z},visible:!0}),null==a?void 0:a.setParent)for(const t of e){const e=null==(i=null==t?void 0:t.userData)?void 0:i.id;e&&a.setParent(e,s.userData.id)}}catch{}return s}ungroupObject(e){var t,n,i,s,a,r,o;if(!this.isGroup(e))return[];const l=[...e.children],c=e.parent;l.forEach(e=>{if(e){const t=e.matrixWorld.clone();c.add(e),e.matrix.copy(t),e.matrix.premultiply(c.matrixWorld.clone().invert()),e.matrix.decompose(e.position,e.quaternion,e.scale),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(e)}});try{const e=null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t);if(null==e?void 0:e.setParent){const t=(null==(i=null==c?void 0:c.userData)?void 0:i.id)??null;for(const n of l){const i=null==(s=null==n?void 0:n.userData)?void 0:s.id;i&&(e.setParent(i,t),e.updateObjectTransform&&e.updateObjectTransform(i,{position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}}))}}}catch{}this.objectSelector.removeSelectableObject&&this.objectSelector.removeSelectableObject(e),c.remove(e);try{const t=null==(r=null==(a=this.editorStore)?void 0:a.getState)?void 0:r.call(a),n=null==(o=null==e?void 0:e.userData)?void 0:o.id;n&&(null==t?void 0:t.removeObjectById)&&t.removeObjectById(n)}catch{}return l}selectObjects(e){this.objectSelector&&e&&0!==e.length&&(this.objectSelector.deselectAllObjects(),1===e.length?this.objectSelector.selectSingleObject(e[0]):this.objectSelector.selectMultipleObjects(e))}logStateChange(e,t,n){}undo(){var e;try{const t=null==(e=this.editorStore)?void 0:e.getState();(null==t?void 0:t.undo)&&t.undo()}catch(t){}}redo(){var e;try{const t=null==(e=this.editorStore)?void 0:e.getState();(null==t?void 0:t.redo)&&t.redo()}catch(t){}}dispose(){this.objectSelector=null,this.editorStore=null,this.keyboardController=null}}class Pa{constructor(){this.isEnabled=!0,this.pressedKeys=new Set,this.mouseState={isDown:!1,button:-1,position:{x:0,y:0},previousPosition:{x:0,y:0},dragStart:{x:0,y:0}},this.handlers={keyboard:new Map,mouse:new Map,wheel:null,contextMenu:null,resize:null},this.modifierKeys={ctrl:!1,shift:!1,alt:!1,meta:!1},this.boundHandlers={keyDown:this.handleKeyDown.bind(this),keyUp:this.handleKeyUp.bind(this),mouseDown:this.handleMouseDown.bind(this),mouseMove:this._scheduleMouseMove.bind(this),mouseUp:this.handleMouseUp.bind(this),wheel:this.handleWheel.bind(this),contextMenu:this.handleContextMenu.bind(this),resize:this.handleResize.bind(this)},this._mouseMoveScheduled=!1,this._lastMouseMoveEvent=null,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",this.boundHandlers.keyDown),document.addEventListener("keyup",this.boundHandlers.keyUp),window.addEventListener("resize",this.boundHandlers.resize)}setupMouseEvents(e){this.canvas=e,e.addEventListener("mousedown",this.boundHandlers.mouseDown),document.addEventListener("mousemove",this.boundHandlers.mouseMove),document.addEventListener("mouseup",this.boundHandlers.mouseUp),e.addEventListener("wheel",this.boundHandlers.wheel,{passive:!1}),e.addEventListener("contextmenu",this.boundHandlers.contextMenu)}handleKeyDown(e){if(!this.isEnabled||this.isInputFieldActive(e.target))return;this.updateModifierKeys(e),this.pressedKeys.add(e.code);const t={code:e.code,key:e.key,ctrl:this.modifierKeys.ctrl,shift:this.modifierKeys.shift,alt:this.modifierKeys.alt,meta:this.modifierKeys.meta,originalEvent:e};this.modifierKeys.ctrl||this.modifierKeys.meta?this.executeHandler("keyboard","ctrl",t):this.executeHandler("keyboard",e.code,t)}handleKeyUp(e){if(!this.isEnabled)return;this.updateModifierKeys(e),this.pressedKeys.delete(e.code);const t={code:e.code,key:e.key,ctrl:this.modifierKeys.ctrl,shift:this.modifierKeys.shift,alt:this.modifierKeys.alt,meta:this.modifierKeys.meta,originalEvent:e};this.executeHandler("keyboard","keyup",t)}handleMouseDown(e){if(!this.isEnabled)return;this.mouseState.isDown=!0,this.mouseState.button=e.button,this.updateMousePosition(e),this.mouseState.previousPosition={...this.mouseState.position},this.mouseState.dragStart={...this.mouseState.position};const t={button:e.button,position:{...this.mouseState.position},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e};this.executeHandler("mouse","mousedown",t)}handleMouseMove(e){if(!this.isEnabled)return;this.mouseState.previousPosition={...this.mouseState.position},this.updateMousePosition(e);const t={position:{...this.mouseState.position},previousPosition:{...this.mouseState.previousPosition},dragStart:{...this.mouseState.dragStart},isDown:this.mouseState.isDown,button:this.mouseState.button,delta:{x:this.mouseState.position.x-this.mouseState.previousPosition.x,y:this.mouseState.position.y-this.mouseState.previousPosition.y},originalEvent:e};this.executeHandler("mouse","mousemove",t)}_scheduleMouseMove(e){if(this._lastMouseMoveEvent=e,this._mouseMoveScheduled)return;this._mouseMoveScheduled=!0;const t=()=>{this._mouseMoveScheduled=!1;const e=this._lastMouseMoveEvent;if(this._lastMouseMoveEvent=null,e)try{this.handleMouseMove(e)}catch(t){}};"undefined"!=typeof window&&"function"==typeof window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,0)}handleMouseUp(e){if(!this.isEnabled)return;const t={button:e.button,position:{...this.mouseState.position},dragStart:{...this.mouseState.dragStart},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e};this.executeHandler("mouse","mouseup",t),this.mouseState.isDown=!1,this.mouseState.button=-1}handleWheel(e){if(!this.isEnabled)return;e.preventDefault();const t={delta:e.deltaY,position:{...this.mouseState.position},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,originalEvent:e};this.handlers.wheel&&this.handlers.wheel(t)}handleContextMenu(e){e.preventDefault(),this.handlers.contextMenu&&this.handlers.contextMenu(e)}handleResize(e){this.handlers.resize&&this.handlers.resize(e)}updateMousePosition(e){if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.mouseState.position={x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,screenX:e.clientX,screenY:e.clientY}}updateModifierKeys(e){this.modifierKeys.ctrl=e.ctrlKey,this.modifierKeys.shift=e.shiftKey,this.modifierKeys.alt=e.altKey,this.modifierKeys.meta=e.metaKey}executeHandler(e,t,n){var i;if("keyboard"===e){const e=this.handlers.keyboard.get("default");if(e)try{e(n)}catch(s){}}else{const a=null==(i=this.handlers[e])?void 0:i.get(t);if(a)try{a(n)}catch(s){}}}isInputFieldActive(e){return["INPUT","TEXTAREA","SELECT"].includes(e.tagName)||"true"===e.contentEditable}registerKeyHandler(e,t){this.handlers.keyboard.has(e)||this.handlers.keyboard.set(e,t)}registerMouseHandler(e,t){this.handlers.mouse.has(e)||this.handlers.mouse.set(e,t)}registerWheelHandler(e){this.handlers.wheel=e}registerContextMenuHandler(e){this.handlers.contextMenu=e}registerResizeHandler(e){this.handlers.resize=e}unregisterHandler(e,t){var n;"wheel"===e?this.handlers.wheel=null:"contextMenu"===e?this.handlers.contextMenu=null:null==(n=this.handlers[e])||n.delete(t)}clearAllHandlers(){this.handlers.keyboard.clear(),this.handlers.mouse.clear(),this.handlers.wheel=null,this.handlers.contextMenu=null}setEnabled(e){this.isEnabled=e}isKeyPressed(e){return this.pressedKeys.has(e)}getModifierKeys(){return{...this.modifierKeys}}getMouseState(){return{...this.mouseState}}getInputState(){return{enabled:this.isEnabled,pressedKeys:Array.from(this.pressedKeys),modifierKeys:this.getModifierKeys(),mouseState:this.getMouseState()}}dispose(){document.removeEventListener("keydown",this.boundHandlers.keyDown),document.removeEventListener("keyup",this.boundHandlers.keyUp),this.canvas&&(this.canvas.removeEventListener("mousedown",this.boundHandlers.mouseDown),this.canvas.removeEventListener("wheel",this.boundHandlers.wheel),this.canvas.removeEventListener("contextmenu",this.boundHandlers.contextMenu)),document.removeEventListener("mousemove",this.boundHandlers.mouseMove),document.removeEventListener("mouseup",this.boundHandlers.mouseUp),window.removeEventListener("resize",this.boundHandlers.resize),this.clearAllHandlers(),this.canvas=null,this.boundHandlers=null,this.pressedKeys.clear()}}class Fa{constructor(e){this.inputManager=e,this.comboLocks=new Set,this.actions={transform:new Map,rotation:new Map,selection:new Map,viewport:new Map,object:new Map,system:new Map},this.setupDefaultKeyMappings(),this.registerInputHandlers()}setupDefaultKeyMappings(){this.actions.transform.set("KeyW",{name:"Move Mode",description:"이동 모드",action:null,allowRepeat:!1,category:"transform"}),this.actions.transform.set("KeyE",{name:"Rotate Mode",description:"회전 모드",action:null,allowRepeat:!1,category:"transform"}),this.actions.transform.set("KeyR",{name:"Scale Mode",description:"크기 모드",action:null,allowRepeat:!1,category:"transform"}),this.actions.transform.set("KeyQ",{name:"Toggle Space",description:"좌표계 전환",action:null,allowRepeat:!1,category:"transform"}),this.actions.transform.set("KeyX",{name:"Toggle Snap",description:"그리드 스냅 토글",action:null,allowRepeat:!1,category:"transform"}),this.actions.rotation.set("KeyJ",{name:"Rotate X+",description:"X축 양의 방향 15도 회전",action:null,allowRepeat:!0,category:"rotation"}),this.actions.rotation.set("KeyL",{name:"Rotate X-",description:"X축 음의 방향 15도 회전",action:null,allowRepeat:!0,category:"rotation"}),this.actions.rotation.set("KeyI",{name:"Rotate Y+",description:"Y축 양의 방향 15도 회전",action:null,allowRepeat:!0,category:"rotation"}),this.actions.rotation.set("KeyK",{name:"Rotate Y-",description:"Y축 음의 방향 15도 회전",action:null,allowRepeat:!0,category:"rotation"}),this.actions.rotation.set("KeyU",{name:"Rotate Z+",description:"Z축 양의 방향 15도 회전",action:null,allowRepeat:!0,category:"rotation"}),this.actions.rotation.set("KeyO",{name:"Rotate Z-",description:"Z축 음의 방향 15도 회전",action:null,allowRepeat:!0,category:"rotation"}),this.actions.rotation.set("KeyP",{name:"Reset Rotation",description:"회전 초기화",action:null,allowRepeat:!1,category:"rotation"}),this.actions.selection.set("Escape",{name:"Deselect All",description:"모든 선택 해제",action:null,allowRepeat:!1,category:"selection"}),this.actions.selection.set("KeyA",{name:"Select All",description:"전체 선택",action:null,allowRepeat:!1,category:"selection",requiresCtrl:!0}),this.actions.object.set("Delete",{name:"Delete Objects",description:"선택된 오브젝트 삭제",action:null,allowRepeat:!1,category:"object"}),this.actions.object.set("Backspace",{name:"Delete Objects",description:"선택된 오브젝트 삭제",action:null,allowRepeat:!1,category:"object"}),this.actions.object.set("KeyD",{name:"Duplicate Objects",description:"오브젝트 복제",action:null,allowRepeat:!1,category:"object",requiresCtrl:!0}),this.actions.object.set("KeyG",{name:"Group Objects",description:"오브젝트 그룹화",action:null,allowRepeat:!1,category:"object",requiresCtrl:!0}),this.actions.viewport.set("KeyF",{name:"Focus on Object",description:"선택된 오브젝트로 포커스",action:null,allowRepeat:!1,category:"viewport"}),this.actions.viewport.set("Numpad5",{name:"Toggle Projection",description:"투영 모드 전환",action:null,allowRepeat:!1,category:"viewport"}),this.actions.viewport.set("Numpad1",{name:"Front View",description:"정면 뷰",action:null,allowRepeat:!1,category:"viewport"}),this.actions.viewport.set("Numpad3",{name:"Side View",description:"측면 뷰",action:null,allowRepeat:!1,category:"viewport"}),this.actions.viewport.set("Numpad7",{name:"Top View",description:"상단 뷰",action:null,allowRepeat:!1,category:"viewport"}),this.actions.viewport.set("Numpad0",{name:"Reset Camera",description:"카메라 리셋",action:null,allowRepeat:!1,category:"viewport"}),this.actions.system.set("KeyZ",{name:"Undo",description:"실행 취소",action:null,allowRepeat:!1,category:"system",requiresCtrl:!0}),this.actions.system.set("KeyY",{name:"Redo",description:"다시 실행",action:null,allowRepeat:!1,category:"system",requiresCtrl:!0}),this.actions.system.set("KeyS",{name:"Save",description:"저장",action:null,allowRepeat:!1,category:"system",requiresCtrl:!0})}registerInputHandlers(){this.inputManager.registerKeyHandler("default",this.handleKeyInput.bind(this))}handleKeyInput(e){const{code:t,ctrl:n,shift:i,originalEvent:s}=e;"keyup"!==(null==s?void 0:s.type)?n?this.handleCtrlKeyPress(e):this.handleKeyPress(e):this.releaseComboLocksForKey(t)}handleKeyPress(e){const{code:t,ctrl:n,shift:i,originalEvent:s}=e;if(n)return;const a=this.findAction(t);if(a&&a.action&&!a.requiresCtrl){if((null==s?void 0:s.repeat)&&!a.allowRepeat)return;s.preventDefault(),this.executeAction(a,e)}}handleCtrlKeyPress(e){const{code:t,shift:n,originalEvent:i}=e,s="KeyZ"===t||"KeyY"===t,a=this.buildComboSignature(t,{ctrl:!0,shift:n});if(s&&this.comboLocks.has(a))return;const r=this.findAction(t);if(r&&r.action&&r.requiresCtrl){if((null==i?void 0:i.repeat)&&!r.allowRepeat)return;if(i.preventDefault(),n&&"KeyG"===t)this.executeSpecialAction("ungroupObjects",e);else if(n&&"KeyZ"===t){if(null==i?void 0:i.repeat)return;s&&this.comboLocks.add(a),this.executeSpecialAction("redo",e)}else s&&this.comboLocks.add(a),this.executeAction(r,e)}}buildComboSignature(e,{ctrl:t=!1,shift:n=!1}={}){const i=[];return t&&i.push("Ctrl"),n&&i.push("Shift"),i.push(e),i.join("+")}releaseComboLocksForKey(e){const t=[];for(const n of this.comboLocks)n.endsWith(`+${e}`)&&t.push(n);for(const n of t)this.comboLocks.delete(n)}findAction(e){for(const[t,n]of Object.entries(this.actions))if(n.has(e))return n.get(e);return null}executeAction(e,t){if("function"==typeof e.action)try{e.action(t)}catch(n){}}executeSpecialAction(e,t){var n,i;const s={ungroupObjects:null==(n=this.actions.object.get("KeyG"))?void 0:n.ungroupAction,redo:null==(i=this.actions.system.get("KeyZ"))?void 0:i.redoAction}[e];if("function"==typeof s)try{s(t)}catch(a){}}registerTransformActions(e){e.setMode&&(this.actions.transform.get("KeyW").action=()=>e.setMode("translate"),this.actions.transform.get("KeyE").action=()=>e.setMode("rotate"),this.actions.transform.get("KeyR").action=()=>e.setMode("scale")),e.toggleSpace&&(this.actions.transform.get("KeyQ").action=e.toggleSpace),e.toggleSnap&&(this.actions.transform.get("KeyX").action=e.toggleSnap)}registerRotationActions(e){e.rotateX&&(this.actions.rotation.get("KeyJ").action=()=>e.rotateX(15),this.actions.rotation.get("KeyL").action=()=>e.rotateX(-15)),e.rotateY&&(this.actions.rotation.get("KeyI").action=()=>e.rotateY(15),this.actions.rotation.get("KeyK").action=()=>e.rotateY(-15)),e.rotateZ&&(this.actions.rotation.get("KeyU").action=()=>e.rotateZ(15),this.actions.rotation.get("KeyO").action=()=>e.rotateZ(-15)),e.resetRotation&&(this.actions.rotation.get("KeyP").action=e.resetRotation)}registerSelectionActions(e){e.deselectAll&&(this.actions.selection.get("Escape").action=e.deselectAll),e.selectAll&&(this.actions.selection.get("KeyA").action=e.selectAll)}registerObjectActions(e){e.deleteSelected&&(this.actions.object.get("Delete").action=e.deleteSelected,this.actions.object.get("Backspace").action=e.deleteSelected),e.duplicateSelected&&(this.actions.object.get("KeyD").action=e.duplicateSelected),e.groupSelected&&(this.actions.object.get("KeyG").action=e.groupSelected),e.ungroupSelected&&(this.actions.object.get("KeyG").ungroupAction=e.ungroupSelected)}registerViewportActions(e){e.focusOnSelected&&(this.actions.viewport.get("KeyF").action=e.focusOnSelected),e.toggleProjection&&(this.actions.viewport.get("Numpad5").action=e.toggleProjection),e.setView&&(this.actions.viewport.get("Numpad1").action=()=>e.setView("front"),this.actions.viewport.get("Numpad3").action=()=>e.setView("side"),this.actions.viewport.get("Numpad7").action=()=>e.setView("top")),e.resetCamera&&(this.actions.viewport.get("Numpad0").action=e.resetCamera)}registerSystemActions(e){e.undo&&(this.actions.system.get("KeyZ").action=e.undo),e.redo&&(this.actions.system.get("KeyZ").redoAction=e.redo,this.actions.system.has("KeyY")&&(this.actions.system.get("KeyY").action=e.redo)),e.save&&(this.actions.system.get("KeyS").action=e.save)}registerCustomKey(e,t,n,i,s="custom",a=!1){this.actions[s]||(this.actions[s]=new Map),this.actions[s].set(e,{name:t,description:n,action:i,category:s,requiresCtrl:a,allowRepeat:!1})}unregisterKey(e,t=null){if(t&&this.actions[t])this.actions[t].delete(e);else for(const n of Object.values(this.actions))if(n.has(e)){n.delete(e);break}}getKeyMappings(){const e={};for(const[t,n]of Object.entries(this.actions)){e[t]={};for(const[i,s]of n.entries())e[t][i]={name:s.name,description:s.description,requiresCtrl:s.requiresCtrl||!1}}return e}checkKeyConflicts(){const e=new Map,t=[];for(const[n,i]of Object.entries(this.actions))for(const[s,a]of i.entries()){const i=`${s}${a.requiresCtrl?"+Ctrl":""}`;e.has(i)?t.push({key:i,conflicting:[e.get(i),`${n}:${a.name}`]}):e.set(i,`${n}:${a.name}`)}return t.length,t}generateHelpText(){let e="Keyboard Shortcuts:\n\n";for(const[t,n]of Object.entries(this.actions))if(0!==n.size){e+=`${t.toUpperCase()}:\n`;for(const[t,i]of n.entries()){e+=`  ${this.formatKeyName(t,i.requiresCtrl).padEnd(20)} - ${i.description}\n`}e+="\n"}return e}formatKeyName(e,t=!1){const n={KeyW:"W",KeyE:"E",KeyR:"R",KeyQ:"Q",KeyX:"X",KeyV:"V",KeyC:"C",KeyA:"A",KeyD:"D",KeyG:"G",KeyF:"F",KeyZ:"Z",KeyS:"S",Escape:"ESC",Delete:"DEL",Backspace:"BACKSPACE",Numpad1:"NUM1",Numpad3:"NUM3",Numpad5:"NUM5",Numpad7:"NUM7",Numpad0:"NUM0"}[e]||e;return t?`Ctrl+${n}`:n}setEnabled(e){this.inputManager.setEnabled(e)}dispose(){for(const e of Object.values(this.actions))e.clear()}}class Na{constructor(e){this.inputManager=e,this.transformControls=null,this.objectSelector=null,this.state={isDragging:!1,dragButton:-1,dragThreshold:5,isSelecting:!1,isPanning:!1,isOrbiting:!1,isGizmoInteracting:!1},this.handlers={leftClick:null,rightClick:null,middleClick:null,leftDrag:null,rightDrag:null,middleDrag:null,dragSelect:null,wheel:null,hover:null},this.selectionBox={element:null,startX:0,startY:0,isVisible:!1},this.registerInputHandlers()}registerInputHandlers(){this.inputManager.registerMouseHandler("mousedown",this.handleMouseDown.bind(this)),this.inputManager.registerMouseHandler("mousemove",this.handleMouseMove.bind(this)),this.inputManager.registerMouseHandler("mouseup",this.handleMouseUp.bind(this)),this.inputManager.registerWheelHandler(this.handleWheel.bind(this))}setTransformControls(e){this.transformControls=e,this.setupGizmoEventListeners()}setObjectSelector(e){this.objectSelector=e,e&&e.transformControls&&this.setTransformControls(e.transformControls)}setupGizmoEventListeners(){this.transformControls&&this.transformControls.addEventListener("dragging-changed",e=>{this.state.isGizmoInteracting=e.value})}isGizmoInteracting(){return this.state.isGizmoInteracting||this.transformControls&&this.transformControls.dragging}handleMouseDown(e){const{button:t,position:n,ctrl:i,shift:s,alt:a,originalEvent:r}=e;if(!this.isGizmoInteracting())switch(this.state.dragButton=t,t){case 0:this.handleLeftMouseDown(e);break;case 1:this.handleMiddleMouseDown(e);break;case 2:this.handleRightMouseDown(e)}}handleLeftMouseDown(e){const{position:t,ctrl:n,shift:i}=e;if(this.isGizmoInteracting&&this.isGizmoInteracting())return;const s=n||i;this.state.isSelecting=!0,this.selectionBox.startX=t.screenX,this.selectionBox.startY=t.screenY,this.handlers.leftClick&&this.handlers.leftClick({position:t,isMultiSelect:s,originalEvent:e.originalEvent})}handleMiddleMouseDown(e){const{alt:t,originalEvent:n}=e;n.preventDefault(),t?this.state.isOrbiting=!0:this.state.isPanning=!0,this.handlers.middleClick&&this.handlers.middleClick({isOrbiting:this.state.isOrbiting,isPanning:this.state.isPanning,originalEvent:n})}handleRightMouseDown(e){this.handlers.rightClick&&this.handlers.rightClick(e)}handleMouseMove(e){const{position:t,isDown:n,button:i,delta:s}=e;if((!this.isGizmoInteracting()||!n)&&(!n&&this.handlers.hover&&this.handlers.hover({position:t}),n)){if(!this.state.isDragging){this.calculateDragDistance(e)>this.state.dragThreshold&&(this.state.isDragging=!0,this.onDragStart(e))}this.state.isDragging&&this.handleDragMove(e),this.state.isSelecting&&0===i&&this.updateSelectionBox(e)}}onDragStart(e){}handleDragMove(e){const{button:t,delta:n}=e;switch(t){case 0:this.handlers.leftDrag&&this.handlers.leftDrag({delta:n,mouseInfo:e});break;case 1:this.state.isPanning&&this.handlers.middleDrag?this.handlers.middleDrag({type:"pan",delta:n,mouseInfo:e}):this.state.isOrbiting&&this.handlers.middleDrag&&this.handlers.middleDrag({type:"orbit",delta:n,mouseInfo:e});break;case 2:this.handlers.rightDrag&&this.handlers.rightDrag({delta:n,mouseInfo:e})}}handleMouseUp(e){const{button:t,position:n}=e;this.isGizmoInteracting()||(this.state.isSelecting&&0===t&&this.finishDragSelection(e),this.state.isDragging?this.handleDragEnd(e):this.handleClick(e)),this.resetMouseState()}handleClick(e){}handleDragEnd(e){this.state.isPanning&&this.handlers.dragEnd&&this.handlers.dragEnd({type:"pan",mouseInfo:e})}handleWheel(e){this.handlers.wheel&&this.handlers.wheel(e)}calculateDragDistance(e){const{position:t,dragStart:n}=e,i=t.screenX-n.screenX,s=t.screenY-n.screenY;return Math.sqrt(i*i+s*s)}updateSelectionBox(e){var t;const{position:n}=e,i=n.screenX,s=n.screenY,a=null==(t=this.inputManager)?void 0:t.canvas,r=a?a.getBoundingClientRect():null,o=(e,t,n)=>Math.min(Math.max(e,t),n),l=this.selectionBox.startX,c=this.selectionBox.startY,A=r?o(l,r.left,r.right):l,d=r?o(c,r.top,r.bottom):c,h=r?o(i,r.left,r.right):i,u=r?o(s,r.top,r.bottom):s,p=Math.min(A,h),g=Math.min(d,u),m=Math.abs(h-A),b=Math.abs(u-d);(m>this.state.dragThreshold||b>this.state.dragThreshold)&&(m>0&&b>0?this.showSelectionBox(p,g,m,b):this.hideSelectionBox(),this.handlers.dragSelect&&this.handlers.dragSelect({startX:A,startY:d,currentX:h,currentY:u,left:p,top:g,width:m,height:b}))}finishDragSelection(e){var t;const{position:n,ctrl:i,shift:s}=e,a=this.calculateDragDistance(e),r=i||s;if(this.hideSelectionBox(),a<this.state.dragThreshold)return;const o=null==(t=this.inputManager)?void 0:t.canvas,l=o?o.getBoundingClientRect():null,c=(e,t,n)=>Math.min(Math.max(e,t),n),A=l?c(this.selectionBox.startX,l.left,l.right):this.selectionBox.startX,d=l?c(this.selectionBox.startY,l.top,l.bottom):this.selectionBox.startY,h=l?c(n.screenX,l.left,l.right):n.screenX,u=l?c(n.screenY,l.top,l.bottom):n.screenY;l&&Math.abs(h-A)<=this.state.dragThreshold&&Math.abs(u-d)<=this.state.dragThreshold||this.handlers.dragSelectEnd&&this.handlers.dragSelectEnd({startX:A,startY:d,endX:h,endY:u,isMultiSelect:r})}showSelectionBox(e,t,n,i){this.selectionBox.element||this.createSelectionBoxElement();const s=this.selectionBox.element;s.style.left=`${e}px`,s.style.top=`${t}px`,s.style.width=`${n}px`,s.style.height=`${i}px`,s.style.display="block",this.selectionBox.isVisible=!0}hideSelectionBox(){this.selectionBox.element&&(this.selectionBox.element.style.display="none"),this.selectionBox.isVisible=!1}createSelectionBoxElement(){const e=document.createElement("div");e.style.position="fixed",e.style.border="1px dashed #007acc",e.style.backgroundColor="rgba(0, 122, 204, 0.1)",e.style.pointerEvents="none",e.style.zIndex="10000",e.style.display="none",document.body.appendChild(e),this.selectionBox.element=e}resetMouseState(){this.state.isDragging=!1,this.state.dragButton=-1,this.state.isSelecting=!1,this.state.isPanning=!1,this.state.isOrbiting=!1}onLeftClick(e){this.handlers.leftClick=e}onRightClick(e){this.handlers.rightClick=e}onMiddleClick(e){this.handlers.middleClick=e}onLeftDrag(e){this.handlers.leftDrag=e}onMiddleDrag(e){this.handlers.middleDrag=e}onRightDrag(e){this.handlers.rightDrag=e}onDragSelect(e){this.handlers.dragSelect=e}onDragSelectEnd(e){this.handlers.dragSelectEnd=e}onWheel(e){this.handlers.wheel=e}onHover(e){this.handlers.hover=e}onDragEnd(e){this.handlers.dragEnd=e}setDragThreshold(e){this.state.dragThreshold=Math.max(1,e)}getMouseState(){return{...this.state}}getSelectionBoxState(){return{...this.selectionBox}}removeHandler(e){this.handlers.hasOwnProperty(e)&&(this.handlers[e]=null)}removeAllHandlers(){for(const e in this.handlers)this.handlers[e]=null}dispose(){this.selectionBox.element&&(document.body.removeChild(this.selectionBox.element),this.selectionBox.element=null),this.removeAllHandlers(),this.resetMouseState(),this.transformControls=null,this.objectSelector=null}}class _a{constructor(e,t,n,i,s=null){var a,r,o,l,c;this.scene=e,this.renderer=n,this.editorStore=i,this.gizmoScene=null,this.inputManager=new Pa,this.keyboardController=new Fa(this.inputManager),this.mouseController=new Na(this.inputManager),this.cameraController=new Oa(t,n,s);try{const e=this.editorStore.getState();null==(r=(a=this.cameraController).setSpeeds)||r.call(a,{pan:e.cameraPanSpeed,orbit:e.cameraOrbitSpeed,zoom:e.cameraZoomSpeed}),this._unsubCamSpeeds=this.editorStore.subscribe((e,t)=>{var n,i;e.cameraPanSpeed===t.cameraPanSpeed&&e.cameraOrbitSpeed===t.cameraOrbitSpeed&&e.cameraZoomSpeed===t.cameraZoomSpeed||null==(i=(n=this.cameraController).setSpeeds)||i.call(n,{pan:e.cameraPanSpeed,orbit:e.cameraOrbitSpeed,zoom:e.cameraZoomSpeed})})}catch{}this.objectSelector=new ka(e,t,n,i),null==(l=(o=this.objectSelector).setGizmoScene)||l.call(o,null),this._gizmoPointerDown=!1,this._gizmoPointerDownAt=0;try{const e=null==(c=this.objectSelector)?void 0:c.transformControls;e&&(e.addEventListener("mouseDown",()=>{this._gizmoPointerDown=!0,this._gizmoPointerDownAt="undefined"!=typeof performance?performance.now():Date.now()}),e.addEventListener("mouseUp",()=>{this._gizmoPointerDown=!1,this._gizmoPointerDownAt=0}),e.addEventListener("dragging-changed",e=>{(null==e?void 0:e.value)&&(this._gizmoPointerDown=!0)}))}catch{}this.mouseController.setObjectSelector(this.objectSelector),this.transformManager=new La(this.objectSelector,i,this.keyboardController),this._wrapSceneAddForWireframe(e),this.initializeGrid(),this.inputManager.setupMouseEvents(n.domElement),this.inputManager.registerResizeHandler(this.onWindowResize.bind(this)),this.setupMouseHandlers(),this.setupViewportActions(),this.isMouseDown=!1,this.isPanning=!1,this.isOrbiting=!1,this.isDragSelecting=!1,this.mousePosition=new E,this.previousMousePosition=new E,this.dragStartPosition=new E,this.partInspector={enabled:!1,selectedPart:null,selectedParts:new Set,solo:!1,clipping:!1,savedVisibility:new Map,clippingPlanes:[],group:null,groupPivot:"center",groupEnabled:!1},this._partRaycaster=new qe,this._partTransformControls=null,this._initPartTransformControls(t,n)}_wrapSceneAddForWireframe(e){try{if(!e||!e.add||e.__addWrapped)return;const t=e.add.bind(e),n=this.editorStore;e.add=(...e)=>{var i;const s=t(...e);try{const t=!!n.getState().isWireframe;for(const n of e)null==(i=null==n?void 0:n.traverse)||i.call(n,e=>{e&&e.isMesh&&e.material&&(Array.isArray(e.material)?e.material.forEach(e=>{e&&(e.wireframe=t)}):e.material.wireframe=t)})}catch{}return s},e.__addWrapped=!0}catch{}}setupMouseHandlers(){this.mouseController.onLeftClick(e=>{var t;const{position:n,isMultiSelect:i}=e;this.updateMousePosition(n);const s="undefined"!=typeof performance?performance.now():Date.now(),a=this._gizmoPointerDown||this._gizmoPointerDownAt&&s-this._gizmoPointerDownAt<300;if(!this.objectSelector.isDraggingGizmo()&&!a){if(this.partInspector.enabled){const e=this.raycastMeshAtNDC(this.mousePosition);return void(i?(null==(t=null==e?void 0:e.object)?void 0:t.isMesh)&&(this.partInspector.selectedParts.has(e.object)?this.partInspector.selectedParts.delete(e.object):(this.partInspector.selectedParts.add(e.object),this.partInspector.selectedPart=e.object),this._updatePartOutline()):this.selectPart((null==e?void 0:e.object)||null,(null==e?void 0:e.point)||null))}this.objectSelector.handleObjectSelection(this.mousePosition,i)}}),this.mouseController.onMiddleClick(e=>{var t,n;try{if(null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t).useBlenderControls)return}catch{}const{isOrbiting:i,isPanning:s}=e;this.isOrbiting=i,this.isPanning=s}),this.mouseController.onMiddleDrag(e=>{var t,n;try{if(null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t).useBlenderControls)return}catch{}const{type:i,delta:s}=e;"pan"===i?this.cameraController.pan(s.x,s.y):"orbit"===i&&this.cameraController.orbit(s.x,s.y)}),this.mouseController.onDragSelect(e=>{const{left:t,top:n,width:i,height:s}=e;this.objectSelector.showSelectionBox(t,n,i,s)}),this.mouseController.onDragSelectEnd(e=>{const{startX:t,startY:n,endX:i,endY:s,isMultiSelect:a}=e;this.partInspector.enabled?this.selectPartsInRect(t,n,i,s,a):this.finishDragSelection(t,n,i,s,a)}),this.mouseController.onWheel(e=>{var t,n;try{if(null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t).useBlenderControls)return}catch{}if(this.objectSelector.isDraggingGizmo())return;const i=e.delta>0?1:-1;this.cameraController.zoom(.3*i)}),this.mouseController.onDragEnd(e=>{var t,n;try{if(null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t).useBlenderControls)return}catch{}"pan"===e.type&&this.cameraController.updateRotationCenterAfterPan(this.scene,this.objectSelector.getSelectableObjects()),this.isMouseDown=!1,this.isPanning=!1,this.isOrbiting=!1,this.isDragSelecting=!1,this.objectSelector.hideSelectionBox()})}_initPartTransformControls(e,t){var n,i;try{this._partTransformControls=new Aa(e,t.domElement),this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,this._partTransformControls.setSize(.9);try{const e=null==(i=(n=this._partTransformControls).getHelper)?void 0:i.call(n);if(e&&e.isObject3D){const t=()=>{var t,n,i;try{const s=null==(n=null==(t=e.children)?void 0:t.find)?void 0:n.call(t,e=>"helper"===e.name);s&&(s.visible=!1);const a=[];null==(i=e.traverse)||i.call(e,e=>{const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,n=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||n)&&a.push(e)}),a.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const n=e.material;Array.isArray(n)?n.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==n?void 0:n.dispose)&&n.dispose()}catch{}})}catch{}};t(),e.onBeforeRender=()=>{try{t()}catch{}},e.renderOrder=999;(this.gizmoScene||this.scene).add(e),this._partTransformControls.addEventListener("change",t),this._partTransformControls.addEventListener("dragging-changed",t),this._partTransformControls.addEventListener("mouseDown",t),this._partTransformControls.addEventListener("mouseUp",t),this._partTransformControls.addEventListener("objectChange",t)}}catch{}this._partGizmoInitial=null,this._partTransformControls.addEventListener("dragging-changed",e=>{var t,n;const i=e.value,s=this.getActivePartSet();if(0!==s.length)if(i)this._partGizmoInitial=s.map(e=>{var t,n;return{uuid:e.uuid,position:e.position.clone(),rotation:e.rotation.clone(),scale:e.scale.clone(),parentId:(null==(n=null==(t=e.parent)?void 0:t.userData)?void 0:n.id)??null}});else{if(!this._partGizmoInitial)return;const e=s.map(e=>{var t,n;return{uuid:e.uuid,parentId:(null==(n=null==(t=e.parent)?void 0:t.userData)?void 0:n.id)??null,after:{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}}}),i=new Map(this._partGizmoInitial.map(e=>[e.uuid,e])),a=[];for(const t of e){const e=i.get(t.uuid);if(!e)continue;const n={position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}},s=t.after;(n.position.x!==s.position.x||n.position.y!==s.position.y||n.position.z!==s.position.z||n.rotation.x!==s.rotation.x||n.rotation.y!==s.rotation.y||n.rotation.z!==s.rotation.z||n.scale.x!==s.scale.x||n.scale.y!==s.scale.y||n.scale.z!==s.scale.z)&&a.push({uuid:t.uuid,parentId:t.parentId,before:n,after:s})}if(a.length>0)try{const e=null==(n=null==(t=this.editorStore)?void 0:t.getState)?void 0:n.call(t);(null==e?void 0:e._pushHistory)&&e._pushHistory({type:"part-transform",parts:a})}catch{}this._partGizmoInitial=null}})}catch(s){this._partTransformControls=null}}isPartGizmoEnabled(){var e;return!!(null==(e=this.partInspector)?void 0:e.gizmo)}setPartGizmoEnabled(e){var t,n,i,s,a,r,o,l,c,A;const d=this.partInspector.selectedPart;if(!this._partTransformControls)return!1;if(!e){this.partInspector.gizmo=!1;try{this._partTransformControls.detach()}catch{}return this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,!0}if(!d&&!this.partInspector.groupEnabled)return!1;try{null==(i=null==(n=null==(t=this.objectSelector)?void 0:t.transformControls)?void 0:n.detach)||i.call(n)}catch{}this.partInspector.groupEnabled?(this._ensurePartGroup(),this.partInspector.group&&this._partTransformControls.attach(this.partInspector.group)):this._partTransformControls.attach(d);try{const e=(null==(a=null==(s=this.transformManager)?void 0:s.getState)?void 0:a.call(s).mode)||(null==(l=null==(o=null==(r=this.objectSelector)?void 0:r.transformControls)?void 0:o.getMode)?void 0:l.call(o))||"translate",t=(null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:A.call(c).gizmoSpace)||"world";this._partTransformControls.setMode(e),this._partTransformControls.setSpace(t)}catch{}return this._partTransformControls.visible=!0,this._partTransformControls.enabled=!0,this.partInspector.gizmo=!0,!0}setPartGizmoMode(e){return!!this._partTransformControls&&(!!["translate","rotate","scale"].includes(e)&&(this._partTransformControls.setMode(e),!0))}detachPartGizmo(){if(this._partTransformControls){try{this._partTransformControls.detach()}catch{}this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,this.partInspector.gizmo=!1}}setPostProcessingManager(e){var t,n;this.postProcessingManager=e;try{null==(n=null==(t=this.objectSelector)?void 0:t.setPostProcessingManager)||n.call(t,e)}catch{}}_updatePartOutline(){}setupViewportActions(){this.keyboardController.registerViewportActions({focusOnSelected:()=>{var e,t,n,i;const s=(null==(t=(e=this.objectSelector).getSelectedObjects)?void 0:t.call(e))||[],a=e=>this.resolveToThreeObject(e),r=s.map(e=>(null==e?void 0:e.isObject3D)?e:a((null==e?void 0:e.id)||e)).filter(Boolean);if(0===r.length){const e=this.editorStore.getState().selectedObject,t=this.resolveToThreeObject(e);t&&r.push(t)}if(0!==r.length){try{if((null==(i=null==(n=this.editorStore)?void 0:n.getState)?void 0:i.call(n).useBlenderControls)&&"undefined"!=typeof window&&window.__blenderControls)return void(1===r.length?window.__blenderControls.focusOnObject(r[0]):window.__blenderControls.focusOnObjects(r))}catch{}if(1===r.length)this.cameraController.focusOnObject(r[0]);else{const e=new fe;r.forEach(t=>{try{e.expandByObject(t)}catch{}});const t=e.getCenter(new B),n=e.getSize(new B),i=Math.max(n.x,n.y,n.z)||1;let s;const a=this.cameraController.getCamera();if(a.isPerspectiveCamera){const e=a.fov*(Math.PI/180);s=1.5*Math.abs(i/Math.sin(e/2))}else s=2*i;const o=(new B).subVectors(a.position,t).normalize();this.cameraController.setTarget(t),a.position.copy(t).add(o.multiplyScalar(s)),a.lookAt(t),a.updateMatrixWorld()}}},toggleProjection:()=>{const e=this.cameraController.toggleProjection();return this.objectSelector.updateCamera(e),e},setView:e=>{this.cameraController.setView(e)},resetCamera:()=>{this.cameraController.resetCamera()}})}updateMousePosition(e){void 0!==e.x&&void 0!==e.y&&(this.mousePosition.x=e.x,this.mousePosition.y=e.y)}finishDragSelection(e,t,n,i,s){const a=this.renderer.domElement.getBoundingClientRect(),r={x:(e-a.left)/a.width*2-1,y:-(t-a.top)/a.height*2+1},o={x:(n-a.left)/a.width*2-1,y:-(i-a.top)/a.height*2+1},l=this.objectSelector.getObjectsInArea(r,o);if(l.length>0)this.objectSelector.selectMultipleObjects(l,s);else if(!s){const s=Math.abs(n-e),a=Math.abs(i-t);Math.hypot(s,a)>=12&&this.objectSelector.deselectAllObjects()}this.objectSelector.hideSelectionBox()}get camera(){return this.cameraController.getCamera()}set camera(e){this.cameraController.camera=e,this.objectSelector.updateCamera(e)}onWindowResize(){this.cameraController.handleResize(),this.renderer.setSize(window.innerWidth,window.innerHeight)}addSelectableObject(e){this.objectSelector.addSelectableObject(e)}removeSelectableObject(e){this.objectSelector.removeSelectableObject(e)}updateSelectableObjects(e){this.objectSelector.updateSelectableObjects(e)}getSelectedObjects(){return this.objectSelector.getSelectedObjects()}getSelectableObjects(){return this.objectSelector.getSelectableObjects()}selectObject(e){this.objectSelector.selectSingleObject(e)}findObjectById(e){if(null==e)return null;let t=null,n=null;if(this.scene.traverse(n=>{t||n&&n.userData&&n.userData.id===e&&(t=n)}),t)return t;if(this.scene.traverse(t=>{n||t&&t.userData&&t.userData.ownerId===e&&(n=t)}),!n)return null;let i=n;for(;i;){if(i.userData&&i.userData.id===e)return i;i=i.parent}return n}deselectAllObjects(){this.objectSelector.deselectAllObjects()}setGizmoMode(e){this.objectSelector.setGizmoMode(e)}getTransformState(){return this.transformManager.getState()}setTransformMode(e){return this.transformManager.setTransformMode(e)}toggleTransformSpace(){return this.transformManager.toggleSpace()}toggleGridSnap(){return this.transformManager.toggleGridSnap()}setGridSize(e){return this.transformManager.setGridSize(e)}duplicateSelectedObjects(){return this.transformManager.duplicateSelected()}deleteSelectedObjects(){return this.transformManager.deleteSelected()}groupSelectedObjects(){return this.transformManager.groupSelected()}ungroupSelectedObjects(){return this.transformManager.ungroupSelected()}focusOnObject(e){const t=this.resolveToThreeObject(e);t&&this.cameraController.focusOnObject(t)}updateSelectedOutlines(){this.objectSelector.updateAllSelectionOutlines()}setCameraView(e){this.cameraController.setView(e)}toggleCameraProjection(){const e=this.cameraController.toggleProjection();return this.objectSelector.updateCamera(e),e}getCameraTarget(){return this.cameraController.getTarget()}setCameraTarget(e){this.cameraController.setTarget(e)}resetCamera(){this.cameraController.resetCamera()}get transformControls(){return this.objectSelector.getTransformControls()}get selectedObjects(){return this.objectSelector.getSelectedObjects()}get isDragging(){return this.objectSelector.isDraggingGizmo()}dispose(){this.inputManager.dispose(),this.keyboardController.dispose(),this.mouseController.dispose(),this.objectSelector.dispose(),this.transformManager.dispose(),this.gridHelper&&(this.scene.remove(this.gridHelper),this.gridHelper.dispose(),this.gridHelper=null)}resolveToThreeObject(e){var t;if(!e)return null;if(e.isObject3D)return e;const n="object"==typeof e?e.id??(null==(t=e.userData)?void 0:t.id)??e:e;return this.findObjectById(n)}updateGridSnap(){this.objectSelector.updateGridSnap()}updateWireframe(){const e=this.editorStore.getState();e.scene&&e.scene.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material.forEach(t=>{t.wireframe=e.isWireframe}):t.material.wireframe=e.isWireframe)})}updateGizmoSpace(){this.objectSelector.updateGizmoSpace()}applyInitialViewState(){var e,t,n,i,s,a;try{null==(e=this.updateWireframe)||e.call(this)}catch{}try{null==(t=this.updateGridSnap)||t.call(this)}catch{}try{null==(n=this.updateGizmoSpace)||n.call(this)}catch{}try{null==(s=null==(i=this.objectSelector)?void 0:i.updateGizmoSize)||s.call(i)}catch{}try{null==(a=this.toggleGrid)||a.call(this)}catch{}}initializeGrid(){this.gridHelper=new nt(20,20,8947848,4473924),this.gridHelper.name="EditorGrid",this.gridHelper.position.y=0,this.gridHelper.userData=this.gridHelper.userData||{},this.gridHelper.userData.isSystemObject=!0,this.gridHelper.material.opacity=.8,this.gridHelper.material.transparent=!0,this.gridHelper.material.depthWrite=!1;const e=this.editorStore.getState().isGridVisible;this.gridHelper.visible=e,this.scene.add(this.gridHelper)}toggleGrid(){if(!this.gridHelper)return!1;const e=this.editorStore.getState().isGridVisible;return this.gridHelper.visible=e,this.gridHelper.updateMatrixWorld(!0),e}isGridShown(){return this.editorStore.getState().isGridVisible}setGridSize(e,t=20){if(!this.gridHelper)return;this.scene.remove(this.gridHelper),this.gridHelper.dispose();const n=this.editorStore.getState().isGridVisible;this.gridHelper=new nt(e,t,8947848,4473924),this.gridHelper.name="EditorGrid",this.gridHelper.position.y=0,this.gridHelper.visible=n,this.gridHelper.userData=this.gridHelper.userData||{},this.gridHelper.userData.isSystemObject=!0,this.gridHelper.material.opacity=.8,this.gridHelper.material.transparent=!0,this.gridHelper.material.depthWrite=!1,this.scene.add(this.gridHelper)}enablePartInspect(e){e!==this.partInspector.enabled&&(this.partInspector.enabled=!!e,e||(this.clearPartSelection(),this.setPartSolo(!1),this.setPartClipping(!1),this.detachPartGizmo()))}getSelectedPart(){return this.partInspector.selectedPart}getSelectedPartInfo(){var e,t,n,i,s,a,r,o,l;const c=this.partInspector.selectedPart;if(!c||!c.isMesh||!c.geometry)return null;const A=c.geometry,d=Array.isArray(c.material)?c.material[0]:c.material;A.boundingBox||A.computeBoundingBox(),A.boundingSphere||A.computeBoundingSphere();const h=null==(e=A.attributes)?void 0:e.position,u=A.index,p=null==(t=A.attributes)?void 0:t.uv,g=null==(n=A.attributes)?void 0:n.uv2,m=(new fe).setFromObject(c),b=m.getSize(new B),f=m.getCenter(new B),v=u?Math.floor(u.count/3):h?Math.floor(h.count/3):0,y=h?h.count:0;return{name:c.name||"(unnamed mesh)",uuid:c.uuid,drawMode:c.drawMode,geometry:{type:A.type,hasIndex:!!u,attributes:Object.keys(A.attributes||{}),vertices:y,triangles:v,bbox:{min:(null==(a=null==(s=null==(i=A.boundingBox)?void 0:i.min)?void 0:s.toArray)?void 0:a.call(s))||null,max:(null==(l=null==(o=null==(r=A.boundingBox)?void 0:r.max)?void 0:o.toArray)?void 0:l.call(o))||null},world:{size:b.toArray(),center:f.toArray()},uv:p?{count:p.count,itemSize:p.itemSize}:null,uv2:g?{count:g.count,itemSize:g.itemSize}:null},material:d?{type:d.type,name:d.name,color:d.color?`#${d.color.getHexString()}`:null,opacity:d.opacity??1,transparent:!!d.transparent,metalness:d.metalness??null,roughness:d.roughness??null,maps:{map:!!d.map,normalMap:!!d.normalMap,aoMap:!!d.aoMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,emissiveMap:!!d.emissiveMap,alphaMap:!!d.alphaMap}}:null}}raycastMeshAtNDC(e){const t=this.cameraController.getCamera();this._partRaycaster.setFromCamera(e,t);const n=[];this.scene.traverse(e=>{e.isMesh&&e.visible&&n.push(e)});const i=this._partRaycaster.intersectObjects(n,!0);if(!i||0===i.length)return null;return i.find(e=>{var t,n;return(null==(t=e.object)?void 0:t.isMesh)&&!(null==(n=e.object.userData)?void 0:n.isRayHelper)})||i[0]}selectPartsInRect(e,t,n,i,s){const a=this.renderer.domElement.getBoundingClientRect(),r=Math.min(e,n),o=Math.min(t,i),l=Math.max(e,n),c=Math.max(t,i),A=this.cameraController.getCamera(),d=new qe,h=[];this.scene.traverse(e=>{e.isMesh&&e.visible&&h.push(e)});const u=new Set;for(let p=0;p<6;p++)for(let e=0;e<6;e++){const t=o+(e+.5)/6*(c-o),n=new E((r+(p+.5)/6*(l-r)-a.left)/a.width*2-1,-(t-a.top)/a.height*2+1);d.setFromCamera(n,A);const i=d.intersectObjects(h,!0);if(i&&i.length){const e=i[0].object;(null==e?void 0:e.isMesh)&&u.add(e)}}s||this.partInspector.selectedParts.clear(),u.forEach(e=>this.partInspector.selectedParts.add(e)),this.partInspector.selectedPart=this.partInspector.selectedParts.values().next().value||null,this._updatePartOutline()}selectPart(e,t=null){if(this._restorePartHighlight(),this.partInspector.selectedPart=e&&e.isMesh?e:null,this.partInspector.selectedPart&&this.partInspector.selectedParts.add(this.partInspector.selectedPart),this.partInspector.selectedPart){const e=this.partInspector.selectedPart.material,t=Array.isArray(e)?e[0]:e;t&&"emissive"in t&&(t.userData||(t.userData={}),t.userData._origEmissive=t.emissive.clone(),t.userData._origEmissiveIntensity=t.emissiveIntensity??1,t.emissive=new b(65535),t.emissiveIntensity=.6,t.needsUpdate=!0),this.partInspector.clipping&&this.setPartClipping(!0),this.partInspector.solo&&this.setPartSolo(!0),this.partInspector.gizmo&&this.setPartGizmoEnabled(!0)}else this.setPartSolo(!1),this.setPartClipping(!1),this.detachPartGizmo(),this.partInspector.selectedParts.clear();this._updatePartOutline()}clearPartSelection(){this._restorePartHighlight(),this.partInspector.selectedPart=null,this.partInspector.selectedParts.clear()}_restorePartHighlight(){const e=this.partInspector.selectedPart;if(!e)return;const t=Array.isArray(e.material)?e.material[0]:e.material;t&&t.userData&&t.userData._origEmissive&&(t.emissive.copy(t.userData._origEmissive),t.emissiveIntensity=t.userData._origEmissiveIntensity??1,delete t.userData._origEmissive,delete t.userData._origEmissiveIntensity,t.needsUpdate=!0)}getActivePartSet(){return this.partInspector.groupEnabled&&this.partInspector.selectedParts.size>0?Array.from(this.partInspector.selectedParts):this.partInspector.selectedPart?[this.partInspector.selectedPart]:[]}selectAllChildParts(){const e=this.partInspector.selectedPart;if(!e)return 0;const t=this.partInspector.selectedParts,n=[];return(e.parent||e).traverse(e=>{e.isMesh&&(t.add(e),n.push(e))}),this._updatePartOutline(),n.length}clearAllPartSelections(){this.partInspector.selectedParts.clear(),this._updatePartOutline()}isPartGroupGizmoEnabled(){return!!this.partInspector.groupEnabled}setPartGroupGizmoEnabled(e){this.partInspector.groupEnabled=!!e,e?(this._ensurePartGroup(),this.setPartGizmoEnabled(!0)):(this._detachPartGroup(),this.partInspector.selectedPart&&this.setPartGizmoEnabled(!0)),this._updatePartOutline()}getPartGroupPivot(){return this.partInspector.groupPivot}setPartGroupPivot(e){["center","first","last"].includes(e)&&(this.partInspector.groupPivot=e,this.partInspector.groupEnabled&&this._ensurePartGroup(!0))}_ensurePartGroup(e=!1){const t=this.getActivePartSet();if(0===t.length)return;this.partInspector.group||(this.partInspector.group=new J,this.partInspector.group.name="PartGroupPivot",this.partInspector.group.userData.isSystemObject=!0,this.scene.add(this.partInspector.group));const n=this.partInspector.group;let i=new B;if("first"===this.partInspector.groupPivot)i.copy(t[0].getWorldPosition(new B));else if("last"===this.partInspector.groupPivot)i.copy(t[t.length-1].getWorldPosition(new B));else{const e=new fe;for(const n of t)e.expandByObject(n);e.getCenter(i)}n.position.copy(i)}_detachPartGroup(){var e,t;if(this.partInspector.group){try{null==(t=null==(e=this._partTransformControls)?void 0:e.detach)||t.call(e)}catch{}try{this.scene.remove(this.partInspector.group)}catch{}this.partInspector.group=null}}setPartSolo(e){const t=this.partInspector;if(!e)return t.savedVisibility.forEach((e,t)=>{t.visible=e}),t.savedVisibility.clear(),void(t.solo=!1);const n=t.selectedPart;n&&(t.savedVisibility.clear(),this.scene.traverse(e=>{var i;e.isObject3D&&((null==(i=e.userData)?void 0:i.isSystemObject)||e===this.gridHelper||(t.savedVisibility.set(e,e.visible),e.visible=e===n||e.isBone||this._isAncestorOf(e,n)||this._isAncestorOf(n,e)))}),t.solo=!0)}_isAncestorOf(e,t){let n=null==t?void 0:t.parent;for(;n;){if(n===e)return!0;n=n.parent}return!1}setPartClipping(e,t=.01){const n=this.renderer,i=this.partInspector;if(!e)return n.clippingPlanes=[],n.localClippingEnabled=!1,i.clippingPlanes=[],void(i.clipping=!1);const s=i.selectedPart;if(!s)return;const a=(new fe).setFromObject(s);a.expandByScalar(t);const r=a.min,o=a.max,l=[new it(new B(1,0,0),-o.x),new it(new B(-1,0,0),r.x),new it(new B(0,1,0),-o.y),new it(new B(0,-1,0),r.y),new it(new B(0,0,1),-o.z),new it(new B(0,0,-1),r.z)];n.clippingPlanes=l,n.localClippingEnabled=!0,i.clippingPlanes=l,i.clipping=!0}}class Ga{constructor(e,t){if(!e||!t)throw new Error("BlenderControls requires camera and domElement");this.camera=e,this.domElement=t,this.enabled=!0,this.target=new B(0,0,0),this.rotateSpeed=1,this.panSpeed=1,this.zoomSpeed=1,this.minDistance=.1,this.maxDistance=1/0,this.minPolarAngle=1e-4,this.maxPolarAngle=Math.PI-1e-4,this.enableDamping=!0,this.dampingFactor=.15,this._spherical=new et,this._sphericalDelta=new et(0,0,0),this._panOffset=new B,this._zoomScale=1,this._state="none",this._isAltDown=!1,this._isShiftDown=!1,this._isCtrlDown=!1,this._pointer=new E,this._pointerPrev=new E,this._lastPointerForPick=new E,this._raycaster=new qe,this._scene=null,this._onContextMenu=this._onContextMenu.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onPointerMovePassive=e=>{this._lastPointerForPick.set(e.clientX,e.clientY)},this._onMouseUp=this._onMouseUp.bind(this),this._onWheel=this._onWheel.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._updateSphericalFromCamera(),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("mousedown",this._onMouseDown),this.domElement.addEventListener("wheel",this._onWheel,{passive:!1}),this.domElement.addEventListener("mousemove",this._onPointerMovePassive),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp)}setSpeeds({rotate:e,pan:t,zoom:n}={}){Number.isFinite(e)&&(this.rotateSpeed=e),Number.isFinite(t)&&(this.panSpeed=t),Number.isFinite(n)&&(this.zoomSpeed=n)}setCamera(e){e&&(this.camera=e,this._updateSphericalFromCamera())}setScene(e){this._scene=e}focusOnObject(e){if(!e)return!1;const t=(new fe).setFromObject(e),n=t.getCenter(new B),i=t.getSize(new B),s=Math.max(i.x,i.y,i.z)||1;let a;if(this.camera.isPerspectiveCamera){const e=(this.camera.fov||75)*Math.PI/180;a=1.2*Math.abs(s/Math.sin(e/2))}else a=2*s;const r=(new B).subVectors(this.camera.position,this.target).normalize();this.target.copy(n),this.camera.position.copy(n).add(r.multiplyScalar(a)),this._updateSphericalFromCamera();{const e=(new S).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}return!0}focusOnObjects(e){const t=Array.isArray(e)?e.filter(Boolean):[e];if(!t||0===t.length)return!1;const n=new fe;for(const l of t)try{n.expandByObject(l)}catch{}if(!isFinite(n.min.x)||!isFinite(n.max.x))return!1;const i=n.getCenter(new B),s=n.getSize(new B),a=Math.max(s.x,s.y,s.z)||1;let r;if(this.camera.isPerspectiveCamera){const e=(this.camera.fov||75)*Math.PI/180;r=1.2*Math.abs(a/Math.sin(e/2))}else r=2*a;const o=(new B).subVectors(this.camera.position,this.target).normalize();this.target.copy(i),this.camera.position.copy(i).add(o.multiplyScalar(r)),this._updateSphericalFromCamera();{const e=(new S).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}return!0}update(){if(!this.enabled)return!1;const e=new B;e.copy(this.camera.position).sub(this.target),this._spherical.setFromVector3(e),this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi,this._spherical.radius*=this._zoomScale,this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.theta>Math.PI&&(this._spherical.theta-=2*Math.PI),this._spherical.theta<-Math.PI&&(this._spherical.theta+=2*Math.PI),this._spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this._spherical.radius)),this.target.add(this._panOffset);const t=(new B).setFromSpherical(this._spherical).add(this.target);this.camera.position.copy(t);{const e=(new S).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}if(this.enableDamping){this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor),Math.abs(this._sphericalDelta.theta)<1e-6&&(this._sphericalDelta.theta=0),Math.abs(this._sphericalDelta.phi)<1e-6&&(this._sphericalDelta.phi=0),this._panOffset.lengthSq()<1e-10&&this._panOffset.set(0,0,0);const e=Math.pow(1-this.dampingFactor,2);this._zoomScale=1+(this._zoomScale-1)*e,Math.abs(this._zoomScale-1)<1e-4&&(this._zoomScale=1)}else this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0),this._zoomScale=1;return!0}dispose(){this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.removeEventListener("mousedown",this._onMouseDown),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("mousemove",this._onPointerMovePassive),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)}_onContextMenu(e){e.preventDefault()}_onKeyDown(e){("Alt"===e.key||e.altKey)&&(this._isAltDown=!0),("Shift"===e.key||e.shiftKey)&&(this._isShiftDown=!0),("Control"===e.key||e.ctrlKey)&&(this._isCtrlDown=!0)}_onKeyUp(e){e.altKey||(this._isAltDown=!1),e.shiftKey||(this._isShiftDown=!1),e.ctrlKey||(this._isCtrlDown=!1)}_onMouseDown(e){this.enabled&&1===e.button&&(e.preventDefault(),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._pointerPrev.set(e.clientX,e.clientY),this._state=this._isAltDown?"rotate":"pan")}_onMouseMove(e){if(!this.enabled||"none"===this._state)return;e.preventDefault(),this._pointer.set(e.clientX,e.clientY),this._lastPointerForPick.set(e.clientX,e.clientY);const t=this._pointer.x-this._pointerPrev.x,n=this._pointer.y-this._pointerPrev.y;this._pointerPrev.copy(this._pointer),"rotate"===this._state?this._handleRotate(t,n):"pan"===this._state&&this._handlePan(t,n)}_onMouseUp(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._state="none"}_onWheel(e){if(!this.enabled)return;e.preventDefault();const t=e.deltaY,n=Math.pow(.95,this.zoomSpeed);t<0?this._dollyIn(n):t>0&&this._dollyOut(n)}_updateSphericalFromCamera(){const e=(new B).copy(this.camera.position).sub(this.target);this._spherical.setFromVector3(e)}_handleRotate(e,t){const{clientWidth:n,clientHeight:i}=this.domElement,s=2*Math.PI*e/Math.max(1,n)*this.rotateSpeed,a=2*Math.PI*t/Math.max(1,i)*this.rotateSpeed;this._sphericalDelta.theta-=s,this._sphericalDelta.phi-=a}_handlePan(e,t){const n=this.domElement;if(this._isShiftDown&&(t=0),this._isCtrlDown&&(e=0),this.camera.isPerspectiveCamera){const i=(new B).copy(this.camera.position).sub(this.target).length(),s=(this.camera.fov||75)*Math.PI/180,a=i*Math.tan(s/2),r=a*(n.clientWidth/Math.max(1,n.clientHeight)),o=e*this.panSpeed*(2*r)/Math.max(1,n.clientWidth),l=t*this.panSpeed*(2*a)/Math.max(1,n.clientHeight);this._panLeft(o),this._panUp(l)}else if(this.camera.isOrthographicCamera){const i=(this.camera.right-this.camera.left)/Math.max(1,n.clientWidth),s=(this.camera.top-this.camera.bottom)/Math.max(1,n.clientHeight);this._panLeft(e*this.panSpeed*i),this._panUp(t*this.panSpeed*s)}else{const n=.002*e*this.panSpeed,i=.002*t*this.panSpeed;this._panLeft(n),this._panUp(i)}}_panLeft(e){const t=new B;t.setFromMatrixColumn(this.camera.matrix,0),t.multiplyScalar(-e),this._panOffset.add(t)}_panUp(e){const t=new B;t.setFromMatrixColumn(this.camera.matrix,1),t.multiplyScalar(e),this._panOffset.add(t)}_dollyIn(e){this._zoomScale*=Math.max(1e-6,e)}_dollyOut(e){this._zoomScale/=Math.max(1e-6,e)}}const Ua={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class za{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const Ha=new $(-1,1,1,-1,0,1);const qa=new class extends c{constructor(){super(),this.setAttribute("position",new Ve([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ve([0,2,0,0,2,0],2))}};class Ka{constructor(e){this._mesh=new q(qa,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Ha)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Wa extends za{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof st?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=at.clone(e.uniforms),this.material=new st({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ka(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Va extends za{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),s=e.state;let a,r;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(a=0,r=1):(a=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),s.buffers.stencil.setClear(r),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class Ya extends za{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Ja{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const n=e.getSize(new E);this._width=n.width,this._height=n.height,(t=new rt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Le})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Wa(Ua),this.copyPass.material.blending=ot,this.clock=new lt}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,s=this.passes.length;i<s;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Va&&(t instanceof Va?n=!0:t instanceof Ya&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new E);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Xa extends za{constructor(e,t,n=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new b}render(e,t,n){const i=e.autoClear;let s,a;e.autoClear=!1,null!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(s),null!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=i}}const Za={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:"\n\t\tprecision highp float;\n\n\t\tuniform mat4 modelViewMatrix;\n\t\tuniform mat4 projectionMatrix;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\t#include <tonemapping_pars_fragment>\n\t\t#include <colorspace_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// tone mapping\n\n\t\t\t#ifdef LINEAR_TONE_MAPPING\n\n\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( AGX_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\n\t\t\t#endif\n\n\t\t\t// color space\n\n\t\t\t#ifdef SRGB_TRANSFER\n\n\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\n\t\t\t#endif\n\n\t\t}"};class $a extends za{constructor(){super();const e=Za;this.uniforms=at.clone(e.uniforms),this.material=new ct({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new Ka(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},se.getTransfer(this._outputColorSpace)===At&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===dt?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ht?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===ut?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===pt?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===gt?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===mt&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),!0===this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const er={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new b(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class tr extends za{constructor(e,t,n,i){super(),this.strength=void 0!==t?t:1,this.radius=n,this.threshold=i,this.resolution=void 0!==e?new E(e.x,e.y):new E(256,256),this.clearColor=new b(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let s=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new rt(s,a,{type:Le}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let c=0;c<this.nMips;c++){const e=new rt(s,a,{type:Le});e.texture.name="UnrealBloomPass.h"+c,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const t=new rt(s,a,{type:Le});t.texture.name="UnrealBloomPass.v"+c,t.texture.generateMipmaps=!1,this.renderTargetsVertical.push(t),s=Math.round(s/2),a=Math.round(a/2)}const r=er;this.highPassUniforms=at.clone(r.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new st({uniforms:this.highPassUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.separableBlurMaterials=[];const o=[3,5,7,9,11];s=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(o[c])),this.separableBlurMaterials[c].uniforms.invSize.value=new E(1/s,1/a),s=Math.round(s/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new B(1,1,1),new B(1,1,1),new B(1,1,1),new B(1,1,1),new B(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const l=Ua;this.copyUniforms=at.clone(l.uniforms),this.blendMaterial=new st({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:bt,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new b,this.oldClearAlpha=1,this.basic=new C,this.fsQuad=new Ka(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let n=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(n,i);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(n,i),this.renderTargetsVertical[s].setSize(n,i),this.separableBlurMaterials[s].uniforms.invSize.value=new E(1/n,1/i),n=Math.round(n/2),i=Math.round(i/2)}render(e,t,n,i,s){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),s&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let r=this.renderTargetBright;for(let o=0;o<this.nMips;o++)this.fsQuad.material=this.separableBlurMaterials[o],this.separableBlurMaterials[o].uniforms.colorTexture.value=r.texture,this.separableBlurMaterials[o].uniforms.direction.value=tr.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[o]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[o].uniforms.colorTexture.value=this.renderTargetsHorizontal[o].texture,this.separableBlurMaterials[o].uniforms.direction.value=tr.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[o]),e.clear(),this.fsQuad.render(e),r=this.renderTargetsVertical[o];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,s&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){const t=[];for(let n=0;n<e;n++)t.push(.39894*Math.exp(-.5*n*n/(e*e))/e);return new st({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new E(.5,.5)},direction:{value:new E(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new st({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}tr.BlurDirectionX=new E(1,0),tr.BlurDirectionY=new E(0,1);const nr={name:"FilmShader",uniforms:{tDiffuse:{value:null},time:{value:0},intensity:{value:.5},grayscale:{value:!1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tuniform float intensity;\n\t\tuniform bool grayscale;\n\t\tuniform float time;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat noise = rand( fract( vUv + time ) );\n\n\t\t\tvec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );\n\n\t\t\tcolor = mix( base.rgb, color, intensity );\n\n\t\t\tif ( grayscale ) {\n\n\t\t\t\tcolor = vec3( luminance( color ) ); // assuming linear-srgb\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( color, base.a );\n\n\t\t}"};class ir extends za{constructor(e=.5,t=!1){super();const n=nr;this.uniforms=at.clone(n.uniforms),this.material=new st({name:n.name,uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.uniforms.intensity.value=e,this.uniforms.grayscale.value=t,this.fsQuad=new Ka(this.material)}render(e,t,n,i){this.uniforms.tDiffuse.value=n.texture,this.uniforms.time.value+=i,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const sr={name:"DotScreenShader",uniforms:{tDiffuse:{value:null},tSize:{value:new E(256,256)},center:{value:new E(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec2 center;\n\t\tuniform float angle;\n\t\tuniform float scale;\n\t\tuniform vec2 tSize;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tfloat pattern() {\n\n\t\t\tfloat s = sin( angle ), c = cos( angle );\n\n\t\t\tvec2 tex = vUv * tSize - center;\n\t\t\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n\n\t\t\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat average = ( color.r + color.g + color.b ) / 3.0;\n\n\t\t\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n\n\t\t}"};class ar extends za{constructor(e,t,n){super();const i=sr;this.uniforms=at.clone(i.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==n&&(this.uniforms.scale.value=n),this.material=new st({name:i.name,uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),this.fsQuad=new Ka(this.material)}render(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.uniforms.tSize.value.set(n.width,n.height),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const rr={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\tuniform int byp; //should we apply the glitch ?\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDisp;\n\n\t\tuniform float amount;\n\t\tuniform float angle;\n\t\tuniform float seed;\n\t\tuniform float seed_x;\n\t\tuniform float seed_y;\n\t\tuniform float distortion_x;\n\t\tuniform float distortion_y;\n\t\tuniform float col_s;\n\n\t\tvarying vec2 vUv;\n\n\n\t\tfloat rand(vec2 co){\n\t\t\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif(byp<1) {\n\t\t\t\tvec2 p = vUv;\n\t\t\t\tfloat xs = floor(gl_FragCoord.x / 0.5);\n\t\t\t\tfloat ys = floor(gl_FragCoord.y / 0.5);\n\t\t\t\t//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n\t\t\t\tfloat disp = texture2D(tDisp, p*seed*seed).r;\n\t\t\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {\n\t\t\t\t\tif(seed_x>0.){\n\t\t\t\t\t\tp.y = 1. - (p.y + distortion_y);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.y = distortion_y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {\n\t\t\t\t\tif(seed_y>0.){\n\t\t\t\t\t\tp.x=distortion_x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.x = 1. - (p.x + distortion_x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.x+=disp*seed_x*(seed/5.);\n\t\t\t\tp.y+=disp*seed_y*(seed/5.);\n\t\t\t\t//base from RGB shift shader\n\t\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\t\tvec4 cr = texture2D(tDiffuse, p + offset);\n\t\t\t\tvec4 cga = texture2D(tDiffuse, p);\n\t\t\t\tvec4 cb = texture2D(tDiffuse, p - offset);\n\t\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\t\t\t\t//add noise\n\t\t\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);\n\t\t\t\tgl_FragColor = gl_FragColor+ snow;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl_FragColor=texture2D (tDiffuse, vUv);\n\t\t\t}\n\t\t}"};class or extends za{constructor(e=64){super();const t=rr;this.uniforms=at.clone(t.uniforms),this.heightMap=this.generateHeightmap(e),this.uniforms.tDisp.value=this.heightMap,this.material=new st({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new Ka(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,n){this.uniforms.tDiffuse.value=n.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=Z.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=Z.randFloat(-1,1),this.uniforms.seed_y.value=Z.randFloat(-1,1),this.uniforms.distortion_x.value=Z.randFloat(0,1),this.uniforms.distortion_y.value=Z.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=Z.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=Z.randFloat(0,1),this.uniforms.distortion_y.value=Z.randFloat(0,1),this.uniforms.seed_x.value=Z.randFloat(-.3,.3),this.uniforms.seed_y.value=Z.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}generateTrigger(){this.randX=Z.randInt(120,240)}generateHeightmap(e){const t=new Float32Array(e*e),n=e*e;for(let s=0;s<n;s++){const e=Z.randFloat(0,1);t[s]=e}const i=new Fe(t,e,e,Ue,Pe);return i.needsUpdate=!0,i}dispose(){this.material.dispose(),this.heightMap.dispose(),this.fsQuad.dispose()}}class lr extends za{constructor(e,t,n,i={}){super(),this.pixelSize=e,this.resolution=new E,this.renderResolution=new E,this.pixelatedMaterial=this.createPixelatedMaterial(),this.normalMaterial=new ft,this.fsQuad=new Ka(this.pixelatedMaterial),this.scene=t,this.camera=n,this.normalEdgeStrength=i.normalEdgeStrength||.3,this.depthEdgeStrength=i.depthEdgeStrength||.4,this.beautyRenderTarget=new rt,this.beautyRenderTarget.texture.minFilter=P,this.beautyRenderTarget.texture.magFilter=P,this.beautyRenderTarget.texture.type=Le,this.beautyRenderTarget.depthTexture=new vt,this.normalRenderTarget=new rt,this.normalRenderTarget.texture.minFilter=P,this.normalRenderTarget.texture.magFilter=P,this.normalRenderTarget.texture.type=Le}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.pixelatedMaterial.dispose(),this.normalMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.resolution.set(e,t),this.renderResolution.set(e/this.pixelSize|0,t/this.pixelSize|0);const{x:n,y:i}=this.renderResolution;this.beautyRenderTarget.setSize(n,i),this.normalRenderTarget.setSize(n,i),this.fsQuad.material.uniforms.resolution.value.set(n,i,1/n,1/i)}setPixelSize(e){this.pixelSize=e,this.setSize(this.resolution.x,this.resolution.y)}render(e,t){const n=this.fsQuad.material.uniforms;n.normalEdgeStrength.value=this.normalEdgeStrength,n.depthEdgeStrength.value=this.depthEdgeStrength,e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera);const i=this.scene.overrideMaterial;e.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,e.render(this.scene,this.camera),this.scene.overrideMaterial=i,n.tDiffuse.value=this.beautyRenderTarget.texture,n.tDepth.value=this.beautyRenderTarget.depthTexture,n.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}createPixelatedMaterial(){return new st({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new yt(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:"\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tuniform sampler2D tDiffuse;\n\t\t\t\tuniform sampler2D tDepth;\n\t\t\t\tuniform sampler2D tNormal;\n\t\t\t\tuniform vec4 resolution;\n\t\t\t\tuniform float normalEdgeStrength;\n\t\t\t\tuniform float depthEdgeStrength;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tfloat getDepth(int x, int y) {\n\n\t\t\t\t\treturn texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;\n\n\t\t\t\t}\n\n\t\t\t\tvec3 getNormal(int x, int y) {\n\n\t\t\t\t\treturn texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tfloat depthEdgeIndicator(float depth, vec3 normal) {\n\n\t\t\t\t\tfloat diff = 0.0;\n\t\t\t\t\tdiff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);\n\t\t\t\t\treturn floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;\n\n\t\t\t\t}\n\n\t\t\t\tfloat neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {\n\n\t\t\t\t\tfloat depthDiff = getDepth(x, y) - depth;\n\t\t\t\t\tvec3 neighborNormal = getNormal(x, y);\n\n\t\t\t\t\t// Edge pixels should yield to faces who's normals are closer to the bias normal.\n\t\t\t\t\tvec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.\n\t\t\t\t\tfloat normalDiff = dot(normal - neighborNormal, normalEdgeBias);\n\t\t\t\t\tfloat normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);\n\n\t\t\t\t\t// Only the shallower pixel should detect the normal edge.\n\t\t\t\t\tfloat depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);\n\n\t\t\t\t\treturn (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;\n\n\t\t\t\t}\n\n\t\t\t\tfloat normalEdgeIndicator(float depth, vec3 normal) {\n\n\t\t\t\t\tfloat indicator = 0.0;\n\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(0, -1, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(0, 1, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(1, 0, depth, normal);\n\n\t\t\t\t\treturn step(0.1, indicator);\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\t\t\tfloat depth = 0.0;\n\t\t\t\t\tvec3 normal = vec3(0.0);\n\n\t\t\t\t\tif (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {\n\n\t\t\t\t\t\tdepth = getDepth(0, 0);\n\t\t\t\t\t\tnormal = getNormal(0, 0);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat dei = 0.0;\n\t\t\t\t\tif (depthEdgeStrength > 0.0)\n\t\t\t\t\t\tdei = depthEdgeIndicator(depth, normal);\n\n\t\t\t\t\tfloat nei = 0.0;\n\t\t\t\t\tif (normalEdgeStrength > 0.0)\n\t\t\t\t\t\tnei = normalEdgeIndicator(depth, normal);\n\n\t\t\t\t\tfloat Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);\n\n\t\t\t\t\tgl_FragColor = texel * Strength;\n\n\t\t\t\t}\n\t\t\t"})}}const cr={name:"SMAAEdgesShader",defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new E(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\n\t\tvoid SMAAEdgeDetectionVS( vec2 texcoord ) {\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAAEdgeDetectionVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\n\t\tvec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n\t\t\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );\n\n\t\t\t// Calculate color deltas:\n\t\t\tvec4 delta;\n\t\t\tvec3 C = texture2D( colorTex, texcoord ).rgb;\n\n\t\t\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;\n\t\t\tvec3 t = abs( C - Cleft );\n\t\t\tdelta.x = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;\n\t\t\tt = abs( C - Ctop );\n\t\t\tdelta.y = max( max( t.r, t.g ), t.b );\n\n\t\t\t// We do the usual threshold:\n\t\t\tvec2 edges = step( threshold, delta.xy );\n\n\t\t\t// Then discard if there is no edge:\n\t\t\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )\n\t\t\t\tdiscard;\n\n\t\t\t// Calculate right and bottom deltas:\n\t\t\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;\n\t\t\tt = abs( C - Cright );\n\t\t\tdelta.z = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;\n\t\t\tt = abs( C - Cbottom );\n\t\t\tdelta.w = max( max( t.r, t.g ), t.b );\n\n\t\t\t// Calculate the maximum delta in the direct neighborhood:\n\t\t\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );\n\n\t\t\t// Calculate left-left and top-top deltas:\n\t\t\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;\n\t\t\tt = abs( C - Cleftleft );\n\t\t\tdelta.z = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;\n\t\t\tt = abs( C - Ctoptop );\n\t\t\tdelta.w = max( max( t.r, t.g ), t.b );\n\n\t\t\t// Calculate the final maximum delta:\n\t\t\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );\n\n\t\t\t// Local contrast adaptation in action:\n\t\t\tedges.xy *= step( 0.5 * maxDelta, delta.xy );\n\n\t\t\treturn vec4( edges, 0.0, 0.0 );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );\n\n\t\t}"},Ar={name:"SMAAWeightsShader",defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new E(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\t\tvarying vec2 vPixcoord;\n\n\t\tvoid SMAABlendingWeightCalculationVS( vec2 texcoord ) {\n\t\t\tvPixcoord = texcoord / resolution;\n\n\t\t\t// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components\n\n\t\t\t// And these for the searches, they indicate the ends of the loops:\n\t\t\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAABlendingWeightCalculationVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tArea;\n\t\tuniform sampler2D tSearch;\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[3];\n\t\tvarying vec2 vPixcoord;\n\n\t\t#if __VERSION__ == 100\n\t\tvec2 round( vec2 x ) {\n\t\t\treturn sign( x ) * floor( abs( x ) + 0.5 );\n\t\t}\n\t\t#endif\n\n\t\tfloat SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {\n\t\t\t// Not required if searchTex accesses are set to point:\n\t\t\t// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n\t\t\t// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n\t\t\t//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n\t\t\te.r = bias + e.r * scale;\n\t\t\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;\n\t\t}\n\n\t\tfloat SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\t/**\n\t\t\t\t* @PSEUDO_GATHER4\n\t\t\t\t* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to\n\t\t\t\t* sample between edge, thus fetching four edges in a row.\n\t\t\t\t* Sampling with different offsets in each direction allows to disambiguate\n\t\t\t\t* which edges are active from the four fetched ones.\n\t\t\t\t*/\n\t\t\tvec2 e = vec2( 0.0, 1.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;\n\t\t\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\t// We correct the previous (-0.25, -0.125) offset we applied:\n\t\t\ttexcoord.x += 0.25 * resolution.x;\n\n\t\t\t// The searches are bias by 1, so adjust the coords accordingly:\n\t\t\ttexcoord.x += resolution.x;\n\n\t\t\t// Disambiguate the length added by the last step:\n\t\t\ttexcoord.x += 2.0 * resolution.x; // Undo last step\n\t\t\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n\t\t\treturn texcoord.x;\n\t\t}\n\n\t\tfloat SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 0.0, 1.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;\n\t\t\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.x -= 0.25 * resolution.x;\n\t\t\ttexcoord.x -= resolution.x;\n\t\t\ttexcoord.x -= 2.0 * resolution.x;\n\t\t\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n\t\t\treturn texcoord.x;\n\t\t}\n\n\t\tfloat SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 1.0, 0.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign\n\t\t\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign\n\n\t\t\treturn texcoord.y;\n\t\t}\n\n\t\tfloat SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 1.0, 0.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign\n\t\t\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign\n\n\t\t\treturn texcoord.y;\n\t\t}\n\n\t\tvec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {\n\t\t\t// Rounding prevents precision errors of bilinear filtering:\n\t\t\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;\n\n\t\t\t// We do a scale and bias for mapping to texel space:\n\t\t\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );\n\n\t\t\t// Move to proper place, according to the subpixel offset:\n\t\t\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n\t\t\treturn texture2D( areaTex, texcoord, 0.0 ).rg;\n\t\t}\n\n\t\tvec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {\n\t\t\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tvec2 e = texture2D( edgesTex, texcoord ).rg;\n\n\t\t\tif ( e.g > 0.0 ) { // Edge at north\n\t\t\t\tvec2 d;\n\n\t\t\t\t// Find the distance to the left:\n\t\t\t\tvec2 coords;\n\t\t\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );\n\t\t\t\tcoords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)\n\t\t\t\td.x = coords.x;\n\n\t\t\t\t// Now fetch the left crossing edges, two at a time using bilinear\n\t\t\t\t// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n\t\t\t\t// discern what value each edge has:\n\t\t\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;\n\n\t\t\t\t// Find the distance to the right:\n\t\t\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );\n\t\t\t\td.y = coords.x;\n\n\t\t\t\t// We want the distances to be in pixel units (doing this here allow to\n\t\t\t\t// better interleave arithmetic and memory accesses):\n\t\t\t\td = d / resolution.x - pixcoord.x;\n\n\t\t\t\t// SMAAArea below needs a sqrt, as the areas texture is compressed\n\t\t\t\t// quadratically:\n\t\t\t\tvec2 sqrt_d = sqrt( abs( d ) );\n\n\t\t\t\t// Fetch the right crossing edges:\n\t\t\t\tcoords.y -= 1.0 * resolution.y; // WebGL port note: Added\n\t\t\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;\n\n\t\t\t\t// Ok, we know how this pattern looks like, now it is time for getting\n\t\t\t\t// the actual area:\n\t\t\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );\n\t\t\t}\n\n\t\t\tif ( e.r > 0.0 ) { // Edge at west\n\t\t\t\tvec2 d;\n\n\t\t\t\t// Find the distance to the top:\n\t\t\t\tvec2 coords;\n\n\t\t\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );\n\t\t\t\tcoords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;\n\t\t\t\td.x = coords.y;\n\n\t\t\t\t// Fetch the top crossing edges:\n\t\t\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;\n\n\t\t\t\t// Find the distance to the bottom:\n\t\t\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );\n\t\t\t\td.y = coords.y;\n\n\t\t\t\t// We want the distances to be in pixel units:\n\t\t\t\td = d / resolution.y - pixcoord.y;\n\n\t\t\t\t// SMAAArea below needs a sqrt, as the areas texture is compressed\n\t\t\t\t// quadratically:\n\t\t\t\tvec2 sqrt_d = sqrt( abs( d ) );\n\n\t\t\t\t// Fetch the bottom crossing edges:\n\t\t\t\tcoords.y -= 1.0 * resolution.y; // WebGL port note: Added\n\t\t\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;\n\n\t\t\t\t// Get the area for this direction:\n\t\t\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );\n\t\t\t}\n\n\t\t\treturn weights;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );\n\n\t\t}"},dr={name:"SMAABlendShader",uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new E(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 2 ];\n\n\t\tvoid SMAANeighborhoodBlendingVS( vec2 texcoord ) {\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAANeighborhoodBlendingVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tColor;\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 2 ];\n\n\t\tvec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {\n\t\t\t// Fetch the blending weights for current pixel:\n\t\t\tvec4 a;\n\t\t\ta.xz = texture2D( blendTex, texcoord ).xz;\n\t\t\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;\n\t\t\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;\n\n\t\t\t// Is there any blending weight with a value greater than 0.0?\n\t\t\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {\n\t\t\t\treturn texture2D( colorTex, texcoord, 0.0 );\n\t\t\t} else {\n\t\t\t\t// Up to 4 lines can be crossing a pixel (one through each edge). We\n\t\t\t\t// favor blending by choosing the line with the maximum weight for each\n\t\t\t\t// direction:\n\t\t\t\tvec2 offset;\n\t\t\t\toffset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n\t\t\t\toffset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n\t\t\t\t// Then we go in the direction that has the maximum weight:\n\t\t\t\tif ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical\n\t\t\t\t\toffset.y = 0.0;\n\t\t\t\t} else {\n\t\t\t\t\toffset.x = 0.0;\n\t\t\t\t}\n\n\t\t\t\t// Fetch the opposite color and lerp by hand:\n\t\t\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );\n\t\t\t\ttexcoord += sign( offset ) * resolution;\n\t\t\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );\n\t\t\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );\n\n\t\t\t\t// WebGL port note: Added gamma correction\n\t\t\t\tC.xyz = pow(C.xyz, vec3(2.2));\n\t\t\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));\n\t\t\t\tvec4 mixed = mix(C, Cop, s);\n\t\t\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n\t\t\t\treturn mixed;\n\t\t\t}\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );\n\n\t\t}"};class hr extends za{constructor(e,t){super(),this.edgesRT=new rt(e,t,{depthBuffer:!1,type:Le}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new rt(e,t,{depthBuffer:!1,type:Le}),this.weightsRT.texture.name="SMAAPass.weights";const n=this,i=new Image;i.src=this.getAreaTexture(),i.onload=function(){n.areaTexture.needsUpdate=!0},this.areaTexture=new pe,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=i,this.areaTexture.minFilter=O,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const s=new Image;s.src=this.getSearchTexture(),s.onload=function(){n.searchTexture.needsUpdate=!0},this.searchTexture=new pe,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=s,this.searchTexture.magFilter=P,this.searchTexture.minFilter=P,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=at.clone(cr.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new st({defines:Object.assign({},cr.defines),uniforms:this.uniformsEdges,vertexShader:cr.vertexShader,fragmentShader:cr.fragmentShader}),this.uniformsWeights=at.clone(Ar.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new st({defines:Object.assign({},Ar.defines),uniforms:this.uniformsWeights,vertexShader:Ar.vertexShader,fragmentShader:Ar.fragmentShader}),this.uniformsBlend=at.clone(dr.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new st({uniforms:this.uniformsBlend,vertexShader:dr.vertexShader,fragmentShader:dr.fragmentShader}),this.fsQuad=new Ka(null)}render(e,t,n){this.uniformsEdges.tDiffuse.value=n.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=n.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}setSize(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)}getAreaTexture(){return"data:image/png;base64,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"}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}dispose(){this.edgesRT.dispose(),this.weightsRT.dispose(),this.areaTexture.dispose(),this.searchTexture.dispose(),this.materialEdges.dispose(),this.materialWeights.dispose(),this.materialBlend.dispose(),this.fsQuad.dispose()}}class ur{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,n){return e[0]*t+e[1]*n}dot3(e,t,n,i){return e[0]*t+e[1]*n+e[2]*i}dot4(e,t,n,i,s){return e[0]*t+e[1]*n+e[2]*i+e[3]*s}noise(e,t){let n,i,s;const a=(e+t)*(.5*(Math.sqrt(3)-1)),r=Math.floor(e+a),o=Math.floor(t+a),l=(3-Math.sqrt(3))/6,c=(r+o)*l,A=e-(r-c),d=t-(o-c);let h,u;A>d?(h=1,u=0):(h=0,u=1);const p=A-h+l,g=d-u+l,m=A-1+2*l,b=d-1+2*l,f=255&r,v=255&o,y=this.perm[f+this.perm[v]]%12,w=this.perm[f+h+this.perm[v+u]]%12,C=this.perm[f+1+this.perm[v+1]]%12;let x=.5-A*A-d*d;x<0?n=0:(x*=x,n=x*x*this.dot(this.grad3[y],A,d));let I=.5-p*p-g*g;I<0?i=0:(I*=I,i=I*I*this.dot(this.grad3[w],p,g));let E=.5-m*m-b*b;return E<0?s=0:(E*=E,s=E*E*this.dot(this.grad3[C],m,b)),70*(n+i+s)}noise3d(e,t,n){let i,s,a,r;const o=(e+t+n)*(1/3),l=Math.floor(e+o),c=Math.floor(t+o),A=Math.floor(n+o),d=1/6,h=(l+c+A)*d,u=e-(l-h),p=t-(c-h),g=n-(A-h);let m,b,f,v,y,w;u>=p?p>=g?(m=1,b=0,f=0,v=1,y=1,w=0):u>=g?(m=1,b=0,f=0,v=1,y=0,w=1):(m=0,b=0,f=1,v=1,y=0,w=1):p<g?(m=0,b=0,f=1,v=0,y=1,w=1):u<g?(m=0,b=1,f=0,v=0,y=1,w=1):(m=0,b=1,f=0,v=1,y=1,w=0);const C=u-m+d,x=p-b+d,I=g-f+d,E=u-v+2*d,S=p-y+2*d,B=g-w+2*d,Q=u-1+.5,j=p-1+.5,M=g-1+.5,D=255&l,T=255&c,R=255&A,O=this.perm[D+this.perm[T+this.perm[R]]]%12,k=this.perm[D+m+this.perm[T+b+this.perm[R+f]]]%12,L=this.perm[D+v+this.perm[T+y+this.perm[R+w]]]%12,P=this.perm[D+1+this.perm[T+1+this.perm[R+1]]]%12;let F=.6-u*u-p*p-g*g;F<0?i=0:(F*=F,i=F*F*this.dot3(this.grad3[O],u,p,g));let N=.6-C*C-x*x-I*I;N<0?s=0:(N*=N,s=N*N*this.dot3(this.grad3[k],C,x,I));let _=.6-E*E-S*S-B*B;_<0?a=0:(_*=_,a=_*_*this.dot3(this.grad3[L],E,S,B));let G=.6-Q*Q-j*j-M*M;return G<0?r=0:(G*=G,r=G*G*this.dot3(this.grad3[P],Q,j,M)),32*(i+s+a+r)}noise4d(e,t,n,i){const s=this.grad4,a=this.simplex,r=this.perm,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,A,d,h,u;const p=(e+t+n+i)*o,g=Math.floor(e+p),m=Math.floor(t+p),b=Math.floor(n+p),f=Math.floor(i+p),v=(g+m+b+f)*l,y=e-(g-v),w=t-(m-v),C=n-(b-v),x=i-(f-v),I=(y>w?32:0)+(y>C?16:0)+(w>C?8:0)+(y>x?4:0)+(w>x?2:0)+(C>x?1:0),E=a[I][0]>=3?1:0,S=a[I][1]>=3?1:0,B=a[I][2]>=3?1:0,Q=a[I][3]>=3?1:0,j=a[I][0]>=2?1:0,M=a[I][1]>=2?1:0,D=a[I][2]>=2?1:0,T=a[I][3]>=2?1:0,R=a[I][0]>=1?1:0,O=a[I][1]>=1?1:0,k=a[I][2]>=1?1:0,L=a[I][3]>=1?1:0,P=y-E+l,F=w-S+l,N=C-B+l,_=x-Q+l,G=y-j+2*l,U=w-M+2*l,z=C-D+2*l,H=x-T+2*l,q=y-R+3*l,K=w-O+3*l,W=C-k+3*l,V=x-L+3*l,Y=y-1+4*l,J=w-1+4*l,X=C-1+4*l,Z=x-1+4*l,$=255&g,ee=255&m,te=255&b,ne=255&f,ie=r[$+r[ee+r[te+r[ne]]]]%32,se=r[$+E+r[ee+S+r[te+B+r[ne+Q]]]]%32,ae=r[$+j+r[ee+M+r[te+D+r[ne+T]]]]%32,re=r[$+R+r[ee+O+r[te+k+r[ne+L]]]]%32,oe=r[$+1+r[ee+1+r[te+1+r[ne+1]]]]%32;let le=.6-y*y-w*w-C*C-x*x;le<0?c=0:(le*=le,c=le*le*this.dot4(s[ie],y,w,C,x));let ce=.6-P*P-F*F-N*N-_*_;ce<0?A=0:(ce*=ce,A=ce*ce*this.dot4(s[se],P,F,N,_));let Ae=.6-G*G-U*U-z*z-H*H;Ae<0?d=0:(Ae*=Ae,d=Ae*Ae*this.dot4(s[ae],G,U,z,H));let de=.6-q*q-K*K-W*W-V*V;de<0?h=0:(de*=de,h=de*de*this.dot4(s[re],q,K,W,V));let he=.6-Y*Y-J*J-X*X-Z*Z;return he<0?u=0:(he*=he,u=he*he*this.dot4(s[oe],Y,J,X,Z)),27*(c+A+d+h+u)}}const pr={name:"SSAOShader",defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new E},cameraProjectionMatrix:{value:new S},cameraInverseProjectionMatrix:{value:new S},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\tuniform highp sampler2D tNormal;\n\t\tuniform highp sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\n\t\t\tif ( depth == 1.0 ) {\n\n\t\t\t\tgl_FragColor = vec4( 1.0 ); // don't influence background\n\t\t\t\t\n\t\t\t} else {\n\n\t\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\t\tvec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );\n\n\t\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t\t\tfloat occlusion = 0.0;\n\n\t\t\t\tfor ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t\t}\n\n\t\t}"},gr={name:"SSAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},mr={name:"SSAOBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new E}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};class br extends za{constructor(e,t,n,i,s=32){super(),this.width=void 0!==n?n:512,this.height=void 0!==i?i:512,this.clear=!0,this.needsSwap=!1,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(s),this.generateRandomKernelRotations();const a=new vt;a.format=wt,a.type=Ct,this.normalRenderTarget=new rt(this.width,this.height,{minFilter:P,magFilter:P,type:Le,depthTexture:a}),this.ssaoRenderTarget=new rt(this.width,this.height,{type:Le}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new st({defines:Object.assign({},pr.defines),uniforms:at.clone(pr.uniforms),vertexShader:pr.vertexShader,fragmentShader:pr.fragmentShader,blending:ot}),this.ssaoMaterial.defines.KERNEL_SIZE=s,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ft,this.normalMaterial.blending=ot,this.blurMaterial=new st({defines:Object.assign({},mr.defines),uniforms:at.clone(mr.uniforms),vertexShader:mr.vertexShader,fragmentShader:mr.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new st({defines:Object.assign({},gr.defines),uniforms:at.clone(gr.uniforms),vertexShader:gr.vertexShader,fragmentShader:gr.fragmentShader,blending:ot}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new st({uniforms:at.clone(Ua.uniforms),vertexShader:Ua.vertexShader,fragmentShader:Ua.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:xt,blendDst:It,blendEquation:Et,blendSrcAlpha:St,blendDstAlpha:It,blendEquationAlpha:Et}),this.fsQuad=new Ka(null),this.originalClearColor=new b}dispose(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t,n){switch(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case br.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=ot,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:n);break;case br.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=ot,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:n);break;case br.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:n);break;case br.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=ot,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:n);break;case br.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=Bt,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:n)}}renderPass(e,t,n,i,s){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),r=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=r,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,n,i,s){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),r=e.autoClear;e.setRenderTarget(n),e.autoClear=!1,i=t.clearColor||i,s=t.clearAlpha||s,null!=i&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=r,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(e){const t=this.kernel;for(let n=0;n<e;n++){const i=new B;i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=Math.random(),i.normalize();let s=n/e;s=Z.lerp(.1,1,s*s),i.multiplyScalar(s),t.push(i)}}generateRandomKernelRotations(){const e=new ur,t=new Float32Array(16);for(let n=0;n<16;n++){const i=2*Math.random()-1,s=2*Math.random()-1,a=0;t[n]=e.noise3d(i,s,a)}this.noiseTexture=new Fe(t,4,4,Ue,Pe),this.noiseTexture.wrapS=L,this.noiseTexture.wrapT=L,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(e){const n=t.get(e);e.visible=n}),t.clear()}}br.OUTPUT={Default:0,SSAO:1,Blur:2,Depth:3,Normal:4};const fr={name:"ColorCorrectionShader",uniforms:{tDiffuse:{value:null},powRGB:{value:new B(2,2,2)},mulRGB:{value:new B(1,1,1)},addRGB:{value:new B(0,0,0)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 powRGB;\n\t\tuniform vec3 mulRGB;\n\t\tuniform vec3 addRGB;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );\n\n\t\t}"},vr={name:"VignetteShader",uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}"},yr={name:"SepiaShader",uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float amount;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\t\t\tvec3 c = color.rgb;\n\n\t\t\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n\t\t\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n\t\t\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n\n\t\t\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n\n\t\t}"},wr={name:"HueSaturationShader",uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float hue;\n\t\tuniform float saturation;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// hue\n\t\t\tfloat angle = hue * 3.14159265;\n\t\t\tfloat s = sin(angle), c = cos(angle);\n\t\t\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\t\t\tfloat len = length(gl_FragColor.rgb);\n\t\t\tgl_FragColor.rgb = vec3(\n\t\t\t\tdot(gl_FragColor.rgb, weights.xyz),\n\t\t\t\tdot(gl_FragColor.rgb, weights.zxy),\n\t\t\t\tdot(gl_FragColor.rgb, weights.yzx)\n\t\t\t);\n\n\t\t\t// saturation\n\t\t\tfloat average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;\n\t\t\tif (saturation > 0.0) {\n\t\t\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n\t\t\t} else {\n\t\t\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);\n\t\t\t}\n\n\t\t}"},Cr={name:"BrightnessContrastShader",uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float brightness;\n\t\tuniform float contrast;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\tgl_FragColor.rgb += brightness;\n\n\t\t\tif (contrast > 0.0) {\n\t\t\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n\t\t\t} else {\n\t\t\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n\t\t\t}\n\n\t\t}"};class xr{constructor(e,t,n){this.scene=e,this.camera=t,this.renderer=n,this.composer=null,this.renderPass=null,this.outputPass=null,this.activeEffects=new Map,this.effectSettings={bloom:{enabled:!1,strength:1.5,radius:.4,threshold:.85},film:{enabled:!1,noiseIntensity:.5,scanlinesIntensity:.05,scanlinesCount:648,grayscale:!1},fxaa:{enabled:!1},ssao:{enabled:!1,kernelRadius:8,minDistance:.005,maxDistance:.1},toneMapping:{enabled:!0,mapping:"ACESFilmic",exposure:1},colorCorrection:{enabled:!1,powRGB:{x:2,y:2,z:2},mulRGB:{x:1,y:1,z:1},addRGB:{x:0,y:0,z:0}},vignette:{enabled:!1,offset:1,darkness:1},sepia:{enabled:!1,amount:1},hueSaturation:{enabled:!1,hue:0,saturation:0},brightnessContrast:{enabled:!1,brightness:0,contrast:0},glitch:{enabled:!1,factor:.1},pixelate:{enabled:!1,pixelSize:6},dotScreen:{enabled:!1,center:{x:.5,y:.5},angle:1.57,scale:1}},this.initializeComposer()}initializeComposer(){if(this.composer)try{for(const e of this.composer.passes||[])try{e.dispose&&e.dispose()}catch{}this.composer.dispose()}catch{}this.composer=new Ja(this.renderer),this.renderPass=new Xa(this.scene,this.camera),this.composer.addPass(this.renderPass),this.outputPass=new $a,this.updateComposer()}setCamera(e){e&&(this.camera=e,this.renderPass&&(this.renderPass.camera=e),this.updateComposer())}updateComposer(){try{const e=(this.composer.passes||[]).filter(e=>e!==this.renderPass);for(const t of e)try{t.dispose&&t.dispose()}catch{}}catch{}this.composer.passes=[this.renderPass],this.activeEffects.clear(),this.addActiveEffects(),this.composer.addPass(this.outputPass)}addActiveEffects(){this.effectSettings.ssao.enabled&&this.addSSAOEffect(),this.effectSettings.bloom.enabled&&this.addBloomEffect(),this.effectSettings.colorCorrection.enabled&&this.addColorCorrectionEffect(),this.effectSettings.brightnessContrast.enabled&&this.addBrightnessContrastEffect(),this.effectSettings.hueSaturation.enabled&&this.addHueSaturationEffect(),this.effectSettings.sepia.enabled&&this.addSepiaEffect(),this.effectSettings.vignette.enabled&&this.addVignetteEffect(),this.effectSettings.pixelate.enabled&&this.addPixelateEffect(),this.effectSettings.dotScreen.enabled&&this.addDotScreenEffect(),this.effectSettings.glitch.enabled&&this.addGlitchEffect(),this.effectSettings.film.enabled&&this.addFilmEffect(),this.effectSettings.fxaa.enabled&&this.addFXAAEffect(),this.applyToneMapping()}addBloomEffect(){const e=this.effectSettings.bloom,t=new E(window.innerWidth,window.innerHeight),n=new tr(t,e.strength,e.radius,e.threshold);this.composer.addPass(n),this.activeEffects.set("bloom",n)}addFilmEffect(){const e=this.effectSettings.film,t=new ir(e.noiseIntensity,e.scanlinesIntensity,e.scanlinesCount,e.grayscale);this.composer.addPass(t),this.activeEffects.set("film",t)}addFXAAEffect(){{const e=this.renderer.getPixelRatio(),t=new hr(Math.max(1,Math.floor(window.innerWidth*e)),Math.max(1,Math.floor(window.innerHeight*e)));return this.composer.addPass(t),void this.activeEffects.set("fxaa",t)}}addSSAOEffect(){var e,t;const n=this.effectSettings.ssao,i=Math.max(1,(null==(t=(e=this.renderer).getPixelRatio)?void 0:t.call(e))||window.devicePixelRatio||1),s=new br(this.scene,this.camera,Math.max(1,Math.floor(window.innerWidth*i)),Math.max(1,Math.floor(window.innerHeight*i)));s.kernelRadius=n.kernelRadius,s.minDistance=n.minDistance,s.maxDistance=n.maxDistance,this.composer.addPass(s),this.activeEffects.set("ssao",s)}applyToneMapping(){const e=this.effectSettings.toneMapping||{enabled:!0,mapping:"ACESFilmic",exposure:1},t=this._resolveToneMappingConst(e.mapping);try{this.renderer.toneMapping=e.enabled?t:Qt,this.renderer.toneMappingExposure=e.exposure??1}catch{}}_resolveToneMappingConst(e){switch((e||"").toLowerCase()){case"none":return Qt;case"linear":return dt;case"reinhard":return ht;case"cineon":return ut;default:return pt}}addColorCorrectionEffect(){const e=this.effectSettings.colorCorrection,t=new Wa(fr);t.material.uniforms.powRGB.value=new B(e.powRGB.x,e.powRGB.y,e.powRGB.z),t.material.uniforms.mulRGB.value=new B(e.mulRGB.x,e.mulRGB.y,e.mulRGB.z),t.material.uniforms.addRGB.value=new B(e.addRGB.x,e.addRGB.y,e.addRGB.z),this.composer.addPass(t),this.activeEffects.set("colorCorrection",t)}addVignetteEffect(){const e=this.effectSettings.vignette,t=new Wa(vr);t.material.uniforms.offset.value=e.offset,t.material.uniforms.darkness.value=e.darkness,this.composer.addPass(t),this.activeEffects.set("vignette",t)}addSepiaEffect(){const e=this.effectSettings.sepia,t=new Wa(yr);t.material.uniforms.amount.value=e.amount,this.composer.addPass(t),this.activeEffects.set("sepia",t)}addHueSaturationEffect(){const e=this.effectSettings.hueSaturation,t=new Wa(wr);t.material.uniforms.hue.value=e.hue,t.material.uniforms.saturation.value=e.saturation,this.composer.addPass(t),this.activeEffects.set("hueSaturation",t)}addBrightnessContrastEffect(){const e=this.effectSettings.brightnessContrast,t=new Wa(Cr);t.material.uniforms.brightness.value=e.brightness,t.material.uniforms.contrast.value=e.contrast,this.composer.addPass(t),this.activeEffects.set("brightnessContrast",t)}addGlitchEffect(){const e=new or;e.factor=this.effectSettings.glitch.factor,this.composer.addPass(e),this.activeEffects.set("glitch",e)}addPixelateEffect(){const e=this.effectSettings.pixelate,t=new lr(e.pixelSize,this.scene,this.camera);this.composer.addPass(t),this.activeEffects.set("pixelate",t)}addDotScreenEffect(){const e=this.effectSettings.dotScreen,t=new ar(new E(e.center.x,e.center.y),e.angle,e.scale);this.composer.addPass(t),this.activeEffects.set("dotScreen",t)}setEffectEnabled(e,t){if(e in this.effectSettings&&(this.effectSettings[e].enabled=t,this.updateComposer(),"toneMapping"===e))try{n(()=>Promise.resolve().then(()=>Rs),void 0).then(e=>{try{e.saveEnvironmentSettingsAsync({toneMapping:{...this.effectSettings.toneMapping}})}catch{}}).catch(()=>{})}catch{}}updateEffectSettings(e,t){if(this.effectSettings[e]&&(Object.assign(this.effectSettings[e],t),this.effectSettings[e].enabled&&this.updateComposer(),"toneMapping"===e))try{n(()=>Promise.resolve().then(()=>Rs),void 0).then(e=>{try{e.saveEnvironmentSettingsAsync({toneMapping:{...this.effectSettings.toneMapping}})}catch{}}).catch(()=>{})}catch{}}render(){this.composer.render()}handleResize(e,t){var n,i,s,a;const r=Math.max(1,(null==(i=(n=this.renderer).getPixelRatio)?void 0:i.call(n))||window.devicePixelRatio||1);"function"==typeof this.composer.setPixelRatio&&this.composer.setPixelRatio(r),this.composer.setSize(e,t);const o=this.activeEffects.get("fxaa");if(o){const n=this.renderer.getPixelRatio();"function"==typeof o.setSize?o.setSize(Math.max(1,Math.floor(e*n)),Math.max(1,Math.floor(t*n))):(null==(a=null==(s=o.material)?void 0:s.uniforms)?void 0:a.resolution)&&(o.material.uniforms.resolution.value.x=1/(e*n),o.material.uniforms.resolution.value.y=1/(t*n))}}setOutlineSelectedObjects(){}setOutlineActiveObjects(){}getSettings(){return JSON.parse(JSON.stringify(this.effectSettings))}loadSettings(e){Object.assign(this.effectSettings,e),this.updateComposer()}applyPreset(e="default"){const t=String(e||"default").toLowerCase(),i={...this.effectSettings};switch(i.fxaa.enabled=!0,i.ssao.enabled=!1,i.bloom.enabled=!1,t){case"high":i.ssao.enabled=!0,i.bloom.enabled=!0,i.bloom.strength=i.bloom.strength??1.5,i.bloom.radius=i.bloom.radius??.4,i.bloom.threshold=i.bloom.threshold??.85,i.ssao.kernelRadius=i.ssao.kernelRadius??12;break;case"medium":i.ssao.enabled=!0,i.ssao.kernelRadius=i.ssao.kernelRadius??8}this.effectSettings=i,this.updateComposer();try{n(()=>Promise.resolve().then(()=>Rs),void 0).then(t=>{try{t.saveEnvironmentSettingsAsync({postProcessing:{preset:e}})}catch{}}).catch(()=>{})}catch{}}dispose(){try{for(const e of this.activeEffects.values())try{e.dispose&&e.dispose()}catch{}if(this.activeEffects.clear(),this.composer){for(const e of this.composer.passes||[])try{e.dispose&&e.dispose()}catch{}this.composer.dispose()}}catch{}this.composer=null,this.renderPass=null,this.outputPass=null}}const Ir={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Er{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(e){return new ao(e)}),this.register(function(e){return new ro(e)}),this.register(function(e){return new Ao(e)}),this.register(function(e){return new ho(e)}),this.register(function(e){return new uo(e)}),this.register(function(e){return new po(e)}),this.register(function(e){return new oo(e)}),this.register(function(e){return new lo(e)}),this.register(function(e){return new co(e)}),this.register(function(e){return new go(e)}),this.register(function(e){return new mo(e)}),this.register(function(e){return new bo(e)}),this.register(function(e){return new fo(e)}),this.register(function(e){return new vo(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,n,i){const s=new so,a=[];for(let r=0,o=this.pluginCallbacks.length;r<o;r++)a.push(this.pluginCallbacks[r](s));s.setPlugins(a),s.setTextureUtils(this.textureUtils),s.writeAsync(e,t,i).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,i,s,t)})}}const Sr=0,Br=1,Qr=2,jr=3,Mr=4,Dr=5120,Tr=5121,Rr=5122,Or=5123,kr=5124,Lr=5125,Pr=5126,Fr=34962,Nr=34963,_r=9728,Gr=9729,Ur=9984,zr=9985,Hr=9986,qr=9987,Kr=33071,Wr=33648,Vr=10497,Yr="KHR_mesh_quantization",Jr={};Jr[P]=_r,Jr[re]=Ur,Jr[le]=Hr,Jr[O]=Gr,Jr[oe]=zr,Jr[k]=qr,Jr[ce]=Kr,Jr[L]=Vr,Jr[Ae]=Wr;const Xr={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Zr=new b;function $r(e,t){return e.length===t.length&&e.every(function(e,n){return e===t[n]})}function eo(e){return 4*Math.ceil(e/4)}function to(e,t=0){const n=eo(e.byteLength);if(n!==e.byteLength){const i=new Uint8Array(n);if(i.set(new Uint8Array(e)),0!==t)for(let s=e.byteLength;s<n;s++)i[s]=t;return i.buffer}return e}function no(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function io(e,t){if(void 0!==e.toBlob)return new Promise(n=>e.toBlob(n,t));let n;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}class so{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+jt}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const i=this,s=i.buffers,a=i.json;n=i.options;const r=i.extensionsUsed,o=i.extensionsRequired,l=new Blob(s,{type:"application/octet-stream"}),c=Object.keys(r),A=Object.keys(o);if(c.length>0&&(a.extensionsUsed=c),A.length>0&&(a.extensionsRequired=A),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===n.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const n=to(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,n.byteLength,!0),i.setUint32(4,5130562,!0);const s=to((r=JSON.stringify(a),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,s.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const A=12+o.byteLength+s.byteLength+i.byteLength+n.byteLength;c.setUint32(8,A,!0);const d=new Blob([l,o,s,i,n],{type:"application/octet-stream"}),h=new FileReader;h.readAsArrayBuffer(d),h.onloadend=function(){t(h.result)}}}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const n=e.result;a.buffers[0].uri=n,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const n=this.options,i=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&s.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in s.gltfExtensions)t.extensions[e]=s.gltfExtensions[e],i[e]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(t.extras=s)}catch(s){}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new B;for(let n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),i=new B;for(let s=0,a=n.count;s<a;s++)i.fromBufferAttribute(n,s),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),n.setXYZ(s,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(i.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,t){if(e===t)return e;function n(e){return e.colorSpace===x?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof xe&&(e=await this.decompressTextureAsync(e)),t instanceof xe&&(t=await this.decompressTextureAsync(t));const i=e?e.image:null,s=t?t.image:null,a=Math.max(i?i.width:0,s?s.width:0),r=Math.max(i?i.height:0,s?s.height:0),o=no();o.width=a,o.height=r;const l=o.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,a,r);const c=l.getImageData(0,0,a,r);if(i){l.drawImage(i,0,0,a,r);const t=n(e),s=l.getImageData(0,0,a,r).data;for(let e=2;e<s.length;e+=4)c.data[e]=256*t(s[e]/256)}if(s){l.drawImage(s,0,0,a,r);const e=n(t),i=l.getImageData(0,0,a,r).data;for(let t=1;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}l.putImageData(c,0,0);const A=(e||t).clone();return A.source=new Mt(o),A.colorSpace=_e,A.channel=(e||t).channel,e&&t&&(e.channel,t.channel),A}async decompressTextureAsync(e,t=1/0){if(null===this.textureUtils)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,i,s){const a=this.json;let r;switch(a.bufferViews||(a.bufferViews=[]),t){case Dr:case Tr:r=1;break;case Rr:case Or:r=2;break;default:r=4}let o=e.itemSize*r;s===Fr&&(o=4*Math.ceil(o/4));const l=eo(i*o),c=new DataView(new ArrayBuffer(l));let A=0;for(let h=n;h<n+i;h++){for(let n=0;n<e.itemSize;n++){let i;e.itemSize>4?i=e.array[h*e.itemSize+n]:(0===n?i=e.getX(h):1===n?i=e.getY(h):2===n?i=e.getZ(h):3===n&&(i=e.getW(h)),!0===e.normalized&&(i=Z.normalize(i,e.array))),t===Pr?c.setFloat32(A,i,!0):t===kr?c.setInt32(A,i,!0):t===Lr?c.setUint32(A,i,!0):t===Rr?c.setInt16(A,i,!0):t===Or?c.setUint16(A,i,!0):t===Dr?c.setInt8(A,i):t===Tr&&c.setUint8(A,i),A+=r}A%o!==0&&(A+=o-A%o)}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};void 0!==s&&(d.target=s),s===Fr&&(d.byteStride=o),this.byteOffset+=l,a.bufferViews.push(d);return{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){const s=new FileReader;s.readAsArrayBuffer(e),s.onloadend=function(){const e=to(s.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(n.bufferViews.push(a)-1)}})}processAccessor(e,t,n,i){const s=this.json;let a;if(e.array.constructor===Float32Array)a=Pr;else if(e.array.constructor===Int32Array)a=kr;else if(e.array.constructor===Uint32Array)a=Lr;else if(e.array.constructor===Int16Array)a=Rr;else if(e.array.constructor===Uint16Array)a=Or;else if(e.array.constructor===Int8Array)a=Dr;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);a=Tr}if(void 0===n&&(n=0),void 0!==i&&i!==1/0||(i=e.count),0===i)return null;const r=function(e,t,n){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+n;s++)for(let t=0;t<e.itemSize;t++){let n;e.itemSize>4?n=e.array[s*e.itemSize+t]:(0===t?n=e.getX(s):1===t?n=e.getY(s):2===t?n=e.getZ(s):3===t&&(n=e.getW(s)),!0===e.normalized&&(n=Z.normalize(n,e.array))),i.min[t]=Math.min(i.min[t],n),i.max[t]=Math.max(i.max[t],n)}return i}(e,n,i);let o;void 0!==t&&(o=e===t.index?Nr:Fr);const l=this.processBufferView(e,a,n,i,o),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:a,count:i,max:r.max,min:r.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(c)-1}processImage(e,t,n,i="image/png"){if(null!==e){const t=this,s=t.cache,a=t.json,r=t.options,o=t.pending;s.images.has(e)||s.images.set(e,{});const l=s.images.get(e),c=i+":flipY/"+n.toString();if(void 0!==l[c])return l[c];a.images||(a.images=[]);const A={mimeType:i},d=no();d.width=Math.min(e.width,r.maxTextureSize),d.height=Math.min(e.height,r.maxTextureSize);const h=d.getContext("2d",{willReadFrequently:!0});if(!0===n&&(h.translate(0,d.height),h.scale(1,-1)),void 0!==e.data){e.width>r.maxTextureSize||(e.height,r.maxTextureSize);const t=new Uint8ClampedArray(e.height*e.width*4);for(let n=0;n<t.length;n+=4)t[n+0]=e.data[n+0],t[n+1]=e.data[n+1],t[n+2]=e.data[n+2],t[n+3]=e.data[n+3];h.putImageData(new ImageData(t,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");h.drawImage(e,0,0,d.width,d.height)}!0===r.binary?o.push(io(d,i).then(e=>t.processBufferViewImage(e)).then(e=>{A.bufferView=e})):void 0!==d.toDataURL?A.uri=d.toDataURL(i):o.push(io(d,i).then(e=>(new FileReader).readAsDataURL(e)).then(e=>{A.uri=e}));const u=a.images.push(A)-1;return l[c]=u,u}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Jr[e.magFilter],minFilter:Jr[e.minFilter],wrapS:Jr[e.wrapS],wrapT:Jr[e.wrapT]};return t.samplers.push(n)-1}async processTextureAsync(e){const t=this.options,n=this.cache,i=this.json;if(n.textures.has(e))return n.textures.get(e);i.textures||(i.textures=[]),e instanceof xe&&(e=await this.decompressTextureAsync(e,t.maxTextureSize));let s=e.userData.mimeType;"image/webp"===s&&(s="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(a.name=e.name),await this._invokeAllAsync(async function(t){t.writeTexture&&await t.writeTexture(e,a)});const r=i.textures.push(a)-1;return n.textures.set(e,r),r}async processMaterialAsync(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&e.isMeshBasicMaterial;const s=e.color.toArray().concat([e.opacity]);if($r(s,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=s),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),n={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(n,t),i.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){const t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){const t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){const t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===U&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),await this._invokeAllAsync(async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,i)});const a=n.materials.push(i)-1;return t.materials.set(e,a),a}async processMeshAsync(e){const t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let A=0,y=e.material.length;A<y;A++)i.push(e.material[A].uuid);else i.push(e.material.uuid);const s=i.join(":");if(t.meshes.has(s))return t.meshes.get(s);const a=e.geometry;let r;r=e.isLineSegments?Br:e.isLineLoop?Qr:e.isLine?jr:e.isPoints?Sr:e.material.wireframe?Br:Mr;const o={},l={},c=[],d=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},u=a.getAttribute("normal");void 0===u||this.isNormalizedNormalAttribute(u)||a.setAttribute("normal",this.createNormalizedNormalAttribute(u));let p=null;for(let y in a.attributes){if("morph"===y.slice(0,5))continue;const e=a.attributes[y];y=h[y]||y.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(e))){l[y]=t.attributes.get(this.getUID(e));continue}p=null;const n=e.array;"JOINTS_0"!==y||n instanceof Uint16Array||n instanceof Uint8Array?(n instanceof Uint32Array||n instanceof Int32Array)&&!y.startsWith("_")&&(p=Er.Utils.toFloat32BufferAttribute(e)):p=new A(new Uint16Array(n),e.itemSize,e.normalized);const i=this.processAccessor(p||e,a);null!==i&&(y.startsWith("_")||this.detectMeshQuantization(y,e),l[y]=i,t.attributes.set(this.getUID(e),i))}if(void 0!==u&&a.setAttribute("normal",u),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const n=[],i=[],s={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)s[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){const o={};let l=!1;for(const e in a.morphAttributes){if("position"!==e&&"normal"!==e){l||(l=!0);continue}const n=a.morphAttributes[e][r],i=e.toUpperCase(),s=a.attributes[e];if(t.attributes.has(this.getUID(n,!0))){o[i]=t.attributes.get(this.getUID(n,!0));continue}const c=n.clone();if(!a.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let i=0;i<n.itemSize;i++)0===i&&c.setX(e,n.getX(e)-s.getX(e)),1===i&&c.setY(e,n.getY(e)-s.getY(e)),2===i&&c.setZ(e,n.getZ(e)-s.getZ(e)),3===i&&c.setW(e,n.getW(e)-s.getW(e));o[i]=this.processAccessor(c,a),t.attributes.set(this.getUID(s,!0),o[i])}d.push(o),n.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&i.push(s[r])}o.weights=n,i.length>0&&(o.extras={},o.extras.targetNames=i)}const g=Array.isArray(e.material);if(g&&0===a.groups.length)return null;let m=!1;if(g&&null===a.index){const e=[];for(let t=0,n=a.attributes.position.count;t<n;t++)e[t]=t;a.setIndex(e),m=!0}const b=g?e.material:[e.material],f=g?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let A=0,y=f.length;A<y;A++){const e={mode:r,attributes:l};if(this.serializeUserData(a,e),d.length>0&&(e.targets=d),null!==a.index){let n=this.getUID(a.index);void 0===f[A].start&&void 0===f[A].count||(n+=":"+f[A].start+":"+f[A].count),t.attributes.has(n)?e.indices=t.attributes.get(n):(e.indices=this.processAccessor(a.index,a,f[A].start,f[A].count),t.attributes.set(n,e.indices)),null===e.indices&&delete e.indices}const n=await this.processMaterialAsync(b[f[A].materialIndex]);null!==n&&(e.material=n),c.push(e)}!0===m&&a.setIndex(null),o.primitives=c,n.meshes||(n.meshes=[]),await this._invokeAllAsync(function(t){t.writeMesh&&t.writeMesh(e,o)});const v=n.meshes.push(o)-1;return t.meshes.set(s,v),v}detectMeshQuantization(e,t){if(this.extensionsUsed[Yr])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");const i=e.split("_",1)[0];Ir[i]&&Ir[i].includes(n)&&(this.extensionsUsed[Yr]=!0,this.extensionsRequired[Yr]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Z.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);const s=(e=Er.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],r=[];for(let o=0;o<s.length;++o){const e=s[o],n=z.parseTrackName(e.name);let l=z.findNode(t,n.nodeName);const c=Xr[n.propertyName];if("bones"===n.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(n.objectIndex):void 0),!l||!c)continue;const d=1;let h,u=e.values.length/e.times.length;c===Xr.morphTargetInfluences&&(u/=l.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",u/=3):h=e.getInterpolation()===de?"STEP":"LINEAR",r.push({input:this.processAccessor(new A(e.times,d)),output:this.processAccessor(new A(e.values,u)),interpolation:h}),a.push({sampler:r.length-1,target:{node:i.get(l),path:c}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:r,channels:a}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],s=e.skeleton;if(void 0===s)return null;const a=e.skeleton.bones[0];if(void 0===a)return null;const r=[],o=new Float32Array(16*s.bones.length),l=new S;for(let c=0;c<s.bones.length;++c)r.push(n.get(s.bones[c])),l.copy(s.boneInverses[c]),l.multiply(e.bindMatrix).toArray(o,16*c);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new A(o,16)),joints:r,skeleton:n.get(a)});return i.skin=t.skins.length-1}async processNodeAsync(e){const t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const s={};if(n.trs){const t=e.quaternion.toArray(),n=e.position.toArray(),i=e.scale.toArray();$r(t,[0,0,0,1])||(s.rotation=t),$r(n,[0,0,0])||(s.translation=n),$r(i,[1,1,1])||(s.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===$r(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(s.matrix=e.matrix.elements);if(""!==e.name&&(s.name=String(e.name)),this.serializeUserData(e,s),e.isMesh||e.isLine||e.isPoints){const t=await this.processMeshAsync(e);null!==t&&(s.mesh=t)}else e.isCamera&&(s.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,s=e.children.length;i<s;i++){const s=e.children[i];if(s.visible||!1===n.onlyVisible){const e=await this.processNodeAsync(s);null!==e&&t.push(e)}}t.length>0&&(s.children=t)}await this._invokeAllAsync(function(t){t.writeNode&&t.writeNode(e,s)});const a=t.nodes.push(s)-1;return i.set(e,a),a}async processSceneAsync(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const s=[];for(let a=0,r=e.children.length;a<r;a++){const t=e.children[a];if(t.visible||!1===n.onlyVisible){const e=await this.processNodeAsync(t);null!==e&&s.push(e)}}s.length>0&&(i.nodes=s),this.serializeUserData(e,i)}async processObjectsAsync(e){const t=new Dt;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);await this.processSceneAsync(t)}async processInputAsync(e){const t=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync(function(t){t.beforeParse&&t.beforeParse(e)});const n=[];for(let i=0;i<e.length;i++)e[i]instanceof Dt?await this.processSceneAsync(e[i]):n.push(e[i]);n.length>0&&await this.processObjectsAsync(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);await this._invokeAllAsync(function(t){t.afterParse&&t.afterParse(e)})}async _invokeAllAsync(e){for(let t=0,n=this.plugins.length;t<n;t++)await e(this.plugins[t])}}class ao{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return;const n=this.writer,i=n.json,s=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&e.decay,e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||e.target.position.z),s[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},s[this.name]=!0);const r=i.extensions[this.name].lights;r.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}}class ro{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class oo{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:await n.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),s.clearcoatTexture=t}if(s.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:await n.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:await n.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),n.applyTextureTransform(t,e.clearcoatNormalMap),s.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class lo{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;const n=this.writer.extensionsUsed,i={};i.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class co{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:await n.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),s.iridescenceTexture=t}if(s.iridescenceIor=e.iridescenceIOR,s.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:await n.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),s.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class Ao{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.transmissionFactor=e.transmission,e.transmissionMap){const t={index:await n.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(t,e.transmissionMap),s.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class ho{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.thicknessFactor=e.thickness,e.thicknessMap){const t={index:await n.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(t,e.thicknessMap),s.thicknessTexture=t}e.attenuationDistance!==1/0&&(s.attenuationDistance=e.attenuationDistance),s.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class uo{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class po{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(Zr)&&!e.specularIntensityMap&&!e.specularColorMap)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.specularIntensityMap){const t={index:await n.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),s.specularTexture=t}if(e.specularColorMap){const t={index:await n.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),s.specularColorTexture=t}s.specularFactor=e.specularIntensity,s.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class go{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.sheenRoughnessMap){const t={index:await n.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(t,e.sheenRoughnessMap),s.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:await n.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),s.sheenColorTexture=t}s.sheenRoughnessFactor=e.sheenRoughness,s.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class mo{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.anisotropyMap){const t={index:await n.processTextureAsync(e.anisotropyMap)};n.applyTextureTransform(t,e.anisotropyMap),s.anisotropyTexture=t}s.anisotropyStrength=e.anisotropy,s.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class bo{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const n=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}class fo{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const n=this.writer,i=n.extensionsUsed,s={};if(e.bumpMap){const t={index:await n.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};n.applyTextureTransform(t,e.bumpMap),s.bumpTexture=t}s.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class vo{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const n=this.writer,i=e,s=new Float32Array(3*i.count),a=new Float32Array(4*i.count),r=new Float32Array(3*i.count),o=new S,l=new B,c=new ae,d=new B;for(let A=0;A<i.count;A++)i.getMatrixAt(A,o),o.decompose(l,c,d),l.toArray(s,3*A),c.toArray(a,4*A),d.toArray(r,3*A);const h={TRANSLATION:n.processAccessor(new A(s,3)),ROTATION:n.processAccessor(new A(a,4)),SCALE:n.processAccessor(new A(r,3))};i.instanceColor&&(h._COLOR_0=n.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:h},n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0}}Er.Utils={insertKeyframe:function(e,t){const n=.001,i=e.getValueSize(),s=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+i),r=e.createInterpolant(new e.ValueBufferType(i));let o;if(0===e.times.length){s[0]=t;for(let e=0;e<i;e++)a[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<n)return 0;s[0]=t,s.set(e.times,1),a.set(r.evaluate(t),0),a.set(e.values,i),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<n)return e.times.length-1;s[s.length-1]=t,s.set(e.times,0),a.set(e.values,0),a.set(r.evaluate(t),e.values.length),o=s.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<n)return l;if(e.times[l]<t&&e.times[l+1]>t){s.set(e.times.slice(0,l+1),0),s[l+1]=t,s.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*i),0),a.set(r.evaluate(t),(l+1)*i),a.set(e.values.slice((l+1)*i),(l+2)*i),o=l+1;break}}return e.times=s,e.values=a,o},mergeMorphTargetTracks:function(e,t){const n=[],i={},s=e.tracks;for(let a=0;a<s.length;++a){let e=s[a];const r=z.parseTrackName(e.name),o=z.findNode(t,r.nodeName);if("morphTargetInfluences"!==r.propertyName||void 0===r.propertyIndex){n.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");e=e.clone(),e.setInterpolation(ie)}const l=o.morphTargetInfluences.length,c=o.morphTargetDictionary[r.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+r.propertyIndex);let A;if(void 0===i[o.uuid]){A=e.clone();const t=new A.ValueBufferType(l*A.times.length);for(let e=0;e<A.times.length;e++)t[e*l+c]=A.values[e];A.name=(r.nodeName||"")+".morphTargetInfluences",A.values=t,i[o.uuid]=A,n.push(A);continue}const d=e.createInterpolant(new e.ValueBufferType(1));A=i[o.uuid];for(let t=0;t<A.times.length;t++)A.values[t*l+c]=d.evaluate(A.times[t]);for(let t=0;t<e.times.length;t++){const n=this.insertKeyframe(A,e.times[t]);A.values[n*l+c]=e.values[t]}}return e.tracks=n,e},toFloat32BufferAttribute:function(e){const t=new A(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return t.array.set(e.array),t;for(let n=0,i=e.count;n<i;n++)for(let s=0;s<e.itemSize;s++)t.setComponent(n,s,e.getComponent(n,s));return t}};let yo=null,wo=1;const Co=new Map;function xo(){try{return"undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas}catch{return!1}}function Io(e,t,n=[]){const i="mw_"+wo++,s=yo||(yo=new Worker(new URL("/assets/meshWorker-616a8fca.js",self.location),{type:"module"}),yo.onmessage=e=>{const t=e.data||{},{id:n}=t;if(!n||!Co.has(n))return;const{resolve:i,reject:s}=Co.get(n);Co.delete(n),"thumbnailFromGLBResult"!==t.type&&"thumbnailFromObjectJSONResult"!==t.type?"exportGLBFromObjectJSONResult"!==t.type?"error"!==t.type?i(t):s(new Error(t.error||"worker error")):t.ok?i(t):s(new Error(t.error||"export failed")):t.ok?i(t):s(new Error(t.error||"thumbnail failed"))},yo.onerror=e=>{for(const[,t]of Co.entries())t.reject((null==e?void 0:e.error)||new Error("Worker error"));Co.clear()},yo),a={type:e,id:i,...t};return new Promise((e,t)=>{Co.set(i,{resolve:e,reject:t}),s.postMessage(a,n)})}async function Eo(e,t=128,n=!0){const i=n?[e]:[];return await Io("thumbnailFromGLB",{glbBuffer:e,size:t},i)}function So(e,t="image/png",n){try{if("undefined"!=typeof OffscreenCanvas){const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),i.convertToBlob({type:t,quality:n}).then(e=>new Promise((t,n)=>{const i=new FileReader;i.onload=()=>t("string"==typeof i.result?i.result:""),i.onerror=()=>n(i.error||new Error("FileReader error")),i.readAsDataURL(e)}))}}catch{}const i=document.createElement("canvas");i.width=e.width,i.height=e.height;return i.getContext("2d").drawImage(e,0,0),Promise.resolve(i.toDataURL(t,n))}class Bo{constructor(){this.loader=ki(),this.exporter=new Er,this.thumbnailRenderer=null,this._thumbUrlCache=new Map,this._thumbDataUrlCache=new Map,this.initThumbnailRenderer(),Hs()}_hasRenderableMesh(e){var t;let n=!1;return!!e&&(null==(t=e.traverse)||t.call(e,e=>{n||(null==e?void 0:e.isMesh)&&e.geometry&&e.geometry.isBufferGeometry&&e.geometry.getAttribute("position")&&(n=!0)}),n)}async importGLBFile(e){if(!e)throw new Error("NO_FILE");const t=await e.arrayBuffer(),n=(e.name||"imported").replace(/\.(glb|gltf)$/i,"");return this.importGLBBuffer(t,n)}async importGLBBuffer(e,t="Imported Mesh"){try{let i=null;if(xo())try{const{bitmap:t}=await Eo(e,128,!1);i=await So(t)}catch(n){}if(!i){const t=new Blob([e],{type:"model/gltf-binary"}),n=URL.createObjectURL(t);try{i=await this.generateThumbnailFromURL(n)}finally{try{URL.revokeObjectURL(n)}catch{}}}const s=Date.now(),a={id:`custom_${s}`,name:t||`custom_${s}`,thumbnail:i,type:"custom",glbData:e,createdAt:s};await this.saveCustomMesh(a);try{window.dispatchEvent(new CustomEvent("customMeshAdded"))}catch{}return a}catch(n){throw n}}downloadCustomMesh(e){if(e&&e.glbData)try{const t=new Blob([e.glbData],{type:"model/gltf-binary"}),n=URL.createObjectURL(t),i=document.createElement("a"),s=(e.name||e.id||"mesh").replace(/[^a-zA-Z0-9_-]/g,"_");i.href=n,i.download=`${s}.glb`,document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>{try{URL.revokeObjectURL(n)}catch{}},0)}catch(t){}}initThumbnailRenderer(){if(this.thumbnailRenderer&&this.thumbnailRenderer.renderer)try{this.thumbnailRenderer.renderer.dispose()}catch{}this.thumbnailRenderer={scene:new Dt,camera:new X(75,1,.1,1e3),renderer:new Tt({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,powerPreference:"low-power"})};const{scene:e,camera:t,renderer:n}=this.thumbnailRenderer;n.setSize(128,128),n.setClearColor(2763306,1),this.setupLighting(e);try{Oi(n)}catch{}}setupLighting(e){const t=new Rt(4210752,.6);e.add(t);const n=new w(16777215,.8);n.position.set(1,1,1),e.add(n);const i=new w(16777215,.4);i.position.set(-1,-1,-1),e.add(i)}safeRotationCopy(e,t){if(e&&t)try{void 0!==e.order?t.copy(e):t.set(e.x||0,e.y||0,e.z||0,"XYZ")}catch(n){t.set(0,0,0,"XYZ")}}createSafeClone(e){try{if(!e||"object"!=typeof e)return new M;if("Group"===e.type||e.isGroup){const t=new J;return t.name=e.name||"",Array.isArray(e.children)&&e.children.forEach(e=>{try{const n=this.createSafeClone(e);t.add(n)}catch(n){}}),e.position&&t.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,t.rotation),e.scale&&t.scale.copy(e.scale),t}if(e.isMesh){const t=e.geometry?e.geometry.clone():null,n=e.material?this.cloneMaterial(e.material):null,i=new q(t,n);return i.name=e.name||"",e.position&&i.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,i.rotation),e.scale&&i.scale.copy(e.scale),i}const t=new M;return t.name=e.name||"",Array.isArray(e.children)&&e.children.forEach(e=>{try{const n=this.createSafeClone(e);t.add(n)}catch(n){}}),e.position&&t.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,t.rotation),e.scale&&t.scale.copy(e.scale),t}catch(t){const n=new M;return n.name=e&&e.name||"fallback_object",n}}cloneMaterial(e){return Array.isArray(e)?e.map(e=>e.clone?e.clone():e):e.clone?e.clone():e}async loadLibraryMeshes(){const e=void 0!==import.meta&&{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"true"==={}.VITE_ENABLE_LIBRARY_MANIFEST,t="undefined"!=typeof window&&!0===window.__ENABLE_LIBRARY_MANIFEST;if(!e&&!t)return[];try{const e="/library/mesh/manifest.json",t=await fetch(e,{method:"GET",cache:"no-store"});if(!t.ok)return[];const n=await t.json();return Array.isArray(n)?n.map(e=>({id:`library_${String(e.filename||"").replace(/\.glb$/i,"")}`,name:e.name||e.filename,type:"library",geometry:"LibraryMesh",glbUrl:`/library/mesh/${e.filename}`,filename:e.filename,thumbnail:null,isLoadingThumbnail:!0})):[]}catch(n){return[]}}async generateThumbnailFromURL(e){if(xo())try{const t=await fetch(e,{cache:"no-store"}),n=await t.arrayBuffer(),{bitmap:i}=await Eo(n,128);return await So(i)}catch(t){}return new Promise((t,n)=>{this.loader.load(e,e=>{try{const{scene:n,camera:i,renderer:s}=this.thumbnailRenderer,a=[];n.traverse(e=>{e.isMesh&&a.push(e)}),a.forEach(e=>n.remove(e));const r=e.scene;n.add(r);const o=(new fe).setFromObject(r).getSize(new B),l=Math.max(o.x,o.y,o.z),c=i.fov*(Math.PI/180);let A=Math.abs(l/2/Math.tan(c/2));A*=1.5,i.position.set(.7*A,.5*A,A),i.lookAt(0,0,0),s.render(n,i);const d=s.domElement.toDataURL("image/png");n.remove(r),t(d)}catch(i){n(i)}},void 0,e=>n(e))})}generateThumbnailFromObject(e,t=128){const{scene:n,camera:i,renderer:s}=this.thumbnailRenderer;for(s.setSize(t,t),s.setClearColor(2763306,1);n.children.length;)n.remove(n.children[0]);let a;this.setupLighting(n);try{a="function"==typeof e.clone?e.clone():this.createSafeClone(e)}catch(h){a=this.createSafeClone(e)}n.add(a);const r=(new fe).setFromObject(a);r.getCenter(new B);const o=r.getSize(new B),l=Math.max(o.x,o.y,o.z),c=i.fov*(Math.PI/180);let A=Math.abs(l/2/Math.tan(c/2));A*=1.5,i.position.set(.7*A,.5*A,A),i.lookAt(0,0,0),s.render(n,i);const d=s.domElement.toDataURL("image/png");return n.clear(),d}_buildSingleMesh(e,{preserveTransform:t=!0}={}){try{if(!e)return null;const t="function"==typeof e.clone?e.clone(!0):this.createSafeClone(e);t.updateMatrixWorld(!0);const n=new S;n.copy(t.matrixWorld).invert();const i=[],s=[],a=e=>{if(e.isSkinnedMesh||e.isInstancedMesh)return!1;if(Array.isArray(e.material))return!1;const t=e.geometry;if(!t||!t.isBufferGeometry)return!1;const a=t.clone(),r=new S;r.copy(e.matrixWorld),r.premultiply(n),a.applyMatrix4(r);try{a.clearGroups()}catch{}return i.push(a),s.push(e.material),!0};let r=!0;if(t.traverse(e=>{if(!r)return;const t=e.userData||{},n=!!(t.isSystemObject||t.isRayHelper||t.isLightHelper||t.isLightTarget||t.isLightTargetHandle||t.isHelper);e.isMesh&&!n&&(r=a(e))}),!r||0===i.length)return null;const o=function(e,t=!1){const n=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),a={},r={},o=e[0].morphTargetsRelative,l=new c;let A=0;for(let c=0;c<e.length;++c){const d=e[c];let h=0;if(n!==(null!==d.index))return null;for(const e in d.attributes){if(!i.has(e))return null;void 0===a[e]&&(a[e]=[]),a[e].push(d.attributes[e]),h++}if(h!==i.size)return null;if(o!==d.morphTargetsRelative)return null;for(const e in d.morphAttributes){if(!s.has(e))return null;void 0===r[e]&&(r[e]=[]),r[e].push(d.morphAttributes[e])}if(t){let e;if(n)e=d.index.count;else{if(void 0===d.attributes.position)return null;e=d.attributes.position.count}l.addGroup(A,e,c),A+=e}}if(n){let t=0;const n=[];for(let i=0;i<e.length;++i){const s=e[i].index;for(let e=0;e<s.count;++e)n.push(s.getX(e)+t);t+=e[i].attributes.position.count}l.setIndex(n)}for(const c in a){const e=Wt(a[c]);if(!e)return null;l.setAttribute(c,e)}for(const c in r){const e=r[c][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[c]=[];for(let t=0;t<e;++t){const e=[];for(let i=0;i<r[c].length;++i)e.push(r[c][i][t]);const n=Wt(e);if(!n)return null;l.morphAttributes[c].push(n)}}return l}(i,!0);if(!o||!o.groups||o.groups.length!==s.length)return null;const l=new q(o,s);return l.name=e.name||"MergedMesh",l.position.set(0,0,0),l.rotation.set(0,0,0),l.scale.set(1,1,1),l}catch(n){return null}}async exportObjectToGLB(e,t={}){const{preserveTransform:n=!1}=t;if(xo())try{const t=(null==e?void 0:e.toJSON)?e.toJSON():(new M).toJSON(),{glb:i}=await async function(e,t={}){return await Io("exportGLBFromObjectJSON",{objectJSON:e,options:t})}(t,{preserveTransform:n,compressToSingleMesh:!0});if(i&&(i.byteLength||i.buffer&&i.buffer.byteLength))return i}catch(i){}return new Promise((t,i)=>{var s,a,r,o,l,c;let A;try{A="function"==typeof e.clone?e.clone():this.createSafeClone(e)}catch(d){A=this.createSafeClone(e)}if(A&&"object"==typeof A){if(n){try{null==(s=A.updateMatrixWorld)||s.call(A,!0);const e=(new S).copy(A.matrixWorld).invert();null==(a=A.traverse)||a.call(A,t=>{if(!(t&&t.isMesh&&t.geometry&&t.geometry.isBufferGeometry))return;const n=(new S).copy(t.matrixWorld).premultiply(e);try{const e=t.geometry.clone();e.applyMatrix4(n),t.geometry=e}catch{}}),null==(r=A.traverse)||r.call(A,e=>{var t,n;try{e.position&&"function"==typeof e.position.set&&e.position.set(0,0,0),e.rotation&&"function"==typeof e.rotation.set&&e.rotation.set(0,0,0,"XYZ"),e.scale&&"function"==typeof e.scale.set&&e.scale.set(1,1,1),null==(t=e.updateMatrix)||t.call(e),null==(n=e.updateMatrixWorld)||n.call(e,!1)}catch{}})}catch{}try{null==(o=A.position)||o.set(0,0,0),null==(l=A.rotation)||l.set(0,0,0,"XYZ"),null==(c=A.scale)||c.set(1,1,1)}catch{}}else try{A.position&&"function"==typeof A.position.set&&A.position.set(0,0,0),A.rotation&&"function"==typeof A.rotation.set&&A.rotation.set(0,0,0,"XYZ"),A.scale&&"function"==typeof A.scale.set&&A.scale.set(1,1,1)}catch(h){}this.exporter.parse(A,e=>{t(e)},e=>{i(e)},{binary:!0,includeCustomExtensions:!0,embedImages:!0,maxTextureSize:1024,forcePowerOfTwoTextures:!1,truncateDrawRange:!1})}else i(new Error("객체 복제에 실패했습니다."))})}async addCustomMesh(e,t,n={}){const{preserveTransform:i=!0,compressToSingleMesh:s=!0}=n;try{let n=e;if(s&&!xo()){const t=this._buildSingleMesh(e,{preserveTransform:i});t&&(n=t)}if(!this._hasRenderableMesh(n))throw new Error("NO_MESH_FOUND");const a=await this.exportObjectToGLB(n,{preserveTransform:i});let r=null;if(xo())try{const t=(null==e?void 0:e.toJSON)?e.toJSON():(new M).toJSON(),{bitmap:n}=await async function(e,t=128){return await Io("thumbnailFromObjectJSON",{objectJSON:e,size:t})}(t,128);r=await So(n)}catch{}r||(r=this.generateThumbnailFromObject(e));const o=Date.now(),l={id:`custom_${o}`,name:t||"커스텀 메쉬",fileName:`custom_${o}.glb`,thumbnail:r,type:"custom",glbData:a,createdAt:o,transform:e&&e.position&&e.rotation&&e.scale?{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}:void 0};return await this.saveCustomMesh(l),l}catch(a){throw new Error("ADD_CUSTOM_MESH_FAILED")}}async saveCustomMesh(e){try{await Us(e)}catch(t){throw new Error("IDB_SAVE_FAILED")}}async getCustomMeshes(){const e=await Gs();return await Promise.all(e.map(async e=>{const t={...e};if(t.type||(t.type="custom"),e&&e.thumbnail&&"object"==typeof e.thumbnail&&"size"in e.thumbnail)try{const n=this._thumbDataUrlCache.get(e.id);n?t.thumbnail=n:(t.thumbnail=await new Promise((t,n)=>{try{const i=new FileReader;i.onload=()=>t("string"==typeof i.result?i.result:""),i.onerror=()=>n(i.error||new Error("FileReader error")),i.readAsDataURL(e.thumbnail)}catch(i){n(i)}}),this._thumbDataUrlCache.set(e.id,t.thumbnail))}catch{}return t}))}async getCustomMeshById(e){try{const{idbGetCustomMesh:t}=await n(()=>Promise.resolve().then(()=>qs),void 0),i=await t(e);if(i)return i}catch{}try{return(await this.getCustomMeshes()||[]).find(t=>t.id===e)||null}catch{return null}}async deleteCustomMesh(e){try{await zs(e);try{const t=this._thumbUrlCache.get(e);t&&(URL.revokeObjectURL(t),this._thumbUrlCache.delete(e))}catch{}try{this._thumbDataUrlCache.delete(e)}catch{}}catch(t){throw new Error("IDB_DELETE_FAILED")}return await Gs()}createBlobURL(e){try{let t;if(e instanceof ArrayBuffer)t=e;else if(e instanceof Uint8Array)t=e.buffer;else if("object"==typeof e&&"Buffer"===e.type)t=new Uint8Array(e.data||e).buffer;else{if(!Array.isArray(e))throw new Error("GLB 데이터를 처리할 수 없습니다.");t=new Uint8Array(e).buffer}const n=new Blob([t],{type:"model/gltf-binary"});return URL.createObjectURL(n)}catch(t){throw t}}async loadGLBModel(e){return new Promise((t,n)=>{this.loader.load(e,e=>{t(e.scene)},e=>{},e=>{n(e)})})}dispose(){this.thumbnailRenderer&&(this.thumbnailRenderer.renderer.dispose(),this.thumbnailRenderer.scene.clear(),this.thumbnailRenderer=null)}}let Qo=null;const jo=()=>(Qo||(Qo=new Bo),Qo);function Mo({onEditorControlsReady:e,onPostProcessingReady:t,onContextMenu:s}){const a=r.useRef(null),o=r.useRef(null),l=r.useRef(null),c=r.useRef(null),A=r.useRef(null),[d,h]=r.useState(!1),u=r.useRef(new Map),p=r.useRef(new Set),g=r.useRef({lastT:0,frames:0,fps:0,lastPush:0,vert:0,tri:0,obj:0}),m=r.useRef(!1),f=r.useRef(null),x=r.useRef({animId:null,t:0,target:0,start:0,startTime:0,duration:220,easing:"easeInOutQuad",maxOpacity:.6}),{objects:I,walls:S,setScene:Q,setSelectedObject:j}=Ys(),M=r.useRef(Ys.getState().isPostProcessingEnabled);return r.useEffect(()=>{const e=Ys.subscribe((e,t)=>{e.isPostProcessingEnabled!==t.isPostProcessingEnabled&&(M.current=e.isPostProcessingEnabled)});return()=>{try{null==e||e()}catch{}}},[]),r.useEffect(()=>{var n,i,r,d,p,I,S,D;if(!a.current)return;const T=new Dt,R=new Dt;T.background=new b(2763306);const O=new X(75,window.innerWidth/window.innerHeight,.1,1e3);O.position.set(15,20,15),O.lookAt(0,0,0);const k=(()=>{try{return Ys.getState().rendererAA||"msaa"}catch{return"msaa"}})(),L=new Tt({antialias:"msaa"===k,powerPreference:"high-performance"});try{const e=Ys.getState(),t=(null==(n=e.safeMode)?void 0:n.enabled)?e.safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);L.setPixelRatio(t)}catch{L.setPixelRatio(Math.min(2,window.devicePixelRatio||1))}L.setSize(window.innerWidth,window.innerHeight),L.shadowMap.enabled=!0,L.shadowMap.type=Ot,L.sortObjects=!1,L.autoClear=!1,a.current.appendChild(L.domElement);try{Oi(L)}catch{}const P=e=>{e.preventDefault()},F=()=>{try{L.setSize(window.innerWidth,window.innerHeight),c.current&&(c.current.initializeComposer(),c.current.handleResize(window.innerWidth,window.innerHeight))}catch{}};L.domElement.addEventListener("webglcontextlost",P,!1),L.domElement.addEventListener("webglcontextrestored",F,!1);const N=e=>{s&&s(e)};L.domElement.addEventListener("contextmenu",N),A.current=T,Q(T,O,L);const _=new _a(T,O,L,Ys,e=>{var t,n,i,s;Q(T,e,L);try{null==(n=null==(t=c.current)?void 0:t.setCamera)||n.call(t,e)}catch{}try{null==(s=null==(i=l.current)?void 0:i.setCamera)||s.call(i,e)}catch{}});_.gizmoScene=R,o.current=_;try{window.__editorControls=_}catch{}window.runSmokeTest=()=>function(e,t){var n,i;try{if(!e||!t)return!1;const a=t.getState();try{null==(n=e.applyInitialViewState)||n.call(e)}catch(s){return null==s||s.message,!1}a.isWireframe,t.getState().toggleWireframe();try{null==(i=e.updateWireframe)||i.call(e)}catch{}t.getState().isWireframe;const r=new G,o=new He(1,1,1),l=new q(o,r);try{e.scene.add(l),l.material.wireframe}catch(s){return null==s||s.message,!1}finally{try{e.scene.remove(l),o.dispose(),r.dispose()}catch{}}return!0}catch(s){return null==s||s.message,!1}}(_,Ys);try{null==(i=_.applyInitialViewState)||i.call(_)}catch{}try{if(!!Ys.getState().useBlenderControls){const e=new Ga(_.camera,L.domElement);e.setScene(T);const t=Ys.getState();e.setSpeeds({rotate:.01*t.cameraOrbitSpeed,pan:.02*t.cameraPanSpeed,zoom:t.cameraZoomSpeed}),l.current=e;try{window.__blenderControls=e}catch{}try{const t=Ys.subscribe((t,n)=>{t.cameraPanSpeed===n.cameraPanSpeed&&t.cameraOrbitSpeed===n.cameraOrbitSpeed&&t.cameraZoomSpeed===n.cameraZoomSpeed||e.setSpeeds({rotate:.01*t.cameraOrbitSpeed,pan:.02*t.cameraPanSpeed,zoom:t.cameraZoomSpeed})}),n=null==(r=_.dispose)?void 0:r.bind(_);_.dispose=()=>{try{null==t||t()}catch{}null==n||n()}}catch{}}}catch{}const z=new xr(T,O,L);c.current=z;try{h(!0)}catch{}try{z.setCamera(O)}catch{}try{const e=null==loadEnvironmentSettings?void 0:loadEnvironmentSettings();e&&(e.toneMapping&&(z.updateEffectSettings("toneMapping",{...e.toneMapping}),z.setEffectEnabled("toneMapping",!1!==e.toneMapping.enabled)),(null==(d=e.postProcessing)?void 0:d.preset)&&(null==(p=z.applyPreset)||p.call(z,e.postProcessing.preset)))}catch{}try{_.setPostProcessingManager(z)}catch{}try{Ys.getState().setPostProcessingManager(z)}catch{}try{const e=Ys.getState(),t="fxaa"===e.rendererAA&&!(null==(I=e.safeMode)?void 0:I.enabled);z.setEffectEnabled("fxaa",!!t)}catch{}try{Ys.getState().estimateVRAMUsage()}catch{}e&&e(_),t&&t(z),null==(D=(S=_.objectSelector).setGizmoScene)||D.call(S,R);const H=new Rt(4210752,.6);H.userData.isSystemObject=!0,T.add(H);const K=new w(16777215,.8);K.position.set(50,50,50),K.castShadow=!0,K.shadow.mapSize.width=1024,K.shadow.mapSize.height=1024,K.userData.isSystemObject=!0,T.add(K);const W=new y(16755336,1,100);W.position.set(0,6,6),W.userData.isSystemObject=!0,T.add(W);const V=new He(2,2,2),Y=new G({color:16711680}),J=new q(V,Y);J.position.set(0,1,0),J.castShadow=!0,J.userData.name="Test Cube",J.userData.id="test_cube",T.add(J);const Z=new We(.5,.5,3),$=new G({color:9127187}),ee=new q(Z,$);ee.position.set(5,1.5,0),ee.castShadow=!0,ee.userData.name="Tree Trunk",ee.userData.id="tree_trunk",T.add(ee);const te=new Je(2),ne=new G({color:2263842}),ie=new q(te,ne);ie.position.set(5,4,0),ie.castShadow=!0,ie.userData.name="Tree Leaves",ie.userData.id="tree_leaves",T.add(ie),u.current.set("test_cube",J),u.current.set("tree_trunk",ee),u.current.set("tree_leaves",ie),_.addSelectableObject(J),_.addSelectableObject(ee),_.addSelectableObject(ie);let se=!0;const re=()=>{se=!0};try{window.__requestRender=re}catch{}const oe=()=>{var e,t,n,i,s,a,r,A;const d=(()=>{try{return Ys.getState().renderMode||"continuous"}catch{return"continuous"}})();requestAnimationFrame(oe),J.rotation.y+=.005;const h=(()=>{var e,t;try{return null==(t=null==(e=l.current)?void 0:e.update)?void 0:t.call(e)}catch{return!1}})();if(h&&(se=!0),f.current){const e=f.current,t=x.current;if(t&&t.duration>0&&(t.t<1||e.material.opacity!==t.target)){const n=performance.now(),i=Math.min(1,(n-t.startTime)/t.duration);let s;switch(t.easing){case"linear":s=i;break;case"easeOutCubic":s=1-Math.pow(1-i,3);break;case"easeInCubic":s=Math.pow(i,3);break;default:s=i<.5?2*i*i:(4-2*i)*i-1}const a=t.start+(t.target-t.start)*s;e.material&&(e.material.opacity=Math.max(0,Math.min(1,a))),t.t=i,i>=1&&0===t.target&&e.visible&&(e.visible=!1)}}if("on-demand"===d&&!se&&!h)return;if(o.current&&("on-demand"!==d||se)){try{o.current.updateSelectedOutlines()}catch{}try{((null==(t=(e=o.current).getSelectedObjects)?void 0:t.call(e))||[]).forEach(e=>{var t,n,i,s,a,r,o;if((null==e?void 0:e.isLight)&&(null==(n=null==(t=e.userData)?void 0:t.lightHelper)?void 0:n.update))e.userData.lightHelper.update();else if((null==(i=null==e?void 0:e.userData)?void 0:i.isLightTarget)||(null==(s=null==e?void 0:e.userData)?void 0:s.ownerId)){const t=e.userData.ownerId;let n=null;t&&(null==(a=u.current)?void 0:a.has(t))&&(n=u.current.get(t)),(null==(o=null==(r=null==n?void 0:n.userData)?void 0:r.lightHelper)?void 0:o.update)&&n.userData.lightHelper.update()}})}catch{}}try{const e=performance.now(),t=g.current;t.lastT||(t.lastT=e),t.frames+=1;const n=e-t.lastT;if(n>=500&&(t.fps=Math.round(1e3*t.frames/n),t.frames=0,t.lastT=e),(!t.lastPush||e-t.lastPush>=2e3)&&!m.current){t.lastPush=e,m.current=!0;(e=>{const t="undefined"!=typeof window&&window.requestIdleCallback;t?t(()=>e()):setTimeout(e,0)})(()=>{let e=0,n=0,i=0;try{T.traverse(t=>{var s,a,r;if(!t.visible)return;if((null==(s=t.userData)?void 0:s.isSystemObject)||(null==(a=t.userData)?void 0:a.isSelectionOutline))return;const o=(t.name||"").toLowerCase();if(!(o.includes("transformcontrols")||o.includes("gizmo")||o.includes("helper"))&&(t.isGroup&&(e+=1),t.isMesh&&t.geometry)){e+=1;const s=t.geometry,a=null==(r=s.attributes)?void 0:r.position,o=s.index,l=a?a.count:0,c=o?Math.floor(o.count/3):a?Math.floor(a.count/3):0;n+=l,i+=c}}),t.obj=e,t.vert=n,t.tri=i;try{Ys.getState().setStats({fps:t.fps,objects:e,vertices:n,triangles:i})}catch{}}finally{m.current=!1}})}}catch{}se=!1,L.clear();const p=o.current?o.current.camera:O;if(M.current&&!!c.current){try{c.current.setCamera(p)}catch{}c.current.render()}else L.render(T,p);try{null==(s=null==(i=null==(n=o.current)?void 0:n.objectSelector)?void 0:i.forceHideGizmoLines)||s.call(i)}catch{}L.clearDepth(),L.render(R,p);try{null==(A=null==(r=null==(a=o.current)?void 0:a.objectSelector)?void 0:r.forceHideGizmoLines)||A.call(r)}catch{}};oe();const le=L.domElement,ce=(e,t=220)=>{var n;const i=f.current;if(!i)return;const s=x.current;s.start=(null==(n=i.material)?void 0:n.opacity)??0;const{dropIndicator:a}=Ys.getState();s.target=Math.min(e,(null==a?void 0:a.maxOpacity)??.6),s.t=0,s.duration=t,s.easing=(null==a?void 0:a.easing)??"easeInOutQuad",s.maxOpacity=(null==a?void 0:a.maxOpacity)??.6,s.startTime=performance.now(),e>0&&(i.visible=!0)};le.addEventListener("dragover",e=>{e.preventDefault();try{const t=le.getBoundingClientRect(),n=new E;n.x=(e.clientX-t.left)/t.width*2-1,n.y=-(e.clientY-t.top)/t.height*2+1;const i=new qe,s=o.current?o.current.camera:O;i.setFromCamera(n,s);const a=[];T.traverse(e=>{e.isMesh&&e.visible&&a.push(e)});const r=i.intersectObjects(a,!0);if(r&&r.length>0){const e=r[0],t=e.point,n=e.face&&e.face.normal?e.face.normal.clone():new B(0,1,0);if(e.object&&e.object.isMesh&&e.object.normalMatrix&&n.applyMatrix3(e.object.normalMatrix).normalize(),f.current){const e=f.current;e.position.copy(t);const i=new B(0,1,0),s=(new ae).setFromUnitVectors(i,n.clone().normalize());e.quaternion.copy(s),e.visible=!0}else{const e=new kt(.6,.75,48),i=new C({color:43775,transparent:!0,opacity:0,side:U}),s=new q(e,i);s.position.copy(t);const a=new B(0,1,0),r=(new ae).setFromUnitVectors(a,n.clone().normalize());s.quaternion.copy(r),s.userData.isSystemObject=!0,T.add(s),f.current=s}const i=s.position.distanceTo(t),a=Math.max(.5,Math.min(4,.06*i));f.current.scale.setScalar(a);const o=Ys.getState().dropIndicator;ce((null==o?void 0:o.maxOpacity)??.6,(null==o?void 0:o.inMs)??200)}else{const e=new it(new B(0,1,0),0),t=new B;if(i.ray.intersectPlane(e,t)){if(f.current)f.current.position.copy(t),f.current.rotation.set(-Math.PI/2,0,0),f.current.visible=!0;else{const e=new kt(.6,.75,48),n=new C({color:43775,transparent:!0,opacity:0,side:U}),i=new q(e,n);i.rotation.x=-Math.PI/2,i.position.copy(t),i.userData.isSystemObject=!0,T.add(i),f.current=i}const e=s.position.distanceTo(t),n=Math.max(.5,Math.min(4,.06*e));f.current.scale.setScalar(n);const i=Ys.getState().dropIndicator;ce((null==i?void 0:i.maxOpacity)??.6,(null==i?void 0:i.inMs)??200)}}}catch{}}),le.addEventListener("drop",e=>{var t,n;if(e.preventDefault(),f.current){const e=Ys.getState().dropIndicator;ce(0,(null==e?void 0:e.outMs)??180)}try{const s=e.dataTransfer.getData("text/plain");if(s){const a=JSON.parse(s);if("start_position"===a.type||"directional_light"===a.type||"point_light"===a.type||"spot_light"===a.type||"ambient_light"===a.type||"audio_source"===a.type||"fog"===a.type||"skybox"===a.type||"post_process"===a.type||"camera_helper"===a.type||"grid_helper"===a.type||"axes_helper"===a.type){const i=le.getBoundingClientRect(),s=new E;s.x=(e.clientX-i.left)/i.width*2-1,s.y=-(e.clientY-i.top)/i.height*2+1;const r=new qe;r.setFromCamera(s,O);const o=new it(new B(0,1,0),0),l=new B;let c;switch(r.ray.intersectPlane(o,l),a.type){case"start_position":c=null;break;case"directional_light":const e=new w(16777215,1);e.position.set(l.x+5,l.y+10,l.z+5),e.target.position.copy(l),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048;const t=new Nt(e,1);e.userData=e.userData||{},e.userData.lightHelper=t,T.add(t);try{t.update()}catch{}try{const t=new Je(.18,12,12),n=new C({color:6750156,transparent:!0,opacity:.95}),i=new q(t,n);i.name="DirectionalTargetHandle",i.userData.isSystemObject=!0,i.userData.isLightTargetHandle=!0,i.raycast=q.prototype.raycast,e.target.userData=e.target.userData||{},e.target.userData.isLightTarget=!0,e.target.add(i)}catch{}try{const t=new Je(.25,12,12),n=new C({color:16777062,transparent:!0,opacity:.9}),i=new q(t,n);i.name="DirectionalLightHandle",i.userData.isSystemObject=!0,i.userData.isLightHelper=!0,i.raycast=q.prototype.raycast,e.add(i)}catch{}c=e,T.add(e.target);try{_.addSelectableObject(e.target)}catch{}break;case"point_light":const n=new y(16777215,1,10,2);n.position.set(l.x,l.y+3,l.z),n.castShadow=!0;const i=new Ft(n,.5);n.userData=n.userData||{},n.userData.lightHelper=i,T.add(i);try{i.update()}catch{}try{const e=new Je(.2,12,12),t=new C({color:16777062,transparent:!0,opacity:.95}),i=new q(e,t);i.name="PointLightHandle",i.userData.isSystemObject=!0,i.userData.isLightHelper=!0,i.raycast=q.prototype.raycast,n.add(i)}catch{}c=n;break;case"spot_light":const s=new v(16777215,1,10,Math.PI/6,.1,2);s.position.set(l.x,l.y+5,l.z),s.target.position.copy(l),s.castShadow=!0;const a=new Pt(s);s.userData=s.userData||{},s.userData.lightHelper=a,T.add(a);try{a.update()}catch{}try{const e=new Je(.22,12,12),t=new C({color:16777062,transparent:!0,opacity:.9}),n=new q(e,t);n.name="SpotLightHandle",n.userData.isSystemObject=!0,n.userData.isLightHelper=!0,n.raycast=q.prototype.raycast,s.add(n)}catch{}c=s,T.add(s.target);try{const e=new Je(.18,12,12),t=new C({color:6750156,transparent:!0,opacity:.95}),n=new q(e,t);n.name="SpotTargetHandle",n.userData.isSystemObject=!0,n.userData.isLightTargetHandle=!0,n.raycast=q.prototype.raycast,s.target.userData=s.target.userData||{},s.target.userData.isLightTarget=!0,s.target.add(n)}catch{}try{_.addSelectableObject(s.target)}catch{}break;case"ambient_light":const r=new Rt(4210752,.3),o=new Je(.5,16,16),A=new C({color:4210752,wireframe:!0,transparent:!0,opacity:.5});c=new q(o,A),c.position.copy(l),T.add(r);break;case"audio_source":const d=new Je(.3,16,16),h=new G({color:16750848});c=new q(d,h),c.position.set(l.x,l.y+1,l.z);break;case"grid_helper":c=new nt(10,10),c.position.copy(l);break;case"axes_helper":c=new Lt(2),c.position.copy(l);try{const e=new Je(.2,12,12),t=new C({color:6737151,transparent:!0,opacity:.9}),n=new q(e,t);n.name="AxesHelperHandle",n.userData.isSystemObject=!0,n.userData.isHelperHandle=!0,n.raycast=q.prototype.raycast,c.add(n)}catch{}break;default:const u=new He(.5,.5,.5),p=new G({color:8947848});c=new q(u,p),c.position.copy(l)}if(c){c.isMesh&&(c.castShadow=!0,c.receiveShadow=!0);const e=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;c.name=e,c.userData=Object.assign(c.userData||{},{id:e,name:a.name,type:a.type,originalData:a}),T.add(c),_.addSelectableObject(c),u.current.set(e,c);const i=Ys.getState().addObject,s=["directional_light","point_light","spot_light"].includes(a.type),r="directional_light"===a.type?"directional":"point_light"===a.type?"point":"spot_light"===a.type?"spot":void 0;i({id:e,name:a.name,type:s?"light":a.type,lightType:s?r:void 0,position:{x:c.position.x,y:c.position.y,z:c.position.z},rotation:{x:c.rotation.x,y:c.rotation.y,z:c.rotation.z},scale:{x:c.scale.x,y:c.scale.y,z:c.scale.z},visible:!0,userData:c.userData});try{if(c.isLight&&c.target&&c.target.isObject3D){c.target.userData=c.target.userData||{},c.target.userData.ownerId=e;const i=null==(n=null==(t=c.target.children)?void 0:t.find)?void 0:n.call(t,e=>{var t;return null==(t=e.userData)?void 0:t.isLightTargetHandle});i&&(i.userData.ownerId=e)}}catch{}j(e)}return}if("custom"===a.type||"library"===a.type){let t=function(){c.load(A,e=>{const t=e.scene;t.position.copy(l),t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});const n=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.name=n,t.userData={id:n,name:a.name,type:a.type,originalData:a,..."custom"===a.type?{customMeshId:a.id}:{}};try{t.traverse(e=>{e.userData=e.userData||{},e.userData.ownerId||(e.userData.ownerId=n)})}catch{}T.add(t),_.addSelectableObject(t),u.current.set(n,t);(0,Ys.getState().addObject)({id:n,name:a.name,type:"glb",..."custom"===a.type?{customMeshId:a.id}:{url:a.glbUrl},position:{x:l.x,y:l.y,z:l.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:t.userData}),j(n),"custom"===a.type&&URL.revokeObjectURL(A)},void 0,e=>{"custom"===a.type&&URL.revokeObjectURL(A)})};const n=le.getBoundingClientRect(),s=new E;s.x=(e.clientX-n.left)/n.width*2-1,s.y=-(e.clientY-n.top)/n.height*2+1;const r=new qe;r.setFromCamera(s,O);const o=new it(new B(0,1,0),0),l=new B;r.ray.intersectPlane(o,l);const c=ki();let A,d=null;if("custom"===a.type)try{const e=jo(),n=n=>{d=n,A=e.createBlobURL(d),t()},i=e=>{};return!a.glbData&&a.id?void e.getCustomMeshes().then(e=>{const t=e.find(e=>e.id===a.id);if(!t)throw new Error("NOT_FOUND");n(t.glbData)}).catch(i):void n(a.glbData)}catch(i){return}else if("library"===a.type)return A=a.glbUrl,void t();return}const r=le.getBoundingClientRect(),o=new E;o.x=(e.clientX-r.left)/r.width*2-1,o.y=-(e.clientY-r.top)/r.height*2+1;const l=new qe;l.setFromCamera(o,O);const c=new it(new B(0,1,0),0),A=new B;l.ray.intersectPlane(c,A);const d=new G({color:5025616,roughness:.3,metalness:.1});let h,p;switch(a.geometry){case"BoxGeometry":h=new He(...a.params);break;case"SphereGeometry":h=new Je(...a.params);break;case"CylinderGeometry":h=new We(...a.params);break;case"ConeGeometry":h=new _t(...a.params);break;case"PlaneGeometry":h=new Ze(...a.params);break;case"TorusGeometry":h=new Xe(...a.params);break;case"CustomGeometry":if(a.glbData)try{const e=jo().createBlobURL(a.glbData);return void ki().load(e,t=>{const n=t.scene;n.position.copy(A);const i=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;n.name=i,n.userData={id:i,name:a.name,type:a.type||"custom",originalName:a.name},n.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),T.add(n),_.addSelectableObject(n),u.current.set(i,n);(0,Ys.getState().addObject)({id:i,name:a.name,type:"mesh",position:{x:A.x,y:A.y,z:A.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:n.userData}),j(i),URL.revokeObjectURL(e)},void 0,t=>{URL.revokeObjectURL(e)})}catch(i){return}else h=a.originalObject&&a.originalObject.geometry?a.originalObject.geometry.clone():new He(1,1,1);break;case"LibraryMesh":if(a.glbUrl){return void ki().load(a.glbUrl,e=>{const t=e.scene;t.position.copy(A);const n=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.name=n,t.userData={id:n,name:a.name,type:a.type||"library",originalName:a.name},t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),T.add(t),_.addSelectableObject(t),u.current.set(n,t);(0,Ys.getState().addObject)({id:n,name:a.name,type:"mesh",position:{x:A.x,y:A.y,z:A.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:t.userData}),j(n)},void 0,e=>{})}h=new He(1,1,1);break;default:h=new He(1,1,1)}p=new q(h,d),p.position.copy(A),"PlaneGeometry"===a.geometry&&(p.rotation.x=-Math.PI/2),p.castShadow=!0,p.receiveShadow=!0;const g=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;p.name=g,p.userData={id:g,name:a.name,type:a.type||"basic",originalName:a.name,geometry:a.geometry,params:a.params,ownerId:g},T.add(p),_.addSelectableObject(p),u.current.set(g,p);(0,Ys.getState().addObject)({id:g,name:a.name,type:"basic",geometry:a.geometry,params:a.params,position:{x:A.x,y:A.y,z:A.z},rotation:{x:p.rotation.x,y:p.rotation.y,z:p.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:p.userData}),j(g)}}catch(i){}}),le.addEventListener("dragleave",()=>{if(f.current){const e=Ys.getState().dropIndicator;ce(0,(null==e?void 0:e.outMs)??220)}});const Ae=["mousedown","mouseup","mousemove","wheel","keydown","keyup","resize"],de=()=>{var e;try{"on-demand"===(Ys.getState().renderMode||"continuous")&&(null==(e=window.__requestRender)||e.call(window))}catch{}};Ae.forEach(e=>window.addEventListener(e,de,{passive:!0})),le.addEventListener("dragover",de,{passive:!0}),le.addEventListener("drop",de,{passive:!0});const he=()=>{var e;try{const t=Ys.getState(),n=(null==(e=t.safeMode)?void 0:e.enabled)?t.safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);L.setPixelRatio(n)}catch{}o.current?o.current.onWindowResize():(O.aspect=window.innerWidth/window.innerHeight,O.updateProjectionMatrix(),L.setPixelRatio(Math.min(2,window.devicePixelRatio||1)),L.setSize(window.innerWidth,window.innerHeight)),c.current&&c.current.handleResize(window.innerWidth,window.innerHeight);try{Ys.getState().estimateVRAMUsage()}catch{}};return window.addEventListener("resize",he),()=>{try{Ae.forEach(e=>window.removeEventListener(e,de))}catch{}try{le.removeEventListener("dragover",de),le.removeEventListener("drop",de)}catch{}if(window.removeEventListener("resize",he),L.domElement&&(L.domElement.removeEventListener("contextmenu",N),L.domElement.removeEventListener("webglcontextlost",P),L.domElement.removeEventListener("webglcontextrestored",F)),o.current&&o.current.dispose(),l.current)try{l.current.dispose()}catch{}c.current&&c.current.dispose(),a.current&&L.domElement&&a.current.removeChild(L.domElement),L.dispose()}},[Q]),r.useEffect(()=>{var e;if(!d)return;if(!A.current||!o.current)return;const t=A.current,i=ki();I.forEach(e=>{var s,a,r,l,c,A,d,h,g,m,b,f,x,I,E,S;if(!u.current.has(e.id))if("glb"===e.type&&(e.file||e.url)){if(p.current.has(e.id)||u.current.has(e.id))return;p.current.add(e.id);const n=e.file||e.url;i.load(n,n=>{var i,s,a,r,l,c,A,d,h,g,m,b;if(u.current.has(e.id)){try{p.current.delete(e.id)}catch{}return}const f=n.scene,v=(new fe).setFromObject(f);v.getSize(new B),v.getCenter(new B),f.position.set(e.position.x,e.position.y,e.position.z),f.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),f.scale.set(e.scale.x,e.scale.y,e.scale.z),f.name=e.name,f.userData={...f.userData||{},id:e.id,type:e.type,customMeshId:e.customMeshId||(null==(i=e.userData)?void 0:i.customMeshId)||(null==(a=null==(s=e.userData)?void 0:s.originalData)?void 0:a.id),originalData:(null==(r=e.userData)?void 0:r.originalData)||(e.customMeshId?{id:e.customMeshId}:void 0)};try{f.traverse(t=>{t.userData||(t.userData={}),t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}f.visible=!1!==e.visible,f.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});try{const e=!!Ys.getState().isWireframe;f.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material.forEach(t=>t.wireframe=e):t.material.wireframe=e)})}catch{}t.add(f),o.current.addSelectableObject(f),u.current.set(e.id,f);try{p.current.delete(e.id)}catch{}j(e.id);try{null==(c=(l=o.current).updateWireframe)||c.call(l)}catch{}try{null==(d=(A=o.current).updateGridSnap)||d.call(A)}catch{}try{null==(g=(h=o.current).updateGizmoSpace)||g.call(h)}catch{}try{null==(b=null==(m=o.current.objectSelector)?void 0:m.updateGizmoSize)||b.call(m)}catch{}o.current.selectObject(f)},void 0,n=>{const i=new He(1,1,1),s=new Gt({color:16739179,transparent:!0,opacity:.7}),a=new q(i,s);a.position.set(e.position.x,e.position.y,e.position.z),a.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),a.scale.set(e.scale.x,e.scale.y,e.scale.z),a.name=`${e.name} (로딩실패)`,a.userData={id:e.id,type:e.type,loadError:!0},a.castShadow=!0,a.receiveShadow=!0,a.visible=!1!==e.visible,t.add(a),o.current.addSelectableObject(a),u.current.set(e.id,a);try{p.current.delete(e.id)}catch{}j(e.id),o.current.selectObject(a)})}else if("glb"===e.type&&(e.customMeshId||(null==(s=e.userData)?void 0:s.customMeshId)||(null==(r=null==(a=e.userData)?void 0:a.originalData)?void 0:r.id)||e.glbData)){const s=jo();if(p.current.has(e.id)||u.current.has(e.id))return;p.current.add(e.id);const a=e.customMeshId||(null==(l=e.userData)?void 0:l.customMeshId)||(null==(A=null==(c=e.userData)?void 0:c.originalData)?void 0:A.id),r=(null==(h=null==(d=e.userData)?void 0:d.originalData)?void 0:h.glbUrl)||(null==(g=e.userData)?void 0:g.glbUrl)||e.glbUrl||null,m=e=>!!e&&(e instanceof ArrayBuffer||(e instanceof Uint8Array||(!!Array.isArray(e)||!("object"!=typeof e||"Buffer"!==e.type||!Array.isArray(e.data))))),b=n=>{i.load(n,i=>{var s,a,r,l;if(u.current.has(e.id)){try{URL.revokeObjectURL(n)}catch{}try{p.current.delete(e.id)}catch{}return}const c=i.scene,A=(new fe).setFromObject(c);A.getSize(new B),A.getCenter(new B),c.position.set(e.position.x,e.position.y,e.position.z),c.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),c.scale.set(e.scale.x,e.scale.y,e.scale.z),c.name=e.name,c.userData={...c.userData||{},id:e.id,type:e.type,customMeshId:e.customMeshId||(null==(s=e.userData)?void 0:s.customMeshId)||(null==(r=null==(a=e.userData)?void 0:a.originalData)?void 0:r.id),originalData:(null==(l=e.userData)?void 0:l.originalData)||(e.customMeshId?{id:e.customMeshId}:void 0)};try{c.traverse(t=>{t.userData||(t.userData={}),t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}c.visible=!1!==e.visible,c.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),t.add(c),o.current.addSelectableObject(c),u.current.set(e.id,c),j(e.id),o.current.selectObject(c);try{URL.revokeObjectURL(n)}catch{}try{p.current.delete(e.id)}catch{}},void 0,()=>{try{URL.revokeObjectURL(n)}catch{}try{p.current.delete(e.id)}catch{}})};if(!e.glbData&&r)try{b(r)}catch(Q){try{p.current.delete(e.id)}catch{}}else if(a)(async()=>{try{const{idbGetCustomMesh:e}=await n(()=>Promise.resolve().then(()=>qs),void 0),t=await e(a);if(!t)throw new Error("CUSTOM_MESH_NOT_FOUND");let i=t.glbData;if(i&&"object"==typeof i&&"size"in i){const e=URL.createObjectURL(i);b(e)}else{if(!i)throw new Error("CUSTOM_MESH_NOT_FOUND");{const e=s.createBlobURL(i);b(e)}}}catch(Q){try{const e=(await s.getCustomMeshes()||[]).find(e=>e.id===a);if(!(null==e?void 0:e.glbData))throw new Error("CUSTOM_MESH_NOT_FOUND");{const t=s.createBlobURL(e.glbData);b(t)}}catch(i){try{const n=new He(1,1,1),i=new Gt({color:16739179,transparent:!0,opacity:.7}),s=new q(n,i);s.position.set(e.position.x,e.position.y,e.position.z),s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),s.scale.set(e.scale.x,e.scale.y,e.scale.z),s.name=`${e.name||a} (누락)`,s.userData={id:e.id,type:e.type,customMeshId:a,loadError:!0,missingCustomMesh:!0},s.castShadow=!0,s.receiveShadow=!0,s.visible=!1!==e.visible,t.add(s),o.current.addSelectableObject(s),u.current.set(e.id,s),j(e.id),o.current.selectObject(s);try{window.dispatchEvent(new CustomEvent("mapLoadWarning",{detail:{type:"customMeshMissing",id:a,objectId:e.id,objectName:e.name||""}}))}catch{}}catch{}try{p.current.delete(e.id)}catch{}}}})();else if(e.glbData&&m(e.glbData))try{const t=s.createBlobURL(e.glbData);b(t)}catch(Q){try{p.current.delete(e.id)}catch{}}else try{p.current.delete(e.id)}catch{}}else if("light"===e.type||["directional_light","point_light","spot_light","ambient_light","grid_helper","axes_helper","audio_source"].includes(e.type)){let n=null;switch("light"===e.type?e.lightType:"directional_light"===e.type?"directional":"point_light"===e.type?"point":"spot_light"===e.type?"spot":e.type){case"directional":{const i=new w(16777215,e.intensity??1);i.position.set(e.position.x,e.position.y,e.position.z);const s=((null==(m=e.position)?void 0:m.y)??0)-1;i.target.position.set(e.position.x,s,e.position.z),i.castShadow=!!e.castShadow,t.add(i.target);try{i.target.userData={...i.target.userData||{},isLightTarget:!0,ownerId:e.id}}catch{}n=i;try{o.current.addSelectableObject(i.target)}catch{}try{const e=new Nt(i,1);i.userData=i.userData||{},i.userData.lightHelper=e,t.add(e),null==(b=e.update)||b.call(e)}catch{}break}case"point":{const i=new y(16777215,e.intensity??1,e.distance??10,e.decay??2);i.position.set(e.position.x,e.position.y,e.position.z),i.castShadow=!!e.castShadow,n=i;try{const e=new Ft(i,.5);i.userData=i.userData||{},i.userData.lightHelper=e,t.add(e),null==(f=e.update)||f.call(e)}catch{}break}case"spot":{const i=new v(16777215,e.intensity??1,e.distance??10,e.angle??Math.PI/6,e.penumbra??.1,e.decay??2);i.position.set(e.position.x,e.position.y,e.position.z);const s=((null==(x=e.position)?void 0:x.y)??0)-1;i.target.position.set(e.position.x,s,e.position.z),i.castShadow=!!e.castShadow,t.add(i.target);try{i.target.userData={...i.target.userData||{},isLightTarget:!0,ownerId:e.id}}catch{}n=i;try{o.current.addSelectableObject(i.target)}catch{}try{const e=new Pt(i);i.userData=i.userData||{},i.userData.lightHelper=e,t.add(e),null==(I=e.update)||I.call(e)}catch{}break}case"ambient_light":{const i=new Rt(e.color??4210752,e.intensity??.3);t.add(i);const s=new q(new Je(.5,16,16),new C({color:4210752,wireframe:!0,transparent:!0,opacity:.5}));s.position.set(e.position.x,e.position.y,e.position.z),n=s;break}case"grid_helper":{const t=new nt(10,10);t.position.set(e.position.x,e.position.y,e.position.z),n=t;break}case"axes_helper":{const t=new Lt(2);t.position.set(e.position.x,e.position.y,e.position.z),n=t;break}case"audio_source":{const t=new q(new Je(.3,16,16),new G({color:16750848}));t.position.set(e.position.x,e.position.y,e.position.z),n=t;break}}if(n){n.name=e.name,n.userData={...n.userData||{},id:e.id,type:e.type};try{null==(E=n.traverse)||E.call(n,t=>{t.userData=t.userData||{},t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}n.visible=!1!==e.visible,t.add(n);try{o.current.addSelectableObject(n)}catch{}u.current.set(e.id,n),j(e.id);try{o.current.selectObject(n)}catch{}}}else if("cube"===e.type){const n=new He(e.size.x,e.size.y,e.size.z),i=new Gt({color:e.material.color}),s=new q(n,i);s.position.set(e.position.x,e.position.y,e.position.z),s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),s.name=e.name,s.userData={id:e.id,type:e.type};try{null==(S=s.traverse)||S.call(s,t=>{t.userData=t.userData||{},t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}s.castShadow=!0,s.receiveShadow=!0,t.add(s),o.current.addSelectableObject(s),u.current.set(e.id,s),j(e.id),o.current.selectObject(s)}else if("basic"===e.type||e.geometry&&e.params){const n=new G({color:5025616,roughness:.3,metalness:.1});let i;switch(e.geometry){case"BoxGeometry":i=new He(...e.params);break;case"SphereGeometry":i=new Je(...e.params);break;case"CylinderGeometry":i=new We(...e.params);break;case"ConeGeometry":i=new _t(...e.params);break;case"PlaneGeometry":i=new Ze(...e.params);break;case"TorusGeometry":i=new Xe(...e.params);break;default:i=new He(1,1,1)}const s=new q(i,n);s.position.set(e.position.x,e.position.y,e.position.z),s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),s.scale.set(e.scale.x,e.scale.y,e.scale.z),s.name=e.name,s.userData={id:e.id,type:e.type};try{s.traverse(t=>{t.userData=t.userData||{},t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}s.castShadow=!0,s.receiveShadow=!0,s.visible=!1!==e.visible,"PlaneGeometry"===e.geometry&&(s.rotation.x=-Math.PI/2),t.add(s),o.current.addSelectableObject(s),u.current.set(e.id,s),j(e.id),o.current.selectObject(s)}});const s=new Set(I.map(e=>e.id));for(const[n,a]of u.current)if(!s.has(n)){if(null==(e=a.userData)?void 0:e.isSystemObject)continue;t.remove(a),o.current.removeSelectableObject(a),u.current.delete(n)}try{const e=[],n=e=>{var n,i;let a=e;for(;a&&a!==t;){const e=null==(n=a.userData)?void 0:n.id,t=null==(i=a.userData)?void 0:i.ownerId;if(e&&s.has(e)||t&&s.has(t))return!0;a=a.parent}return!1};t.traverse(i=>{var s,a;if(!i||i===t)return;if(null==(s=i.userData)?void 0:s.isSystemObject)return;if(null==(a=i.userData)?void 0:a.isSelectionOutline)return;const r=(i.name||"").toLowerCase();r.includes("transformcontrols")||r.includes("gizmo")||r.includes("helper")||n(i)||e.push(i)}),e.forEach(e=>{var n,i;try{null==(i=null==(n=o.current)?void 0:n.removeSelectableObject)||i.call(n,e)}catch{}try{e.parent?e.parent.remove(e):t.remove(e)}catch{}})}catch{}},[I,j,d]),r.useEffect(()=>{A.current&&(I.forEach(e=>{const t=u.current.get(e.id);t&&(t.visible=!1!==e.visible)}),S.forEach(e=>{const t=u.current.get(e.id);t&&(t.visible=!1!==e.visible)}))},[I,S]),i.jsx("div",{ref:a,style:{width:"100%",height:"100vh",position:"relative"}})}function Do(e,t,n=!0){if(!e||!e.isObject3D)return!1;if(t&&!t.isObject3D)return!1;if(e===t)return!1;if(t&&function(e,t){if(!(e&&t&&e.isObject3D&&t.isObject3D))return!1;let n=t.parent;for(;n;){if(n===e)return!0;n=n.parent}return!1}(e,t))return!1;let i=null;if(n&&(e.updateMatrixWorld(!0),i=e.matrixWorld.clone()),e.parent)try{e.parent.remove(e)}catch{}if(t)try{t.add(e)}catch{}if(n&&i){const t=e.parent&&e.parent.matrixWorld?e.parent.matrixWorld:new S,n=(new S).copy(t).invert(),s=(new S).copy(n).multiply(i),a=new B,r=new ae,o=new B;s.decompose(a,r,o),e.position.copy(a),e.quaternion.copy(r),e.scale.copy(o),e.updateMatrix(),e.updateMatrixWorld(!0)}return!0}class To{constructor(e){this.editorControls=e,this.selectedObject=null,this.threeObject=null,this.changeCallbacks=[]}onPropertyChange(e){this.changeCallbacks.push(e)}notifyPropertyChange(e,t,n){this.changeCallbacks.forEach(i=>{i({type:e,property:t,value:n,object:this.selectedObject})})}setSelectedObject(e){if(this.selectedObject=e,this.threeObject=null,e)if(e.isObject3D||e.isMesh||e.isLight||e.isCamera)this.threeObject=e;else if(this.editorControls){const t=e.id||e;this.threeObject=this.editorControls.findObjectById(t),!this.threeObject&&this.editorControls.selectedObjects&&this.editorControls.selectedObjects.length>0&&(this.threeObject=this.editorControls.selectedObjects[0])}}getObjectType(){return this.threeObject?this.threeObject.isLight?"light":this.threeObject.isCamera?"camera":this.threeObject.isHelper?"helper":this.threeObject.isMesh?"mesh":this.threeObject.isGroup?"group":"mesh":"unknown"}setTransformProperty(e,t,n){if(!this.threeObject)return!1;const i=parseFloat(n);if(isNaN(i))return!1;switch(e){case"position":this.threeObject.position[t]=i;break;case"rotation":this.threeObject.rotation[t]=i*Math.PI/180;break;case"scale":this.threeObject.scale[t]=i}return this.notifyPropertyChange("transform",e,{[t]:i}),!0}getTransformProperty(e,t){return this.threeObject?"rotation"===e?(180*this.threeObject[e][t]/Math.PI).toFixed(1):this.threeObject[e][t].toFixed(2):0}setLightProperty(e,t){if(!this.threeObject||!this.threeObject.isLight)return!1;switch(e){case"color":this.threeObject.color.setHex(t.replace("#","0x"));break;case"intensity":this.threeObject.intensity=parseFloat(t);break;case"distance":void 0!==this.threeObject.distance&&(this.threeObject.distance=parseFloat(t));break;case"angle":void 0!==this.threeObject.angle&&(this.threeObject.angle=parseFloat(t));break;case"penumbra":void 0!==this.threeObject.penumbra&&(this.threeObject.penumbra=parseFloat(t));break;case"decay":void 0!==this.threeObject.decay&&(this.threeObject.decay=parseFloat(t))}return this.notifyPropertyChange("light",e,t),!0}getLightProperty(e){if(!this.threeObject||!this.threeObject.isLight)return null;switch(e){case"type":return this.threeObject.type;case"color":return"#"+this.threeObject.color.getHexString();case"intensity":return this.threeObject.intensity;case"distance":return this.threeObject.distance||0;case"angle":return this.threeObject.angle||0;case"penumbra":return this.threeObject.penumbra||0;case"decay":return this.threeObject.decay||1;default:return null}}setCameraProperty(e,t){if(!this.threeObject||!this.threeObject.isCamera)return!1;switch(e){case"fov":this.threeObject.isPerspectiveCamera&&(this.threeObject.fov=parseFloat(t),this.threeObject.updateProjectionMatrix());break;case"near":this.threeObject.near=parseFloat(t),this.threeObject.updateProjectionMatrix();break;case"far":this.threeObject.far=parseFloat(t),this.threeObject.updateProjectionMatrix()}return this.notifyPropertyChange("camera",e,t),!0}getCameraProperty(e){if(!this.threeObject||!this.threeObject.isCamera)return null;switch(e){case"type":return this.threeObject.type;case"fov":return this.threeObject.fov||75;case"near":return this.threeObject.near||.1;case"far":return this.threeObject.far||1e3;default:return null}}setMaterialProperty(e,t){if(!this.threeObject||!this.threeObject.isMesh)return!1;const n=this.threeObject.material;if(!n)return!1;switch(e){case"color":n.color&&n.color.setHex(t.replace("#","0x"));break;case"metalness":void 0!==n.metalness&&(n.metalness=parseFloat(t));break;case"roughness":void 0!==n.roughness&&(n.roughness=parseFloat(t));break;case"emissive":n.emissive&&n.emissive.setHex(t.replace("#","0x"));break;case"emissiveIntensity":void 0!==n.emissiveIntensity&&(n.emissiveIntensity=parseFloat(t));break;case"opacity":n.opacity=parseFloat(t),n.transparent=n.opacity<1}return n.needsUpdate=!0,this.notifyPropertyChange("material",e,t),!0}getMaterialProperty(e){if(!this.threeObject||!this.threeObject.isMesh)return null;const t=this.threeObject.material;if(!t)return null;switch(e){case"color":return t.color?"#"+t.color.getHexString():"#ffffff";case"metalness":return t.metalness||0;case"roughness":return t.roughness||.8;case"emissive":return t.emissive?"#"+t.emissive.getHexString():"#000000";case"emissiveIntensity":return t.emissiveIntensity||0;case"opacity":return t.opacity||1;default:return null}}getObjectInfo(){var e;if(!this.threeObject)return null;return{name:this.threeObject.name||"Unnamed Object",type:this.getObjectType(),id:(null==(e=this.threeObject.userData)?void 0:e.id)||this.threeObject.id,position:{x:this.getTransformProperty("position","x"),y:this.getTransformProperty("position","y"),z:this.getTransformProperty("position","z")},rotation:{x:this.getTransformProperty("rotation","x"),y:this.getTransformProperty("rotation","y"),z:this.getTransformProperty("rotation","z")},scale:{x:this.getTransformProperty("scale","x"),y:this.getTransformProperty("scale","y"),z:this.getTransformProperty("scale","z")}}}dispose(){this.selectedObject=null,this.threeObject=null,this.editorControls=null,this.changeCallbacks=[]}}function Ro({objects:e,selectedIds:t=[],selectedObjectId:n,dragUseSelectionForDnD:s=!1,onSelect:a,onReparent:o,onReorder:l,onBatchStart:c,onBatchEnd:A,onToggleVisibility:d,onToggleFreeze:h}){const u=r.useRef({draggingId:null}),[p,g]=r.useState(null),[m,b]=r.useState(null),[f,v]=r.useState(()=>new Set),y=r.useMemo(()=>new Map((e||[]).map(e=>[e.id,e])),[e]),w=r.useMemo(()=>{const t=new Map;(e||[]).forEach(e=>{const n=e.parentId??null;t.has(n)||t.set(n,[]),t.get(n).push(e)});for(const e of t.values())e.sort((e,t)=>(e.order??0)-(t.order??0));return t},[e]),C=w.get(null)||[],x=r.useMemo(()=>{try{const e=Array.isArray(t)?t.slice():[];return null!=n&&e.push(n),new Set(e.map(e=>String(e)))}catch{return new Set}},[t,n]),I=r.useCallback((e,t)=>{if(null==e||null==t)return!1;let n=y.get(t);const i=new Set;for(;n&&!i.has(n.id);){if(i.add(n.id),n.id===e)return!0;const t=n.parentId??null;n=null!=t?y.get(t):null}return!1},[y]),E=(e,t)=>{u.current.draggingId=t;const n=x,i=String(t);let a=(s||n.has(i))&&n.size>0?Array.from(n):[i];const r=new Set(a);a=a.filter(e=>!(e=>{let t=y.get(e);const n=new Set;for(;t&&!n.has(t.id);){n.add(t.id);const e=t.parentId??null;if(null==e)return!1;if(r.has(e))return!0;t=y.get(e)}return!1})(e));try{const t=JSON.stringify({ids:a});e.dataTransfer.setData("application/json",t),e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move"}catch{}},S=(t,n)=>{t.preventDefault();let i=null;try{const e=t.dataTransfer.getData("application/json")||t.dataTransfer.getData("text/plain")||"";e&&(i=JSON.parse(e))}catch{}const s=Array.isArray(null==i?void 0:i.ids)&&i.ids.length?i.ids:u.current.draggingId?[u.current.draggingId]:[];if(g(null),b(null),!s.length)return;const r=y.get(n);if(!r)return;const d=m||"inside";if("inside"===d)s.length>1&&(null==c||c()),s.forEach(e=>{e!==n&&(I(e,n)||null==o||o(e,n))}),s.length>1&&(null==A||A());else{const t=r.parentId??null;s.length>1&&(null==c||c());const i=s.filter(e=>{if(e===n)return!1;return null==t||!I(e,t)});i.forEach(e=>null==o?void 0:o(e,t)),i.length&&((t,n,i,s)=>{const a=(e||[]).filter(e=>(e.parentId??null)===(t??null)),r=new Set(n),o=a.map(e=>e.id).filter(e=>!r.has(e)),c=o.indexOf(i),A="above"===s?Math.max(0,c):Math.min(o.length,c+1),d=[...o.slice(0,A),...n,...o.slice(A)];null==l||l(t??null,d)})(t,i,n,d),s.length>1&&(null==A||A())}const h=s[0];null!=h&&(null==a||a(h))},B=(e,t=0)=>{const n=x.has(String(e.id)),s=w.get(e.id)||[],r=f.has(e.id),l=p===e.id,c=l?m||"inside":null,A=12*Math.max(0,t),u=!1!==e.visible,y=!0===e.frozen,C="camera"===e.type?"📷":"light"===e.type?"💡":"🔶";return i.jsxs("div",{className:"tree-node "+(n?"selected":""),draggable:!0,onDragStart:t=>E(t,e.id),onDragOver:t=>((e,t)=>{e.preventDefault(),g(t??null);try{const t=e.currentTarget.getBoundingClientRect(),n=e.clientY-t.top,i=t.height||1;b(n<.25*i?"above":n>.75*i?"below":"inside")}catch{b("inside")}e.dataTransfer.dropEffect="move"})(t,e.id),onDragLeave:t=>{return n=e.id,g(e=>e===n?null:e),void b(e=>p===n?null:e);var n},onDrop:t=>S(t,e.id),onClick:()=>null==a?void 0:a(e.id),style:{margin:"2px 0",borderRadius:3,background:n?"#ff8c00":l&&"inside"===c?"#2d2d2d":"transparent",outline:n?"2px solid #ff6600":"none",borderLeft:n?"3px solid #ff6600":"3px solid transparent",borderTop:l&&"above"===c?"2px solid #00b894":void 0,borderBottom:l&&"below"===c?"2px solid #00b894":void 0,boxShadow:n?"0 0 8px rgba(255,140,0,0.6)":"none",paddingLeft:8+A,transition:"all .15s ease"},children:[i.jsxs("div",{className:"tree-row",style:{display:"flex",alignItems:"center",gap:6,padding:"4px 6px"},children:[i.jsx("button",{title:r?"펼치기":"접기",onClick:t=>{var n;t.stopPropagation(),n=e.id,v(e=>{const t=new Set(e);return t.has(n)?t.delete(n):t.add(n),t})},style:{width:16,height:20,background:"none",border:"none",color:"#aaa",cursor:"pointer"},children:s.length>0?r?"▸":"▾":"·"}),i.jsx("span",{className:"tree-type",style:{opacity:.8},children:C}),i.jsx("span",{className:"tree-name",style:{color:n?"#fff":"#ccc",fontWeight:n?"bold":"normal",userSelect:"none",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),i.jsxs("div",{className:"tree-actions",style:{display:"flex",alignItems:"center",gap:4},children:[null!=e.parentId&&i.jsx("button",{className:"icon-btn unparent",title:"부모 해제 (루트로 이동)",onClick:t=>{t.stopPropagation(),null==o||o(e.id,null)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:"#ddd"},children:"⏏"}),i.jsx("button",{className:"icon-btn eye "+(u?"on":"off"),title:u?"숨기기":"보이기",onClick:t=>{t.stopPropagation(),null==d||d(e)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:u?"#ddd":"#666"},children:u?"👁":"🙈"}),i.jsx("button",{className:"icon-btn lock "+(y?"on":"off"),title:y?"잠금 해제":"잠금",onClick:t=>{t.stopPropagation(),null==h||h(e)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:y?"#ddd":"#666"},children:y?"🔒":"🔓"})]})]}),s.length>0&&!r&&i.jsx("div",{className:"tree-children",children:s.map(e=>B(e,t+1))})]},e.id)};return i.jsxs("div",{className:"scene-hierarchy-panel",children:[i.jsx("div",{className:"panel-header",children:i.jsx("h3",{children:"계층"})}),i.jsx("div",{className:"panel-content",children:(C||[]).map(e=>B(e,0))})]})}const Oo=r.memo(function({objects:e,walls:t,selectedIds:n,setSelectedIds:s,setParent:a,reorderSiblings:o,selectedObject:l,onObjectVisibilityToggle:c,onObjectFreezeToggle:A,onObjectSelect:d,onObjectRemove:h,onObjectFocus:u,onObjectRename:p,onContextMenu:g,editorControls:m,postProcessingManager:b,onObjectUpdate:f,onClose:v}){var y,w,C,x,I;const E=()=>{const e=Ys(e=>e.stats);return i.jsx("div",{style:{marginTop:10,padding:"10px 12px",background:"rgba(255,255,255,0.04)",borderRadius:6,fontSize:13,lineHeight:1.6},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"6px 12px"},children:[i.jsx("div",{children:"FPS"}),i.jsx("div",{children:(null==e?void 0:e.fps)??0}),i.jsx("div",{children:"오브젝트"}),i.jsx("div",{children:(null==e?void 0:e.objects)??0}),i.jsx("div",{children:"버텍스"}),i.jsx("div",{children:(null==e?void 0:e.vertices)??0}),i.jsx("div",{children:"폴리곤(트라이)"}),i.jsx("div",{children:(null==e?void 0:e.triangles)??0})]})})},S=Ys(e=>e.viewReady),B=Ys(e=>e.uiReady),Q=Ys(e=>e.envReady),[j,M]=r.useState({transform:!1,object:!1,material:!1,light:!1,camera:!1,part:!1}),[D,T]=r.useState(null),[R,O]=r.useState(0),k=r.useRef(null),L=r.useRef(0),P=r.useRef(0),F=r.useRef(!1);r.useEffect(()=>{const e=new To(m);return e.onPropertyChange(e=>{try{f&&f(e)}catch{}const t=Date.now();t-(L.current||0)>=50&&(L.current=t,O(e=>e+1))}),T(e),()=>{e.dispose()}},[m,f]),r.useEffect(()=>{var e;if(!D)return;const t=l||((null==(e=null==m?void 0:m.selectedObjects)?void 0:e[0])??null);D.setSelectedObject(t),O(e=>e+1)},[D,l,m]),r.useEffect(()=>{var e,t,n,i,s;if(!l||!D||!m)return;const a=1e-4,r=()=>{const e=D.threeObject;return e?{p:[e.position.x,e.position.y,e.position.z],r:[e.rotation.x,e.rotation.y,e.rotation.z],s:[e.scale.x,e.scale.y,e.scale.z]}:null},o=()=>{try{P.current&&cancelAnimationFrame(P.current)}catch{}k.current=r(),O(e=>e+1);const e=()=>{if(!F.current)return void(P.current=0);const t=r(),n=Date.now();t&&((e,t)=>{if(!e||!t)return!0;for(let n=0;n<3;n++){if(Math.abs(e.p[n]-t.p[n])>a)return!0;if(Math.abs(e.r[n]-t.r[n])>a)return!0;if(Math.abs(e.s[n]-t.s[n])>a)return!0}return!1})(t,k.current)&&n-(L.current||0)>=80&&(k.current=t,L.current=n,O(e=>e+1)),P.current=requestAnimationFrame(e)};P.current=requestAnimationFrame(e)},c=null==(e=null==m?void 0:m.objectSelector)?void 0:e.transformControls,A=null==m?void 0:m._partTransformControls,d=e=>{F.current=!!(null==e?void 0:e.value),F.current?o():(P.current&&cancelAnimationFrame(P.current),P.current=0,O(e=>e+1))},h=()=>{F.current||(()=>{const e=Date.now();e-(L.current||0)>=100&&(L.current=e,O(e=>e+1))})()};return null==(t=null==c?void 0:c.addEventListener)||t.call(c,"dragging-changed",d),null==(n=null==c?void 0:c.addEventListener)||n.call(c,"objectChange",h),null==(i=null==A?void 0:A.addEventListener)||i.call(A,"dragging-changed",d),null==(s=null==A?void 0:A.addEventListener)||s.call(A,"objectChange",h),()=>{var e,t,n,i;try{null==(e=null==c?void 0:c.removeEventListener)||e.call(c,"dragging-changed",d)}catch{}try{null==(t=null==c?void 0:c.removeEventListener)||t.call(c,"objectChange",h)}catch{}try{null==(n=null==A?void 0:A.removeEventListener)||n.call(A,"dragging-changed",d)}catch{}try{null==(i=null==A?void 0:A.removeEventListener)||i.call(A,"objectChange",h)}catch{}P.current&&cancelAnimationFrame(P.current),P.current=0,F.current=!1}},[l,D,m]);const N=(null==D?void 0:D.getObjectType())||"unknown",_=null==D?void 0:D.getObjectInfo(),G=r.useRef(null);r.useEffect(()=>{var e,t;if(!D)return;const n=!(!(null==m?void 0:m._gizmoPointerDown)&&!(null==(t=null==(e=null==m?void 0:m.objectSelector)?void 0:e.transformControls)?void 0:t.dragging));if(D.getObjectInfo())G.current=D.threeObject||G.current;else if(n&&G.current){try{D.setSelectedObject(G.current)}catch{}O(e=>e+1)}},[D,m]);const U=(null==(y=null==m?void 0:m.getSelectedPartInfo)?void 0:y.call(m))||null,z=e=>M(t=>({...t,[e]:!t[e]}));return i.jsxs("div",{className:"inspector-panel",children:[i.jsxs("div",{className:"inspector-header",children:[i.jsx("h3",{children:"인스펙터"}),i.jsx("button",{className:"close-btn",onClick:v,children:"×"})]}),i.jsxs("div",{className:"inspector-content",children:[i.jsxs("div",{className:"hierarchy-section",children:[i.jsx("div",{className:"section-header",children:i.jsx("h4",{children:"씬 계층구조"})}),i.jsx("div",{className:"hierarchy-container",children:i.jsx(Ro,{objects:e,selectedIds:n||[],selectedObjectId:(null==l?void 0:l.id)??l,dragUseSelectionForDnD:(()=>{try{return Ys.getState().dragUseSelectionForDnD}catch{return!1}})(),onBatchStart:()=>{var e,t;try{null==(t=(e=Ys.getState()).beginBatch)||t.call(e)}catch{}},onBatchEnd:()=>{var e,t;try{null==(t=(e=Ys.getState()).endBatch)||t.call(e)}catch{}},onSelect:t=>{var n,i;null==s||s([t]);const a=null==(n=null==m?void 0:m.findObjectById)?void 0:n.call(m,t);a&&(null==(i=null==m?void 0:m.selectObject)||i.call(m,a));try{const n=(e||[]).find(e=>e.id===t)||{id:t};null==d||d(n)}catch{}},onReparent:(e,t)=>{var n,i;null==a||a(e,t);try{const s=null==(n=null==m?void 0:m.findObjectById)?void 0:n.call(m,e);if(s)if(null==t)!function(e,t,n=!0){!(!e||!e.isObject3D)&&Do(e,t&&t.isScene?t:null,n)}(s,null==m?void 0:m.scene,!0);else{const e=null==(i=null==m?void 0:m.findObjectById)?void 0:i.call(m,t);e&&s!==e&&Do(s,e,!0)}}catch{}try{clearTimeout(window.__reparentOutlineT)}catch{}try{window.__reparentOutlineT=setTimeout(()=>{var e,t;null==(t=null==(e=null==m?void 0:m.objectSelector)?void 0:e.updateAllSelectionOutlines)||t.call(e),window.__reparentOutlineT=null},0)}catch{}},onReorder:(e,t)=>{null==o||o(e,t)},onToggleVisibility:e=>null==c?void 0:c(e),onToggleFreeze:e=>null==A?void 0:A(e)})})]}),i.jsxs("div",{className:"properties-section-wrapper",children:[i.jsxs("div",{className:"section-header",children:[i.jsx("h4",{children:"속성"}),i.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginLeft:"auto"},children:[i.jsxs("span",{title:"뷰 설정",style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:S?"rgba(40,167,69,0.15)":"rgba(255,193,7,0.12)",color:S?"#7CDA9B":"#FFD666",border:"1px solid "+(S?"rgba(40,167,69,0.45)":"rgba(255,193,7,0.35)")},children:["View ",S?"✓":"…"]}),i.jsxs("span",{title:"UI 설정",style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:B?"rgba(40,167,69,0.15)":"rgba(255,193,7,0.12)",color:B?"#7CDA9B":"#FFD666",border:"1px solid "+(B?"rgba(40,167,69,0.45)":"rgba(255,193,7,0.35)")},children:["UI ",B?"✓":"…"]}),i.jsxs("span",{title:"환경 설정",style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:Q?"rgba(40,167,69,0.15)":"rgba(255,193,7,0.12)",color:Q?"#7CDA9B":"#FFD666",border:"1px solid "+(Q?"rgba(40,167,69,0.45)":"rgba(255,193,7,0.35)")},children:["Env ",Q?"✓":"…"]})]}),_&&i.jsxs("div",{className:"object-info",children:[i.jsx("span",{className:"object-name",children:_.name}),i.jsxs("span",{className:"object-type",children:["(",N,")"]}),((null==(C=null==(w=null==m?void 0:m.objectSelector)?void 0:w.transformControls)?void 0:C.dragging)||(null==m?void 0:m._gizmoPointerDown))&&i.jsx("span",{className:"editing-badge",title:"기즈모 편집 중 - 값만 실시간 갱신됩니다",children:"편집 중"})]})]}),i.jsxs("div",{className:"properties-container "+((null==(I=null==(x=null==m?void 0:m.objectSelector)?void 0:x.transformControls)?void 0:I.dragging)||(null==m?void 0:m._gizmoPointerDown)?"editing":""),children:[!l&&i.jsxs("div",{className:"no-selection",children:[i.jsx("div",{className:"no-selection-icon",children:"ℹ️"}),i.jsx("div",{className:"no-selection-text",children:"뷰 정보"}),i.jsx("div",{className:"no-selection-hint",children:"선택된 객체가 없을 때 현재 시스템 상태를 보여줍니다."}),i.jsx(E,{})]}),_&&i.jsxs("div",{className:"accordion",children:[i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>z("transform"),children:[i.jsx("span",{className:"chevron "+(j.transform?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Transform"})]}),!j.transform&&i.jsx("div",{className:"accordion-body transform-properties",children:_?i.jsxs("div",{className:"transform-properties",children:[i.jsxs("div",{className:"transform-row",children:[i.jsx("div",{className:"transform-label",children:"Position"}),i.jsxs("div",{className:"transform-inputs",children:[i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"X"}),i.jsx("input",{type:"number",step:"0.1",value:_.position.x,onChange:e=>null==D?void 0:D.setTransformProperty("position","x",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Y"}),i.jsx("input",{type:"number",step:"0.1",value:_.position.y,onChange:e=>null==D?void 0:D.setTransformProperty("position","y",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Z"}),i.jsx("input",{type:"number",step:"0.1",value:_.position.z,onChange:e=>null==D?void 0:D.setTransformProperty("position","z",e.target.value)})]})]})]}),i.jsxs("div",{className:"transform-row",children:[i.jsx("div",{className:"transform-label",children:"Rotation"}),i.jsxs("div",{className:"transform-inputs",children:[i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"X"}),i.jsx("input",{type:"number",step:"1",value:_.rotation.x,onChange:e=>null==D?void 0:D.setTransformProperty("rotation","x",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Y"}),i.jsx("input",{type:"number",step:"1",value:_.rotation.y,onChange:e=>null==D?void 0:D.setTransformProperty("rotation","y",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Z"}),i.jsx("input",{type:"number",step:"1",value:_.rotation.z,onChange:e=>null==D?void 0:D.setTransformProperty("rotation","z",e.target.value)})]})]})]}),i.jsxs("div",{className:"transform-row",children:[i.jsx("div",{className:"transform-label",children:"Scale"}),i.jsxs("div",{className:"transform-inputs",children:[i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"X"}),i.jsx("input",{type:"number",step:"0.1",min:"0.1",value:_.scale.x,onChange:e=>null==D?void 0:D.setTransformProperty("scale","x",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Y"}),i.jsx("input",{type:"number",step:"0.1",min:"0.1",value:_.scale.y,onChange:e=>null==D?void 0:D.setTransformProperty("scale","y",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Z"}),i.jsx("input",{type:"number",step:"0.1",min:"0.1",value:_.scale.z,onChange:e=>null==D?void 0:D.setTransformProperty("scale","z",e.target.value)})]})]})]})]}):i.jsx("div",{style:{color:"red",padding:"20px"},children:"objectInfo가 없습니다"})})]}),i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>z("object"),children:[i.jsx("span",{className:"chevron "+(j.object?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Object"})]}),!j.object&&i.jsx("div",{className:"accordion-body object-properties",children:_?i.jsxs("div",{className:"object-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Name"}),i.jsx("input",{type:"text",value:_.name,onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.name=e.target.value,D.notifyPropertyChange("object","name",e.target.value))}})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Type"}),i.jsx("span",{className:"readonly-value",children:_.type})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"ID"}),i.jsx("span",{className:"readonly-value",children:_.id})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Visible"}),i.jsx("input",{type:"checkbox",checked:!1!==(null==(H=null==D?void 0:D.threeObject)?void 0:H.visible),onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.visible=e.target.checked,D.notifyPropertyChange("object","visible",e.target.checked))}})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Cast Shadow"}),i.jsx("input",{type:"checkbox",checked:(null==(q=null==D?void 0:D.threeObject)?void 0:q.castShadow)||!1,onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.castShadow=e.target.checked,D.notifyPropertyChange("object","castShadow",e.target.checked))}})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Receive Shadow"}),i.jsx("input",{type:"checkbox",checked:(null==(K=null==D?void 0:D.threeObject)?void 0:K.receiveShadow)||!1,onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.receiveShadow=e.target.checked,D.notifyPropertyChange("object","receiveShadow",e.target.checked))}})]})]}):i.jsx("div",{style:{color:"red",padding:"20px"},children:"objectInfo가 없습니다"})})]}),"mesh"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>z("material"),children:[i.jsx("span",{className:"chevron "+(j.material?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Material"})]}),!j.material&&i.jsx("div",{className:"accordion-body material-properties",children:"mesh"!==N?i.jsx("div",{className:"not-available",children:"메시 객체가 아닙니다"}):i.jsxs("div",{className:"material-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Color"}),i.jsx("input",{type:"color",value:(null==D?void 0:D.getMaterialProperty("color"))||"#ffffff",onChange:e=>null==D?void 0:D.setMaterialProperty("color",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Metalness"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("metalness"))||0,onChange:e=>null==D?void 0:D.setMaterialProperty("metalness",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("metalness"))||0).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Roughness"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("roughness"))||.8,onChange:e=>null==D?void 0:D.setMaterialProperty("roughness",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("roughness"))||.8).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Emissive"}),i.jsx("input",{type:"color",value:(null==D?void 0:D.getMaterialProperty("emissive"))||"#000000",onChange:e=>null==D?void 0:D.setMaterialProperty("emissive",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Emissive Intensity"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("emissiveIntensity"))||0,onChange:e=>null==D?void 0:D.setMaterialProperty("emissiveIntensity",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("emissiveIntensity"))||0).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Opacity"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("opacity"))||1,onChange:e=>null==D?void 0:D.setMaterialProperty("opacity",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("opacity"))||1).toFixed(2)})]})]})]})})]}),"light"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>z("light"),children:[i.jsx("span",{className:"chevron "+(j.light?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Light"})]}),!j.light&&i.jsx("div",{className:"accordion-body light-properties",children:(()=>{if("light"!==N)return i.jsx("div",{className:"not-available",children:"라이트 객체가 아닙니다"});const e=null==D?void 0:D.getLightProperty("type");return i.jsxs("div",{className:"light-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Type"}),i.jsx("span",{className:"readonly-value",children:e})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Color"}),i.jsx("input",{type:"color",value:(null==D?void 0:D.getLightProperty("color"))||"#ffffff",onChange:e=>null==D?void 0:D.setLightProperty("color",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Intensity"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:(null==D?void 0:D.getLightProperty("intensity"))||1,onChange:e=>null==D?void 0:D.setLightProperty("intensity",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("intensity"))||1).toFixed(1)})]})]}),"SpotLight"===e&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Distance"}),i.jsx("input",{type:"number",min:"0",step:"1",value:(null==D?void 0:D.getLightProperty("distance"))||0,onChange:e=>null==D?void 0:D.setLightProperty("distance",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Angle"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1.57",step:"0.01",value:(null==D?void 0:D.getLightProperty("angle"))||0,onChange:e=>null==D?void 0:D.setLightProperty("angle",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("angle"))||0).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Penumbra"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getLightProperty("penumbra"))||0,onChange:e=>null==D?void 0:D.setLightProperty("penumbra",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("penumbra"))||0).toFixed(2)})]})]})]}),("PointLight"===e||"SpotLight"===e)&&i.jsxs(i.Fragment,{children:["PointLight"===e&&i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Distance"}),i.jsx("input",{type:"number",min:"0",step:"1",value:(null==D?void 0:D.getLightProperty("distance"))||0,onChange:e=>null==D?void 0:D.setLightProperty("distance",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Decay"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:(null==D?void 0:D.getLightProperty("decay"))||1,onChange:e=>null==D?void 0:D.setLightProperty("decay",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("decay"))||1).toFixed(1)})]})]})]})]})})()})]}),"camera"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>z("camera"),children:[i.jsx("span",{className:"chevron "+(j.camera?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Camera"})]}),!j.camera&&i.jsx("div",{className:"accordion-body camera-properties",children:"camera"!==N?i.jsx("div",{className:"not-available",children:"카메라 객체가 아닙니다"}):i.jsxs("div",{className:"camera-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Type"}),i.jsx("span",{className:"readonly-value",children:null==D?void 0:D.getCameraProperty("type")})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"FOV"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"10",max:"120",step:"1",value:(null==D?void 0:D.getCameraProperty("fov"))||75,onChange:e=>null==D?void 0:D.setCameraProperty("fov",e.target.value)}),i.jsxs("span",{children:[(null==D?void 0:D.getCameraProperty("fov"))||75,"°"]})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Near"}),i.jsx("input",{type:"number",min:"0.01",step:"0.01",value:(null==D?void 0:D.getCameraProperty("near"))||.1,onChange:e=>null==D?void 0:D.setCameraProperty("near",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Far"}),i.jsx("input",{type:"number",min:"1",step:"1",value:(null==D?void 0:D.getCameraProperty("far"))||1e3,onChange:e=>null==D?void 0:D.setCameraProperty("far",e.target.value)})]})]})})]}),"mesh"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>z("part"),children:[i.jsx("span",{className:"chevron "+(j.part?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Part"})]}),!j.part&&i.jsx("div",{className:"accordion-body part-properties",children:(()=>{var e,t,n,s,a,r,o,l,c,A,d,h,u,p,g,f,v,y,w,C,x;if("mesh"!==N)return i.jsx("div",{className:"not-available",children:"메시 객체가 아닙니다"});const I=!!(null==(e=null==m?void 0:m.partInspector)?void 0:e.enabled),E=!!(null==(t=null==m?void 0:m.partInspector)?void 0:t.solo),S=!!(null==(n=null==m?void 0:m.partInspector)?void 0:n.clipping),B=!!(null==(s=null==m?void 0:m.partInspector)?void 0:s.gizmo),Q=U;return i.jsxs("div",{className:"part-properties",children:[i.jsxs("div",{className:"property-group",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[i.jsx("label",{children:"파트 인스펙션"}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:I,onChange:e=>{var t;return null==(t=null==m?void 0:m.enablePartInspect)?void 0:t.call(m,e.target.checked)}})," 사용"]}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:E,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartSolo)?void 0:t.call(m,e.target.checked)},disabled:!I})," 솔로 뷰"]}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:S,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartClipping)?void 0:t.call(m,e.target.checked)},disabled:!I})," 클리핑"]}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.clearPartSelection)?void 0:e.call(m)},disabled:!I,children:"파트 선택 해제"})]}),I&&i.jsxs("div",{className:"property-group",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[i.jsx("label",{children:"파트 기즈모"}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:B,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGizmoEnabled)?void 0:t.call(m,e.target.checked)},disabled:!(null==(a=null==m?void 0:m.getSelectedPart)?void 0:a.call(m))})," 활성화"]}),i.jsxs("div",{style:{display:"inline-flex",gap:6},children:[i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"translate")},disabled:!B,children:"이동"}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"rotate")},disabled:!B,children:"회전"}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"scale")},disabled:!B,children:"스케일"})]})]}),i.jsxs("div",{className:"property-group",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"8px 12px"},children:[i.jsx("div",{style:{gridColumn:"1 / span 2",fontWeight:600},children:"포스트프로세싱"}),i.jsx("label",{children:"Bloom"}),i.jsx("input",{type:"checkbox",checked:!!(null==(o=null==(r=null==b?void 0:b.effectSettings)?void 0:r.bloom)?void 0:o.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"bloom",e.target.checked)}catch{}}}),i.jsx("label",{children:"AA (SMAA)"}),i.jsx("input",{type:"checkbox",checked:!!(null==(c=null==(l=null==b?void 0:b.effectSettings)?void 0:l.fxaa)?void 0:c.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"fxaa",e.target.checked)}catch{}}}),i.jsx("label",{children:"SSAO"}),i.jsx("input",{type:"checkbox",checked:!!(null==(d=null==(A=null==b?void 0:b.effectSettings)?void 0:A.ssao)?void 0:d.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"ssao",e.target.checked)}catch{}}}),i.jsx("label",{children:"Tone Mapping"}),i.jsx("input",{type:"checkbox",checked:!1!==(null==(u=null==(h=null==b?void 0:b.effectSettings)?void 0:h.toneMapping)?void 0:u.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"toneMapping",e.target.checked)}catch{}}})]}),i.jsxs("div",{className:"property-group",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"8px 12px"},children:[i.jsx("div",{style:{gridColumn:"1 / span 2",fontWeight:600},children:"톤 매핑"}),i.jsx("label",{children:"모드"}),i.jsxs("select",{value:(null==(g=null==(p=null==b?void 0:b.effectSettings)?void 0:p.toneMapping)?void 0:g.mapping)||"ACESFilmic",onChange:e=>{var t;try{null==(t=null==b?void 0:b.updateEffectSettings)||t.call(b,"toneMapping",{mapping:e.target.value})}catch{}},children:[i.jsx("option",{value:"None",children:"None"}),i.jsx("option",{value:"Linear",children:"Linear"}),i.jsx("option",{value:"Reinhard",children:"Reinhard"}),i.jsx("option",{value:"Cineon",children:"Cineon"}),i.jsx("option",{value:"ACESFilmic",children:"ACESFilmic"})]}),i.jsx("label",{children:"노출"}),i.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.05",value:(null==(v=null==(f=null==b?void 0:b.effectSettings)?void 0:f.toneMapping)?void 0:v.exposure)??1,onChange:e=>{var t;const n=parseFloat(e.target.value);try{null==(t=null==b?void 0:b.updateEffectSettings)||t.call(b,"toneMapping",{exposure:n})}catch{}}})]}),I&&i.jsxs("div",{className:"property-group",children:[i.jsx("div",{style:{fontSize:12,color:"#aaa",marginBottom:6},children:"서브메시를 클릭해 선택하세요."}),Q?i.jsxs("div",{className:"mesh-info",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"6px 12px"},children:[i.jsx("div",{children:"이름"}),i.jsx("div",{children:Q.name}),i.jsx("div",{children:"UUID"}),i.jsx("div",{style:{wordBreak:"break-all"},children:Q.uuid}),i.jsx("div",{children:"지오메트리"}),i.jsxs("div",{children:[Q.geometry.type," ",Q.geometry.hasIndex?"(Indexed)":""]}),i.jsx("div",{children:"버텍스/트라이"}),i.jsxs("div",{children:[Q.geometry.vertices," / ",Q.geometry.triangles]}),i.jsx("div",{children:"속성"}),i.jsx("div",{children:Q.geometry.attributes.join(", ")}),i.jsx("div",{children:"월드 크기"}),i.jsx("div",{children:Q.geometry.world.size.map(e=>e.toFixed(3)).join(", ")}),i.jsx("div",{children:"월드 중심"}),i.jsx("div",{children:Q.geometry.world.center.map(e=>e.toFixed(3)).join(", ")}),i.jsx("div",{children:"UV"}),i.jsx("div",{children:Q.geometry.uv?`${Q.geometry.uv.count}x${Q.geometry.uv.itemSize}`:"없음"}),i.jsx("div",{children:"UV2"}),i.jsx("div",{children:Q.geometry.uv2?`${Q.geometry.uv2.count}x${Q.geometry.uv2.itemSize}`:"없음"}),Q.material&&i.jsxs(i.Fragment,{children:[i.jsx("div",{children:"머티리얼"}),i.jsxs("div",{children:[Q.material.type," ",Q.material.name?`(${Q.material.name})`:""]}),i.jsx("div",{children:"색상/불투명"}),i.jsxs("div",{children:[Q.material.color||"-"," / ",Q.material.opacity]}),i.jsx("div",{children:"Metal/Rough"}),i.jsxs("div",{children:[Q.material.metalness??"-"," / ",Q.material.roughness??"-"]}),i.jsx("div",{children:"맵들"}),i.jsx("div",{children:Object.entries(Q.material.maps).filter(([,e])=>e).map(([e])=>e).join(", ")||"없음"})]})]}):i.jsx("div",{style:{color:"#aaa"},children:"선택된 파트가 없습니다."}),i.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.selectAllChildParts)?void 0:e.call(m)},disabled:!(null==(y=null==m?void 0:m.getSelectedPart)?void 0:y.call(m)),children:"자식 파트 전체 선택"}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.clearAllPartSelections)?void 0:e.call(m)},disabled:!(null==(w=null==m?void 0:m.getSelectedPart)?void 0:w.call(m)),children:"모든 파트 선택 해제"}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:!!(null==(C=null==m?void 0:m.isPartGroupGizmoEnabled)?void 0:C.call(m)),onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGroupGizmoEnabled)?void 0:t.call(m,e.target.checked)}})," 그룹 기즈모(일괄 변형)"]}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:["피벗",i.jsxs("select",{value:(null==(x=null==m?void 0:m.getPartGroupPivot)?void 0:x.call(m))||"center",onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGroupPivot)?void 0:t.call(m,e.target.value)},children:[i.jsx("option",{value:"center",children:"선택 중심"}),i.jsx("option",{value:"first",children:"첫 파트"}),i.jsx("option",{value:"last",children:"마지막 파트"})]})]})]})]})]})})()})]})]})]})]})]})]});var H,q,K}),ko=({onObjectDrop:e,onClose:t,forceRefresh:n=0})=>{const[s,a]=r.useState(!1),[l,c]=r.useState([]),[A,d]=r.useState([]),h=r.useRef(null),{customMeshes:u,loadCustomMeshes:p}=Ys(),g=r.useRef(jo()),m=r.useRef(new Set),b=r.useRef(null),[f,v]=r.useState(!1),[y,w]=r.useState({open:!1,x:0,y:0,mesh:null}),C=r.useRef(null);r.useEffect(()=>{if(!y.open)return;const e=()=>w({open:!1,x:0,y:0,mesh:null}),t=t=>{"Escape"===t.key&&e()},n=t=>{try{const e=C.current;if(e&&e.contains(t.target))return}catch{}e()};return window.addEventListener("click",n),window.addEventListener("keydown",t),()=>{window.removeEventListener("click",n),window.removeEventListener("keydown",t)}},[y.open]);r.useEffect(()=>((async()=>{const e=await g.current.getCustomMeshes();p(e)})(),()=>{const e=m.current;for(const t of e)try{URL.revokeObjectURL(t)}catch{}e.clear()}),[p]),r.useEffect(()=>{const e=async()=>{const e=await g.current.getCustomMeshes();p(e)};return window.addEventListener("customMeshAdded",e),()=>{window.removeEventListener("customMeshAdded",e)}},[p]),r.useEffect(()=>{const e=m.current,t=new Set((u||[]).map(e=>"string"==typeof e.thumbnail&&e.thumbnail.startsWith("blob:")?e.thumbnail:null).filter(Boolean));for(const n of e)if(!t.has(n))try{URL.revokeObjectURL(n)}catch{}m.current=t},[u]),r.useEffect(()=>{(()=>{const e=JSON.parse(localStorage.getItem("customObjects")||"[]");c(e)})()},[n]),r.useEffect(()=>{(async()=>{try{const t=await g.current.loadLibraryMeshes();d(t);for(let n=0;n<t.length;n++){const i=t[n];try{const e=await g.current.generateThumbnailFromURL(i.glbUrl);d(t=>t.map(t=>t.id===i.id?{...t,thumbnail:e,isLoadingThumbnail:!1}:t))}catch(e){d(e=>e.map(e=>e.id===i.id?{...e,isLoadingThumbnail:!1}:e))}}}catch(e){}})()},[]);const x=(e,t)=>{a(!0),h.current=t;let n=t;"custom"===t.type&&(n={type:"custom",id:t.id,name:t.name});const i=document.createElement("canvas");i.width=50,i.height=50;const s=i.getContext("2d");s.fillStyle="rgba(100, 150, 255, 0.8)",s.fillRect(0,0,50,50),s.fillStyle="white",s.font="12px Arial",s.textAlign="center",s.fillText(t.name,25,30),e.dataTransfer.setDragImage(i,25,25),e.dataTransfer.setData("text/plain",JSON.stringify(n))},I=()=>{a(!1),h.current=null},E=t=>{e&&("custom"===t.type?e({type:"custom",id:t.id,name:t.name},{x:0,y:0,z:0}):(t.type,e(t,{x:0,y:0,z:0})))},S=async(e,t)=>{if(t.stopPropagation(),window.confirm(`"${e.name}"을(를) 라이브러리에서 삭제하시겠습니까?`))try{await g.current.deleteCustomMesh(e.id);const t=await g.current.getCustomMeshes();p(t),window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제되었습니다.",type:"success",duration:2e3}}))}catch(n){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}},B=async e=>{try{const e=await g.current.getCustomMeshes();p(e)}catch{}};return i.jsxs("div",{className:"library-panel",children:[i.jsxs("div",{className:"library-header",children:[i.jsx("h3",{children:"라이브러리"}),i.jsx("button",{className:"close-btn",onClick:t,children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]}),i.jsxs("div",{className:"library-content",children:[i.jsx("div",{className:"category-section",style:{marginTop:0},children:i.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[i.jsx("button",{className:"upload-btn",onClick:()=>{var e;null==(e=b.current)||e.click()},disabled:f,title:"GLB 파일 임포트",children:f?"임포트 중…":"GLB 임포트"}),i.jsx("input",{ref:b,type:"file",accept:".glb,model/gltf-binary",multiple:!0,style:{display:"none"},onChange:async e=>{const t=Array.from(e.target.files||[]);if(t.length){v(!0);try{for(const i of t)try{await g.current.importGLBFile(i)}catch(n){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:`${i.name} 임포트 실패`,type:"error",duration:3e3}}))}const e=await g.current.getCustomMeshes();p(e),window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"임포트 완료",type:"success",duration:2e3}}))}finally{v(!1),b.current&&(b.current.value="")}}}})]})}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"기본 도형"}),i.jsx("div",{className:"object-grid",children:[{id:"cube",name:"정육면체",type:"basic",geometry:"BoxGeometry",params:[1,1,1]},{id:"sphere",name:"구체",type:"basic",geometry:"SphereGeometry",params:[.5,32,16]},{id:"cylinder",name:"원기둥",type:"basic",geometry:"CylinderGeometry",params:[.5,.5,1,32]},{id:"cone",name:"원뿔",type:"basic",geometry:"ConeGeometry",params:[.5,1,32]},{id:"plane",name:"평면",type:"basic",geometry:"PlaneGeometry",params:[1,1]},{id:"torus",name:"도넛",type:"basic",geometry:"TorusGeometry",params:[.5,.2,16,100]}].map(e=>i.jsx("div",{className:"library-item",draggable:!0,onDragStart:t=>x(t,e),onDragEnd:I,onClick:()=>E(e),title:e.name,children:i.jsx("div",{className:"object-grid",children:i.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:["cube"===e.id&&i.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"}),"sphere"===e.id&&i.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}),"cylinder"===e.id&&i.jsx("path",{d:"M12,2C8.14,2 5,3.79 5,6V18C5,20.21 8.14,22 12,22C15.86,22 19,20.21 19,18V6C19,3.79 15.86,2 12,2M12,4C14.67,4 17,4.9 17,6C17,7.1 14.67,8 12,8C9.33,8 7,7.1 7,6C7,4.9 9.33,4 12,4M7,9.5C8.21,10.72 9.86,11.26 12,11.26C14.14,11.26 15.79,10.72 17,9.5V18C17,19.1 14.67,20 12,20C9.33,20 7,19.1 7,18V9.5Z"}),"cone"===e.id&&i.jsx("path",{d:"M12,2L1,21H23L12,2M12,6L19.53,19H4.47L12,6Z"}),"plane"===e.id&&i.jsx("path",{d:"M3,3V21H21V3H3M19,19H5V5H19V19Z"}),"torus"===e.id&&i.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"})]})})},e.id))})]}),A.length>0&&i.jsx("div",{className:"section-divider"}),A.length>0&&i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"라이브러리 메쉬"}),i.jsxs("div",{style:{display:"flex",gap:6,position:"absolute",top:6,right:6},children:[i.jsx("button",{className:"delete-btn",onClick:e=>S(mesh,e),title:"삭제",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})})}),i.jsx("button",{className:"delete-btn",onClick:e=>{e.stopPropagation(),g.current.downloadCustomMesh(mesh)},title:"내보내기",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M5,20H19V18H5M14,10V3H10V10H7L12,15L17,10H14Z"})})})]}),i.jsx("div",{className:"object-grid",children:A.map(e=>i.jsx("div",{className:"library-item library-mesh",draggable:!0,onDragStart:t=>x(t,e),onDragEnd:I,onClick:()=>E(e),title:`${e.name} (라이브러리)`,children:i.jsx("div",{className:"library-thumbnail",children:e.isLoadingThumbnail?i.jsx("div",{className:"thumbnail-loading",children:i.jsx("div",{className:"loading-spinner"})}):e.thumbnail?i.jsx("img",{src:e.thumbnail,alt:e.name,className:"thumbnail-image",onError:()=>B(e.id)}):i.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2L2,7L12,12L22,7L12,2M2,17L12,22L22,17L20.84,16.47L12,21.17L3.16,16.47L2,17Z"})})})},e.id))})]}),i.jsx("div",{className:"section-divider"}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"커스텀 메쉬"}),i.jsx("div",{className:"object-grid",children:u.length>0?u.map(e=>i.jsxs("div",{className:"library-item custom-mesh",draggable:!0,onDragStart:t=>x(t,e),onDragEnd:I,onClick:()=>E(e),onContextMenu:t=>((e,t)=>{e.preventDefault(),e.stopPropagation(),w({open:!0,x:e.clientX,y:e.clientY,mesh:t})})(t,e),title:e.name,children:[i.jsxs("div",{className:"library-thumbnail",children:[i.jsx("img",{src:e.thumbnail,alt:e.name,width:"40",height:"40",onError:t=>{t.target.style.display="none",t.target.nextSibling.style.display="block",B(e.id)}}),i.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",style:{display:"none"},children:i.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})]}),i.jsx("button",{className:"delete-btn",onClick:t=>S(e,t),title:"삭제",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})})})]},e.id)):i.jsx("div",{className:"empty-library"})})]}),l.length>0&&i.jsx("div",{className:"section-divider"}),l.length>0&&i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"사용자 정의"}),i.jsx("div",{className:"object-grid",children:l.map(e=>i.jsxs("div",{className:"library-item custom-object",draggable:!0,onDragStart:t=>x(t,e),onDragEnd:I,onClick:()=>E(e),title:`${e.name} (사용자 정의)`,children:[i.jsx("div",{className:"library-thumbnail",children:e.thumbnail?i.jsx("img",{src:e.thumbnail,alt:e.name,style:{width:"24px",height:"24px",objectFit:"cover",borderRadius:"2px"}}):i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2L13.09,8.26L22,9L14.74,14.74L17.18,22L12,18.5L6.82,22L9.26,14.74L2,9L10.91,8.26L12,2Z"})})}),i.jsx("button",{className:"delete-btn",onClick:t=>((e,t)=>{if(t.stopPropagation(),window.confirm(`"${e.name}"을(를) 라이브러리에서 삭제하시겠습니까?`)){e.glbUrl&&URL.revokeObjectURL(e.glbUrl);const t=JSON.parse(localStorage.getItem("customObjects")||"[]").filter(t=>t.id!==e.id);localStorage.setItem("customObjects",JSON.stringify(t)),c(t)}})(e,t),title:"삭제",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]},e.id))})]})]}),y.open&&o.createPortal(i.jsx("div",{ref:C,className:"lib-context-menu",style:{left:y.x,top:y.y},children:i.jsx("button",{className:"ctx-item",onClick:async()=>{if(y.mesh)try{let e=y.mesh;if(!e.glbData&&e.id){const t=(await g.current.getCustomMeshes()).find(t=>t.id===e.id);t&&(e=t)}g.current.downloadCustomMesh(e);try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"다운로드 시작",type:"success",duration:1500}}))}catch{}}catch(e){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"내보내기 실패",type:"error",duration:2500}}))}finally{w({open:!1,x:0,y:0,mesh:null})}},children:"GLB 내보내기"})}),document.body)]})},Lo=({onAssetDrop:e,onClose:t})=>i.jsxs("div",{className:"assets-panel",children:[i.jsxs("div",{className:"assets-header",children:[i.jsx("h3",{children:"기본 에셋"}),i.jsx("button",{className:"close-btn",onClick:t,children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]}),i.jsx("div",{className:"assets-content",children:i.jsx("div",{className:"assets-grid",children:[{id:"point_light",name:"포인트 라이트",type:"point_light",description:"점 조명"},{id:"spot_light",name:"스포트 라이트",type:"spot_light",description:"스포트 조명"},{id:"axes_helper",name:"축 헬퍼",type:"axes_helper",description:"XYZ 축 표시"}].map(t=>i.jsx("div",{className:"asset-item",draggable:!0,onDragStart:e=>((e,t)=>{const n=document.createElement("canvas");n.width=50,n.height=50;const i=n.getContext("2d");i.fillStyle="rgba(255, 165, 0, 0.8)",i.fillRect(0,0,50,50),i.fillStyle="white",i.font="12px Arial",i.textAlign="center",i.fillText(t.name.substring(0,6),25,20),i.fillText("Asset",25,35),e.dataTransfer.setDragImage(n,25,25),e.dataTransfer.setData("text/plain",JSON.stringify(t))})(e,t),onClick:()=>(t=>{e&&e(t,{x:0,y:0,z:0})})(t),title:`${t.name}: ${t.description}`,children:i.jsx("div",{className:"asset-name",children:t.name})},t.id))})})]}),Po=({postProcessingManager:e,onClose:t})=>{const[n,s]=r.useState({}),[a,o]=r.useState("basic"),l=Ys(e=>e.isPostProcessingEnabled),c=Ys(e=>e.togglePostProcessingEnabled),A=Ys(e=>e.postProcessingPreset),d=Ys(e=>e.setPostProcessingPreset);r.useEffect(()=>{e&&s(e.getSettings())},[e]);const h=t=>{var i;if(!e)return;const a=!(null==(i=n[t])?void 0:i.enabled);e.setEffectEnabled(t,a),s(e=>({...e,[t]:{...e[t],enabled:a}}))},u=(t,n,i)=>{if(!e)return;const a={[n]:i};e.updateEffectSettings(t,a),s(e=>({...e,[t]:{...e[t],[n]:i}}))};return i.jsxs("div",{className:"post-processing-panel",children:[i.jsxs("div",{className:"panel-header",children:[i.jsx("h2",{children:"포스트프로세싱 효과"}),i.jsxs("label",{className:"checkbox-label",style:{marginLeft:"auto",marginRight:8},children:[i.jsx("input",{type:"checkbox",checked:l,onChange:c})," 전체 사용"]}),i.jsx("button",{className:"close-button",onClick:t,children:"×"})]}),!l&&i.jsx("div",{style:{background:"rgba(255, 194, 61, 0.12)",border:"1px solid rgba(255, 194, 61, 0.35)",color:"#b78200",padding:"8px 10px",borderRadius:6,margin:"8px 12px"},children:'포스트프로세싱이 꺼져 있어 효과가 화면에 보이지 않습니다. 상단의 "전체 사용"을 켜세요.'}),i.jsxs("div",{className:"panel-tabs",children:[i.jsx("button",{className:"tab-button "+("basic"===a?"active":""),onClick:()=>o("basic"),children:"기본"}),i.jsx("button",{className:"tab-button "+("color"===a?"active":""),onClick:()=>o("color"),children:"색상"}),i.jsx("button",{className:"tab-button "+("artistic"===a?"active":""),onClick:()=>o("artistic"),children:"아티스틱"})]}),i.jsxs("div",{className:"panel-content",children:["basic"===a&&i.jsxs("div",{className:"effect-group",children:[i.jsx("h3",{children:"기본 효과"}),i.jsx("div",{className:"effect-item",children:i.jsxs("div",{className:"effect-header",children:[i.jsx("label",{style:{color:"#ccc",fontSize:12,marginRight:8},children:"프리셋"}),i.jsxs("select",{value:A,onChange:t=>{var n;const i=t.target.value;d(i);try{null==(n=null==e?void 0:e.applyPreset)||n.call(e,i)}catch{}},children:[i.jsx("option",{value:"default",children:"Default"}),i.jsx("option",{value:"low",children:"Low"}),i.jsx("option",{value:"medium",children:"Medium"}),i.jsx("option",{value:"high",children:"High"})]})]})}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(p=n.bloom)?void 0:p.enabled)||!1,onChange:()=>h("bloom")}),"Bloom (발광)"]})}),(null==(g=n.bloom)?void 0:g.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"강도:"}),i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:(null==(m=n.bloom)?void 0:m.strength)||1.5,onChange:e=>u("bloom","strength",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(b=n.bloom)?void 0:b.strength)||1.5})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"반경:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(f=n.bloom)?void 0:f.radius)||.4,onChange:e=>u("bloom","radius",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(v=n.bloom)?void 0:v.radius)||.4})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"임계값:"}),i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(y=n.bloom)?void 0:y.threshold)||.85,onChange:e=>u("bloom","threshold",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(w=n.bloom)?void 0:w.threshold)||.85})]})]})]}),i.jsx("div",{className:"effect-item",children:i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(C=n.fxaa)?void 0:C.enabled)||!1,onChange:()=>h("fxaa")}),"FXAA (안티앨리어싱)"]})})}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(x=n.ssao)?void 0:x.enabled)||!1,onChange:()=>h("ssao")}),"SSAO (주변광 차폐)"]})}),(null==(I=n.ssao)?void 0:I.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"커널 반경:"}),i.jsx("input",{type:"range",min:"1",max:"32",step:"1",value:(null==(E=n.ssao)?void 0:E.kernelRadius)||8,onChange:e=>u("ssao","kernelRadius",parseInt(e.target.value))}),i.jsx("span",{children:(null==(S=n.ssao)?void 0:S.kernelRadius)||8})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(B=n.toneMapping)?void 0:B.enabled)??!0,onChange:()=>h("toneMapping")}),"Tone Mapping (톤 매핑)"]})}),!1!==(null==(Q=n.toneMapping)?void 0:Q.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"모드:"}),i.jsxs("select",{value:(null==(j=n.toneMapping)?void 0:j.mapping)||"ACESFilmic",onChange:e=>u("toneMapping","mapping",e.target.value),children:[i.jsx("option",{value:"None",children:"None"}),i.jsx("option",{value:"Linear",children:"Linear"}),i.jsx("option",{value:"Reinhard",children:"Reinhard"}),i.jsx("option",{value:"Cineon",children:"Cineon"}),i.jsx("option",{value:"ACESFilmic",children:"ACESFilmic"})]})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"노출:"}),i.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.05",value:(null==(M=n.toneMapping)?void 0:M.exposure)??1,onChange:e=>u("toneMapping","exposure",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(D=n.toneMapping)?void 0:D.exposure)??1})]})]})]})]}),"color"===a&&(()=>{var e,t,s,a,r,o,l,c,A,d,p,g,m,b,f,v,y,w,C,x,I,E,S,B,Q,j,M,D;return i.jsxs("div",{className:"effect-group",children:[i.jsx("h3",{children:"색상 효과"}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(e=n.colorCorrection)?void 0:e.enabled)||!1,onChange:()=>h("colorCorrection")}),"Color Correction (색상 보정)"]})}),(null==(t=n.colorCorrection)?void 0:t.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"Red Power:"}),i.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:(null==(a=null==(s=n.colorCorrection)?void 0:s.powRGB)?void 0:a.x)||2,onChange:e=>u("colorCorrection","powRGB",{...n.colorCorrection.powRGB,x:parseFloat(e.target.value)})}),i.jsx("span",{children:(null==(o=null==(r=n.colorCorrection)?void 0:r.powRGB)?void 0:o.x)||2})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(l=n.brightnessContrast)?void 0:l.enabled)||!1,onChange:()=>h("brightnessContrast")}),"Brightness/Contrast (밝기/대비)"]})}),(null==(c=n.brightnessContrast)?void 0:c.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"밝기:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(A=n.brightnessContrast)?void 0:A.brightness)||0,onChange:e=>u("brightnessContrast","brightness",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(d=n.brightnessContrast)?void 0:d.brightness)||0})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"대비:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(p=n.brightnessContrast)?void 0:p.contrast)||0,onChange:e=>u("brightnessContrast","contrast",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(g=n.brightnessContrast)?void 0:g.contrast)||0})]})]})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(m=n.hueSaturation)?void 0:m.enabled)||!1,onChange:()=>h("hueSaturation")}),"Hue/Saturation (색조/채도)"]})}),(null==(b=n.hueSaturation)?void 0:b.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"색조:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(f=n.hueSaturation)?void 0:f.hue)||0,onChange:e=>u("hueSaturation","hue",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(v=n.hueSaturation)?void 0:v.hue)||0})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"채도:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(y=n.hueSaturation)?void 0:y.saturation)||0,onChange:e=>u("hueSaturation","saturation",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(w=n.hueSaturation)?void 0:w.saturation)||0})]})]})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(C=n.sepia)?void 0:C.enabled)||!1,onChange:()=>h("sepia")}),"Sepia (세피아)"]})}),(null==(x=n.sepia)?void 0:x.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"강도:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(I=n.sepia)?void 0:I.amount)||1,onChange:e=>u("sepia","amount",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(E=n.sepia)?void 0:E.amount)||1})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(S=n.vignette)?void 0:S.enabled)||!1,onChange:()=>h("vignette")}),"Vignette (비네트)"]})}),(null==(B=n.vignette)?void 0:B.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"오프셋:"}),i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(Q=n.vignette)?void 0:Q.offset)||1,onChange:e=>u("vignette","offset",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(j=n.vignette)?void 0:j.offset)||1})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"어둠:"}),i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(M=n.vignette)?void 0:M.darkness)||1,onChange:e=>u("vignette","darkness",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(D=n.vignette)?void 0:D.darkness)||1})]})]})]})]})})(),"artistic"===a&&(()=>{var e,t,s,a,r,o,l,c,A,d,p,g,m,b,f,v,y,w,C;return i.jsxs("div",{className:"effect-group",children:[i.jsx("h3",{children:"아티스틱 효과"}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(e=n.film)?void 0:e.enabled)||!1,onChange:()=>h("film")}),"Film (필름 효과)"]})}),(null==(t=n.film)?void 0:t.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"노이즈:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(s=n.film)?void 0:s.noiseIntensity)||.5,onChange:e=>u("film","noiseIntensity",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(a=n.film)?void 0:a.noiseIntensity)||.5})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"스캔라인:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(r=n.film)?void 0:r.scanlinesIntensity)||.05,onChange:e=>u("film","scanlinesIntensity",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(o=n.film)?void 0:o.scanlinesIntensity)||.05})]}),i.jsx("div",{className:"control-row",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(l=n.film)?void 0:l.grayscale)||!1,onChange:e=>u("film","grayscale",e.target.checked)}),"흑백"]})})]})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(c=n.pixelate)?void 0:c.enabled)||!1,onChange:()=>h("pixelate")}),"Pixelate (픽셀화)"]})}),(null==(A=n.pixelate)?void 0:A.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"픽셀 크기:"}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:(null==(d=n.pixelate)?void 0:d.pixelSize)||6,onChange:e=>u("pixelate","pixelSize",parseInt(e.target.value))}),i.jsx("span",{children:(null==(p=n.pixelate)?void 0:p.pixelSize)||6})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(g=n.dotScreen)?void 0:g.enabled)||!1,onChange:()=>h("dotScreen")}),"Dot Screen (도트 스크린)"]})}),(null==(m=n.dotScreen)?void 0:m.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"스케일:"}),i.jsx("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:(null==(b=n.dotScreen)?void 0:b.scale)||1,onChange:e=>u("dotScreen","scale",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(f=n.dotScreen)?void 0:f.scale)||1})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(v=n.glitch)?void 0:v.enabled)||!1,onChange:()=>h("glitch")}),"Glitch (글리치)"]})}),(null==(y=n.glitch)?void 0:y.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"강도:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(w=n.glitch)?void 0:w.factor)||.1,onChange:e=>u("glitch","factor",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(C=n.glitch)?void 0:C.factor)||.1})]})})]})]})})()]})]});var p,g,m,b,f,v,y,w,C,x,I,E,S,B,Q,j,M,D};function Fo({scene:e,onClose:t}){const n=Ys(e=>e.hdriSettings),s=Ys(e=>e.updateHDRISettings),a=Ys(e=>e.sunLightRef);Ys(e=>e.setSunLightRef);const o=Ys(e=>e.saveHDRISettings),l=Ys(e=>e.renderer),[c,A]=r.useState(!1),[d,h]=r.useState(null),u=r.useRef(null),{currentHDRI:p,hdriIntensity:g,hdriRotation:m,sunLightEnabled:f,sunIntensity:v,timeOfDay:y,sunAzimuth:w,sunElevation:C,sunColor:x}=n,I=(e,t="info")=>{h({message:e,type:t}),setTimeout(()=>h(null),3e3)},E=async(t,n)=>{var i,a,r,o,c,A;if(!e)throw new Error("씬이 초기화되지 않았습니다");const d=new Promise((e,t)=>{setTimeout(()=>t(new Error("로드 시간 초과")),3e4)});try{const o=await Promise.race([S(t),d]);o.mapping=zt,o.magFilter=O,o.minFilter=O,o.generateMipmaps=!1,o.matrixAutoUpdate=!0,null==(a=null==(i=o.center)?void 0:i.set)||a.call(i,.5,.5),o.needsUpdate=!0;try{(null==(r=null==p?void 0:p.envRT)?void 0:r.dispose)&&p.envRT.dispose()}catch{}try{(null==p?void 0:p.texture)&&p.texture!==o&&p.texture.dispose()}catch{}e.background=o;let c=null;if(l){const t=new Ut(l);t.compileEquirectangularShader(),c=t.fromEquirectangular(o),t.dispose(),e.environment=c.texture}else e.environment=o;void 0!==e.backgroundIntensity&&(e.backgroundIntensity=g),void 0!==e.environmentIntensity&&(e.environmentIntensity=g),s({currentHDRI:{name:n,type:"hdr",url:t}})}catch(h){if(t.startsWith("blob:")&&URL.revokeObjectURL(t),h.message.includes("Bad File Format"))try{const i=await B(t);i.mapping=zt,i.magFilter=O,i.minFilter=O,i.generateMipmaps=!1,i.matrixAutoUpdate=!0,null==(c=null==(o=i.center)?void 0:o.set)||c.call(o,.5,.5),i.needsUpdate=!0;try{(null==(A=null==p?void 0:p.envRT)?void 0:A.dispose)&&p.envRT.dispose()}catch{}try{(null==p?void 0:p.texture)&&p.texture.dispose()}catch{}e.background=i;let a=null;if(l){const t=new Ut(l);t.compileEquirectangularShader(),a=t.fromEquirectangular(i),t.dispose(),e.environment=a.texture}else e.environment=i;return void s({currentHDRI:{name:n+" (폴백)",type:"hdr",url:t}})}catch(u){}throw h}},S=async e=>{const t=new qt;return new Promise((n,i)=>{t.load(e,e=>{e&&e.image?n(e):i(new Error("텍스처 데이터가 유효하지 않습니다"))},void 0,e=>{i(e)})})},B=async e=>{const t=new D;return new Promise((n,i)=>{t.load(e,e=>{e&&e.image?n(e):i(new Error("폴백 텍스처 데이터가 유효하지 않습니다"))},void 0,e=>{i(e)})})},Q=(e,t,n)=>{const i=t*Math.PI/180,s=n*Math.PI/180,a=Math.sin(i)*Math.cos(s)*100,r=100*Math.sin(s),o=Math.cos(i)*Math.cos(s)*100;e.position.set(a,r,o),e.lookAt(0,0,0)},j=e=>{s({timeOfDay:e}),a&&(e=>{let t="#ffffff";t=e>=5&&e<7?"#ff6b47":e>=7&&e<10?"#ffaa80":e>=10&&e<16?"#ffffff":e>=16&&e<18?"#ffcc99":e>=18&&e<20?"#ff8c66":"#4a6fa5",s({sunColor:t}),a&&a.color.setHex(t.replace("#","0x"))})(e)};return r.useEffect(()=>()=>{},[e]),r.useEffect(()=>{e&&setTimeout(()=>o(),100)},[n,e,o]),r.useEffect(()=>{var t,n;if(e&&p&&p.type&&p.texture&&"none"!==p.type){void 0!==e.backgroundIntensity&&(e.backgroundIntensity=g),void 0!==e.environmentIntensity&&(e.environmentIntensity=g);try{null==(n=null==(t=p.texture.center)?void 0:t.set)||n.call(t,.5,.5)}catch{}if(p.texture.rotation=m*Math.PI/180,p.texture.needsUpdate=!0,l)try{if(!p.envRT){const t=new Ut(l);t.compileEquirectangularShader();const n=t.fromEquirectangular(p.texture);t.dispose(),e.environment=n.texture,s({currentHDRI:{...p,envRT:n}})}}catch{}}},[e,p,g,m,l]),i.jsxs("div",{className:"hdri-panel",children:[i.jsxs("div",{className:"hdri-header",children:[i.jsx("h3",{children:"HDRI 환경"}),i.jsxs("div",{className:"header-controls",children:[i.jsx("span",{className:"auto-save-indicator",title:"설정이 자동으로 저장됩니다",children:"💾"}),i.jsx("button",{className:"close-btn",onClick:t,children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]})]}),i.jsxs("div",{className:"hdri-content",children:[i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"현재 환경"}),i.jsx("div",{className:"current-hdri-display",children:p?i.jsx("span",{className:"hdri-name",children:p.name}):i.jsx("span",{className:"no-hdri",children:"환경 없음"})})]}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"환경맵 업로드"}),i.jsx("input",{type:"file",ref:u,onChange:async e=>{const t=e.target.files[0];if(!t)return;const n=[".hdr",".exr",".hdri"],i=[...n,".jpg",".jpeg",".png",".webp",".bmp"],s=t.name.toLowerCase().substring(t.name.lastIndexOf("."));if(!i.includes(s))return void I("지원하는 형식: HDRI(.hdr, .exr, .hdri) 또는 이미지(.jpg, .png, .webp)","error");if(t.size>209715200)return void I("파일 크기가 너무 큽니다 (최대 200MB)","error");if(t.size<100)return void I("파일이 너무 작습니다","error");const a=n.includes(s);if(a)try{const e=await t.slice(0,20).arrayBuffer(),n=new Uint8Array(e),i=String.fromCharCode(...n.slice(0,20));if(".hdr"===s){i.includes("#?RADIANCE")||i.includes("#?RGBE")||i.includes("RADIANCE")||35===n[0]||I("HDR 파일 형식이 표준과 다를 수 있습니다. 일반 이미지로 시도합니다.","info")}}catch(r){}else I("일반 이미지 파일을 환경맵으로 사용합니다","info");A(!0);try{const e=URL.createObjectURL(t);await E(e,t.name),I((a?"HDRI":"이미지")+" 환경이 로드되었습니다","success")}catch(o){let e="파일을 로드할 수 없습니다";o.message.includes("Bad File Format")?e="파일 형식을 읽을 수 없습니다. 다른 파일을 시도해보세요.":o.message.includes("network")?e="네트워크 오류로 파일을 로드할 수 없습니다":o.message.includes("로드 시간 초과")&&(e="파일 로드 시간이 초과되었습니다"),I(e,"error")}finally{A(!1),e.target.value=""}},accept:".hdr,.exr,.hdri,.jpg,.jpeg,.png,.webp,.bmp",style:{display:"none"}}),i.jsxs("button",{className:"hdri-upload-btn",onClick:()=>{var e;return null==(e=u.current)?void 0:e.click()},disabled:c,children:[i.jsx("div",{className:"upload-icon",children:i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})}),i.jsx("span",{children:c?"로딩중...":"파일 선택"})]}),i.jsx("div",{className:"upload-hint",children:".hdr, .exr, .hdri 지원"})]}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"기본 환경"}),i.jsx("div",{className:"hdri-grid",children:[{name:"컨트리 로드",type:"preset",url:"/hdr/sunny_country_road_2k.hdr",description:"햇살 좋은 시골길"},{name:"기본 스카이박스",type:"gradient",description:"그라디언트 스카이박스"},{name:"기본 배경",type:"none",description:"회색 배경"}].map((t,n)=>i.jsxs("div",{className:"hdri-item "+((null==p?void 0:p.name)===t.name?"active":""),onClick:()=>(async(t,n=null)=>{var i,a;if(e)switch(t){case"preset":if(n&&n.url)try{A(!0),await E(n.url,n.name),I(`${n.name} 환경이 적용되었습니다`,"success")}catch(r){I("프리셋 환경을 로드할 수 없습니다","error")}finally{A(!1)}break;case"gradient":e.background&&e.background.isTexture&&e.background.dispose();try{(null==(i=null==p?void 0:p.envRT)?void 0:i.dispose)&&p.envRT.dispose()}catch{}e.background=new b(8900331),e.environment=null,s({currentHDRI:{name:"기본 스카이박스",type:"gradient"}});break;case"none":e.background&&e.background.isTexture&&e.background.dispose();try{(null==(a=null==p?void 0:p.envRT)?void 0:a.dispose)&&p.envRT.dispose()}catch{}e.background=new b(2763306),e.environment=null,s({currentHDRI:{name:"기본 배경",type:"none"}})}})(t.type,t),title:t.description,children:[i.jsx("div",{className:"hdri-thumbnail",children:i.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:["preset"===t.type&&i.jsx("path",{d:"M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V10.5L17.5,9L16,10.5L14.5,9L11.5,12L9,9.5L7.5,11L6,9.5L5,10.5V5H19Z"}),"gradient"===t.type&&i.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}),"none"===t.type&&i.jsx("path",{d:"M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"})]})}),i.jsx("div",{className:"hdri-label",children:t.name})]},n))})]}),p&&"none"!==p.type&&i.jsx("div",{className:"section-divider"}),p&&"none"!==p.type&&i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"환경 설정"}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"강도"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:g,onChange:t=>{return n=parseFloat(t.target.value),s({hdriIntensity:n}),void(e&&p&&p.texture&&"none"!==p.type&&(e.backgroundIntensity=n,e.environmentIntensity=n));var n},className:"hdri-slider"}),i.jsx("span",{className:"slider-value",children:g.toFixed(1)})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"회전"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:m,onChange:t=>(n=>{var i,a,r;if(s({hdriRotation:n}),e&&p&&p.texture&&"none"!==p.type){const o=n*Math.PI/180;try{null==(a=null==(i=p.texture.center)?void 0:i.set)||a.call(i,.5,.5)}catch{}if(p.texture.rotation=o,p.texture.needsUpdate=!0,l){try{(null==(r=p.envRT)?void 0:r.dispose)&&p.envRT.dispose()}catch{}try{const t=new Ut(l);t.compileEquirectangularShader();const n=t.fromEquirectangular(p.texture);t.dispose(),e.environment=n.texture,s({currentHDRI:{...p,envRT:n}})}catch(t){e.environment=p.texture,s({currentHDRI:{...p,envRT:null}})}}else e.environment=p.texture}})(parseFloat(t.target.value)),className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[m,"°"]})]})]})]}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"태양 조명"}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"활성화"}),i.jsx("input",{type:"checkbox",checked:f,onChange:e=>{return t=e.target.checked,void s({sunLightEnabled:t});var t},className:"setting-checkbox"})]}),f&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"시간"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"24",step:"0.5",value:y,onChange:e=>j(Number(e.target.value)),className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[y,"시"]})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"강도"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"20",step:"0.1",value:v,onChange:e=>{return t=Number(e.target.value),s({sunIntensity:t}),void(a&&(a.intensity=t));var t},className:"hdri-slider"}),i.jsx("span",{className:"slider-value",children:v})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"방위각"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:w,onChange:e=>{return t=Number(e.target.value),s({sunAzimuth:t}),void(a&&Q(a,t,C));var t},className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[w,"°"]})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"고도각"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"90",step:"1",value:C,onChange:e=>{return t=Number(e.target.value),s({sunElevation:t}),void(a&&Q(a,w,t));var t},className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[C,"°"]})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"색상"}),i.jsx("div",{className:"color-preview",style:{backgroundColor:x,padding:"4px 8px",borderRadius:"4px",fontSize:"12px",textAlign:"center"},children:y<6||y>20?"밤":y<10?"아침":y<16?"낮":"저녁"})]})]})]})]}),d&&i.jsx("div",{className:`hdri-toast hdri-toast-${d.type}`,children:d.message})]})}const No=({x:e,y:t,isVisible:n,onClose:s,selectedObject:a,onAddToLibrary:o,onAddComment:l,hitInfo:c})=>{const A=r.useRef(null);if(r.useEffect(()=>{const e=e=>{A.current&&!A.current.contains(e.target)&&s()},t=e=>{"Escape"===e.key&&s()};if(n)return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[n,s]),!n)return null;const d=Math.min(e,window.innerWidth-200),h=Math.min(t,window.innerHeight-150);return i.jsxs("div",{ref:A,className:"context-menu",style:{left:d,top:h},children:[i.jsx("div",{className:"context-menu-header",children:i.jsx("span",{children:"메쉬 옵션"})}),i.jsxs("div",{className:"context-menu-items",children:[i.jsxs("button",{className:"context-menu-item "+(c?"":"disabled"),disabled:!c,onClick:()=>{c&&l&&l(c),s()},children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M9,22V19H5A2,2 0 0,1 3,17V5A2,2 0 0,1 5,3H19A2,2 0 0,1 21,5V17A2,2 0 0,1 19,19H13L9,22M7,7V9H17V7H7M7,11V13H14V11H7Z"})}),i.jsx("span",{children:"코멘트"})]}),i.jsxs("button",{className:"context-menu-item",onClick:()=>{a&&o&&o(a),s()},children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})}),i.jsx("span",{children:"라이브러리에 추가"})]}),i.jsxs("button",{className:"context-menu-item disabled",disabled:!0,children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"})}),i.jsx("span",{children:"복제 (곧 제공)"})]}),i.jsxs("button",{className:"context-menu-item disabled",disabled:!0,children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})}),i.jsx("span",{children:"삭제 (곧 제공)"})]})]}),a&&i.jsx("div",{className:"context-menu-info",children:i.jsx("span",{className:"selected-object-name",children:a.name||"이름 없음"})})]})},_o=({message:e,type:t="info",isVisible:n,onClose:s})=>{if(r.useEffect(()=>{if(n){const e=setTimeout(()=>{s()},3e3);return()=>clearTimeout(e)}},[n,s]),!n)return null;return i.jsxs("div",{className:`toast toast-${t} ${n?"toast-visible":""}`,children:[i.jsx("div",{className:"toast-icon",children:(()=>{switch(t){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}})()}),i.jsx("div",{className:"toast-message",children:e}),i.jsx("button",{className:"toast-close",onClick:s,children:"×"})]})};function Go({editorControls:e,postProcessingManager:t,onAddToLibrary:n,showInspector:s,onToggleInspector:a}){const{selectedObject:o,transformMode:l,objects:c,walls:A,savedObjects:d,selectedIds:h,setSelectedIds:u,setParent:p,reorderSiblings:g,setTransformMode:m,addWall:b,addObject:f,removeObject:v,removeObjectById:y,addAsset:w,saveMap:C,loadMap:x,clearMap:I,toggleObjectVisibility:S,toggleObjectFreeze:Q,renameObject:j,setSelectedObject:M,annotations:D,addAnnotation:T,removeAnnotation:R}=Ys();Ys(e=>e.viewReady),Ys(e=>e.uiReady),Ys(e=>e.envReady),r.useState(""),r.useState("");const O=Ys(e=>e.showLibrary),k=Ys(e=>e.showAssets),L=Ys(e=>e.showHDRI),P=Ys(e=>e.isPostProcessingPanelOpen),F=Ys(e=>e.setShowLibrary),N=Ys(e=>e.setShowAssets),_=Ys(e=>e.setShowHDRI),G=Ys(e=>e.setIsPostProcessingPanelOpen),[U,z]=r.useState({isVisible:!1,x:0,y:0,hit:null}),[H,q]=r.useState(0);r.useState({message:"",type:"info",isVisible:!1});r.useEffect(()=>{const t=t=>{(t=>{var n,i,s;t.preventDefault();let a=null;try{if(e&&e.raycastMeshAtNDC){const r=null==(s=null==(i=null==(n=e.renderer)?void 0:n.domElement)?void 0:i.getBoundingClientRect)?void 0:s.call(i);if(r){const n=new E((t.clientX-r.left)/r.width*2-1,-(t.clientY-r.top)/r.height*2+1),i=e.raycastMeshAtNDC(n);i&&i.point&&(a={point:i.point.clone(),object:i.object})}}}catch{}z({isVisible:!0,x:t.clientX,y:t.clientY,hit:a})})(t.detail.originalEvent)};return window.addEventListener("editorContextMenu",t),()=>{window.removeEventListener("editorContextMenu",t)}},[o]);const K=t=>{if(!t)return e&&e.deselectAllObjects(),void M(null);if(e){const n=e.findObjectById(t.id);n&&e.selectObject(n)}M((null==t?void 0:t.id)??t)},W=r.useRef([]),V=r.useRef(null),Y=()=>{let e=document.querySelector(".annotation-layer");if(e||(e=document.createElement("div"),e.className="annotation-layer",Object.assign(e.style,{position:"fixed",left:0,top:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:30}),document.body.appendChild(e)),!V.current){let e=document.querySelector(".annotation-line-layer");e||(e=document.createElement("canvas"),e.className="annotation-line-layer",Object.assign(e.style,{position:"fixed",left:0,top:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:29}),document.body.appendChild(e)),V.current=e}return{layer:e,lineCanvas:V.current}},J=t=>{var n,i;const s=null==(i=null==(n=null==e?void 0:e.cameraController)?void 0:n.getCamera)?void 0:i.call(n),a=null==e?void 0:e.renderer;if(!s||!a)return null;const r=a.domElement.getBoundingClientRect(),o=t.clone().project(s);return{x:r.left+.5*(o.x+1)*r.width,y:r.top+(1-.5*(o.y+1))*r.height,z:o.z}},X=()=>{var t,n,i,s,a;const{layer:r,lineCanvas:o}=Y();if(!(null==(n=null==(t=null==e?void 0:e.cameraController)?void 0:t.getCamera)?void 0:n.call(t))||!(null==e?void 0:e.renderer))return;const l=o.getContext("2d"),c=o.width=window.innerWidth,A=o.height=window.innerHeight;l.clearRect(0,0,c,A),l.strokeStyle="rgba(255,255,255,0.9)",l.lineWidth=1.25,l.beginPath();const d=null==e?void 0:e.scene,h=[];for(const u of W.current){if((!u.targetObject||!u.targetObject.parent)&&u.ownerId&&(null==e?void 0:e.findObjectById))try{u.targetObject=e.findObjectById(u.ownerId)}catch{}let t=!1,n=u.targetObject;for(;n;){if(n===d){t=!0;break}n=n.parent}if(!u.targetObject||!t){try{(null==(i=u.el)?void 0:i.style)&&(u.el.style.display="none")}catch{}h.push(u);continue}try{null==(a=(s=u.targetObject).updateMatrixWorld)||a.call(s,!0)}catch{}const r=u.localPoint.clone();u.targetObject.localToWorld(r);const o=J(r);if(!o){h.push(u);continue}const c=u.el,A=20,p=-20;c.style.left=`${Math.round(o.x+A)}px`,c.style.top=`${Math.round(o.y+p)}px`;try{c.style.display="block"}catch{}const g=c.getBoundingClientRect();l.moveTo(o.x,o.y),l.lineTo(g.left,g.top),h.push(u)}l.stroke(),W.current=h};r.useEffect(()=>{let e;const t=()=>{X(),e=requestAnimationFrame(t)};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[e]);return r.useEffect(()=>{var t,n,i;const s=Array.isArray(D)?D:[],a=new Map(W.current.map(e=>[e.id,e])),r=new Set,{layer:o}=Y();for(const c of s)if(r.add(c.id),a.has(c.id))try{a.get(c.id).el.querySelector(".annotation-text").textContent=String(c.text||"")}catch{}else{const s=document.createElement("div");s.className="annotation-box",s.innerHTML='<div class="annotation-text"></div><button class="annotation-close">✕</button>';s.querySelector(".annotation-text").textContent=String(c.text||""),Object.assign(s.style,{position:"fixed",minWidth:"180px",maxWidth:"260px",padding:"8px 10px",background:"rgba(0,0,0,0.66)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.35)",fontSize:"12px",lineHeight:"1.4",pointerEvents:"auto",display:"none"});const a=s.querySelector(".annotation-close");Object.assign(a.style,{position:"absolute",top:"4px",right:"6px",border:"none",background:"transparent",color:"#fff",cursor:"pointer"}),o.appendChild(s);const r=c.ownerId&&(null==e?void 0:e.findObjectById)?e.findObjectById(c.ownerId):null,l={id:c.id,ownerId:c.ownerId??null,targetObject:r||null,localPoint:new B((null==(t=c.local)?void 0:t.x)||0,(null==(n=c.local)?void 0:n.y)||0,(null==(i=c.local)?void 0:i.z)||0),el:s},A=()=>{try{s.remove()}catch{}W.current=W.current.filter(e=>e.id!==c.id);try{null==R||R(c.id)}catch{}X()};a.addEventListener("click",A),W.current.push(l)}const l=[];for(const e of W.current)if(r.has(e.id))l.push(e);else try{e.el.remove()}catch{}W.current=l,X()},[D,e]),i.jsxs("div",{className:"editor-ui",children:[i.jsx("div",{className:"tool-panel",children:i.jsxs("div",{className:"tool-section",children:[i.jsx("button",{className:"tool-btn assets-btn "+(k?"active":""),onClick:()=>{const e=!k;N(e),e&&(O&&F(!1),P&&G(!1),L&&_(!1))},title:"기본 에셋",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2L13.09,8.26L22,9L14.74,14.74L17.18,22L12,18.5L6.82,22L9.26,14.74L2,9L10.91,8.26L12,2Z"})})}),i.jsx("button",{className:"tool-btn library-btn "+(O?"active":""),onClick:()=>{const e=!O;F(e),e&&(k&&N(!1),P&&G(!1),L&&_(!1))},title:"라이브러리",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M4,6H20V8H4V6M4,11H20V13H4V11M4,16H20V18H4V16Z"})})}),i.jsx("button",{className:"tool-btn post-processing-btn "+(P?"active":""),onClick:()=>{const e=!P;G(e),e&&(O&&F(!1),k&&N(!1),L&&_(!1))},title:"포스트프로세싱 효과",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M9,12L11,14L15,10L20,15H4L9,12Z"})})}),i.jsx("button",{className:"tool-btn hdri-btn "+(L?"active":""),onClick:()=>{const e=!L;_(e),e&&(O&&F(!1),k&&N(!1),P&&G(!1))},title:"HDRI 환경",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,2L14.39,5.42C13.65,5.15 12.84,5 12,5C11.16,5 10.35,5.15 9.61,5.42L12,2M3.34,7L7.5,6.65C6.9,7.16 6.36,7.78 5.94,8.5C5.5,9.24 5.25,10 5.11,10.79L3.34,7M3.36,17L5.12,13.23C5.26,14 5.53,14.78 5.95,15.5C6.37,16.24 6.91,16.86 7.5,17.37L3.36,17M20.65,7L18.88,10.79C18.74,10 18.47,9.23 18.05,8.5C17.63,7.78 17.1,7.15 16.5,6.64L20.65,7M20.64,17L16.5,17.36C17.09,16.85 17.62,16.22 18.04,15.5C18.46,14.77 18.73,14 18.87,13.21L20.64,17Z"})})}),P&&i.jsx(Po,{postProcessingManager:t,onClose:()=>G(!1)})]})}),k&&i.jsx(Lo,{onAssetDrop:(e,t)=>{const n=e=>`${e||"obj"}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;let i;switch(e.type){case"start_position":i={id:n(e.name||e.type),type:"start_position",name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}};break;case"directional_light":i={id:n(e.name||e.type),type:"directional_light",name:e.name,position:t||{x:5,y:10,z:5},rotation:{x:-Math.PI/4,y:Math.PI/4,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,castShadow:!0};break;case"point_light":i={id:n(e.name||e.type),type:"point_light",name:e.name,position:t||{x:0,y:3,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,distance:10,decay:2};break;case"spot_light":i={id:n(e.name||e.type),type:"spot_light",name:e.name,position:t||{x:0,y:5,z:0},rotation:{x:-Math.PI/2,y:0,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,distance:10,angle:Math.PI/6,penumbra:.1};break;case"ambient_light":i={id:n(e.name||e.type),type:"ambient_light",name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},intensity:.3,color:4210752};break;case"audio_source":i={id:n(e.name||e.type),type:"audio_source",name:e.name,position:t||{x:0,y:1,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},volume:1,loop:!1,autoplay:!1};break;default:i={id:n(e.name||e.type),type:e.type,name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}f(i),setTimeout(()=>{M(i.id)},100)},onClose:()=>N(!1)}),O&&i.jsx(ko,{onObjectDrop:async(e,t)=>{const n=e=>`${e||"obj"}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;let i;i="library"===e.type?{id:n(e.name||e.id||"library"),type:"glb",url:e.glbUrl,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name}:"custom"===e.type?{id:n(e.name||e.id||"custom"),type:"glb",customMeshId:e.id,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name||"Custom Mesh"}:{id:n(e.name||e.type),type:e.type||"basic",geometry:e.geometry,params:e.params,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name},f(i),setTimeout(()=>{M(i.id)},100)},onClose:()=>F(!1),forceRefresh:H}),L&&i.jsx(Fo,{scene:null==e?void 0:e.scene,onClose:()=>_(!1)}),i.jsx(No,{x:U.x,y:U.y,isVisible:U.isVisible,onClose:()=>{z({isVisible:!1,x:0,y:0,hit:null})},selectedObject:o,onAddToLibrary:n,onAddComment:t=>{const n=prompt("코멘트를 입력하세요:");if(!n)return;if(!(null==t?void 0:t.object)||!(null==t?void 0:t.point))return;const{rootId:i,rootObj:s}=(t=>{var n,i;let s=null,a=t;for(;a;){if(null==(n=a.userData)?void 0:n.id){s=a.userData.id;break}a=a.parent}s||(s=(null==(i=t.userData)?void 0:i.ownerId)??null);return{rootId:s,rootObj:s&&(null==e?void 0:e.findObjectById)?e.findObjectById(s):null}})(t.object);if(!i||!s)return;const a=t.point.clone();try{s.worldToLocal(a)}catch{}const r=`ann_${Date.now()}_${Math.random().toString(36).slice(2,7)}`;try{null==T||T({id:r,ownerId:i,text:n,local:{x:a.x,y:a.y,z:a.z}})}catch{}const{layer:o}=Y(),l=document.createElement("div");l.className="annotation-box",l.innerHTML='<div class="annotation-text"></div><button class="annotation-close">✕</button>';l.querySelector(".annotation-text").textContent=n,Object.assign(l.style,{position:"fixed",minWidth:"180px",maxWidth:"260px",padding:"8px 10px",background:"rgba(0,0,0,0.66)",color:"#fff",border:"1px solid rgba(255,255,255,0.2)",borderRadius:"6px",boxShadow:"0 2px 8px rgba(0,0,0,0.35)",fontSize:"12px",lineHeight:"1.4",pointerEvents:"auto"});const c=l.querySelector(".annotation-close");Object.assign(c.style,{position:"absolute",top:"4px",right:"6px",border:"none",background:"transparent",color:"#fff",cursor:"pointer"}),o.appendChild(l),W.current.push({id:r,ownerId:i,targetObject:s,localPoint:a.clone(),el:l});c.addEventListener("click",()=>{try{l.remove()}catch{}W.current=W.current.filter(e=>e.id!==r);try{null==R||R(r)}catch{}X()}),X()},hitInfo:U.hit}),s&&i.jsx(Oo,{objects:c,walls:A,selectedIds:h,setSelectedIds:u,setParent:p,reorderSiblings:g,selectedObject:o,onObjectVisibilityToggle:e=>{S(e)},onObjectFreezeToggle:e=>{Q(e)},onObjectSelect:K,onObjectRemove:t=>{if(e&&e.objectSelector){if(e.objectSelector.transformControls)try{e.objectSelector.transformControls.detach()}catch(n){}try{const n=e.findObjectById(t.id);n&&e.objectSelector.removeSelectionOutline(n)}catch(n){}}if(o&&o.id===t.id){if(e)try{e.deselectAllObjects()}catch(n){}M(null)}setTimeout(()=>{try{null==y||y(null==t?void 0:t.id)}catch(n){}},50)},onObjectFocus:t=>{if(K(t),e){const n=e.findObjectById(t.id);n&&e.focusOnObject(n)}},onObjectRename:(e,t)=>{if(j(e.id,t),(null==o?void 0:o.id)===e.id){const e={...o,name:t};M(e)}},onContextMenu:(e,t)=>{e.preventDefault(),K(t),z({isVisible:!0,x:e.clientX,y:e.clientY})},editorControls:e,postProcessingManager:t,onObjectUpdate:t=>{if(e&&t.id){const n=e.findObjectById(t.id);n&&(t.position&&n.position.set(t.position.x,t.position.y,t.position.z),t.rotation&&n.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),t.scale&&n.scale.set(t.scale.x,t.scale.y,t.scale.z),t.name&&(n.name=t.name))}(null==o?void 0:o.id)===t.id&&M(t)},onClose:()=>a(!1)})]})}const Uo=({onMenuAction:e})=>{const[t,n]=r.useState(null),s=e=>{e.target.closest(".menu-bar")||n(null)};return l.useEffect(()=>(document.addEventListener("click",s),()=>{document.removeEventListener("click",s)}),[]),i.jsx("div",{className:"menu-bar",children:i.jsx("div",{className:"menu-items",children:[{title:"파일",items:[{label:"새 맵",action:"new-map",shortcut:"Ctrl+N"},{label:"불러오기",action:"load-map",shortcut:"Ctrl+O"},{label:"저장하기",action:"save-map",shortcut:"Ctrl+S"},{type:"separator"},{label:"임포트",action:"import"},{label:"익스포트",action:"export"},{type:"separator"},{label:"나가기",action:"exit",shortcut:"Alt+F4"}]},{title:"에디터",items:[{label:"실행 취소",action:"undo",shortcut:"Ctrl+Z"},{label:"다시 실행",action:"redo",shortcut:"Ctrl+Y"},{type:"separator"},{label:"복사",action:"copy",shortcut:"Ctrl+C"},{label:"붙여넣기",action:"paste",shortcut:"Ctrl+V"},{label:"삭제",action:"delete",shortcut:"Delete"},{type:"separator"},{label:"전체 선택",action:"select-all",shortcut:"Ctrl+A"},{label:"선택 해제",action:"deselect-all",shortcut:"Ctrl+D"}]},{title:"윈도우",items:[{label:"뷰포트 리셋",action:"reset-viewport"},{label:"카메라 리셋",action:"reset-camera"},{type:"separator"},{label:"그리드 토글",action:"toggle-grid"},{label:"통계 표시",action:"toggle-stats"},{type:"separator"},{label:"인스펙터",action:"toggle-inspector",shortcut:"I"},{type:"separator"},{label:"전체화면",action:"fullscreen",shortcut:"F11"}]},{title:"정보",items:[{label:"단축키",action:"show-shortcuts"},{label:"도움말",action:"show-help",shortcut:"F1"},{type:"separator"},{label:"프로그램 정보",action:"about"}]}].map((s,a)=>i.jsxs("div",{className:"menu-item "+(t===a?"active":""),onClick:()=>{var e;n(t===(e=a)?null:e)},children:[i.jsx("span",{className:"menu-title",children:s.title}),t===a&&i.jsx("div",{className:"dropdown-menu",children:s.items.map((t,s)=>"separator"===t.type?i.jsx("div",{className:"menu-separator"},s):i.jsxs("div",{className:"dropdown-item",onClick:i=>{var s;i.stopPropagation(),s=t.action,n(null),e&&e(s)},children:[i.jsx("span",{className:"item-label",children:t.label}),t.shortcut&&i.jsx("span",{className:"item-shortcut",children:t.shortcut})]},s))})]},a))})})};function zo({editorControls:e}){const{isWireframe:t,isGridSnap:n,isGridVisible:s,gizmoSpace:a,gizmoSize:o,snapMove:l,snapRotateDeg:c,snapScale:A,cameraPanSpeed:d,cameraOrbitSpeed:h,cameraZoomSpeed:u,toggleWireframe:p,toggleGridSnap:g,toggleGridVisible:m,toggleGizmoSpace:b,setGizmoSize:f,setSnapMove:v,setSnapRotateDeg:y,setSnapScale:w,setCameraPanSpeed:C,setCameraOrbitSpeed:x,setCameraZoomSpeed:I}=Ys(),E=Ys(e=>e.isViewGizmoSettingsOpen),S=Ys(e=>e.setIsViewGizmoSettingsOpen),B=Ys(e=>e.isPostProcessingEnabled),Q=Ys(e=>e.togglePostProcessingEnabled),j=Ys(e=>e.safeMode),M=Ys(e=>e.toggleSafeMode),D=Ys(e=>e.setSafeModePixelRatio),T=(e,t=80)=>{let n;return(...i)=>{n&&clearTimeout(n),n=setTimeout(()=>e(...i),t)}},R=r.useMemo(()=>T(()=>{var t;try{null==(t=null==e?void 0:e.updateWireframe)||t.call(e)}catch{}},80),[e]),O=r.useMemo(()=>T(()=>{var t;try{null==(t=null==e?void 0:e.updateGridSnap)||t.call(e)}catch{}},80),[e]),k=r.useMemo(()=>T(()=>{var t,n;try{null==(n=null==(t=null==e?void 0:e.objectSelector)?void 0:t.updateGizmoSize)||n.call(t)}catch{}},80),[e]),L=E;return r.useEffect(()=>{k()},[k,o]),r.useEffect(()=>{O()},[O,l,c,A,n]),r.useEffect(()=>{var t,n,i,s,a;if(e){try{null==(t=e.updateWireframe)||t.call(e)}catch{}try{null==(n=e.updateGridSnap)||n.call(e)}catch{}try{null==(i=e.updateGizmoSpace)||i.call(e)}catch{}try{null==(a=null==(s=e.objectSelector)?void 0:s.updateGizmoSize)||a.call(s)}catch{}}},[e]),i.jsxs("div",{className:"viewport-controls",children:[i.jsx("button",{className:"viewport-control-btn "+(s?"active":""),onClick:()=>{var t;m();try{null==(t=null==e?void 0:e.toggleGrid)||t.call(e)}catch{}},title:"그리드 표시/숨기기",children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M3 3h18v18H3z"}),i.jsx("path",{d:"M8 3v18"}),i.jsx("path",{d:"M13 3v18"}),i.jsx("path",{d:"M18 3v18"}),i.jsx("path",{d:"M3 8h18"}),i.jsx("path",{d:"M3 13h18"}),i.jsx("path",{d:"M3 18h18"})]})}),i.jsx("button",{className:"viewport-control-btn "+("local"===a?"active":""),onClick:()=>{var t;b();try{null==(t=null==e?void 0:e.updateGizmoSpace)||t.call(e)}catch{}},title:`기즈모 좌표계 (${"world"===a?"월드":"로컬"})`,children:i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:"world"===a?i.jsxs(i.Fragment,{children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M12 3v18"}),i.jsx("path",{d:"M3 12h18"}),i.jsx("path",{d:"M8 8l8 8"}),i.jsx("path",{d:"M16 8l-8 8"})]}):i.jsxs(i.Fragment,{children:[i.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),i.jsx("path",{d:"M12 4v16"}),i.jsx("path",{d:"M4 12h16"}),i.jsx("circle",{cx:"12",cy:"12",r:"2"})]})})}),i.jsx("button",{className:"viewport-control-btn "+(L?"active":""),onClick:()=>S(!E),title:"뷰/기즈모 설정",children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M12 1v22"}),i.jsx("path",{d:"M5 5h14"}),i.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),L&&i.jsxs("div",{className:"viewport-settings-pop",children:[i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"포스트프로세싱"}),i.jsx("input",{type:"checkbox",checked:B,onChange:Q})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"안전모드"}),i.jsx("input",{type:"checkbox",checked:!!(null==j?void 0:j.enabled),onChange:()=>M()})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"픽셀 비율"}),i.jsx("input",{type:"number",min:"0.5",max:"2",step:"0.05",value:Number((null==j?void 0:j.pixelRatio)??1).toFixed(2),disabled:!(null==j?void 0:j.enabled),onChange:e=>D(parseFloat(e.target.value))})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"와이어프레임"}),i.jsx("input",{type:"checkbox",checked:t,onChange:()=>{p(),R()}})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"그리드 스냅"}),i.jsx("input",{type:"checkbox",checked:n,onChange:()=>{g(),O()}})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"기즈모 크기"}),i.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:o,onChange:e=>f(e.target.value)}),i.jsx("span",{children:Number(o).toFixed(1)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"이동 스냅"}),i.jsx("input",{type:"number",step:"0.1",value:l,onChange:e=>v(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"회전 스냅(도)"}),i.jsx("input",{type:"number",step:"1",value:c,onChange:e=>y(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"크기 스냅"}),i.jsx("input",{type:"number",step:"0.01",value:A,onChange:e=>w(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{style:{opacity:.8},children:"카메라 Pan"}),i.jsx("input",{type:"number",step:"1",value:d,onChange:e=>C(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{style:{opacity:.8},children:"카메라 Orbit"}),i.jsx("input",{type:"number",step:"1",value:h,onChange:e=>x(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{style:{opacity:.8},children:"카메라 Zoom"}),i.jsx("input",{type:"number",step:"0.05",value:u,onChange:e=>I(e.target.value)})]}),i.jsx("div",{className:"hint",children:"스냅은 그리드 스냅이 활성화되어야 적용됩니다."})]})]})}const Ho="새 맵을 만들면 현재 작업이 사라집니다. 계속하시겠습니까?",qo="익스포트 기능은 준비 중입니다.",Ko="에디터를 종료하시겠습니까?",Wo="실행 취소 기능은 준비 중입니다.",Vo="다시 실행 기능은 준비 중입니다.",Yo="전체 선택 기능은 준비 중입니다.",Jo="선택 해제 기능은 준비 중입니다.",Xo="뷰포트 리셋 기능은 준비 중입니다.",Zo="카메라 리셋: 키패드 0번을 누르세요.",$o="통계 표시 기능은 준비 중입니다.",el="단축키 정보:\nW/E/R: 기즈모 모드\nF: 오브젝트 포커스\nESC: 선택 해제\n키패드 0: 카메라 리셋\n키패드 5: 카메라 모드 토글\n키패드 1/3/7/9: 뷰 변경",tl="도움말:\n• 좌클릭: 오브젝트 선택\n• Shift+좌클릭: 다중 선택\n• 중간클릭: 팬 이동\n• Alt+중간클릭: 카메라 회전\n• 마우스 휠: 줌",nl="ThirdPersonTreeJS Editor\nVersion 1.0.0\n3D 에디터 프로그램";function il(){const e=Kt(),{clearMap:t,saveMap:n,loadMap:s,addObject:a,setSelectedObject:o,addCustomMesh:l,selectedObject:c,selectedIds:A,toggleGridVisible:d,scene:h,hdriSettings:u,sunLightRef:p,setSunLightRef:g,saveHDRISettings:m,objects:f,setSelectedIds:v,setParent:y,reorderSiblings:C,copyObject:x,pasteObject:I,deleteSelectedObject:E,hasClipboardData:Q}=Ys(),[j,M]=r.useState(null),[D,T]=r.useState([]),[R,O]=r.useState(!1),[k,L]=r.useState(""),[P,F]=r.useState(""),[N,_]=r.useState(null),[G,U]=r.useState(!0),z=r.useRef(null),[H,q]=r.useState(null),K=r.useRef(null),W=r.useRef(jo()),V=r.useRef(new Set);r.useEffect(()=>{let e=!1;return(async()=>{try{const t=await W.current.getCustomMeshes();if(!e&&0===(Ys.getState().customMeshes||[]).length){const e=t.map(e=>"string"==typeof e.thumbnail&&e.thumbnail.startsWith("blob:")?e.thumbnail:null).filter(Boolean);V.current=new Set(e),Ys.getState().loadCustomMeshes(t)}}catch{}})(),()=>{e=!0;for(const e of V.current)try{URL.revokeObjectURL(e)}catch{}V.current.clear()}},[]),r.useEffect(()=>{const e=e=>{const{message:t,type:n="info",duration:i=3e3}=e.detail||{};t&&(_({message:t,type:n}),i>0&&setTimeout(()=>_(null),i))};return window.addEventListener("appToast",e),()=>window.removeEventListener("appToast",e)},[]),r.useEffect(()=>{h&&u.sunLightEnabled&&!p?Y():h&&!u.sunLightEnabled&&p&&X()},[h,u.sunLightEnabled,p]),r.useEffect(()=>{if(!h||!p||!u.sunLightEnabled)return;if(!(()=>{let e=!1;return h.traverse(t=>{t===p&&(e=!0)}),e})())try{h.add(p)}catch{}},[h,p,u.sunLightEnabled]),r.useEffect(()=>{h&&u.currentHDRI&&"none"===u.currentHDRI.type&&(h.background=new b(2763306),h.environment=null)},[h,u.currentHDRI]),r.useEffect(()=>{const e=e=>{if(null==e?void 0:e.defaultPrevented)return;const t=null==e?void 0:e.target,n=null==t?void 0:t.tagName;if("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n&&!(null==t?void 0:t.isContentEditable)&&!(null==e?void 0:e.repeat)){if("i"!==e.key&&"I"!==e.key||e.ctrlKey||e.altKey||e.shiftKey||(e.preventDefault(),U(e=>!e)),e.ctrlKey&&("c"===e.key||"C"===e.key)){if(e.preventDefault(),!c)return _({message:"복사할 객체를 먼저 선택해주세요",type:"warning"}),void setTimeout(()=>_(null),2e3);requestAnimationFrame(()=>{var e;try{let t=null;if(z.current){const n=c.id||c;t=z.current.findObjectById(n)||(null==(e=z.current.selectedObjects)?void 0:e[0])||null}t?(x(t),_({message:`"${t.name}"이(가) 복사되었습니다`,type:"success"})):(x(c),_({message:`"${c.name}"이(가) 복사되었습니다`,type:"success"}))}finally{setTimeout(()=>_(null),2e3)}})}!e.ctrlKey||"v"!==e.key&&"V"!==e.key||(e.preventDefault(),requestAnimationFrame(()=>{try{if(Q()){const e=I();_(e?{message:`"${e.name}"이(가) 붙여넣기되었습니다`,type:"success"}:{message:"붙여넣기에 실패했습니다",type:"error"})}else _({message:"붙여넣을 객체가 클립보드에 없습니다",type:"warning"})}finally{setTimeout(()=>_(null),2e3)}}))}};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[c,f,x,I,E,Q,_]);const Y=()=>{if(!h)return;const e=new w(u.sunColor,u.sunIntensity),t=u.sunAzimuth*Math.PI/180,n=u.sunElevation*Math.PI/180,i=Math.sin(t)*Math.cos(n)*100,s=100*Math.sin(n),a=Math.cos(t)*Math.cos(n)*100;e.position.set(i,s,a),e.lookAt(0,0,0),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.name="sunLight",e.userData=e.userData||{},e.userData.isSystemObject=!0,g(e),h.add(e)},X=()=>{h&&p&&(h.remove(p),p.dispose&&p.dispose(),g(null))};r.useEffect(()=>{h&&setTimeout(()=>m(),100)},[u,h,m]);const Z=e=>{var t,n,i,s,a;if(e&&"object"==typeof e)try{const r=z.current,o=window.__blenderControls;if(e.camera){const s=(null==(t=null==r?void 0:r.getCamera)?void 0:t.call(r))||(null==o?void 0:o.camera);s&&(Array.isArray(e.camera.position)&&s.position.fromArray(e.camera.position),Array.isArray(e.camera.up)&&s.up.fromArray(e.camera.up),"number"==typeof e.camera.fov&&(s.fov=e.camera.fov),"number"==typeof e.camera.near&&(s.near=e.camera.near),"number"==typeof e.camera.far&&(s.far=e.camera.far),null==(n=s.updateProjectionMatrix)||n.call(s),o&&Array.isArray(e.camera.target)?o.target.fromArray(e.camera.target):r&&Array.isArray(e.camera.target)&&(null==(i=r.setCameraTarget)||i.call(r,(new B).fromArray(e.camera.target))))}if(e.viewOptions){const t=Ys.getState();if("boolean"==typeof e.viewOptions.isWireframe&&t.isWireframe!==e.viewOptions.isWireframe&&Ys.getState().toggleWireframe(),"boolean"==typeof e.viewOptions.isGridSnap&&t.isGridSnap!==e.viewOptions.isGridSnap&&Ys.getState().toggleGridSnap(),"boolean"==typeof e.viewOptions.isGridVisible&&t.isGridVisible!==e.viewOptions.isGridVisible&&Ys.getState().toggleGridVisible(),e.viewOptions.gizmoSpace&&t.gizmoSpace!==e.viewOptions.gizmoSpace&&Ys.getState().toggleGizmoSpace(),Number.isFinite(e.viewOptions.gizmoSize)&&Ys.getState().setGizmoSize(e.viewOptions.gizmoSize),Number.isFinite(e.viewOptions.snapMove)&&Ys.getState().setSnapMove(e.viewOptions.snapMove),Number.isFinite(e.viewOptions.snapRotateDeg)&&Ys.getState().setSnapRotateDeg(e.viewOptions.snapRotateDeg),Number.isFinite(e.viewOptions.snapScale)&&Ys.getState().setSnapScale(e.viewOptions.snapScale),Number.isFinite(e.viewOptions.cameraPanSpeed)&&Ys.getState().setCameraPanSpeed(e.viewOptions.cameraPanSpeed),Number.isFinite(e.viewOptions.cameraOrbitSpeed)&&Ys.getState().setCameraOrbitSpeed(e.viewOptions.cameraOrbitSpeed),Number.isFinite(e.viewOptions.cameraZoomSpeed)&&Ys.getState().setCameraZoomSpeed(e.viewOptions.cameraZoomSpeed),"boolean"==typeof e.viewOptions.isPostProcessingEnabled){Ys.getState().isPostProcessingEnabled!==e.viewOptions.isPostProcessingEnabled&&Ys.getState().togglePostProcessingEnabled()}null==(s=null==r?void 0:r.applyInitialViewState)||s.call(r),o&&(null==(a=o.update)||a.call(o))}}catch{}},$=async()=>{var e,t,i,s;if("save"===j&&P.trim()){const e=(()=>{var e,t,n,i;const s={};try{const a=z.current,r=window.__blenderControls,o=(null==(e=null==a?void 0:a.getCamera)?void 0:e.call(a))||(null==r?void 0:r.camera);o&&(s.camera={position:o.position?o.position.toArray():null,target:r&&r.target?r.target.toArray():(null==(i=null==(n=null==(t=null==a?void 0:a.getCameraTarget)?void 0:t.call(a))?void 0:n.toArray)?void 0:i.call(n))||[0,0,0],up:o.up?o.up.toArray():null,fov:o.fov,near:o.near,far:o.far});const l=Ys.getState();s.viewOptions={isWireframe:l.isWireframe,isGridSnap:l.isGridSnap,isGridVisible:l.isGridVisible,gizmoSpace:l.gizmoSpace,gizmoSize:l.gizmoSize,snapMove:l.snapMove,snapRotateDeg:l.snapRotateDeg,snapScale:l.snapScale,cameraPanSpeed:l.cameraPanSpeed,cameraOrbitSpeed:l.cameraOrbitSpeed,cameraZoomSpeed:l.cameraZoomSpeed,isPostProcessingEnabled:l.isPostProcessingEnabled}}catch{}return s})();await n(P.trim(),e),alert(`맵이 "${P.trim()}"으로 저장되었습니다.`)}else if("load"===j&&P.trim()){if(await(null==(t=(e=Ys.getState()).loadMap)?void 0:t.call(e,P.trim()))){try{const e=await(null==(s=(i=Ys.getState()).getMapData)?void 0:s.call(i,P.trim()));e&&e.viewState&&Z(e.viewState)}catch{}try{window.__requestRender&&window.__requestRender()}catch{}alert(`맵 "${P.trim()}"을 불러왔습니다.`)}else alert(`맵 "${P.trim()}"을 찾을 수 없습니다.`)}M(null),F("")},ee=()=>{M(null),F("")},te=async()=>{var e,t;try{O(!0);const n=await(null==(t=(e=Ys.getState()).listMaps)?void 0:t.call(e));T(Array.isArray(n)?n:[])}catch{T([])}finally{O(!1)}};r.useEffect(()=>{"load"===j&&te()},[j]);r.useEffect(()=>{const e=e=>{const t=(null==e?void 0:e.detail)||{};"customMeshMissing"===(null==t?void 0:t.type)&&(_({message:`일부 커스텀 메쉬를 찾지 못했습니다. (id=${t.id})`,type:"warning"}),setTimeout(()=>_(null),2500))};return window.addEventListener("mapLoadWarning",e),()=>window.removeEventListener("mapLoadWarning",e)},[]);return i.jsxs("div",{className:"editor-page",children:[i.jsx(Uo,{onMenuAction:n=>{var i,s,r,l;switch(n){case"new-map":if(confirm(Ho)){t();try{null==(s=null==(i=z.current)?void 0:i.resetCamera)||s.call(i)}catch{}try{window.__blenderControls&&(window.__blenderControls.target.set(0,0,0),null==(l=(r=window.__blenderControls).update)||l.call(r))}catch{}}break;case"load-map":M("load");break;case"save-map":M("save");break;case"import":(()=>{const e=document.createElement("input");e.type="file",e.accept=".glb,.gltf",e.multiple=!1,e.onchange=e=>{const t=e.target.files[0];if(!t)return;const n=URL.createObjectURL(t),i=t.name.replace(/\.[^/.]+$/,""),s={id:Date.now(),type:"glb",file:n,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:i};a(s),setTimeout(()=>{o(s.id)},100)},e.click()})();break;case"export":alert(qo);break;case"exit":confirm(Ko)&&e("/");break;case"undo":alert(Wo);break;case"redo":alert(Vo);break;case"copy":if(c){const e=f.find(e=>e.id===c);e?(x(e),_({message:`"${e.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>_(null),2e3)):(_({message:"복사할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>_(null),2e3))}else _({message:"복사할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>_(null),2e3);break;case"paste":if(Q()){const e=I();e?(_({message:`"${e.name}"이(가) 붙여넣기되었습니다`,type:"success"}),setTimeout(()=>_(null),2e3)):(_({message:"붙여넣기에 실패했습니다",type:"error"}),setTimeout(()=>_(null),2e3))}else _({message:"붙여넣을 객체가 클립보드에 없습니다",type:"warning"}),setTimeout(()=>_(null),2e3);break;case"delete":if(c){const e=f.find(e=>e.id===c);if(e){const t=e.name;E(),_({message:`"${t}"이(가) 삭제되었습니다`,type:"success"}),setTimeout(()=>_(null),2e3)}else _({message:"삭제할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>_(null),2e3)}else _({message:"삭제할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>_(null),2e3);break;case"select-all":alert(Yo);break;case"deselect-all":alert(Jo);break;case"reset-viewport":alert(Xo);break;case"reset-camera":alert(Zo);break;case"toggle-grid":d();const n=Ys.getState().isGridVisible;z.current&&z.current.toggleGrid(),_({message:`그리드가 ${n?"표시":"숨김"} 되었습니다`,type:"info"}),setTimeout(()=>_(null),2e3);break;case"toggle-stats":alert($o);break;case"toggle-inspector":U(e=>!e),_({message:`인스펙터가 ${G?"숨김":"표시"} 되었습니다`,type:"info"}),setTimeout(()=>_(null),2e3);break;case"fullscreen":document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();break;case"show-shortcuts":alert(el);break;case"show-help":alert(tl);break;case"about":alert(nl)}}}),i.jsxs("div",{className:"editor-container",children:[i.jsx(Mo,{onEditorControlsReady:e=>{z.current=e,q(e)},onPostProcessingReady:e=>{K.current=e},onContextMenu:e=>{const t=new CustomEvent("editorContextMenu",{detail:{originalEvent:e}});window.dispatchEvent(t)}}),i.jsx(zo,{editorControls:H}),i.jsx(Go,{editorControls:H,postProcessingManager:K.current,onAddToLibrary:async e=>{var t,n,i;try{const s=prompt("메쉬 이름을 입력하세요:",e.name||"커스텀 메쉬");if(!s)return;const a=!0;_({message:"라이브러리에 추가 중...",type:"info"});const r=z.current;let o=null;const c=(null==r?void 0:r.selectedObjects)&&r.selectedObjects.length>0?[...r.selectedObjects]:[];if(c.length>1){const e=new J;e.name=s,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld(!0),c.forEach(t=>{try{t.updateMatrixWorld(!0);const n=t.clone(!0),i=(new S).copy(t.matrixWorld),s=new B,a=new ae,r=new B(1,1,1);i.decompose(s,a,r),n.position.copy(s),n.quaternion.copy(a),n.scale.copy(r),n.updateMatrix(),n.updateMatrixWorld(!0),e.add(n)}catch{}}),e.updateMatrixWorld(!0),o=e}else{const s=e&&"object"==typeof e?e.id??(null==(t=e.userData)?void 0:t.ownerId)??e:e;o=e&&"object"==typeof e&&e.isObject3D?e:r&&((null==(n=r.findObjectById)?void 0:n.call(r,s))||(null==(i=r.selectedObjects)?void 0:i[0]))||null}if(!o)return _({message:"내보낼 Three.js 객체를 찾지 못했습니다.",type:"error"}),void setTimeout(()=>_(null),4e3);const A=await W.current.addCustomMesh(o,s,{preserveTransform:a,compressToSingleMesh:!0});try{W.current.downloadCustomMesh(A)}catch{}if((Ys.getState().customMeshes||[]).some(e=>e.id===A.id)){if(!confirm("동일 ID의 커스텀 메쉬가 이미 있습니다.\n\n- 기존 항목을 덮어쓸까요?"))return _({message:"추가가 취소되었습니다(중복 ID).",type:"warning"}),void setTimeout(()=>_(null),2500);await Us(A);const e=(Ys.getState().customMeshes||[]).map(e=>e.id===A.id?A:e);Ys.getState().loadCustomMeshes(e)}else await l(A);window.dispatchEvent(new CustomEvent("customMeshAdded",{detail:A})),_({message:`"${s}" GLB가 내보내지고 라이브러리에 추가되었습니다! (그룹 피벗 항등/자식 월드 변환 유지)`,type:"success"}),setTimeout(()=>_(null),5e3)}catch(s){const e=s&&"NO_MESH_FOUND"===s.message?"선택한 오브젝트에서 내보낼 메시를 찾지 못했습니다. (스키닝/인스턴스/비메시 제외)":"라이브러리 추가에 실패했습니다.";_({message:e,type:"error"}),setTimeout(()=>_(null),5e3)}},showInspector:G,onToggleInspector:U})]}),j&&i.jsx("div",{className:"dialog-overlay",children:i.jsxs("div",{className:"dialog",children:[i.jsx("h3",{children:"save"===j?"맵 저장":"맵 불러오기"}),i.jsx("input",{type:"text",value:P,onChange:e=>F(e.target.value),placeholder:"맵 이름을 입력하세요",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&$(),"Escape"===e.key&&ee()}}),i.jsxs("div",{className:"dialog-buttons",children:[i.jsx("button",{type:"button",onClick:$,disabled:!!k,children:"확인"}),i.jsx("button",{type:"button",onClick:ee,disabled:!!k,children:"취소"})]}),"load"===j&&i.jsxs("div",{style:{marginTop:12,maxHeight:260,overflow:"auto",borderTop:"1px solid #444",paddingTop:10},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[i.jsx("strong",{children:"저장된 맵 목록"}),i.jsx("button",{onClick:te,disabled:R,style:{padding:"4px 8px"},children:R?"새로고침…":"새로고침"})]}),0===D.length&&i.jsx("div",{style:{opacity:.7},children:"저장된 맵이 없습니다."}),D.map(e=>i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,padding:"6px 0",borderBottom:"1px solid #333"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[i.jsx("span",{style:{fontWeight:600},children:e.name}),i.jsxs("span",{style:{fontSize:12,opacity:.8},children:["업데이트: ",e.updated_at?new Date(e.updated_at).toLocaleString():"-"]})]}),i.jsxs("div",{style:{display:"flex",gap:6},children:[i.jsx("button",{type:"button",onClick:()=>(async e=>{var t,n,i,s;if(e)try{if(L(e),_({message:`"${e}" 불러오는 중…`,type:"info"}),await(null==(n=(t=Ys.getState()).loadMap)?void 0:n.call(t,e))){try{const t=await(null==(s=(i=Ys.getState()).getMapData)?void 0:s.call(i,e));(null==t?void 0:t.viewState)&&Z(t.viewState)}catch{}try{window.__requestRender&&window.__requestRender()}catch{}M(null),F(""),_({message:`맵 "${e}"을 불러왔습니다.`,type:"success"}),setTimeout(()=>_(null),1800)}else _({message:`맵 "${e}"을 찾을 수 없습니다.`,type:"error"}),setTimeout(()=>_(null),1800)}catch(a){_({message:"불러오기 중 오류가 발생했습니다.",type:"error"}),setTimeout(()=>_(null),1800)}finally{L("")}})(e.name),disabled:!!k,style:{padding:"4px 8px"},children:k===e.name?"불러오는 중…":"불러오기"}),i.jsx("button",{type:"button",onClick:()=>(async e=>{var t,n;if(!e)return;if(!window.confirm(`정말 "${e}" 맵을 삭제하시겠습니까?`))return;await(null==(n=(t=Ys.getState()).deleteMap)?void 0:n.call(t,e))?(await te(),_({message:`맵 "${e}"이(가) 삭제되었습니다.`,type:"success"}),setTimeout(()=>_(null),1500)):(_({message:"삭제에 실패했습니다.",type:"error"}),setTimeout(()=>_(null),1500))})(e.name),disabled:!!k,style:{padding:"4px 8px",background:"#a33",color:"#fff"},children:"삭제"})]})]},e.name))]})]})}),N&&i.jsx(_o,{message:N.message,type:N.type,onClose:()=>_(null)})]})}export{il as default};
