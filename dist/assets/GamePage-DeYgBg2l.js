import{r as e,j as s}from"./react-vendor-C18QMWF4.js";import{c as t}from"./state-MC_ymbCc.js";import{am as a,X as n,C as i,P as o,W as r,$ as l,Y as d,Z as c,ab as m,ad as u,b as h,B as p,a2 as w}from"./three-CPLCFrMS.js";import{u as x}from"./router-CBy-A1a3.js";import"./editor-D3I3U6u0.js";import"./three-stdlib-CLJV8NWX.js";const j=t((e,s)=>({isPlaying:!0,isPaused:!1,isLoading:!0,scene:null,camera:null,renderer:null,player:null,mixer:null,clock:new a,playerPosition:{x:0,y:1,z:0},playerRotation:0,cameraState:{distance:10,height:5,followMode:!0,rotationSpeed:.002,zoomSpeed:1,minDistance:3,maxDistance:50,phi:Math.PI/4,theta:0},keys:{},mouseState:{isMouseDown:!1,prevMousePos:{x:0,y:0},sensitivity:.002},trees:[],items:[],walls:[],setLoading:s=>e({isLoading:s}),setScene:(s,t,a)=>e({scene:s,camera:t,renderer:a}),setPlayer:s=>e({player:s}),updatePlayerPosition:s=>e({playerPosition:s}),updatePlayerRotation:s=>e({playerRotation:s}),setKey:(s,t)=>e(e=>({keys:{...e.keys,[s]:t}})),pause:()=>e({isPaused:!0}),resume:()=>e({isPaused:!1}),restart:()=>e({isPlaying:!0,isPaused:!1,playerPosition:{x:0,y:1,z:0},playerRotation:0}),toggleCameraFollowMode:()=>e(e=>({cameraState:{...e.cameraState,followMode:!e.cameraState.followMode}})),updateCameraDistance:s=>e(e=>({cameraState:{...e.cameraState,distance:Math.max(e.cameraState.minDistance,Math.min(e.cameraState.maxDistance,s))}})),updateCameraAngles:(s,t)=>e(e=>({cameraState:{...e.cameraState,phi:Math.max(.1,Math.min(Math.PI-.1,s)),theta:t}})),setMouseDown:(s,t)=>e(e=>({mouseState:{...e.mouseState,isMouseDown:s,prevMousePos:t||e.mouseState.prevMousePos}})),addItem:s=>e(e=>({items:[...e.items,s]})),removeItem:s=>e(e=>({items:e.items.filter(e=>e.id!==s)})),setTrees:s=>e({trees:s}),addWall:s=>e(e=>({walls:[...e.walls,s]})),clearWalls:()=>e({walls:[]}),setMixer:s=>e({mixer:s})}));function v(){const t=e.useRef(null);return e.useEffect(()=>{if(!t.current)return;const e=new n;e.background=new i(8900331);const s=new o(75,window.innerWidth/window.innerHeight,.1,1e3);s.position.set(0,5,10),s.lookAt(0,0,0);const a=new r({antialias:!0});a.setSize(window.innerWidth,window.innerHeight),a.shadowMap.enabled=!0,a.shadowMap.type=l,t.current.appendChild(a.domElement);const x=new d(4210752,.6);e.add(x);const j=new c(16777215,.8);j.position.set(10,10,5),j.castShadow=!0,e.add(j);const v=new m(20,20),y=new u({color:65280}),g=new h(v,y);g.rotation.x=-Math.PI/2,g.receiveShadow=!0,e.add(g);const f=new p(2,2,2),S=new u({color:16711680}),b=new h(f,S);b.position.set(0,1,0),b.castShadow=!0,e.add(b);const N=new w(1,32,32),M=new u({color:255}),P=new h(N,M);P.position.set(3,1,0),P.castShadow=!0,e.add(P);const k=()=>{requestAnimationFrame(k),b.rotation.x+=.01,b.rotation.y+=.01,P.rotation.y+=.02,a.render(e,s)};k();const C=()=>{s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),t.current&&a.domElement&&t.current.removeChild(a.domElement),a.dispose()}},[]),s.jsx("div",{ref:t,style:{width:"100vw",height:"100vh",position:"absolute",top:0,left:0,zIndex:1}})}function y(){const{isPaused:t,pause:a,resume:n,restart:i,toggleCameraFollowMode:o,cameraState:r,playerPosition:l}=j(),[d,c]=e.useState(!1),[m,u]=e.useState(10);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"crosshair"}),s.jsx("div",{className:"game-message"}),t&&s.jsxs("div",{className:"pause-overlay",children:[s.jsx("h2",{children:"ê²Œì„ ì¼ì‹œì •ì§€"}),s.jsx("button",{onClick:n,className:"resume-btn",children:"ê³„ì†í•˜ê¸°"}),s.jsx("button",{onClick:i,className:"restart-btn",children:"ì¬ì‹œì‘"})]}),s.jsxs("div",{className:"controls-info",children:[s.jsx("div",{children:"WASD: ì´ë™"}),s.jsx("div",{children:"ë§ˆìš°ìŠ¤: ì¹´ë©”ë¼ íšŒì „"}),s.jsx("div",{children:"ìŠ¤í¬ë¡¤: ì¤Œ"}),s.jsx("div",{children:"ESC: ì¼ì‹œì •ì§€"}),s.jsxs("div",{children:["ìœ„ì¹˜: (",Math.round(l.x),", ",Math.round(l.z),")"]})]}),s.jsx("button",{className:"sidebar-toggle-btn",onClick:()=>c(!d),children:"âš™ï¸"}),s.jsxs("div",{className:"sidebar "+(d?"open":""),children:[s.jsxs("div",{className:"sidebar-header",children:[s.jsx("h3",{children:"ê²Œì„ ì„¤ì •"}),s.jsx("button",{className:"close-btn",onClick:()=>c(!1),children:"âœ•"})]}),s.jsxs("div",{className:"sidebar-content",children:[s.jsxs("div",{className:"section",children:[s.jsx("h4",{children:"í”Œë ˆì´ì–´ ëª¨ë¸"}),s.jsx("input",{type:"file",accept:".glb,.gltf",onChange:e=>{e.target.files[0]},style:{display:"none"},id:"model-file-input"}),s.jsx("button",{className:"upload-btn",onClick:()=>document.getElementById("model-file-input").click(),children:"ëª¨ë¸ ì—…ë¡œë“œ"}),s.jsx("button",{className:"reset-btn",onClick:()=>{window.confirm("ìºë¦­í„°ë¥¼ ê¸°ë³¸ ëª¨ë¸ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?")},children:"ê¸°ë³¸ ëª¨ë¸ë¡œ ë¦¬ì…‹"}),s.jsx("div",{className:"model-info",children:"ê¸°ë³¸ ëª¨ë¸ ì‚¬ìš© ì¤‘"})]}),s.jsxs("div",{className:"section",children:[s.jsxs("h4",{children:["ë‚˜ë¬´ ê°œìˆ˜: ",m]}),s.jsx("input",{type:"range",min:"0",max:"20",value:m,onChange:e=>{const s=parseInt(e.target.value,10);u(s)},className:"slider"})]}),s.jsxs("div",{className:"section",children:[s.jsx("h4",{children:"ì¹´ë©”ë¼"}),s.jsx("button",{className:"camera-btn "+(r.followMode?"active":""),onClick:o,children:r.followMode?"ë”°ë¼ê°€ê¸° ëª¨ë“œ":"ê³ ì • ëª¨ë“œ"})]}),s.jsxs("div",{className:"section",children:[s.jsx("h4",{children:"ë§µ ì„ íƒ"}),s.jsx("select",{className:"map-select",children:s.jsx("option",{value:"default",children:"ê¸°ë³¸ ë§µ"})}),s.jsx("button",{className:"apply-map-btn",children:"ë§µ ì ìš©"})]})]})]})]})}function g(){const t=x(),{isLoading:a,setLoading:n,pause:i,restart:o,setKey:r}=j(),[l,d]=e.useState("ê²Œì„ ë¡œë”© ì¤‘...");return e.useEffect(()=>{(async()=>{try{d("ê²Œì„ ì—”ì§„ ì´ˆê¸°í™” ì¤‘..."),await new Promise(e=>setTimeout(e,1e3)),d("ê²Œì„ ì¤€ë¹„ ì™„ë£Œ!"),setTimeout(()=>{n(!1)},500)}catch(e){d(`âŒ ê²Œì„ ë¡œë”© ì‹¤íŒ¨: ${e.message}`)}})()},[n]),e.useEffect(()=>{const e=e=>{"Escape"===e.code&&i(),"KeyR"===e.code&&o(),"KeyH"===e.code&&t("/")};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[i,o,t]),e.useEffect(()=>{const e=document.querySelector("canvas");e&&e.addEventListener("click",()=>{e.requestPointerLock()})},[a]),s.jsxs("div",{className:"game-page",children:[a&&s.jsxs("div",{className:"loading-screen",children:[s.jsx("div",{className:"loader"}),s.jsx("p",{className:"loading-status",children:l})]}),!a&&s.jsxs(s.Fragment,{children:[s.jsx(v,{}),s.jsx(y,{}),s.jsx("button",{className:"home-btn",onClick:()=>t("/"),title:"í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° (H)",children:"ğŸ "})]})]})}export{g as default};
