import{_ as e,j as t}from"./index-79d28234.js";import{r as s,a as i}from"./react-vendor-340b36b2.js";import{T as a,h as n,i as r,j as o,k as l,l as c,b as A,m as h,n as d,o as u,d as g,p,q as m,r as b,V as f,s as C,t as v,I as y,u as x,O as I,v as E,w as B,x as w,y as S,L as Q,z as j,R as M,N as D,E as T,G as R,J as k,K as O,Q as F,U as L,X as P,Y as N,f as G,Z as U,_ as z,$ as H,a0 as _,a1 as q,P as K,a2 as V,a3 as Y,a4 as W,a5 as J,a6 as X,a7 as Z,a8 as $,a9 as ee,aa as te,ab as se,ac as ie,ad as ae,ae as ne,af as re,ag as oe,ah as le,ai as ce,aj as Ae,ak as he,al as de,am as ue,an as ge,ao as pe,ap as me,aq as be,ar as fe,as as Ce,at as ve,au as ye,av as xe,aw as Ie,ax as Ee,ay as Be,az as we,aA as Se,aB as Qe,aC as je,aD as Me,H as De,F as Te,aE as Re,aF as ke,aG as Oe,aH as Fe,aI as Le,aJ as Pe,B as Ne,aK as Ge,aL as Ue,aM as ze,aN as He,aO as _e,g as qe,aP as Ke,e as Ve,aQ as Ye,aR as We,aS as Je,aT as Xe,aU as Ze,aV as $e,aW as et,aX as tt,aY as st,C as it,aZ as at,a_ as nt,a$ as rt,b0 as ot,b1 as lt,b2 as ct,b3 as At,b4 as ht,b5 as dt,b6 as ut,b7 as gt,b8 as pt,b9 as mt,ba as bt,bb as ft,bc as Ct,bd as vt,be as yt,bf as xt,bg as It,bh as Et,bi as Bt,S as wt,W as St,A as Qt,c as jt,bj as Mt,bk as Dt,bl as Tt,bm as Rt,bn as kt,bo as Ot,M as Ft,bp as Lt}from"./three-6759fa90.js";import{c as Pt}from"./state-b6f0ffd6.js";import{R as Nt}from"./three-stdlib-0da64232.js";import{u as Gt}from"./router-276f05ba.js";function Ut(e,t){if(t===a)return e;if(t===n||t===r){let s=e.getIndex();if(null===s){const t=[],i=e.getAttribute("position");if(void 0===i)return e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const i=s.count-2,a=[];if(t===n)for(let e=1;e<=i;e++)a.push(s.getX(0)),a.push(s.getX(e)),a.push(s.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(a.push(s.getX(e)),a.push(s.getX(e+1)),a.push(s.getX(e+2))):(a.push(s.getX(e+2)),a.push(s.getX(e+1)),a.push(s.getX(e)));a.length;const r=e.clone();return r.setIndex(a),r.clearGroups(),r}return e}class zt extends o{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Yt(e)}),this.register(function(e){return new Wt(e)}),this.register(function(e){return new as(e)}),this.register(function(e){return new ns(e)}),this.register(function(e){return new rs(e)}),this.register(function(e){return new Xt(e)}),this.register(function(e){return new Zt(e)}),this.register(function(e){return new $t(e)}),this.register(function(e){return new es(e)}),this.register(function(e){return new Vt(e)}),this.register(function(e){return new ts(e)}),this.register(function(e){return new Jt(e)}),this.register(function(e){return new is(e)}),this.register(function(e){return new ss(e)}),this.register(function(e){return new qt(e)}),this.register(function(e){return new os(e)}),this.register(function(e){return new ls(e)})}load(e,t,s,i){const a=this;let n;if(""!==this.resourcePath)n=this.resourcePath;else if(""!==this.path){const t=l.extractUrlBase(e);n=l.resolveURL(t,this.path)}else n=l.extractUrlBase(e);this.manager.itemStart(e);const r=function(t){i&&i(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new c(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(s){try{a.parse(s,n,function(s){t(s),a.manager.itemEnd(e)},r)}catch(i){r(i)}},s,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let a;const n={},r={},o=new TextDecoder;if("string"==typeof e)a=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===cs){try{n[_t.KHR_BINARY_GLTF]=new ds(e)}catch(c){return void(i&&i(c))}a=JSON.parse(n[_t.KHR_BINARY_GLTF].content)}else a=JSON.parse(o.decode(e))}else a=e;if(void 0===a.asset||a.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new Ps(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let A=0;A<this.pluginCallbacks.length;A++){const e=this.pluginCallbacks[A](l);e.name,r[e.name]=e,n[e.name]=!0}if(a.extensionsUsed)for(let A=0;A<a.extensionsUsed.length;++A){const e=a.extensionsUsed[A],t=a.extensionsRequired||[];switch(e){case _t.KHR_MATERIALS_UNLIT:n[e]=new Kt;break;case _t.KHR_DRACO_MESH_COMPRESSION:n[e]=new us(a,this.dracoLoader);break;case _t.KHR_TEXTURE_TRANSFORM:n[e]=new gs;break;case _t.KHR_MESH_QUANTIZATION:n[e]=new ps;break;default:t.indexOf(e)>=0&&r[e]}}l.setExtensions(n),l.setPlugins(r),l.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,a){s.parse(e,t,i,a)})}}function Ht(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const _t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class qt{constructor(e){this.parser=e,this.name=_t.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const a=t.json,n=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let r;const o=new A(16777215);void 0!==n.color&&o.setRGB(n.color[0],n.color[1],n.color[2],h);const l=void 0!==n.range?n.range:0;switch(n.type){case"directional":r=new g(o),r.target.position.set(0,0,-1),r.add(r.target);break;case"point":r=new u(o),r.distance=l;break;case"spot":r=new d(o),r.distance=l,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,r.angle=n.spot.outerConeAngle,r.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return r.position.set(0,0,0),r.decay=2,Ts(r,n),void 0!==n.intensity&&(r.intensity=n.intensity),r.name=t.createUniqueName(n.name||"light_"+e),i=Promise.resolve(r),t.cache.add(s,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(e){return s._getNodeRef(t.cache,a,e)})}}let Kt=class{constructor(){this.name=_t.KHR_MATERIALS_UNLIT}getMaterialType(){return p}extendParams(e,t,s){const i=[];e.color=new A(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],h),e.opacity=t[3]}void 0!==a.baseColorTexture&&i.push(s.assignTexture(e,"map",a.baseColorTexture,m))}return Promise.all(i)}},Vt=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}},Yt=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];if(void 0!==n.clearcoatFactor&&(t.clearcoat=n.clearcoatFactor),void 0!==n.clearcoatTexture&&a.push(s.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),void 0!==n.clearcoatRoughnessFactor&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),void 0!==n.clearcoatRoughnessTexture&&a.push(s.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),void 0!==n.clearcoatNormalTexture&&(a.push(s.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),void 0!==n.clearcoatNormalTexture.scale)){const e=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new f(e,e)}return Promise.all(a)}},Wt=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}},Jt=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];return void 0!==n.iridescenceFactor&&(t.iridescence=n.iridescenceFactor),void 0!==n.iridescenceTexture&&a.push(s.assignTexture(t,"iridescenceMap",n.iridescenceTexture)),void 0!==n.iridescenceIor&&(t.iridescenceIOR=n.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==n.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),void 0!==n.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),void 0!==n.iridescenceThicknessTexture&&a.push(s.assignTexture(t,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(a)}},Xt=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new A(0,0,0),t.sheenRoughness=0,t.sheen=1;const n=i.extensions[this.name];if(void 0!==n.sheenColorFactor){const e=n.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],h)}return void 0!==n.sheenRoughnessFactor&&(t.sheenRoughness=n.sheenRoughnessFactor),void 0!==n.sheenColorTexture&&a.push(s.assignTexture(t,"sheenColorMap",n.sheenColorTexture,m)),void 0!==n.sheenRoughnessTexture&&a.push(s.assignTexture(t,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(a)}},Zt=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];return void 0!==n.transmissionFactor&&(t.transmission=n.transmissionFactor),void 0!==n.transmissionTexture&&a.push(s.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(a)}},$t=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];t.thickness=void 0!==n.thicknessFactor?n.thicknessFactor:0,void 0!==n.thicknessTexture&&a.push(s.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||1/0;const r=n.attenuationColor||[1,1,1];return t.attenuationColor=(new A).setRGB(r[0],r[1],r[2],h),Promise.all(a)}},es=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}},ts=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];t.specularIntensity=void 0!==n.specularFactor?n.specularFactor:1,void 0!==n.specularTexture&&a.push(s.assignTexture(t,"specularIntensityMap",n.specularTexture));const r=n.specularColorFactor||[1,1,1];return t.specularColor=(new A).setRGB(r[0],r[1],r[2],h),void 0!==n.specularColorTexture&&a.push(s.assignTexture(t,"specularColorMap",n.specularColorTexture,m)),Promise.all(a)}},ss=class{constructor(e){this.parser=e,this.name=_t.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];return t.bumpScale=void 0!==n.bumpFactor?n.bumpFactor:1,void 0!==n.bumpTexture&&a.push(s.assignTexture(t,"bumpMap",n.bumpTexture)),Promise.all(a)}},is=class{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?b:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const a=[],n=i.extensions[this.name];return void 0!==n.anisotropyStrength&&(t.anisotropy=n.anisotropyStrength),void 0!==n.anisotropyRotation&&(t.anisotropyRotation=n.anisotropyRotation),void 0!==n.anisotropyTexture&&a.push(s.assignTexture(t,"anisotropyMap",n.anisotropyTexture)),Promise.all(a)}};class as{constructor(e){this.parser=e,this.name=_t.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const a=i.extensions[this.name],n=t.options.ktx2Loader;if(!n){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,n)}}class ns{constructor(e){this.parser=e,this.name=_t.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,a=i.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],r=i.images[n.source];let o=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then(function(a){if(a)return s.loadTextureImage(e,n.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class rs{constructor(e){this.parser=e,this.name=_t.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,a=i.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],r=i.images[n.source];let o=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then(function(a){if(a)return s.loadTextureImage(e,n.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class os{constructor(e){this.name=_t.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const s=e.byteOffset||0,i=e.byteLength||0,n=e.count,r=e.byteStride,o=new Uint8Array(t,s,i);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(n,r,o,e.mode,e.filter).then(function(e){return e.buffer}):a.ready.then(function(){const t=new ArrayBuffer(n*r);return a.decodeGltfBuffer(new Uint8Array(t),n,r,o,e.mode,e.filter),t})})}return null}}let ls=class{constructor(e){this.name=_t.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const i=t.meshes[s.mesh];for(const o of i.primitives)if(o.mode!==Cs.TRIANGLES&&o.mode!==Cs.TRIANGLE_STRIP&&o.mode!==Cs.TRIANGLE_FAN&&void 0!==o.mode)return null;const a=s.extensions[this.name].attributes,n=[],r={};for(const o in a)n.push(this.parser.getDependency("accessor",a[o]).then(e=>(r[o]=e,r[o])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(e=>{const t=e.pop(),s=t.isGroup?t.children:[t],i=e[0].count,a=[];for(const n of s){const e=new C,t=new v,s=new ee,o=new v(1,1,1),l=new y(n.geometry,n.material,i);for(let a=0;a<i;a++)r.TRANSLATION&&t.fromBufferAttribute(r.TRANSLATION,a),r.ROTATION&&s.fromBufferAttribute(r.ROTATION,a),r.SCALE&&o.fromBufferAttribute(r.SCALE,a),l.setMatrixAt(a,e.compose(t,s,o));for(const i in r)if("_COLOR_0"===i){const e=r[i];l.instanceColor=new x(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&n.geometry.setAttribute(i,r[i]);I.prototype.copy.call(l,n),this.parser.assignFinalMaterial(l),a.push(l)}return t.isGroup?(t.clear(),t.add(...a),t):a[0]}))}};const cs="glTF",As=1313821514,hs=5130562;class ds{constructor(e){this.name=_t.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==cs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,a=new DataView(e,12);let n=0;for(;n<i;){const t=a.getUint32(n,!0);n+=4;const i=a.getUint32(n,!0);if(n+=4,i===As){const i=new Uint8Array(e,12+n,t);this.content=s.decode(i)}else if(i===hs){const s=12+n;this.body=e.slice(s,s+t)}n+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class us{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=_t.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,a=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,r={},o={},l={};for(const c in n){const e=Es[c]||c.toLowerCase();r[e]=n[c]}for(const c in e.attributes){const t=Es[c]||c.toLowerCase();if(void 0!==n[c]){const i=s.accessors[e.attributes[c]],a=vs[i.componentType];l[t]=a.name,o[t]=!0===i.normalized}}return t.getDependency("bufferView",a).then(function(e){return new Promise(function(t,s){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const s=e.attributes[t],i=o[t];void 0!==i&&(s.normalized=i)}t(e)},r,l,h,s)})})}}class gs{constructor(){this.name=_t.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class ps{constructor(){this.name=_t.KHR_MESH_QUANTIZATION}}class ms extends pe{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,a=e*i*3+i;for(let n=0;n!==i;n++)t[n]=s[a+n];return t}interpolate_(e,t,s,i){const a=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=2*r,l=3*r,c=i-t,A=(s-t)/c,h=A*A,d=h*A,u=e*l,g=u-l,p=-2*d+3*h,m=d-h,b=1-p,f=m-h+A;for(let C=0;C!==r;C++){const e=n[g+C+r],t=n[g+C+o]*c,s=n[u+C+r],i=n[u+C]*c;a[C]=b*e+f*t+p*s+m*i}return a}}const bs=new ee;class fs extends ms{interpolate_(e,t,s,i){const a=super.interpolate_(e,t,s,i);return bs.fromArray(a).normalize().toArray(a),a}}const Cs={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},vs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ys={9728:D,9729:Q,9984:te,9985:se,9986:ie,9987:j},xs={33071:ae,33648:ne,10497:M},Is={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Es={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bs={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ws={CUBICSPLINE:void 0,LINEAR:Z,STEP:re},Ss="OPAQUE",Qs="MASK",js="BLEND";function Ms(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new O({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:oe})),e.DefaultMaterial}function Ds(e,t,s){for(const i in s.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=s.extensions[i])}function Ts(e,t){void 0!==t.extras&&"object"==typeof t.extras&&Object.assign(e.userData,t.extras)}function Rs(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,i=t.weights.length;s<i;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,i=s.length;t<i;t++)e.morphTargetDictionary[s[t]]=t}}}function ks(e){let t;const s=e.extensions&&e.extensions[_t.KHR_DRACO_MESH_COMPRESSION];if(t=s?"draco:"+s.bufferView+":"+s.indices+":"+Os(s.attributes):e.indices+":"+Os(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,a=e.targets.length;i<a;i++)t+=":"+Os(e.targets[i]);return t}function Os(e){let t="";const s=Object.keys(e).sort();for(let i=0,a=s.length;i<a;i++)t+=s[i]+":"+e[s[i]]+";";return t}function Fs(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Ls=new C;class Ps{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ht,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=-1,a=!1,n=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;s=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=s&&t?parseInt(t[1],10):-1,a=e.indexOf("Firefox")>-1,n=a?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||s&&i<17||a&&n<98?this.textureLoader=new E(this.options.manager):this.textureLoader=new B(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new c(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(t){const n={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:s,userData:{}};return Ds(a,n,i),Ts(n,i),Promise.all(s._invokeAll(function(e){return e.afterRoot&&e.afterRoot(n)})).then(function(){for(const e of n.scenes)e.updateMatrixWorld();e(n)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,a=t.length;i<a;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let i=0,a=e.length;i<a;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(s[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),a=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[i,n]of e.children.entries())a(n,t.children[i])};return a(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const a=e(t[i]);a&&s.push(a)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[_t.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,a){s.load(l.resolveURL(t.uri,i.path),e,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const s=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+s)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=Is[i.type],t=vs[i.componentType],s=!0===i.normalized,a=new t(i.count*e);return Promise.resolve(new w(a,e,s))}const a=[];return void 0!==i.bufferView?a.push(this.getDependency("bufferView",i.bufferView)):a.push(null),void 0!==i.sparse&&(a.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(a).then(function(e){const a=e[0],n=Is[i.type],r=vs[i.componentType],o=r.BYTES_PER_ELEMENT,l=o*n,c=i.byteOffset||0,A=void 0!==i.bufferView?s.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let d,u;if(A&&A!==l){const e=Math.floor(c/A),s="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(s);l||(d=new r(a,e*A,i.count*A/o),l=new S(d,A/o),t.cache.add(s,l)),u=new le(l,n,c%A/o,h)}else d=null===a?new r(i.count*n):new r(a,c,i.count*n),u=new w(d,n,h);if(void 0!==i.sparse){const t=Is.SCALAR,s=vs[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new s(e[1],o,i.sparse.count*t),A=new r(e[2],l,i.sparse.count*n);null!==a&&(u=new w(u.array.slice(),u.itemSize,u.normalized)),u.normalized=!1;for(let e=0,i=c.length;e<i;e++){const t=c[e];if(u.setX(t,A[e*n]),n>=2&&u.setY(t,A[e*n+1]),n>=3&&u.setZ(t,A[e*n+2]),n>=4&&u.setW(t,A[e*n+3]),n>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}u.normalized=h}return u})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,a=t.images[i];let n=this.textureLoader;if(a.uri){const e=s.manager.getHandler(a.uri);null!==e&&(n=e)}return this.loadTextureImage(e,i,n)}loadTextureImage(e,t,s){const i=this,a=this.json,n=a.textures[e],r=a.images[t],o=(r.uri||r.bufferView)+":"+n.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,s).then(function(t){t.flipY=!1,t.name=n.name||r.name||"",""===t.name&&"string"==typeof r.uri&&!1===r.uri.startsWith("data:image/")&&(t.name=r.uri);const s=(a.samplers||{})[n.sampler]||{};return t.magFilter=ys[s.magFilter]||Q,t.minFilter=ys[s.minFilter]||j,t.wrapS=xs[s.wrapS]||M,t.wrapT=xs[s.wrapT]||M,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==D&&t.minFilter!==Q,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){const s=this,i=this.json,a=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const n=i.images[e],r=self.URL||self.webkitURL;let o=n.uri||"",c=!1;if(void 0!==n.bufferView)o=s.getDependency("bufferView",n.bufferView).then(function(e){c=!0;const t=new Blob([e],{type:n.mimeType});return o=r.createObjectURL(t),o});else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const A=Promise.resolve(o).then(function(e){return new Promise(function(s,i){let n=s;!0===t.isImageBitmapLoader&&(n=function(e){const t=new ce(e);t.needsUpdate=!0,s(t)}),t.load(l.resolveURL(e,a.path),n,void 0,i)})}).then(function(e){var t;return!0===c&&r.revokeObjectURL(o),Ts(e,n),e.userData.mimeType=n.mimeType||((t=n.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e}).catch(function(e){throw e});return this.sourceCache[e]=A,A}assignTexture(e,t,s,i){const a=this;return this.getDependency("texture",s.index).then(function(n){if(!n)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((n=n.clone()).channel=s.texCoord),a.extensions[_t.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[_t.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=a.associations.get(n);n=a.extensions[_t.KHR_TEXTURE_TRANSFORM].extendTexture(n,e),a.associations.set(n,t)}}return void 0!==i&&(n.colorSpace=i),e[t]=n,n})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,n=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new T,R.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new k,R.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,this.cache.add(e,t)),s=t}if(i||a||n){let e="ClonedMaterial:"+s.uuid+":";i&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),n&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),a&&(t.vertexColors=!0),n&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return O}loadMaterial(e){const t=this,s=this.json,i=this.extensions,a=s.materials[e];let n;const r={},o=[];if((a.extensions||{})[_t.KHR_MATERIALS_UNLIT]){const e=i[_t.KHR_MATERIALS_UNLIT];n=e.getMaterialType(),o.push(e.extendParams(r,a,t))}else{const s=a.pbrMetallicRoughness||{};if(r.color=new A(1,1,1),r.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;r.color.setRGB(e[0],e[1],e[2],h),r.opacity=e[3]}void 0!==s.baseColorTexture&&o.push(t.assignTexture(r,"map",s.baseColorTexture,m)),r.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,r.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(o.push(t.assignTexture(r,"metalnessMap",s.metallicRoughnessTexture)),o.push(t.assignTexture(r,"roughnessMap",s.metallicRoughnessTexture))),n=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),o.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,r)})))}!0===a.doubleSided&&(r.side=F);const l=a.alphaMode||Ss;if(l===js?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,l===Qs&&(r.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&n!==p&&(o.push(t.assignTexture(r,"normalMap",a.normalTexture)),r.normalScale=new f(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;r.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&n!==p&&(o.push(t.assignTexture(r,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(r.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&n!==p){const e=a.emissiveFactor;r.emissive=(new A).setRGB(e[0],e[1],e[2],h)}return void 0!==a.emissiveTexture&&n!==p&&o.push(t.assignTexture(r,"emissiveMap",a.emissiveTexture,m)),Promise.all(o).then(function(){const s=new n(r);return a.name&&(s.name=a.name),Ts(s,a),t.associations.set(s,{materials:e}),a.extensions&&Ds(i,s,a),s})}createUniqueName(e){const t=L.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function a(e){return s[_t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(s){return Ns(s,e,t)})}const n=[];for(let r=0,o=e.length;r<o;r++){const s=e[r],o=ks(s),l=i[o];if(l)n.push(l.promise);else{let e;e=s.extensions&&s.extensions[_t.KHR_DRACO_MESH_COMPRESSION]?a(s):Ns(new P,s,t),i[o]={primitive:s,promise:e},n.push(e)}}return Promise.all(n)}loadMesh(e){const t=this,s=this.json,i=this.extensions,a=s.meshes[e],o=a.primitives,l=[];for(let n=0,r=o.length;n<r;n++){const e=void 0===o[n].material?Ms(this.cache):this.getDependency("material",o[n].material);l.push(e)}return l.push(t.loadGeometries(o)),Promise.all(l).then(function(s){const l=s.slice(0,s.length-1),c=s[s.length-1],A=[];for(let d=0,u=c.length;d<u;d++){const s=c[d],h=o[d];let u;const g=l[d];if(h.mode===Cs.TRIANGLES||h.mode===Cs.TRIANGLE_STRIP||h.mode===Cs.TRIANGLE_FAN||void 0===h.mode)u=!0===a.isSkinnedMesh?new N(s,g):new G(s,g),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),h.mode===Cs.TRIANGLE_STRIP?u.geometry=Ut(u.geometry,r):h.mode===Cs.TRIANGLE_FAN&&(u.geometry=Ut(u.geometry,n));else if(h.mode===Cs.LINES)u=new U(s,g);else if(h.mode===Cs.LINE_STRIP)u=new z(s,g);else if(h.mode===Cs.LINE_LOOP)u=new H(s,g);else{if(h.mode!==Cs.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);u=new _(s,g)}Object.keys(u.geometry.morphAttributes).length>0&&Rs(u,a),u.name=t.createUniqueName(a.name||"mesh_"+e),Ts(u,a),h.extensions&&Ds(i,u,h),t.assignFinalMaterial(u),A.push(u)}for(let i=0,a=A.length;i<a;i++)t.associations.set(A[i],{meshes:e,primitives:i});if(1===A.length)return a.extensions&&Ds(i,A[0],a),A[0];const h=new q;a.extensions&&Ds(i,h,a),t.associations.set(h,{meshes:e});for(let e=0,t=A.length;e<t;e++)h.add(A[e]);return h})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(i)return"perspective"===s.type?t=new K(V.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===s.type&&(t=new Y(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),Ts(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let i=0,a=t.joints.length;i<a;i++)s.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(e){const t=e.pop(),s=e,i=[],a=[];for(let n=0,r=s.length;n<r;n++){const e=s[n];if(e){i.push(e);const s=new C;null!==t&&s.fromArray(t.array,16*n),a.push(s)}}return new W(i,a)})}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],a=i.name?i.name:"animation_"+e,n=[],r=[],o=[],l=[],c=[];for(let A=0,h=i.channels.length;A<h;A++){const e=i.channels[A],t=i.samplers[e.sampler],s=e.target,a=s.node,h=void 0!==i.parameters?i.parameters[t.input]:t.input,d=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==s.node&&(n.push(this.getDependency("node",a)),r.push(this.getDependency("accessor",h)),o.push(this.getDependency("accessor",d)),l.push(t),c.push(s))}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],l=[];for(let a=0,c=t.length;a<c;a++){const e=t[a],c=i[a],A=n[a],h=r[a],d=o[a];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const u=s._createAnimationTracks(e,c,A,h,d);if(u)for(let t=0;t<u.length;t++)l.push(u[t])}return new J(a,void 0,l)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return void 0===i.mesh?null:s.getDependency("mesh",i.mesh).then(function(e){const t=s._getNodeRef(s.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,s=this.json.nodes[e],i=t._loadNodeShallow(e),a=[],n=s.children||[];for(let o=0,l=n.length;o<l;o++)a.push(t.getDependency("node",n[o]));const r=void 0===s.skin?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([i,Promise.all(a),r]).then(function(e){const t=e[0],s=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,Ls)});for(let a=0,n=s.length;a<n;a++)t.add(s[a]);return t})}_loadNodeShallow(e){const t=this.json,s=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const a=t.nodes[e],n=a.name?i.createUniqueName(a.name):"",r=[],o=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&r.push(o),void 0!==a.camera&&r.push(i.getDependency("camera",a.camera).then(function(e){return i._getNodeRef(i.cameraCache,a.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){r.push(e)}),this.nodeCache[e]=Promise.all(r).then(function(t){let r;if(r=!0===a.isBone?new X:t.length>1?new q:1===t.length?t[0]:new I,r!==t[0])for(let e=0,s=t.length;e<s;e++)r.add(t[e]);if(a.name&&(r.userData.name=a.name,r.name=n),Ts(r,a),a.extensions&&Ds(s,r,a),void 0!==a.matrix){const e=new C;e.fromArray(a.matrix),r.applyMatrix4(e)}else void 0!==a.translation&&r.position.fromArray(a.translation),void 0!==a.rotation&&r.quaternion.fromArray(a.rotation),void 0!==a.scale&&r.scale.fromArray(a.scale);return i.associations.has(r)||i.associations.set(r,{}),i.associations.get(r).nodes=e,r}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,a=new q;s.name&&(a.name=i.createUniqueName(s.name)),Ts(a,s),s.extensions&&Ds(t,a,s);const n=s.nodes||[],r=[];for(let o=0,l=n.length;o<l;o++)r.push(i.getDependency("node",n[o]));return Promise.all(r).then(function(e){for(let t=0,s=e.length;t<s;t++)a.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[s,a]of i.associations)(s instanceof R||s instanceof ce)&&t.set(s,a);return e.traverse(e=>{const s=i.associations.get(e);null!=s&&t.set(e,s)}),t})(a),a})}_createAnimationTracks(e,t,s,i,a){const n=[],r=e.name?e.name:e.uuid,o=[];let l;switch(Bs[a.path]===Bs.weights?e.traverse(function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)}):o.push(r),Bs[a.path]){case Bs.weights:l=he;break;case Bs.rotation:l=de;break;case Bs.position:case Bs.scale:l=Ae;break;default:if(1===s.itemSize)l=he;else l=Ae}const c=void 0!==i.interpolation?ws[i.interpolation]:Z,A=this._getArrayFromAccessor(s);for(let h=0,d=o.length;h<d;h++){const e=new l(o[h]+"."+Bs[a.path],t.array,A,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),n.push(e)}return n}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Fs(t.constructor),s=new Float32Array(t.length);for(let i=0,a=t.length;i<a;i++)s[i]=t[i]*e;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof de?fs:ms)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ns(e,t,s){const i=t.attributes,a=[];function n(t,i){return s.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const r in i){const t=Es[r]||r.toLowerCase();t in e.attributes||a.push(n(i[r],t))}if(void 0!==t.indices&&!e.index){const i=s.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});a.push(i)}return $.workingColorSpace,Ts(e,t),function(e,t,s){const i=t.attributes,a=new ue;if(void 0===i.POSITION)return;{const e=s.json.accessors[i.POSITION],t=e.min,n=e.max;if(void 0===t||void 0===n)return;if(a.set(new v(t[0],t[1],t[2]),new v(n[0],n[1],n[2])),e.normalized){const t=Fs(vs[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const n=t.targets;if(void 0!==n){const e=new v,t=new v;for(let i=0,a=n.length;i<a;i++){const a=n[i];if(void 0!==a.POSITION){const i=s.json.accessors[a.POSITION],n=i.min,r=i.max;if(void 0!==n&&void 0!==r){if(t.setX(Math.max(Math.abs(n[0]),Math.abs(r[0]))),t.setY(Math.max(Math.abs(n[1]),Math.abs(r[1]))),t.setZ(Math.max(Math.abs(n[2]),Math.abs(r[2]))),i.normalized){const e=Fs(vs[i.componentType]);t.multiplyScalar(e)}e.max(t)}}}a.expandByVector(e)}e.boundingBox=a;const r=new ge;a.getCenter(r.center),r.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=r}(e,t,s),Promise.all(a).then(function(){return void 0!==t.targets?function(e,t,s){let i=!1,a=!1,n=!1;for(let c=0,A=t.length;c<A;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(a=!0),void 0!==e.COLOR_0&&(n=!0),i&&a&&n)break}if(!i&&!a&&!n)return Promise.resolve(e);const r=[],o=[],l=[];for(let c=0,A=t.length;c<A;c++){const A=t[c];if(i){const t=void 0!==A.POSITION?s.getDependency("accessor",A.POSITION):e.attributes.position;r.push(t)}if(a){const t=void 0!==A.NORMAL?s.getDependency("accessor",A.NORMAL):e.attributes.normal;o.push(t)}if(n){const t=void 0!==A.COLOR_0?s.getDependency("accessor",A.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l)]).then(function(t){const s=t[0],r=t[1],o=t[2];return i&&(e.morphAttributes.position=s),a&&(e.morphAttributes.normal=r),n&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,s):e})}const Gs=new WeakMap;class Us extends o{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,i){const a=new c(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,e=>{this.parse(e,t,i)},s,i)}parse(e,t,s=()=>{}){this.decodeDracoFile(e,t,null,null,m,s).catch(s)}decodeDracoFile(e,t,s,i,a=h,n=()=>{}){const r={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:a};return this.decodeGeometry(e,r).then(t).catch(n)}decodeGeometry(e,t){const s=JSON.stringify(t);if(Gs.has(e)){const t=Gs.get(e);if(t.key===s)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const a=this.workerNextTaskID++,n=e.byteLength,r=this._getWorker(a,n).then(s=>(i=s,new Promise((s,n)=>{i._callbacks[a]={resolve:s,reject:n},i.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return r.catch(()=>!0).then(()=>{i&&a&&this._releaseTask(i,a)}),Gs.set(e,{key:s,promise:r}),r}_createGeometry(e){const t=new P;e.index&&t.setIndex(new w(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const i=e.attributes[s],a=i.name,n=i.array,r=i.itemSize,o=new w(n,r);"color"===a&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=n instanceof Float32Array==!1),t.setAttribute(a,o)}return t}_assignVertexColorSpace(e,t){if(t!==m)return;const s=new A;for(let i=0,a=e.count;i<a;i++)s.fromBufferAttribute(e,i),$.toWorkingColorSpace(s,m),e.setXYZ(i,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new c(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((t,i)=>{s.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const s=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=zs.toString(),a=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const s=t.data;switch(s.type){case"decode":e._callbacks[s.id].resolve(s);break;case"error":e._callbacks[s.id].reject(s)}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function zs(){let e,t;function s(e,t,s,i,a,n){const r=n.num_components(),o=s.num_points()*r,l=o*a.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,a),A=e._malloc(l);t.GetAttributeDataArrayForAllPoints(s,n,c,l,A);const h=new a(e.HEAPF32.buffer,A,o).slice();return e._free(A),{name:i,array:h,itemSize:r}}onmessage=function(i){const a=i.data;switch(a.type){case"init":e=a.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const i=a.buffer,n=a.taskConfig;t.then(e=>{const t=e.draco,r=new t.Decoder;try{const e=function(e,t,i,a){const n=a.attributeIDs,r=a.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(i,i.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const A={index:null,attributes:[]};for(const h in n){const i=self[r[h]];let l,c;if(a.useUniqueIDs)c=n[h],l=t.GetAttributeByUniqueId(o,c);else{if(c=t.GetAttributeId(o,e[n[h]]),-1===c)continue;l=t.GetAttribute(o,c)}const d=s(e,t,o,h,i,l);"color"===h&&(d.vertexColorSpace=a.vertexColorSpace),A.attributes.push(d)}c===e.TRIANGULAR_MESH&&(A.index=function(e,t,s){const i=s.num_faces(),a=3*i,n=4*a,r=e._malloc(n);t.GetTrianglesUInt32Array(s,n,r);const o=new Uint32Array(e.HEAPF32.buffer,r,a).slice();return e._free(r),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),A}(t,r,new Int8Array(i),n),o=e.attributes.map(e=>e.array.buffer);e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:e},o)}catch(o){self.postMessage({type:"error",id:a.id,error:o.message})}finally{t.destroy(r)}})}}}class Hs{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:t,msg:s,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(s,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(s=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=s,this.workers[i].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const _s=9,qs=15,Ks=16,Vs=22,Ys=37,Ws=43,Js=76,Xs=83,Zs=97,$s=100,ei=103,ti=109,si=165,ii=166,ai=1000066e3;class ni{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class ri{constructor(e,t,s,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const s=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,i)}}const oi=[171,75,84,88,32,50,48,187,13,10,26,10];function li(e){return(new TextDecoder).decode(e)}let ci,Ai,hi;const di={env:{emscripten_notify_memory_growth:function(e){hi=new Uint8Array(Ai.exports.memory.buffer)}}};class ui{init(){return ci||(ci="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+gi).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,di)).then(this._init):WebAssembly.instantiate(Buffer.from(gi,"base64"),di).then(this._init),ci)}_init(e){Ai=e.instance,di.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Ai)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,i=Ai.exports.malloc(s);hi.set(e,i),t=t||Number(Ai.exports.ZSTD_findDecompressedSize(i,s));const a=Ai.exports.malloc(t),n=Ai.exports.ZSTD_decompress(a,t,i,s),r=hi.slice(a,a+n);return Ai.exports.free(i),Ai.exports.free(a),r}}const gi="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",pi=new WeakMap;let mi;class bi extends o{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Hs,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new c(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new c(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([e,t])=>{const s=bi.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(bi.EngineFormat),"let _EngineType = "+JSON.stringify(bi.EngineType),"let _TranscoderFormat = "+JSON.stringify(bi.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(bi.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})})}return this.transcoderPending}load(e,t,s,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const a=new c(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(e,e=>{this.parse(e,t,i)},s,i)}parse(e,t,s){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(pi.has(e)){return pi.get(e).promise.then(t).catch(s)}this._createTexture(e).then(e=>t?t(e):null).catch(s)}_createTextureFrom(e,t){const{type:s,error:i,data:{faces:a,width:n,height:r,format:o,type:l,dfdFlags:c}}=e;if("error"===s)return Promise.reject(i);let A;if(6===t.faceCount)A=new me(a,o,l);else{const e=a[0].mipmaps;A=t.layerCount>1?new be(e,n,r,t.layerCount,o,l):new fe(e,n,r,o,l)}return A.minFilter=1===a[0].mipmaps.length?Q:j,A.magFilter=Q,A.generateMipmaps=!1,A.needsUpdate=!0,A.colorSpace=yi(t),A.premultiplyAlpha=!!(1&c),A}async _createTexture(e,t={}){const s=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,oi.length);if(t[0]!==oi[0]||t[1]!==oi[1]||t[2]!==oi[2]||t[3]!==oi[3]||t[4]!==oi[4]||t[5]!==oi[5]||t[6]!==oi[6]||t[7]!==oi[7]||t[8]!==oi[8]||t[9]!==oi[9]||t[10]!==oi[10]||t[11]!==oi[11])throw new Error("Missing KTX 2.0 identifier.");const s=new ni,i=17*Uint32Array.BYTES_PER_ELEMENT,a=new ri(e,oi.length,i,!0);s.vkFormat=a._nextUint32(),s.typeSize=a._nextUint32(),s.pixelWidth=a._nextUint32(),s.pixelHeight=a._nextUint32(),s.pixelDepth=a._nextUint32(),s.layerCount=a._nextUint32(),s.faceCount=a._nextUint32();const n=a._nextUint32();s.supercompressionScheme=a._nextUint32();const r=a._nextUint32(),o=a._nextUint32(),l=a._nextUint32(),c=a._nextUint32(),A=a._nextUint64(),h=a._nextUint64(),d=new ri(e,oi.length+i,3*n*8,!0);for(let R=0;R<n;R++)s.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const u=new ri(e,r,o,!0),g={vendorId:u._skip(4)._nextUint16(),descriptorType:u._nextUint16(),versionNumber:u._nextUint16(),descriptorBlockSize:u._nextUint16(),colorModel:u._nextUint8(),colorPrimaries:u._nextUint8(),transferFunction:u._nextUint8(),flags:u._nextUint8(),texelBlockDimension:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],bytesPlane:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],samples:[]},p=(g.descriptorBlockSize/4-6)/4;for(let R=0;R<p;R++){const e={bitOffset:u._nextUint16(),bitLength:u._nextUint8(),channelType:u._nextUint8(),samplePosition:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=u._nextInt32(),e.sampleUpper=u._nextInt32()):(e.sampleLower=u._nextUint32(),e.sampleUpper=u._nextUint32()),g.samples[R]=e}s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(g);const m=new ri(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),i=li(t);if(s.keyValue[i]=m._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){const e=li(s.keyValue[i]);s.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}m._skip(e%4?4-e%4:0)}if(h<=0)return s;const b=new ri(e,A,h,!0),f=b._nextUint16(),C=b._nextUint16(),v=b._nextUint32(),y=b._nextUint32(),x=b._nextUint32(),I=b._nextUint32(),E=[];for(let R=0;R<n;R++)E.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const B=A+b._offset,w=B+v,S=w+y,Q=S+x,j=new Uint8Array(e.buffer,e.byteOffset+B,v),M=new Uint8Array(e.buffer,e.byteOffset+w,y),D=new Uint8Array(e.buffer,e.byteOffset+S,x),T=new Uint8Array(e.buffer,e.byteOffset+Q,I);return s.globalData={endpointCount:f,selectorCount:C,imageDescs:E,endpointsData:j,selectorsData:M,tablesData:D,extendedData:T},s}(new Uint8Array(e)),i=s.vkFormat===ai&&167===s.dataFormatDescriptor[0].colorModel;if(!(0===s.vkFormat||i&&!this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===Ci[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let s;2===e.supercompressionScheme&&(mi||(mi=new Promise(async e=>{const t=new ui;await t.init(),e(t)})),s=await mi);const i=[];for(let n=0;n<e.levels.length;n++){const a=Math.max(1,e.pixelWidth>>n),r=Math.max(1,e.pixelHeight>>n),o=e.pixelDepth?Math.max(1,e.pixelDepth>>n):0,l=e.levels[n];let c,A;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=s.decode(l.levelData,l.uncompressedByteLength)}A=vi[t]===Te?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):vi[t]===De?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,i.push({data:A,width:a,height:r,depth:o})}let a;if(fi.has(Ci[t]))a=0===e.pixelDepth?new Re(i[0].data,e.pixelWidth,e.pixelHeight):new ke(i[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");a=new fe(i,e.pixelWidth,e.pixelHeight)}return a.mipmaps=i,a.type=vi[t],a.format=Ci[t],a.colorSpace=yi(e),a.needsUpdate=!0,Promise.resolve(a)}(s);const a=t,n=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(e=>this._createTextureFrom(e.data,s));return pi.set(e,{promise:n}),n}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}bi.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},bi.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},bi.EngineFormat={RGBAFormat:Ce,RGBA_ASTC_4x4_Format:ve,RGB_BPTC_UNSIGNED_Format:ye,RGBA_BPTC_Format:xe,RGBA_ETC2_EAC_Format:Ie,RGBA_PVRTC_4BPPV1_Format:Ee,RGBA_S3TC_DXT5_Format:Be,RGB_ETC1_Format:we,RGB_ETC2_Format:Se,RGB_PVRTC_4BPPV1_Format:Qe,RGBA_S3TC_DXT1_Format:je},bi.EngineType={UnsignedByteType:Me,HalfFloatType:De,FloatType:Te},bi.BasisWorker=function(){let e,t,s;const i=_EngineFormat,a=_EngineType,n=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(i){const n=i.data;switch(n.type){case"init":e=n.config,o=n.transcoderBinary,t=new Promise(e=>{s={wasmBinary:o,onRuntimeInitialized:e},BASIS(s)}).then(()=>{s.initializeBasis(),s.KTX2File});break;case"transcode":t.then(()=>{try{const{faces:t,buffers:i,width:o,height:h,hasAlpha:d,format:u,type:g,dfdFlags:p}=function(t){const i=new s.KTX2File(new Uint8Array(t));function n(){i.close(),i.delete()}if(!i.isValid())throw n(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let o;if(i.isUASTC())o=r.UASTC;else if(i.isETC1S())o=r.ETC1S;else{if(!i.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");o=r.UASTC_HDR}const h=i.getWidth(),d=i.getHeight(),u=i.getLayers()||1,g=i.getLevels(),p=i.getFaces(),m=i.getHasAlpha(),b=i.getDFDFlags(),{transcoderFormat:f,engineFormat:C,engineType:v}=function(t,s,i,a){const n=l[t];for(let r=0;r<n.length;r++){const o=n[r];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(a&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!c(s)||!c(i)))continue;return{transcoderFormat:o.transcoderFormat[a?1:0],engineFormat:o.engineFormat[a?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(o,h,d,m);if(!h||!d||!g)throw n(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!i.startTranscoding())throw n(),new Error("THREE.KTX2Loader: .startTranscoding failed");const y=[],x=[];for(let e=0;e<p;e++){const t=[];for(let s=0;s<g;s++){const r=[];let o,l;for(let t=0;t<u;t++){const c=i.getImageLevelInfo(s,t,e);0===e&&0===s&&0===t&&(c.origWidth%4!=0||c.origHeight),g>1?(o=c.origWidth,l=c.origHeight):(o=c.width,l=c.height);let A=new Uint8Array(i.getImageTranscodedSizeInBytes(s,t,0,f));const h=i.transcodeImage(A,s,t,e,f,0,-1,-1);if(v===a.HalfFloatType&&(A=new Uint16Array(A.buffer,A.byteOffset,A.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!h)throw n(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(A)}const c=A(r);t.push({data:c,width:o,height:l}),x.push(c.buffer)}y.push({mipmaps:t,width:h,height:d,format:C,type:v})}return n(),{faces:y,buffers:x,width:h,height:d,hasAlpha:m,dfdFlags:b,format:C,type:v}}(n.buffer);self.postMessage({type:"transcode",id:n.id,data:{faces:t,width:o,height:h,hasAlpha:d,format:u,type:g,dfdFlags:p}},i)}catch(t){self.postMessage({type:"error",id:n.id,error:t.message})}})}var o});const o=[{if:"astcSupported",basisFormat:[r.UASTC],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[a.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[a.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[a.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[a.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[a.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[a.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[r.UASTC_HDR],transcoderFormat:[n.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[a.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[n.RGBA32,n.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[a.UnsignedByteType,a.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[r.UASTC_HDR],transcoderFormat:[n.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[a.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[r.ETC1S]:o.filter(e=>e.basisFormat.includes(r.ETC1S)).sort((e,t)=>e.priorityUASTC-t.priorityUASTC),[r.UASTC]:o.filter(e=>e.basisFormat.includes(r.UASTC)).sort((e,t)=>e.priorityUASTC-t.priorityUASTC),[r.UASTC_HDR]:o.filter(e=>e.basisFormat.includes(r.UASTC_HDR)).sort((e,t)=>e.priorityHDR-t.priorityHDR)};function c(e){return e<=2||!(e&e-1)&&0!==e}function A(e){if(1===e.length)return e[0];let t=0;for(let a=0;a<e.length;a++){t+=e[a].byteLength}const s=new Uint8Array(t);let i=0;for(let a=0;a<e.length;a++){const t=e[a];s.set(t,i),i+=t.byteLength}return s}};const fi=new Set([Ce,Fe,Le]),Ci={[ti]:Ce,[Zs]:Ce,[Ys]:Ce,[Ws]:Ce,[ei]:Fe,[Xs]:Fe,[Ks]:Fe,[Vs]:Fe,[$s]:Le,[Js]:Le,[qs]:Le,[_s]:Le,[ai]:ve,[ii]:Pe,[si]:Pe},vi={[ti]:Te,[Zs]:De,[Ys]:Me,[Ws]:Me,[ei]:Te,[Xs]:De,[Ks]:Me,[Vs]:Me,[$s]:Te,[Js]:De,[qs]:Me,[_s]:Me,[ai]:De,[ii]:Me,[si]:Me};function yi(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?m:h:10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(t.colorPrimaries,Oe)}var xi=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var s,i=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",a=WebAssembly.instantiate(n(i),{}).then(function(e){(s=e.instance).exports.__wasm_call_ctors()});function n(e){for(var s=new Uint8Array(e.length),i=0;i<e.length;++i){var a=e.charCodeAt(i);s[i]=a>96?a-97:a>64?a-39:a+4}var n=0;for(i=0;i<e.length;++i)s[n++]=s[i]<60?t[s[i]]:64*(s[i]-60)+s[++i];return s.buffer.slice(0,n)}function r(e,t,i,a,n,r){var o=s.exports.sbrk,l=i+3&-4,c=o(l*a),A=o(n.length),h=new Uint8Array(s.exports.memory.buffer);h.set(n,A);var d=e(c,i,a,A,n.length);if(0==d&&r&&r(c,l,a),t.set(h.subarray(c,c+i*a)),o(c-o(0)),0!=d)throw new Error("Malformed buffer data: "+d)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],A=0;function h(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var s=e.data;t.pending-=s.count,t.requests[s.id][s.action](s.value),delete t.requests[s.id]},t}function d(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(n(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+r.toString()+u.toString(),s=new Blob([t],{type:"text/javascript"}),a=URL.createObjectURL(s),o=0;o<e;++o)c[o]=h(a);URL.revokeObjectURL(a)}function u(e){a.then(function(){var t=e.data;try{var i=new Uint8Array(t.count*t.size);r(s.exports[t.mode],i,t.count,t.size,t.source,s.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:i},[i.buffer])}catch(a){self.postMessage({id:t.id,count:t.count,action:"reject",value:a})}})}return{ready:a,supported:!0,useWorkers:function(e){d(e)},decodeVertexBuffer:function(e,t,i,a,n){r(s.exports.meshopt_decodeVertexBuffer,e,t,i,a,s.exports[o[n]])},decodeIndexBuffer:function(e,t,i,a){r(s.exports.meshopt_decodeIndexBuffer,e,t,i,a)},decodeIndexSequence:function(e,t,i,a){r(s.exports.meshopt_decodeIndexSequence,e,t,i,a)},decodeGltfBuffer:function(e,t,i,a,n,c){r(s.exports[l[n]],e,t,i,a,s.exports[o[c]])},decodeGltfBufferAsync:function(e,t,i,n,h){return c.length>0?function(e,t,s,i,a){for(var n=c[0],r=1;r<c.length;++r)c[r].pending<n.pending&&(n=c[r]);return new Promise(function(r,o){var l=new Uint8Array(s),c=A++;n.pending+=e,n.requests[c]={resolve:r,reject:o},n.object.postMessage({id:c,count:e,size:t,source:l,mode:i,filter:a},[l.buffer])})}(e,t,i,l[n],o[h]):a.then(function(){var a=new Uint8Array(e*t);return r(s.exports[l[n]],a,e,t,i,s.exports[o[h]]),a})}}}();let Ii=null,Ei=null,Bi=!1;function wi(e){try{if(!e)return;Ei||(Ei=(new bi).setTranscoderPath("/libs/basis/")),Bi||(Ei.detectSupport(e),Bi=!0)}catch{}}function Si(){Ii||(Ii=new Us,Ii.setDecoderPath("/libs/draco/")),Ei||(Ei=(new bi).setTranscoderPath("/libs/basis/"));const e=new zt;try{e.setDRACOLoader(Ii)}catch{}try{e.setKTX2Loader(Ei)}catch{}try{e.setMeshoptDecoder(xi)}catch{}return e}const Qi="web3dEditor.settings.v1",ji=(e,t)=>{return{...e,...(s=t,"[object Object]"===Object.prototype.toString.call(s)?t:{})};var s};const Mi={isWireframe:!1,isGridSnap:!1,isGridVisible:!0,gizmoSpace:"world",gizmoSize:1,snapMove:1,snapRotateDeg:15,snapScale:.1,isPostProcessingEnabled:!1,cameraPanSpeed:50,cameraOrbitSpeed:100,cameraZoomSpeed:.3},Di={showLibrary:!1,showAssets:!1,isPostProcessingPanelOpen:!1,showHDRI:!1,isViewGizmoSettingsOpen:!1},Ti={},Ri={},ki={hdriSettings:{currentHDRI:{name:"기본 배경",type:"none"},hdriIntensity:1,hdriRotation:0,sunLightEnabled:!0,sunIntensity:1,timeOfDay:12,sunAzimuth:0,sunElevation:45,sunColor:"#ffffff"},postProcessing:{enabled:!1,preset:"default"},toneMapping:{enabled:!0,mapping:"ACESFilmic",exposure:1},safeMode:{enabled:!1,pixelRatio:1}},Oi={__version:1,viewGizmo:{...Mi},ui:{...Di},editor:{...Ti},game:{...Ri},environment:{...ki}};function Fi(){try{const e=localStorage.getItem(Qi);if(e){return Li(JSON.parse(e))}const t=localStorage.getItem("viewGizmoConfig"),s=localStorage.getItem("hdriSettings");if(t||s){const e={...Oi};if(t){const s=JSON.parse(t);e.viewGizmo=ji(Mi,s)}if(s){const t=JSON.parse(s);e.environment=ji(ki,{hdriSettings:ji(ki.hdriSettings,t)})}return Pi(e),e}return{...Oi}}catch{return{...Oi}}}function Li(e){const t=ji(Oi,e);return t.viewGizmo=ji(Mi,t.viewGizmo),t.ui=ji(Di,t.ui),t.editor=ji(Ti,t.editor),t.game=ji(Ri,t.game),t.environment=ji(ki,t.environment),t}function Pi(e){try{const t=Li(e||{});return localStorage.setItem(Qi,JSON.stringify(t)),!0}catch{return!1}}function Ni(e){const t=Fi();return null==t?void 0:t[e]}function Gi(e,t){const s=Fi();return Pi({...s,[e]:ji((null==s?void 0:s[e])||{},t||{})})}function Ui(e,t,s,i=150){if(!e||"function"!=typeof e.getState||"function"!=typeof e.subscribe)return()=>{};if("function"!=typeof s)return()=>{};let a=s(e.getState());const n=function(e,t=200){let s=null;return(...i)=>{s&&clearTimeout(s),s=setTimeout(()=>e(...i),t)}}(e=>Gi(t,e),i);return e.subscribe(e=>{try{const t=s(e);((e,t)=>{if(e===t)return!0;if(!e||!t)return!1;const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const a of s)if(e[a]!==t[a])return!1;return!0})(t,a)||(a=t,n(t))}catch{}})}function zi(){const e=Ni("viewGizmo");return ji(Mi,e||{})}function Hi(e){return Ui(e,"viewGizmo",e=>({isWireframe:!!e.isWireframe,isGridSnap:!!e.isGridSnap,isGridVisible:!!e.isGridVisible,gizmoSpace:e.gizmoSpace||"world",gizmoSize:Number.isFinite(e.gizmoSize)?e.gizmoSize:1,snapMove:Number.isFinite(e.snapMove)?e.snapMove:1,snapRotateDeg:Number.isFinite(e.snapRotateDeg)?e.snapRotateDeg:15,snapScale:Number.isFinite(e.snapScale)?e.snapScale:.1,isPostProcessingEnabled:!!e.isPostProcessingEnabled,cameraPanSpeed:Number.isFinite(e.cameraPanSpeed)?e.cameraPanSpeed:50,cameraOrbitSpeed:Number.isFinite(e.cameraOrbitSpeed)?e.cameraOrbitSpeed:100,cameraZoomSpeed:Number.isFinite(e.cameraZoomSpeed)?e.cameraZoomSpeed:.3}),150)}function _i(){const e=Ni("environment");return ji(ki,e||{})}function qi(e){return Gi("environment",e)}function Ki(e){return Ui(e,"environment",e=>{var t,s;return{hdriSettings:{...e.hdriSettings||{}},postProcessing:{enabled:!!e.isPostProcessingEnabled,preset:e.postProcessingPreset||"default"},safeMode:{enabled:!!(null==(t=e.safeMode)?void 0:t.enabled),pixelRatio:Number((null==(s=e.safeMode)?void 0:s.pixelRatio)??1)}}},200)}const Vi=Object.freeze(Object.defineProperty({__proto__:null,defaultAppSettings:Oi,defaultEditorSettings:Ti,defaultEnvironmentSettings:ki,defaultGameSettings:Ri,defaultUISettings:Di,defaultViewGizmoConfig:Mi,loadAppSettings:Fi,loadEnvironmentSettings:_i,loadSettingsSection:Ni,loadViewGizmoConfig:zi,saveAppSettings:Pi,saveEnvironmentSettings:qi,saveSettingsSection:Gi,saveViewGizmoConfig:function(e){return Gi("viewGizmo",e)},startEnvironmentAutoPersist:Ki,startSettingsAutoPersist:Ui,startViewGizmoConfigAutoPersist:Hi},Symbol.toStringTag,{value:"Module"})),Yi="customMeshes",Wi=async(e,t)=>{const s=(await new Promise((e,t)=>{const s=indexedDB.open("Web3DModelEditorDB",1);s.onupgradeneeded=e=>{const t=s.result;t.objectStoreNames.contains(Yi)||t.createObjectStore(Yi,{keyPath:"id"})},s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})).transaction(Yi,e),i=s.objectStore(Yi),a=await t(i);return await new Promise((e,t)=>{s.oncomplete=()=>e(),s.onabort=()=>t(s.error),s.onerror=()=>t(s.error)}),a},Ji=async()=>{try{return await Wi("readonly",e=>new Promise((t,s)=>{const i=e.getAll();i.onsuccess=()=>t(i.result||[]),i.onerror=()=>s(i.error)}))}catch(e){return[]}},Xi=async e=>{let t={...e};try{const s=null==e?void 0:e.glbData;Array.isArray(s)&&(t.glbData=new Uint8Array(s).buffer)}catch{}try{const s=null==e?void 0:e.thumbnail;if("string"==typeof s&&s.startsWith("data:")){const e=await fetch(s),i=await e.blob();t.thumbnail=i}}catch(s){}await Wi("readwrite",e=>new Promise((s,i)=>{const a=e.put(t);a.onsuccess=()=>s(),a.onerror=()=>i(a.error)}))},Zi=async e=>{await Wi("readwrite",t=>new Promise((s,i)=>{const a=t.delete(e);a.onsuccess=()=>s(),a.onerror=()=>i(a.error)}))},$i=(()=>{try{const e=_i();if(null==e?void 0:e.hdriSettings)return e.hdriSettings}catch{}try{const e=localStorage.getItem("hdriSettings");if(e)return JSON.parse(e)}catch{}return null})(),ea=(e,t={x:0,y:0,z:0})=>{if(!e&&0!==e)return{...t};if(Array.isArray(e)){const[s=t.x,i=t.y,a=t.z]=e;return{x:s,y:i,z:a}}if("object"==typeof e){return{x:Number.isFinite(e.x)?e.x:t.x,y:Number.isFinite(e.y)?e.y:t.y,z:Number.isFinite(e.z)?e.z:t.z}}return{...t}},ta=e=>{if(!e||"object"!=typeof e)return e;const t={...e};return t.position=ea(e.position,{x:0,y:0,z:0}),t.rotation=ea(e.rotation,{x:0,y:0,z:0}),t.scale=ea(e.scale,{x:1,y:1,z:1}),t},sa=Pt((e,t)=>{const s=zi(),i=Ni("ui")||{};return{scene:null,camera:null,renderer:null,_historyPast:[],_historyFuture:[],_batchActive:!1,_batchBuffer:[],canUndo:!1,canRedo:!1,selectedObject:null,selectedIds:[],transformMode:"translate",isWireframe:!!s.isWireframe,isGridSnap:!!s.isGridSnap,isGridVisible:!!s.isGridVisible,gridSize:1,gizmoSpace:s.gizmoSpace||"world",gizmoSize:Number.isFinite(s.gizmoSize)?s.gizmoSize:1,snapMove:Number.isFinite(s.snapMove)?s.snapMove:1,snapRotateDeg:Number.isFinite(s.snapRotateDeg)?s.snapRotateDeg:15,snapScale:Number.isFinite(s.snapScale)?s.snapScale:.1,cameraPanSpeed:Number.isFinite(s.cameraPanSpeed)?s.cameraPanSpeed:50,cameraOrbitSpeed:Number.isFinite(s.cameraOrbitSpeed)?s.cameraOrbitSpeed:100,cameraZoomSpeed:Number.isFinite(s.cameraZoomSpeed)?s.cameraZoomSpeed:.3,hdriSettings:{currentHDRI:{name:"기본 배경",type:"none"},hdriIntensity:1,hdriRotation:0,sunLightEnabled:!0,sunIntensity:1,timeOfDay:12,sunAzimuth:0,sunElevation:45,sunColor:"#ffffff",...$i},sunLightRef:null,dropIndicator:{easing:"easeInOutQuad",inMs:200,outMs:220,maxOpacity:.6},postProcessingManager:null,isPostProcessingEnabled:(()=>{var e,t;try{return!!(null==(t=null==(e=_i())?void 0:e.postProcessing)?void 0:t.enabled)}catch{}return!!s.isPostProcessingEnabled})(),postProcessingPreset:(()=>{var e,t;try{return(null==(t=null==(e=_i())?void 0:e.postProcessing)?void 0:t.preset)||"default"}catch{}return"default"})(),safeMode:(()=>{const e=_i();return{enabled:!1,pixelRatio:1,notes:"Disables FXAA/SSAO and forces pixelRatio to 1.0 to reduce VRAM.",...(null==e?void 0:e.safeMode)||{}}})(),vramEstimateMB:0,rendererAA:(()=>{var e;try{return(null==(e=_i())?void 0:e.rendererAA)||"msaa"}catch{}return"msaa"})(),renderMode:(()=>{var e;try{return(null==(e=_i())?void 0:e.renderMode)||"continuous"}catch{}return"continuous"})(),savedObjects:new Map,customMeshes:[],objects:[],walls:[],clipboard:null,showLibrary:!!i.showLibrary,showAssets:!!i.showAssets,isPostProcessingPanelOpen:!!i.isPostProcessingPanelOpen,showHDRI:!!i.showHDRI,isViewGizmoSettingsOpen:!!i.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!i.dragUseSelectionForDnD,setShowLibrary:t=>e({showLibrary:!!t}),setShowAssets:t=>e({showAssets:!!t}),setIsPostProcessingPanelOpen:t=>e({isPostProcessingPanelOpen:!!t}),setShowHDRI:t=>e({showHDRI:!!t}),setIsViewGizmoSettingsOpen:t=>e({isViewGizmoSettingsOpen:!!t}),setDragUseSelectionForDnD:t=>e({dragUseSelectionForDnD:!!t}),setSelectedObject:t=>e({selectedObject:t}),setSelectedIds:t=>e({selectedIds:Array.isArray(t)?Array.from(new Set(t)):[]}),setTransformMode:t=>e({transformMode:t}),toggleWireframe:()=>e(e=>({isWireframe:!e.isWireframe})),toggleGridSnap:()=>e(e=>({isGridSnap:!e.isGridSnap})),toggleGridVisible:()=>e(e=>({isGridVisible:!e.isGridVisible})),setGridSize:t=>e({gridSize:t}),toggleGizmoSpace:()=>e(e=>({gizmoSpace:"world"===e.gizmoSpace?"local":"world"})),setGizmoSize:t=>e({gizmoSize:Math.max(.1,Math.min(5,Number(t)||1))}),setSnapMove:t=>e({snapMove:Math.max(.001,Math.min(1e3,Number(t)||1))}),setSnapRotateDeg:t=>e({snapRotateDeg:Math.max(.1,Math.min(360,Number(t)||15))}),setSnapScale:t=>e({snapScale:Math.max(.001,Math.min(100,Number(t)||.1))}),setCameraPanSpeed:t=>e({cameraPanSpeed:Math.max(1,Math.min(500,Number(t)||50))}),setCameraOrbitSpeed:t=>e({cameraOrbitSpeed:Math.max(1,Math.min(1e3,Number(t)||100))}),setCameraZoomSpeed:t=>e({cameraZoomSpeed:Math.max(.01,Math.min(5,Number(t)||.3))}),rehydrateViewGizmoConfig:()=>{const t=zi();e({isWireframe:!!t.isWireframe,isGridSnap:!!t.isGridSnap,isGridVisible:!!t.isGridVisible,gizmoSpace:t.gizmoSpace||"world",gizmoSize:Number.isFinite(t.gizmoSize)?t.gizmoSize:1,snapMove:Number.isFinite(t.snapMove)?t.snapMove:1,snapRotateDeg:Number.isFinite(t.snapRotateDeg)?t.snapRotateDeg:15,snapScale:Number.isFinite(t.snapScale)?t.snapScale:.1,isPostProcessingEnabled:!!t.isPostProcessingEnabled,cameraPanSpeed:Number.isFinite(t.cameraPanSpeed)?t.cameraPanSpeed:50,cameraOrbitSpeed:Number.isFinite(t.cameraOrbitSpeed)?t.cameraOrbitSpeed:100,cameraZoomSpeed:Number.isFinite(t.cameraZoomSpeed)?t.cameraZoomSpeed:.3})},useBlenderControls:!0,setUseBlenderControls:t=>e({useBlenderControls:!!t}),updateHDRISettings:t=>e(e=>({hdriSettings:{...e.hdriSettings,...t}})),setSunLightRef:t=>e({sunLightRef:t}),updateDropIndicator:t=>e(e=>({dropIndicator:{...e.dropIndicator,...t}})),setPostProcessingManager:t=>e({postProcessingManager:t}),setRendererAA:s=>{var i;const a=["msaa","fxaa","none"].includes(s)?s:"msaa";e({rendererAA:a});try{qi({rendererAA:a})}catch{}try{const e=t().postProcessingManager;e&&e.setEffectEnabled("fxaa","fxaa"===a&&!(null==(i=t().safeMode)?void 0:i.enabled))}catch{}},setRenderMode:t=>{const s=["continuous","on-demand"].includes(t)?t:"continuous";e({renderMode:s});try{qi({renderMode:s})}catch{}},togglePostProcessingEnabled:()=>e(e=>({isPostProcessingEnabled:!e.isPostProcessingEnabled})),setPostProcessingPreset:t=>e({postProcessingPreset:t||"default"}),toggleSafeMode:s=>{const i=void 0!==s?!!s:!t().safeMode.enabled,a={...t().safeMode,enabled:i};e({safeMode:a});try{const e=t().postProcessingManager;e&&(e.setEffectEnabled("fxaa",!i),e.setEffectEnabled("ssao",!i),e.handleResize(window.innerWidth,window.innerHeight))}catch{}try{const e=t().renderer;if(e){const s=i?t().safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);e.setPixelRatio(s)}}catch{}try{t().estimateVRAMUsage()}catch{}try{qi({safeMode:{enabled:t().safeMode.enabled,pixelRatio:t().safeMode.pixelRatio}})}catch{}},setSafeModePixelRatio:s=>{const i=Math.max(.5,Math.min(2,Number(s)||1)),a={...t().safeMode,pixelRatio:i};e({safeMode:a});try{const e=t().renderer;e&&t().safeMode.enabled&&e.setPixelRatio(i)}catch{}try{const e=t().postProcessingManager;e&&e.handleResize(window.innerWidth,window.innerHeight)}catch{}try{t().estimateVRAMUsage()}catch{}try{qi({safeMode:{enabled:t().safeMode.enabled,pixelRatio:i}})}catch{}},estimateVRAMUsage:(s={})=>{var i,a,n,r,o;const l=s.width||window.innerWidth,c=s.height||window.innerHeight;let A=1;try{A=(null==(a=null==(i=t().renderer)?void 0:i.getPixelRatio)?void 0:a.call(i))||window.devicePixelRatio||1}catch{}const h=Math.max(1,Math.floor(l*A)),d=Math.max(1,Math.floor(c*A));let u=h*d*8;try{const e=t().postProcessingManager,s=t().isPostProcessingEnabled;if(e&&s){u+=h*d*8;const t=(null==(n=e.getSettings)?void 0:n.call(e))||{};(null==(r=t.ssao)?void 0:r.enabled)&&(u+=h*d*2*4),(null==(o=t.fxaa)?void 0:o.enabled)&&(u+=h*d*4)}}catch{}const g=Math.round(u/1048576);return e({vramEstimateMB:g}),g},initializeHDRISettings:()=>{try{const t=localStorage.getItem("hdriSettings");if(t){const s=JSON.parse(t);return e(e=>({hdriSettings:{...e.hdriSettings,...s}})),!0}}catch(t){}return!1},saveHDRISettings:()=>{const{hdriSettings:e}=t();try{!function(e){try{qi({hdriSettings:{...e||{}}})}catch{}}(e)}catch{}try{localStorage.setItem("hdriSettings",JSON.stringify(e))}catch{}},addAsset:(t,s)=>e(e=>{const i=new Map(e.savedObjects);return i.set(t,s),{savedObjects:i}}),addCustomMesh:async t=>{try{await Xi(t),e(e=>({customMeshes:[...e.customMeshes,t]}))}catch(s){try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"저장에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}catch{}}},deleteCustomMesh:async t=>{try{await Zi(t),e(e=>({customMeshes:e.customMeshes.filter(e=>e.id!==t)}))}catch(s){try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}catch{}}},loadCustomMeshes:t=>e(()=>({customMeshes:t})),updateObjectTransform:(s,i)=>e(e=>{const a=ta(i),n=e.objects.find(e=>e.id===s),r=n?{...n,...a}:null,o=e.objects.map(e=>e.id===s?{...e,...a}:e);if(n){const e={type:"transform",id:s,before:aa(n),after:aa(r)},{_pushHistory:i}=t();i(e)}return{objects:o}}),addObject:s=>e(e=>{const i=ta(s),a=Object.prototype.hasOwnProperty.call(i,"parentId")?i.parentId??null:null;let n=i.order;if(!Number.isFinite(n)){n=e.objects.filter(e=>(e.parentId??null)===a).reduce((e,t)=>Number.isFinite(t.order)?Math.max(e,t.order):e,-1)+1}const r={...i,parentId:a,order:n},o=[...e.objects,r],l={type:"add",object:ia(r)},{_pushHistory:c}=t();return c(l),{objects:o}}),removeObject:s=>e(e=>{if(s.isSystemObject)return e;const i=e.objects.filter(e=>e!==s),a={type:"remove",object:ia(s)},{_pushHistory:n}=t();return n(a),{objects:i,selectedObject:e.selectedObject===s?null:e.selectedObject}}),removeObjectById:s=>e(e=>{const i=e.objects.find(e=>e.id===s);if(!i)return{};if(i.isSystemObject)return{};const{_pushHistory:a}=t(),n=e.objects.filter(e=>e.parentId===s);let r=e.objects;for(const t of n){const e=t.parentId??null,s=i.parentId??null;e!==s&&(a({type:"reparent",id:t.id,before:{parentId:e},after:{parentId:s}}),r=r.map(e=>e.id===t.id?{...e,parentId:s}:e))}a({type:"remove",object:ia(i)});return{objects:r.filter(e=>e.id!==s),selectedObject:e.selectedObject===s?null:e.selectedObject}}),setParent:(s,i)=>e(e=>{const a=e.objects.find(e=>e.id===s);if(!a)return{};const n=a.parentId??null,r=i??null;if(n===r)return{};const o={type:"reparent",id:s,before:{parentId:n},after:{parentId:r}},{_pushHistory:l}=t();l(o);const c=e.objects.filter(e=>(e.parentId??null)===r&&e.id!==s).reduce((e,t)=>Number.isFinite(t.order)?Math.max(e,t.order):e,-1)+1;return{objects:e.objects.map(e=>e.id===s?{...e,parentId:r,order:c}:e)}}),reorderSiblings:(t,s)=>e(e=>{if(!Array.isArray(s))return{};const i=new Map(s.map((e,t)=>[e,t]));return{objects:e.objects.map(e=>(e.parentId??null)!==(t??null)?e:i.has(e.id)?{...e,order:i.get(e.id)}:e)}}),addWall:t=>e(e=>({walls:[...e.walls,t]})),removeWall:t=>e(e=>({walls:e.walls.filter(e=>e.id!==t)})),updateObject:(s,i)=>e(e=>{const a=e.objects.find(e=>e.id===s),n=ta(i),r=e.objects.map(e=>e.id===s?{...e,...n}:e);if(a){const e={type:"update",id:s,before:na(a,n),after:n},{_pushHistory:i}=t();i(e)}return{objects:r}}),copyObject:s=>{var i,a,n,r,o;if(!s)return;if(s.isObject3D){t();const l=null==(i=s.userData)?void 0:i.id;if(l){const{updateObjectTransform:e}=t();e(l,{position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}})}const c=t().objects.find(e=>e.id===l),A={name:`${s.name}_copy`,type:(null==c?void 0:c.type)||(null==(a=s.userData)?void 0:a.type)||"basic",geometry:(null==c?void 0:c.geometry)||(null==(n=s.userData)?void 0:n.geometry)||"BoxGeometry",params:(null==c?void 0:c.params)||(null==(r=s.userData)?void 0:r.params)||[1,1,1],uuid:s.uuid,..."glb"===(null==c?void 0:c.type)&&{url:c.url,glbData:c.glbData,file:c.file},position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z},visible:s.visible,material:(null==c?void 0:c.material)||(null==(o=s.userData)?void 0:o.material)||{type:"MeshStandardMaterial",color:16711680},originalObject:s};return void e({clipboard:A})}if(s.isSystemObject)return;const l={...s,id:void 0,name:`${s.name}_copy`};e({clipboard:l})},pasteObject:()=>{var s,i,a,n,r,o,l,c,A;const h=t();if(!h.clipboard)return null;const d={...h.clipboard,id:Date.now(),position:{x:(null==(s=h.clipboard.position)?void 0:s.x)||0,y:(null==(i=h.clipboard.position)?void 0:i.y)||0,z:(null==(a=h.clipboard.position)?void 0:a.z)||0},rotation:{x:(null==(n=h.clipboard.rotation)?void 0:n.x)||0,y:(null==(r=h.clipboard.rotation)?void 0:r.y)||0,z:(null==(o=h.clipboard.rotation)?void 0:o.z)||0},scale:{x:(null==(l=h.clipboard.scale)?void 0:l.x)||1,y:(null==(c=h.clipboard.scale)?void 0:c.y)||1,z:(null==(A=h.clipboard.scale)?void 0:A.z)||1}},u=[...h.objects,d];return e({objects:u,selectedObject:d.id}),d},hasClipboardData:()=>null!==t().clipboard,clearClipboard:()=>e({clipboard:null}),deleteSelectedObject:()=>{const s=t();if(!s.selectedObject)return;const i=s.objects.find(e=>e.id===s.selectedObject);if(!i)return;if(i.isSystemObject)return;const a=s.objects.filter(e=>e.id!==s.selectedObject),n={type:"remove",object:ia(i)},{_pushHistory:r}=t();r(n),e({objects:a,selectedObject:null})},updateWall:(t,s)=>e(e=>({walls:e.walls.map(e=>e.id===t?{...e,...s}:e)})),toggleObjectVisibility:s=>e(e=>{const i=!1===s.visible,a=e.objects.map(e=>e.id===s.id?{...e,visible:i}:e),n={type:"update",id:s.id,before:{visible:s.visible},after:{visible:i}},{_pushHistory:r}=t();r(n);return{objects:a,walls:e.walls.map(e=>e.id===s.id?{...e,visible:i}:e)}}),toggleObjectFreeze:s=>e(e=>{const i=!0!==s.frozen,a=e.objects.map(e=>e.id===s.id?{...e,frozen:i}:e),n={type:"update",id:s.id,before:{frozen:s.frozen},after:{frozen:i}},{_pushHistory:r}=t();r(n);return{objects:a,walls:e.walls.map(e=>e.id===s.id?{...e,frozen:i}:e)}}),renameObject:(s,i)=>e(e=>{const a=e.objects.find(e=>e.id===s),n=e.objects.map(e=>e.id===s?{...e,name:i}:e);if(a){const e={type:"update",id:s,before:{name:a.name},after:{name:i}},{_pushHistory:n}=t();n(e)}return{objects:n,walls:e.walls.map(e=>e.id===s?{...e,name:i}:e)}}),saveMap:e=>{const s=t(),i={walls:s.walls,objects:s.objects};localStorage.setItem(`map_${e}`,JSON.stringify(i))},loadMap:t=>{const s=localStorage.getItem(`map_${t}`);if(s){const t=JSON.parse(s),i=(t.objects||[]).map(e=>{const t=ta(e),s=Object.prototype.hasOwnProperty.call(t,"parentId")?t.parentId??null:null;let i=t.order;return Number.isFinite(i)||(i=0),{...t,parentId:s,order:i}}),a=(t.walls||[]).map(ta);return e(()=>({walls:a,objects:i})),!0}return!1},clearMap:()=>e(e=>({objects:e.objects.filter(e=>e.isSystemObject),walls:[],selectedObject:null})),setScene:(t,s,i)=>e({scene:t,camera:s,renderer:i}),_pushHistory:s=>{const{_batchActive:i,_historyPast:a}=t();if(i)return void e(e=>({_batchBuffer:[...e._batchBuffer,s]}));const n=[...a,s];e({_historyPast:n,_historyFuture:[],canUndo:n.length>0,canRedo:!1})},beginBatch:()=>e({_batchActive:!0,_batchBuffer:[]}),endBatch:()=>e(e=>{if(!e._batchActive)return{};const t=e._batchBuffer;if(0===t.length)return{_batchActive:!1,_batchBuffer:[]};const s={type:"batch",entries:t},i=[...e._historyPast,s];return{_batchActive:!1,_batchBuffer:[],_historyPast:i,_historyFuture:[],canUndo:i.length>0,canRedo:!1}}),undo:()=>{const s=t(),i=[...s._historyPast];if(0===i.length)return!1;try{s.setSelectedObject&&s.setSelectedObject(null),s.setSelectedIds&&s.setSelectedIds([])}catch{}const a=i.pop();ra(a,e,t);const n=[...s._historyFuture,a];return e({_historyPast:i,_historyFuture:n,canUndo:i.length>0,canRedo:n.length>0}),!0},redo:()=>{const s=t(),i=[...s._historyFuture];if(0===i.length)return!1;try{s.setSelectedObject&&s.setSelectedObject(null),s.setSelectedIds&&s.setSelectedIds([])}catch{}const a=i.pop();oa(a,e,t);const n=[...s._historyPast,a];return e({_historyFuture:i,_historyPast:n,canUndo:n.length>0,canRedo:i.length>0}),!0}}});try{Hi(sa)}catch{}try{Ki(sa)}catch{}try{Ui(sa,"ui",e=>({showLibrary:!!e.showLibrary,showAssets:!!e.showAssets,isPostProcessingPanelOpen:!!e.isPostProcessingPanelOpen,showHDRI:!!e.showHDRI,isViewGizmoSettingsOpen:!!e.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!e.dragUseSelectionForDnD}),120)}catch{}function ia(e){if(!e||"object"!=typeof e)return e;const t={...e};return"glbData"in t&&delete t.glbData,"file"in t&&delete t.file,t}function aa(e){return{position:ea(e.position,{x:0,y:0,z:0}),rotation:ea(e.rotation,{x:0,y:0,z:0}),scale:ea(e.scale,{x:1,y:1,z:1})}}function na(e,t){const s={},i=["name","visible","frozen","parentId","position","rotation","scale"];for(const a of i)a in t&&(s[a]="position"===a||"rotation"===a||"scale"===a?ea(e[a],"scale"===a?{x:1,y:1,z:1}:{x:0,y:0,z:0}):e[a]);return s}function ra(e,t,s){var i;if(e)switch(e.type){case"part-transform":{const t=s().scene;if(!t)break;const i=Array.isArray(e.parts)&&e.parts.length>0?e.parts:e.part&&e.before&&e.after?[{uuid:e.part.uuid,before:e.before}]:[];for(const s of i){const i=s.uuid,a=s.before||e.before;if(!i||!a)continue;let n=null;if(t.traverse(e=>{n||e.uuid!==i||(n=e)}),n&&n.isObject3D)try{n.position.set(a.position.x,a.position.y,a.position.z),n.rotation.set(a.rotation.x,a.rotation.y,a.rotation.z),n.scale.set(a.scale.x,a.scale.y,a.scale.z),n.updateMatrix(),n.updateMatrixWorld(!0)}catch{}}break}case"batch":for(let i=e.entries.length-1;i>=0;i--)ra(e.entries[i],t,s);break;case"reparent":{const i=s(),a=e.id,n=e.before;if(!a||!n)break;t({objects:i.objects.map(e=>e.id===a?{...e,parentId:n.parentId??null}:e)});break}case"add":{const a=null==(i=e.object)?void 0:i.id;if(!a)break;t({objects:s().objects.filter(e=>e.id!==a)});break}case"remove":{const i=s(),a=e.object;if(!a)break;t({objects:[...i.objects,ta(a)]});break}case"update":case"transform":{const i=s(),a=e.id,n=e.before;if(!a||!n)break;t({objects:i.objects.map(e=>e.id===a?{...e,...ta(n)}:e)});break}}}function oa(e,t,s){var i;if(e)switch(e.type){case"part-transform":{const t=s().scene;if(!t)break;const i=Array.isArray(e.parts)&&e.parts.length>0?e.parts:e.part&&e.before&&e.after?[{uuid:e.part.uuid,after:e.after}]:[];for(const s of i){const i=s.uuid,a=s.after||e.after;if(!i||!a)continue;let n=null;if(t.traverse(e=>{n||e.uuid!==i||(n=e)}),n&&n.isObject3D)try{n.position.set(a.position.x,a.position.y,a.position.z),n.rotation.set(a.rotation.x,a.rotation.y,a.rotation.z),n.scale.set(a.scale.x,a.scale.y,a.scale.z),n.updateMatrix(),n.updateMatrixWorld(!0)}catch{}}break}case"batch":for(let i=0;i<e.entries.length;i++)oa(e.entries[i],t,s);break;case"reparent":{const i=s(),a=e.id,n=e.after;if(!a||!n)break;t({objects:i.objects.map(e=>e.id===a?{...e,parentId:n.parentId??null}:e)});break}case"add":{const i=s(),a=e.object;if(!a)break;t({objects:[...i.objects,ta(a)]});break}case"remove":{const a=null==(i=e.object)?void 0:i.id;if(!a)break;t({objects:s().objects.filter(e=>e.id!==a)});break}case"update":case"transform":{const i=s(),a=e.id,n=e.after;if(!a||!n)break;t({objects:i.objects.map(e=>e.id===a?{...e,...ta(n)}:e)});break}}}const la=new Ge,ca=new v,Aa=new v,ha=new ee,da={X:new v(1,0,0),Y:new v(0,1,0),Z:new v(0,0,1)},ua={type:"change"},ga={type:"mouseDown",mode:null},pa={type:"mouseUp",mode:null},ma={type:"objectChange"};class ba extends Ue{constructor(e,t=null){super(void 0,t);const s=new Pa(this);this._root=s;const i=new Na;this._gizmo=i,s.add(i);const a=new Ga;this._plane=a,s.add(a);const n=this;function r(e,t){let s=t;Object.defineProperty(n,e,{get:function(){return void 0!==s?s:t},set:function(t){s!==t&&(s=t,a[e]=t,i[e]=t,n.dispatchEvent({type:e+"-changed",value:t}),n.dispatchEvent(ua))}}),n[e]=t,a[e]=t,i[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0),r("minX",-1/0),r("maxX",1/0),r("minY",-1/0),r("maxY",1/0),r("minZ",-1/0),r("maxZ",1/0);const o=new v,l=new v,c=new ee,A=new ee,h=new v,d=new ee,u=new v,g=new v,p=new v,m=new v;r("worldPosition",o),r("worldPositionStart",l),r("worldQuaternion",c),r("worldQuaternionStart",A),r("cameraPosition",h),r("cameraQuaternion",d),r("pointStart",u),r("pointEnd",g),r("rotationAxis",p),r("rotationAngle",0),r("eye",m),this._offset=new v,this._startNorm=new v,this._endNorm=new v,this._cameraScale=new v,this._parentPosition=new v,this._parentQuaternion=new ee,this._parentQuaternionInv=new ee,this._parentScale=new v,this._worldScaleStart=new v,this._worldQuaternionInv=new ee,this._worldScale=new v,this._positionStart=new v,this._quaternionStart=new ee,this._scaleStart=new v,this._getPointer=fa.bind(this),this._onPointerDown=va.bind(this),this._onPointerHover=Ca.bind(this),this._onPointerMove=ya.bind(this),this._onPointerUp=xa.bind(this),null!==t&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;null!==e&&la.setFromCamera(e,this.camera);const t=Ia(this._gizmo.picker[this.mode],la);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&(null==e||0===e.button)&&null!==this.axis){null!==e&&la.setFromCamera(e,this.camera);const t=Ia(this._plane,la,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,ga.mode=this.mode,this.dispatchEvent(ga)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let a=this.space;if("scale"===s?a="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(a="world"),void 0===i||null===t||!1===this.dragging||null!==e&&-1!==e.button)return;null!==e&&la.setFromCamera(e,this.camera);const n=Ia(this._plane,la,!0);if(n){if(this.pointEnd.copy(n.point).sub(this.worldPositionStart),"translate"===s)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===a&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===a&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===a&&(i.position.applyQuaternion(ha.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===a&&(i.parent&&i.position.add(ca.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(ca.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if("scale"===s){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),Aa.set(e,e,e)}else ca.copy(this.pointStart),Aa.copy(this.pointEnd),ca.applyQuaternion(this._worldQuaternionInv),Aa.applyQuaternion(this._worldQuaternionInv),Aa.divide(ca),-1===t.search("X")&&(Aa.x=1),-1===t.search("Y")&&(Aa.y=1),-1===t.search("Z")&&(Aa.z=1);i.scale.copy(this._scaleStart).multiply(Aa),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===s){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(ca.setFromMatrixPosition(this.camera.matrixWorld));let s=!1;"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ca.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(da[t]),ca.copy(da[t]),"local"===a&&ca.applyQuaternion(this.worldQuaternion),ca.cross(this.eye),0===ca.length()?s=!0:this.rotationAngle=this._offset.dot(ca.normalize())*e),("E"===t||s)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===a&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(ha.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(ha.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ua),this.dispatchEvent(ma)}}pointerUp(e){null!==e&&0!==e.button||(this.dragging&&null!==this.axis&&(pa.mode=this.mode,this.dispatchEvent(pa)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ua),this.dispatchEvent(ma),this.pointStart.copy(this.pointEnd))}getRaycaster(){return la}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function fa(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function Ca(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function va(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function ya(e){this.enabled&&this.pointerMove(this._getPointer(e))}function xa(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function Ia(e,t,s){const i=t.intersectObject(e,!0);for(let a=0;a<i.length;a++)if(i[a].object.visible||s)return i[a];return!1}const Ea=new Ye,Ba=new v(0,1,0),wa=new v(0,0,0),Sa=new C,Qa=new ee,ja=new ee,Ma=new v,Da=new C,Ta=new v(1,0,0),Ra=new v(0,1,0),ka=new v(0,0,1),Oa=new v,Fa=new v,La=new v;class Pa extends I{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;void 0!==t.object&&(t.object.updateMatrixWorld(),null===t.object.parent||t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class Na extends I{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new p({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new k({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const a=e.clone();a.color.setHex(16711680);const n=e.clone();n.color.setHex(65280);const r=e.clone();r.color.setHex(255);const o=e.clone();o.color.setHex(16711680),o.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const A=e.clone();A.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25;e.clone().color.setHex(16776960);const d=e.clone();d.color.setHex(7895160);const u=new ze(0,.04,.1,12);u.translate(0,.05,0);const g=new Ne(.08,.08,.08);g.translate(0,.04,0);const m=new P;m.setAttribute("position",new He([0,0,0,1,0,0],3));const b=new ze(.0075,.0075,.5,3);function f(e,t){const s=new Ke(e,.0075,3,64,t*Math.PI*2);return s.rotateY(Math.PI/2),s.rotateX(Math.PI/2),s}b.translate(0,.25,0);const C={X:[[new G(u,a),[.5,0,0],[0,0,-Math.PI/2]],[new G(u,a),[-.5,0,0],[0,0,Math.PI/2]],[new G(b,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new G(u,n),[0,.5,0]],[new G(u,n),[0,-.5,0],[Math.PI,0,0]],[new G(b,n)]],Z:[[new G(u,r),[0,0,.5],[Math.PI/2,0,0]],[new G(u,r),[0,0,-.5],[-Math.PI/2,0,0]],[new G(b,r),null,[Math.PI/2,0,0]]],XYZ:[[new G(new _e(.1,0),A.clone()),[0,0,0]]],XY:[[new G(new Ne(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new G(new Ne(.15,.15,.01),o.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new Ne(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new G(new ze(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new G(new ze(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new G(new ze(.2,0,.6,4),s),[0,.3,0]],[new G(new ze(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new G(new ze(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new G(new ze(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new G(new _e(.2,0),s)]],XY:[[new G(new Ne(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new G(new Ne(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new Ne(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},y={START:[[new G(new _e(.01,2),i),null,null,null,"helper"]],END:[[new G(new _e(.01,2),i),null,null,null,"helper"]],DELTA:[[new z(function(){const e=new P;return e.setAttribute("position",new He([0,0,0,1,1,1],3)),e}(),i),null,null,null,"helper"]],X:[[new z(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new z(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new z(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},x={XYZE:[[new G(f(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new G(f(.5,.5),a)]],Y:[[new G(f(.5,.5),n),null,[0,0,-Math.PI/2]]],Z:[[new G(f(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new G(f(.75,1),h),null,[0,Math.PI/2,0]]]},E={AXIS:[[new z(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},B={XYZE:[[new G(new qe(.25,10,8),s)]],X:[[new G(new Ke(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new G(new Ke(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new G(new Ke(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new G(new Ke(.75,.1,2,24),s)]]},w={X:[[new G(g,a),[.5,0,0],[0,0,-Math.PI/2]],[new G(b,a),[0,0,0],[0,0,-Math.PI/2]],[new G(g,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new G(g,n),[0,.5,0]],[new G(b,n)],[new G(g,n),[0,-.5,0],[0,0,Math.PI]]],Z:[[new G(g,r),[0,0,.5],[Math.PI/2,0,0]],[new G(b,r),[0,0,0],[Math.PI/2,0,0]],[new G(g,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new G(new Ne(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new G(new Ne(.15,.15,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new Ne(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new G(new Ne(.1,.1,.1),A.clone())]]},S={X:[[new G(new ze(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new G(new ze(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new G(new ze(.2,0,.6,4),s),[0,.3,0]],[new G(new ze(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new G(new ze(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new G(new ze(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new G(new Ne(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new G(new Ne(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new Ne(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new G(new Ne(.2,.2,.2),s),[0,0,0]]]},Q={X:[[new z(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new z(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new z(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function j(e){const t=new I;for(const s in e)for(let i=e[s].length;i--;){const a=e[s][i][0].clone(),n=e[s][i][1],r=e[s][i][2],o=e[s][i][3],l=e[s][i][4];a.name=s,a.tag=l,n&&a.position.set(n[0],n[1],n[2]),r&&a.rotation.set(r[0],r[1],r[2]),o&&a.scale.set(o[0],o[1],o[2]),a.updateMatrix();const c=a.geometry.clone();c.applyMatrix4(a.matrix),a.geometry=c,a.renderOrder=1/0,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1),t.add(a)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(C)),this.add(this.gizmo.rotate=j(x)),this.add(this.gizmo.scale=j(w)),this.add(this.picker.translate=j(v)),this.add(this.picker.rotate=j(B)),this.add(this.picker.scale=j(S)),this.add(this.helper.translate=j(y)),this.add(this.helper.rotate=j(E)),this.add(this.helper.scale=j(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:ja;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const e=s[i];let a;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),a=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(a*this.size/4),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const s=.99,i=.2;"X"===e.name&&Math.abs(Ba.copy(Ta).applyQuaternion(t).dot(this.eye))>s&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"===e.name&&Math.abs(Ba.copy(Ra).applyQuaternion(t).dot(this.eye))>s&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"===e.name&&Math.abs(Ba.copy(ka).applyQuaternion(t).dot(this.eye))>s&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(Ba.copy(ka).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(Ba.copy(Ta).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(Ba.copy(Ra).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)}else"rotate"===this.mode&&(Qa.copy(t),Ba.copy(this.eye).applyQuaternion(ha.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(Sa.lookAt(this.eye,wa,Ra)),"X"===e.name&&(ha.setFromAxisAngle(Ta,Math.atan2(-Ba.y,Ba.z)),ha.multiplyQuaternions(Qa,ha),e.quaternion.copy(ha)),"Y"===e.name&&(ha.setFromAxisAngle(Ra,Math.atan2(Ba.x,Ba.z)),ha.multiplyQuaternions(Qa,ha),e.quaternion.copy(ha)),"Z"===e.name&&(ha.setFromAxisAngle(ka,Math.atan2(Ba.y,Ba.x)),ha.multiplyQuaternions(Qa,ha),e.quaternion.copy(ha)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(t){return e.name===t}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}else e.visible=!1,"AXIS"===e.name?(e.visible=!!this.axis,"X"===this.axis&&(ha.setFromEuler(Ea.set(0,0,0)),e.quaternion.copy(t).multiply(ha),Math.abs(Ba.copy(Ta).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(ha.setFromEuler(Ea.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(ha),Math.abs(Ba.copy(Ra).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(ha.setFromEuler(Ea.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(ha),Math.abs(Ba.copy(ka).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(ha.setFromEuler(Ea.set(0,Math.PI/2,0)),Ba.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(Sa.lookAt(wa,Ba,Ra)),e.quaternion.multiply(ha),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),ca.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ca.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(ca),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld(e)}}class Ga extends G{constructor(){super(new Ve(1e5,1e5,2,2),new p({visible:!1,wireframe:!0,side:F,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Oa.copy(Ta).applyQuaternion("local"===t?this.worldQuaternion:ja),Fa.copy(Ra).applyQuaternion("local"===t?this.worldQuaternion:ja),La.copy(ka).applyQuaternion("local"===t?this.worldQuaternion:ja),Ba.copy(Fa),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ba.copy(this.eye).cross(Oa),Ma.copy(Oa).cross(Ba);break;case"Y":Ba.copy(this.eye).cross(Fa),Ma.copy(Fa).cross(Ba);break;case"Z":Ba.copy(this.eye).cross(La),Ma.copy(La).cross(Ba);break;case"XY":Ma.copy(La);break;case"YZ":Ma.copy(Oa);break;case"XZ":Ba.copy(La),Ma.copy(Fa);break;case"XYZ":case"E":Ma.set(0,0,0)}break;default:Ma.set(0,0,0)}0===Ma.length()?this.quaternion.copy(this.cameraQuaternion):(Da.lookAt(ca.set(0,0,0),Ma,Ba),this.quaternion.setFromRotationMatrix(Da)),super.updateMatrixWorld(e)}}class Ua{constructor(e,t,s=null){this.camera=e,this.renderer=t,this.onCameraChange=s,this.initialPosition=e.position.clone(),this.initialTarget=new v(0,0,0),this.cameraTarget=new v(0,0,0),this.spherical=new We,this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget)),this._tempVector1=new v,this._tempVector2=new v,this._tempVector3=new v,this._panSpeed=50,this._orbitSpeed=100,this._zoomSpeed=.3}resetCamera(){this.camera.position.copy(this.initialPosition),this.cameraTarget.copy(this.initialTarget),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}toggleProjection(){const e=this.camera,t=e.position.clone(),s=this.cameraTarget.clone();if(e.isPerspectiveCamera){const e=t.distanceTo(s),i=window.innerWidth/window.innerHeight,a=.5*e,n=new Y(a*i/-2,a*i/2,a/2,a/-2,.1,1e3);n.position.copy(t),n.lookAt(s),n.updateMatrixWorld(),this.camera=n}else{const e=new K(75,window.innerWidth/window.innerHeight,.1,1e3);e.position.copy(t),e.lookAt(s),e.updateMatrixWorld(),this.camera=e}return this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget)),this.onCameraChange&&this.onCameraChange(this.camera),this.camera}setView(e){const t=this.camera.position.distanceTo(this.cameraTarget),s=this.cameraTarget.clone();let i=new v;switch(e){case"front":i.set(s.x,s.y,s.z+t);break;case"side":i.set(s.x+t,s.y,s.z);break;case"top":i.set(s.x,s.y+t,s.z);break;case"bottom":i.set(s.x,s.y-t,s.z);break;default:return}this.camera.position.copy(i),this.camera.lookAt(s),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}pan(e,t){const s=this._panSpeed,i=new v,a=new v;i.setFromMatrixColumn(this.camera.matrix,0),a.setFromMatrixColumn(this.camera.matrix,1);const n=s*(this.camera.position.distanceTo(this.cameraTarget)/50),r=new v;r.add(i.clone().multiplyScalar(-e*n)),r.add(a.clone().multiplyScalar(-t*n)),this.camera.position.add(r),this.cameraTarget.add(r),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}updateRotationCenterAfterPan(e,t=[]){const s=new Ge,i=new f(0,0);s.setFromCamera(i,this.camera);const a=s.intersectObjects(t,!0);if(a.length>0){const e=a[0].point;this.cameraTarget.copy(e)}else{const e=new v;e.setFromMatrixColumn(this.camera.matrix,2).negate();const t=this.camera.position.clone().add(e.multiplyScalar(50));this.cameraTarget.copy(t)}this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}orbit(e,t){const s=this._orbitSpeed;this.spherical.theta-=e*s*.01,this.spherical.phi+=t*s*.01,this.spherical.phi=Math.max(.1,Math.min(Math.PI-.1,this.spherical.phi));const i=new v;i.setFromSpherical(this.spherical),i.add(this.cameraTarget),this.camera.position.copy(i),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld()}zoom(e){const t=Math.max(.01,this._zoomSpeed),s=e>0?1+t:1/(1+t);if(this.camera.isPerspectiveCamera){this.spherical.radius*=s,this.spherical.radius=Math.max(1,Math.min(1e3,this.spherical.radius));const e=new v;e.setFromSpherical(this.spherical),e.add(this.cameraTarget),this.camera.position.copy(e),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld()}else if(this.camera.isOrthographicCamera){const e=(this.camera.right-this.camera.left)*s,t=(this.camera.top-this.camera.bottom)*s,i=2e3,a=.1,n=Math.max(a,Math.min(i,e)),r=Math.max(a,Math.min(i,t));this.camera.left=-n/2,this.camera.right=n/2,this.camera.top=r/2,this.camera.bottom=-r/2,this.camera.updateProjectionMatrix()}}setSpeeds({pan:e,orbit:t,zoom:s}={}){Number.isFinite(e)&&(this._panSpeed=e),Number.isFinite(t)&&(this._orbitSpeed=t),Number.isFinite(s)&&(this._zoomSpeed=s)}focusOnObject(e){if(!e)return;const t=(new ue).setFromObject(e),s=t.getCenter(new v),i=t.getSize(new v),a=Math.max(i.x,i.y,i.z);let n;if(this.camera.isPerspectiveCamera){const e=this.camera.fov*(Math.PI/180);n=1.5*Math.abs(a/Math.sin(e/2))}else n=2*a;this.cameraTarget.copy(s);const r=new v;r.subVectors(this.camera.position,this.cameraTarget).normalize(),this.camera.position.copy(s).add(r.multiplyScalar(n)),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}handleResize(){if(this.camera.isPerspectiveCamera)this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();else if(this.camera.isOrthographicCamera){const e=window.innerWidth/window.innerHeight,t=(this.camera.top-this.camera.bottom)*e;this.camera.left=-t/2,this.camera.right=t/2,this.camera.updateProjectionMatrix()}}setTarget(e){this.cameraTarget.copy(e),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}getCamera(){return this.camera}getTarget(){return this.cameraTarget.clone()}}class za{constructor(e,t,s,i){this.scene=e,this.camera=t,this.renderer=s,this.editorStore=i,this.gizmoScene=null,this.selectedObjects=[],this.lastSelectedObject=null,this.selectableObjects=[],this.raycaster=new Ge,this.selectionBox=null,this.createSelectionBox(),this.transformControls=null,this.gizmoMode="translate",this.isDragging=!1,this.snapEnabled=!1,this.gridSize=1,this.tempGroup=null,this.tempGroupCenter=new v,this.initialTransformStates=new Map,this.initializeTransformControls(),this._pendingTransformUpdates=new Map,this._rafScheduled=!1,this.postProcessingManager=null}_requestRender(){try{"undefined"!=typeof window&&"function"==typeof window.__requestRender&&window.__requestRender()}catch{}}_shouldUseFallbackOutline(){return!0}forceHideGizmoLines(){var e,t,s;try{const i=null==(t=null==(e=this.transformControls)?void 0:e.getHelper)?void 0:t.call(e);if(!i||!i.isObject3D)return;const a=this.gizmoScene||this.scene;i.parent!==a&&(i.parent&&i.parent.remove(i),a.add(i));const n=[];null==(s=i.traverse)||s.call(i,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,s=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||s)&&n.push(e)}),n.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})}catch{}}setGizmoScene(e){var t,s,i,a;this.gizmoScene=e;try{const n=null==(s=null==(t=this.transformControls)?void 0:t.getHelper)?void 0:s.call(t);if(n&&n.isObject3D&&e){try{const e=null==(a=null==(i=n.children)?void 0:i.find)?void 0:a.call(i,e=>"helper"===e.name);e&&(e.visible=!1);const t=e=>{var t;const s=[];null==(t=e.traverse)||t.call(e,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,i=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||i)&&s.push(e)}),s.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})};t(n),n.onBeforeRender=()=>{try{e&&(e.visible=!1),t(n)}catch{}}}catch{}n.parent&&n.parent.remove(n),e.add(n)}}catch{}}setPostProcessingManager(e){this.postProcessingManager=e}_syncOutlineWithSelection(){if(!this.postProcessingManager)return;const e=this.selectedObjects&&this.selectedObjects.length>0?[...this.selectedObjects]:[];try{this.postProcessingManager.setOutlineSelectedObjects(e);const t=this.lastSelectedObject&&e.includes(this.lastSelectedObject)?[this.lastSelectedObject]:e.length?[e[e.length-1]]:[];this.postProcessingManager.setOutlineActiveObjects(t)}catch{}}isInSceneGraph(e){if(!e)return!1;let t=e;for(;t;){if(t===this.scene)return!0;t=t.parent}return!1}validateTransformAttachment(){if(!this.transformControls||!this.transformControls.object)return;if(this.isDragging)return;const e=this.transformControls.object;if(!this.isInSceneGraph(e)){try{this.transformControls.detach()}catch{}this.editorStore.getState().setSelectedObject(null)}}createTempGroup(){return this.selectedObjects.length<=1?(this.clearTempGroup(),null):(this.clearTempGroup(),this.tempGroup=new q,this.tempGroup.name="TempSelectionGroup",this.tempGroup.userData.isTempGroup=!0,this.calculateGroupCenter(),this.tempGroup.position.copy(this.tempGroupCenter),this.scene.add(this.tempGroup),this.tempGroup)}calculateGroupCenter(){if(0===this.selectedObjects.length)return void this.tempGroupCenter.set(0,0,0);const e=new ue;this.selectedObjects.forEach(t=>{if(t){const s=(new ue).setFromObject(t);e.union(s)}}),e.getCenter(this.tempGroupCenter)}clearTempGroup(){this.tempGroup&&(this.scene.remove(this.tempGroup),this.tempGroup=null)}saveInitialTransformStates(){this.initialTransformStates.clear();for(const e of this.selectedObjects)e&&e.position&&e.rotation&&e.scale&&this.initialTransformStates.set(e,{position:e.position.clone(),rotation:e.rotation.clone(),scale:e.scale.clone()});this.tempGroup&&this.selectedObjects.length>1&&this.initialTransformStates.set(this.tempGroup,{position:this.tempGroup.position.clone(),rotation:this.tempGroup.rotation.clone(),scale:this.tempGroup.scale.clone()})}applyTransformToSelectedObjects(){if(!this.tempGroup||!this.transformControls.object||this.selectedObjects.length<=1)return;const e={position:this.tempGroup.position.clone(),rotation:this.tempGroup.rotation.clone(),scale:this.tempGroup.scale.clone()},t=this.initialTransformStates.get(this.tempGroup);if(t)for(const s of this.selectedObjects)if(s){const i=this.initialTransformStates.get(s);i&&this.applyRelativeTransformFromGroup(s,e,t,i)}}applyRelativeTransformFromGroup(e,t,s,i){switch(this.transformControls.getMode()){case"translate":const a=(new v).subVectors(t.position,s.position);e.position.copy(i.position).add(a);break;case"rotate":const n=(new ee).setFromEuler(new Ye(s.rotation.x,s.rotation.y,s.rotation.z)),r=(new ee).setFromEuler(new Ye(t.rotation.x,t.rotation.y,t.rotation.z)),o=(new ee).multiplyQuaternions(r,n.invert()),l=(new v).subVectors(i.position,s.position);l.applyQuaternion(o),e.position.copy(t.position).add(l);const c=(new ee).setFromEuler(new Ye(i.rotation.x,i.rotation.y,i.rotation.z));e.quaternion.multiplyQuaternions(o,c);break;case"scale":const A=new v(t.scale.x/s.scale.x,t.scale.y/s.scale.y,t.scale.z/s.scale.z),h=(new v).subVectors(i.position,s.position);h.multiply(A),e.position.copy(t.position).add(h),e.scale.copy(i.scale).multiply(A)}}applyRelativeTransform(e,t,s,i){switch(this.transformControls.getMode()){case"translate":const a=(new v).subVectors(t.position,s.position);e.position.copy(i.position).add(a);break;case"rotate":const n=new Ye(t.rotation.x-s.rotation.x,t.rotation.y-s.rotation.y,t.rotation.z-s.rotation.z);e.rotation.copy(i.rotation),e.rotation.x+=n.x,e.rotation.y+=n.y,e.rotation.z+=n.z;break;case"scale":const r=new v(t.scale.x/s.scale.x,t.scale.y/s.scale.y,t.scale.z/s.scale.z);e.scale.copy(i.scale).multiply(r)}}initializeTransformControls(){var e,t;try{this.transformControls=new ba(this.camera,this.renderer.domElement);try{const e=this.editorStore.getState();Number.isFinite(null==e?void 0:e.gizmoSize)&&this.transformControls.setSize(e.gizmoSize);const t=!!(null==e?void 0:e.isGridSnap),s=Number.isFinite(null==e?void 0:e.gridSize)?e.gridSize:1,i=Number.isFinite(null==e?void 0:e.snapMove)?e.snapMove:s,a=Number.isFinite(null==e?void 0:e.snapRotateDeg)?V.degToRad(e.snapRotateDeg):V.degToRad(15),n=Number.isFinite(null==e?void 0:e.snapScale)?e.snapScale:.1;t?(this.transformControls.setTranslationSnap(i||s||1),this.transformControls.setRotationSnap(a),this.transformControls.setScaleSnap(n)):(this.transformControls.setTranslationSnap(null),this.transformControls.setRotationSnap(null),this.transformControls.setScaleSnap(null))}catch{}this.transformControls.addEventListener("dragging-changed",e=>{var t,s,i,a,n,r;if(this.isDragging=e.value,e.value){this.saveInitialTransformStates();try{const e=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);(null==e?void 0:e.beginBatch)&&e.beginBatch()}catch{}}else{try{null==(i=this.flushPendingTransformUpdates)||i.call(this)}catch{}this.initialTransformStates.clear();try{const e=null==(n=null==(a=this.editorStore)?void 0:a.getState)?void 0:n.call(a),t=null==e?void 0:e.updateObjectTransform;if(t){const e=this.selectedObjects&&this.selectedObjects.length>0?this.selectedObjects:this.lastSelectedObject?[this.lastSelectedObject]:[];for(const s of e){const e=null==(r=null==s?void 0:s.userData)?void 0:r.id;e&&t(e,{position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}})}}(null==e?void 0:e.endBatch)&&e.endBatch()}catch{}}}),this.transformControls.addEventListener("change",()=>{this.applyTransformToSelectedObjects();try{(this.selectedObjects&&this.selectedObjects.length>0?this.selectedObjects:this.lastSelectedObject?[this.lastSelectedObject]:[]).forEach(e=>this.scheduleTransformUpdate(e))}catch{}}),this.transformControls.setSize(1);const s=this.transformControls.getHelper();if(s instanceof I){try{const i=null==(t=null==(e=s.children)?void 0:e.find)?void 0:t.call(e,e=>"helper"===e.name);i&&(i.visible=!1);const a=e=>{var t;const s=[];null==(t=e.traverse)||t.call(e,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,i=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||i)&&s.push(e)}),s.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})};a(s),s.onBeforeRender=()=>{try{i&&(i.visible=!1),a(s)}catch{}}}catch{}s.renderOrder=999;(this.gizmoScene||this.scene).add(s);try{const e=()=>{var e,t,i;try{const a=null==(t=null==(e=s.children)?void 0:e.find)?void 0:t.call(e,e=>"helper"===e.name);a&&(a.visible=!1);const n=[];null==(i=s.traverse)||i.call(s,e=>{const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,s=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||s)&&n.push(e)}),n.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})}catch{}};this.transformControls.addEventListener("change",e),this.transformControls.addEventListener("dragging-changed",e),this.transformControls.addEventListener("mouseDown",e),this.transformControls.addEventListener("mouseUp",e),this.transformControls.addEventListener("objectChange",e)}catch{}}}catch(s){this.transformControls=null}}scheduleTransformUpdate(e){var t;if(!e)return;const s=null==(t=e.userData)?void 0:t.id;s&&(this._pendingTransformUpdates.set(s,{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}),this._rafScheduled||(this._rafScheduled=!0,requestAnimationFrame(()=>this.flushPendingTransformUpdates())))}flushPendingTransformUpdates(){var e,t;if(this._rafScheduled=!1,this._pendingTransformUpdates&&0!==this._pendingTransformUpdates.size){try{const s=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:t.call(e),i=null==s?void 0:s.updateObjectTransform;if(i)for(const[e,t]of this._pendingTransformUpdates.entries())i(e,t)}catch{}this._pendingTransformUpdates.clear()}}createSelectionBox(){this.selectionBox=document.createElement("div"),this.selectionBox.style.position="absolute",this.selectionBox.style.border="2px dashed #007acc",this.selectionBox.style.backgroundColor="rgba(0, 122, 204, 0.1)",this.selectionBox.style.pointerEvents="none",this.selectionBox.style.display="none",this.selectionBox.style.zIndex="1000",document.body.appendChild(this.selectionBox)}isObjectValidForSelection(e){if(!e||!e.visible||!e.isObject3D)return!1;const t=this.editorStore.getState(),s=t.objects.find(t=>t.id===e.userData.id)||t.walls.find(t=>t.id===e.userData.id);return!s||!s.frozen}selectSingleObject(e){var t;if(e&&this.isObjectValidForSelection(e)){this.cleanupSelectedObjects(),this.deselectAllObjects(),this.selectedObjects=[e],this.lastSelectedObject=e,this.editorStore.getState().setSelectedObject(e);try{const s=this.editorStore.getState(),i=null==(t=null==e?void 0:e.userData)?void 0:t.id;(null==s?void 0:s.setSelectedIds)&&s.setSelectedIds(i?[i]:[])}catch{}if(this.clearTempGroup(),this.transformControls&&e.parent){let t=!1,s=e;for(;s.parent;)if(s=s.parent,s===this.scene){t=!0;break}t&&(this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}this._syncOutlineWithSelection();try{this.addSelectionOutline(e),this.updateSelectionOutline(e)}catch{}this._requestRender()}}selectMultipleObjects(e,t=!1){if(e&&Array.isArray(e)){t||this.deselectAllObjects();for(const t of e)if(t&&!this.selectedObjects.includes(t)){this.selectedObjects.push(t),this.lastSelectedObject=t;try{this.addSelectionOutline(t),this.updateSelectionOutline(t)}catch{}}if(this.selectedObjects.length>1){const e=this.createTempGroup();e&&this.transformControls&&e.parent===this.scene&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else if(1===this.selectedObjects.length){this.clearTempGroup();const e=this.selectedObjects[0];e&&this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}try{const e=this.editorStore.getState(),t=this.selectedObjects.map(e=>{var t;return null==(t=null==e?void 0:e.userData)?void 0:t.id}).filter(Boolean);(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds(t)}catch{}this._syncOutlineWithSelection(),this._requestRender()}}toggleObjectSelection(e){if(!e)return;const t=this.selectedObjects.indexOf(e);if(t>-1)if(this.selectedObjects.splice(t,1),this.removeSelectionOutline(e),this.lastSelectedObject===e&&(this.lastSelectedObject=this.selectedObjects.length>0?this.selectedObjects[this.selectedObjects.length-1]:null),this.selectedObjects.length>1){const e=this.createTempGroup();e&&this.transformControls&&e.parent===this.scene&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else if(1===this.selectedObjects.length){this.clearTempGroup();const e=this.selectedObjects[0];e&&this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else this.clearTempGroup(),this.editorStore.getState().setSelectedObject(null),this.lastSelectedObject=null,this.transformControls&&this.transformControls.detach();else{this.selectedObjects.push(e),this.lastSelectedObject=e;try{this.addSelectionOutline(e),this.updateSelectionOutline(e)}catch{}if(this.selectedObjects.length>1){const e=this.createTempGroup();e&&this.transformControls&&e.parent===this.scene&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else this.clearTempGroup(),this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}try{const e=this.editorStore.getState(),t=this.selectedObjects.map(e=>{var t;return null==(t=null==e?void 0:e.userData)?void 0:t.id}).filter(Boolean);(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds(t)}catch{}this._syncOutlineWithSelection(),this._requestRender()}deselectAllObjects(){if(this.transformControls)try{this.transformControls.detach()}catch(e){}this.clearTempGroup(),this.cleanupSelectedObjects();for(const t of this.selectedObjects)if(t)try{this.removeSelectionOutline(t)}catch(e){}this.selectedObjects=[],this.lastSelectedObject=null,this.editorStore.getState().setSelectedObject(null);try{const e=this.editorStore.getState();(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds([])}catch{}this._syncOutlineWithSelection(),this._requestRender()}cleanupSelectedObjects(){this.isDragging||(this.selectedObjects.length,this.selectedObjects=this.selectedObjects.filter(e=>this.isObjectValidForSelection(e)&&this.isInSceneGraph(e)),!this.lastSelectedObject||this.isObjectValidForSelection(this.lastSelectedObject)&&this.isInSceneGraph(this.lastSelectedObject)||(this.lastSelectedObject=this.selectedObjects.length>0?this.selectedObjects[this.selectedObjects.length-1]:null),this.validateTransformAttachment())}handleObjectSelection(e,t=!1){if(this.isDragging)return;this.raycaster.setFromCamera(e,this.camera);let s=[];try{s=this.raycaster.intersectObjects(this.selectableObjects,!0)}catch{s=[]}if((!s||0===s.length)&&this.scene)try{const e=this.raycaster.intersectObjects(this.scene.children,!0),t=e=>{let t=e;for(;t;){if(this.selectableObjects.includes(t))return t;t=t.parent}return null};for(const i of e){const e=t(i.object);if(e){s=[{object:e}];break}if(!s.length&&(null==i?void 0:i.object)){s=[{object:i.object}];break}}}catch{}if(s&&s.length>0){let e=s[0].object;for(;e&&e.parent&&!this.selectableObjects.includes(e);)e=e.parent;if(!e||!this.isObjectValidForSelection(e))return;t?this.toggleObjectSelection(e):this.selectSingleObject(e)}else t||this.isDragging||this.deselectAllObjects()}getObjectsInArea(e,t){const s=[],i=Math.min(e.x,t.x),a=Math.max(e.x,t.x),n=Math.min(e.y,t.y),r=Math.max(e.y,t.y);for(const o of this.selectableObjects){if(!this.isObjectValidForSelection(o))continue;const e=new v;o.getWorldPosition(e),e.project(this.camera),e.x>=i&&e.x<=a&&e.y>=n&&e.y<=r&&s.push(o)}return s}addSelectionOutline(e){var t;e&&((null==(t=e.userData)?void 0:t.isSelectionOutline)||this._shouldUseFallbackOutline()&&(e.isGroup||e.children&&e.children.length>0?this.addSelectionOutlineToGroup(e):this.addSelectionOutlineToSingleMesh(e)))}addSelectionOutlineToGroup(e){e&&e.traverse&&e.traverse(t=>{var s;t&&t.isMesh&&t!==e&&!(null==(s=t.userData)?void 0:s.isSelectionOutline)&&this.addSelectionOutlineToSingleMesh(t)})}addSelectionOutlineToSingleMesh(e){var t,s,i;try{if(!e||!e.isMesh)return;if(null==(t=e.userData)?void 0:t.isSelectionOutline)return;if(!this._shouldUseFallbackOutline())return;if(e.userData||(e.userData={}),e.userData.outlineObject){try{const t=e.userData.outlineObject;t&&t.parent!==e&&(t.parent&&t.parent.remove(t),e.add(t))}catch{}return}const a=(null==(i=null==(s=e.geometry)?void 0:s.clone)?void 0:i.call(s))||null;if(!a)return;try{a.attributes&&a.attributes.normal||a.computeVertexNormals()}catch{}const n=this.lastSelectedObject===e||1===this.selectedObjects.length&&this.selectedObjects[0]===e,r=new p({color:n?16765952:16742912,side:Je,transparent:!1,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});try{a.computeBoundingSphere()}catch{}const o=a.boundingSphere?a.boundingSphere.radius:1,l=Math.max(.002,.005*o);r.onBeforeCompile=e=>{e.uniforms.uOutlineThickness={value:l},e.vertexShader=e.vertexShader.replace("#include <common>","#include <common>\nuniform float uOutlineThickness;").replace("#include <begin_vertex>","#include <begin_vertex>\n  vec3 worldNormal = normalize(mat3(modelMatrix) * normal);\n  transformed += worldNormal * uOutlineThickness;"),r.userData.shader=e};const c=new G(a,r);c.name="SelectionOutline",c.userData=c.userData||{},c.userData.isSelectionOutline=!0,c.userData.isSystemObject=!0;try{c.layers.mask=e.layers.mask}catch{}try{c.renderOrder=(e.renderOrder||0)+.001}catch{}e.add(c),e.userData.outlineObject=c}catch{}}removeSelectionOutline(e){e&&(e.isGroup||e.children&&e.children.length>0?this.removeSelectionOutlineFromGroup(e):this.removeSelectionOutlineFromMesh(e))}removeSelectionOutlineFromGroup(e){if(e&&e.traverse){try{e.traverse(t=>{var s;t&&t.isMesh&&t!==e&&!(null==(s=t.userData)?void 0:s.isSelectionOutline)&&this.removeSelectionOutlineFromMesh(t)})}catch(t){}e.userData&&delete e.userData.outlineChildren}}removeSelectionOutlineFromMesh(e){if(e&&e.userData&&!e.userData.isSelectionOutline){if(e.userData.outlineObject){if(e.userData.outlineObject.parent&&e.userData.outlineObject.parent.remove(e.userData.outlineObject),e.userData.outlineObject.geometry){if(this.isDragging)return;e.userData.outlineObject.geometry.dispose()}e.userData.outlineObject.material&&e.userData.outlineObject.material.dispose(),delete e.userData.outlineObject}e.material&&void 0!==e.userData.originalEmissive&&(e.material.emissive.copy(e.userData.originalEmissive),e.material.emissiveIntensity=e.userData.originalEmissiveIntensity,delete e.userData.originalEmissive,delete e.userData.originalEmissiveIntensity)}}updateSelectionOutline(e){var t;(null==(t=e.userData)?void 0:t.isSelectionOutline)||this._shouldUseFallbackOutline()&&(e.isGroup||e.children&&e.children.length>0?this.updateSelectionOutlineForGroup(e):this.updateSelectionOutlineForMesh(e))}updateSelectionOutlineForGroup(e){e&&e.traverse&&e.traverse(t=>{var s;t&&t.isMesh&&t!==e&&!(null==(s=t.userData)?void 0:s.isSelectionOutline)&&this.updateSelectionOutlineForMesh(t)})}updateSelectionOutlineForMesh(e){var t,s;if(!e||!e.isMesh)return;if(null==(t=e.userData)?void 0:t.isSelectionOutline)return;if(!this._shouldUseFallbackOutline())return;const i=null==(s=e.userData)?void 0:s.outlineObject;if(i)try{const t=this.lastSelectedObject===e||1===this.selectedObjects.length&&this.selectedObjects[0]===e?16765952:16742912;i.material&&i.material.color&&i.material.color.setHex(t)}catch{}}updateAllSelectionOutlines(){this.isDragging||this.cleanupSelectedObjects(),this._syncOutlineWithSelection();if(this._shouldUseFallbackOutline()){for(const e of this.selectedObjects)if(e){try{this.addSelectionOutline(e)}catch{}try{this.updateSelectionOutline(e)}catch{}}}else for(const e of this.selectedObjects)if(e)try{this.removeSelectionOutline(e)}catch{}}setGizmoMode(e){if(!this.transformControls)return;this.gizmoMode=e,this.transformControls.setMode(e);const t=this.editorStore.getState();t.setTransformMode&&t.setTransformMode(e);const s=this.editorStore.getState().selectedObject;s&&!this.transformControls.object&&this.transformControls.attach(s)}setGridSnap(e,t=1){if(this.transformControls)if(e){const e=this.editorStore.getState(),s=Number.isFinite(null==e?void 0:e.snapMove)?e.snapMove:t,i=Number.isFinite(null==e?void 0:e.snapRotateDeg)?V.degToRad(e.snapRotateDeg):V.degToRad(15),a=Number.isFinite(null==e?void 0:e.snapScale)?e.snapScale:.1;this.transformControls.setTranslationSnap(s||t),this.transformControls.setRotationSnap(i),this.transformControls.setScaleSnap(a)}else this.transformControls.setTranslationSnap(null),this.transformControls.setRotationSnap(null),this.transformControls.setScaleSnap(null)}updateGizmoSize(){var e;try{const t=null==(e=this.editorStore.getState())?void 0:e.gizmoSize;this.transformControls&&Number.isFinite(t)&&this.transformControls.setSize(t)}catch{}}updateGridSnap(){const e=this.editorStore.getState();this.setGridSnap(e.isGridSnap,e.gridSize)}updateGizmoSpace(){const e=this.editorStore.getState();this.transformControls&&this.transformControls.setSpace(e.gizmoSpace)}isChildOf(e,t){let s=e.parent;for(;s;){if(s===t)return!0;s=s.parent}return!1}updateCamera(e){this.camera=e,this.transformControls&&(this.transformControls.camera=e)}addSelectableObject(e){this.selectableObjects.includes(e)||this.selectableObjects.push(e)}removeSelectableObject(e){const t=this.selectableObjects.indexOf(e);t>-1&&this.selectableObjects.splice(t,1)}updateSelectableObjects(e){this.selectableObjects=[...e]}showSelectionBox(e,t,s,i){this.selectionBox.style.display="block",this.selectionBox.style.left=e+"px",this.selectionBox.style.top=t+"px",this.selectionBox.style.width=s+"px",this.selectionBox.style.height=i+"px"}hideSelectionBox(){this.selectionBox.style.display="none"}getSelectedObjects(){return[...this.selectedObjects]}getSelectableObjects(){return[...this.selectableObjects]}getTransformControls(){return this.transformControls}isDraggingGizmo(){return this.isDragging}dispose(){this.clearTempGroup(),this.transformControls&&(this.transformControls.dispose(),this.scene.remove(this.transformControls)),this.selectionBox&&this.selectionBox.parentNode&&this.selectionBox.parentNode.removeChild(this.selectionBox)}}class Ha{constructor(e,t,s){this.objectSelector=e,this.editorStore=t,this.keyboardController=s,this.state={mode:"translate",space:"world",snapEnabled:!1,gridSize:1},this.registerKeyboardActions(),this.applyInitialSettings()}registerKeyboardActions(){this.keyboardController&&(this.keyboardController.registerTransformActions({setMode:e=>this.setTransformMode(e),toggleSpace:()=>this.toggleSpace(),toggleSnap:()=>this.toggleGridSnap()}),this.keyboardController.registerRotationActions({rotateX:e=>this.rotateSelectedX(e),rotateY:e=>this.rotateSelectedY(e),rotateZ:e=>this.rotateSelectedZ(e),resetRotation:()=>this.resetSelectedRotation()}),this.keyboardController.registerSelectionActions({deselectAll:()=>this.deselectAll(),selectAll:()=>this.selectAll()}),this.keyboardController.registerObjectActions({deleteSelected:()=>this.deleteSelected(),duplicateSelected:()=>this.duplicateSelected(),groupSelected:()=>this.groupSelected(),ungroupSelected:()=>this.ungroupSelected()}),this.keyboardController.registerSystemActions({undo:()=>this.undo(),redo:()=>this.redo()}))}setTransformMode(e){var t;return!(!this.isValidMode(e)||!this.objectSelector)&&(this.state.mode,this.state.mode=e,this.objectSelector.setGizmoMode(e),"rotate"===e&&this.setupQuaternionRotation(),(null==(t=this.editorStore)?void 0:t.getState().setTransformMode)&&this.editorStore.getState().setTransformMode(e),!0)}toggleSpace(){var e;return!!(null==(e=this.objectSelector)?void 0:e.transformControls)&&(this.state.space,this.state.space="world"===this.state.space?"local":"world",this.objectSelector.transformControls.setSpace(this.state.space),!0)}toggleGridSnap(){return!!this.objectSelector&&(this.state.snapEnabled=!this.state.snapEnabled,this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),!0)}setGridSize(e){return!(!this.objectSelector||!this.isValidGridSize(e))&&(this.state.gridSize,this.state.gridSize=e,this.state.snapEnabled&&this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),!0)}deselectAll(){var e;return!!this.objectSelector&&(null==(e=this.objectSelector.selectedObjects)||e.length,this.objectSelector.deselectAllObjects(),!0)}selectAll(){if(!this.objectSelector)return!1;const e=this.objectSelector.getSelectableObjects();return!!(e&&e.length>0)&&(this.objectSelector.selectMultipleObjects(e),!0)}deleteSelected(){var e,t,s,i,a,n,r,o,l,c;if(!this.objectSelector||!this.hasSelectedObjects())return!1;const A=[...this.objectSelector.selectedObjects];try{null==(i=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:(s=t.call(e)).beginBatch)||i.call(s)}catch{}A.map(e=>{var t;return null==(t=null==e?void 0:e.userData)?void 0:t.id}).filter(Boolean);const h=null==(n=null==(a=this.editorStore)?void 0:a.getState)?void 0:n.call(a);this.deselectAll(),A.forEach(e=>{var t;this.removeObjectFromScene(e);const s=null==(t=null==e?void 0:e.userData)?void 0:t.id;s&&(null==h?void 0:h.removeObjectById)&&h.removeObjectById(s)});try{null==(c=null==(o=null==(r=this.editorStore)?void 0:r.getState)?void 0:(l=o.call(r)).endBatch)||c.call(l)}catch{}return!0}duplicateSelected(){var e,t,s,i,a,n,r,o,l,c;if(!this.objectSelector||!this.hasSelectedObjects())return!1;const A=[...this.objectSelector.selectedObjects],h=[];try{null==(i=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:(s=t.call(e)).beginBatch)||i.call(s)}catch{}const d=null==(n=null==(a=this.editorStore)?void 0:a.getState)?void 0:n.call(a);A.forEach(e=>{var t,s,i,a,n;const r=this.cloneObject(e);if(r){h.push(r);const o=null==(t=r.userData)?void 0:t.id;o&&(null==d?void 0:d.addObject)&&d.addObject({id:o,name:r.name||`Object_${o}`,type:(null==(s=null==e?void 0:e.userData)?void 0:s.type)||"basic",parentId:(null==(i=null==e?void 0:e.userData)?void 0:i.id)?(null==(n=null==(a=e.parent)?void 0:a.userData)?void 0:n.id)??null:null,position:{x:r.position.x,y:r.position.y,z:r.position.z},rotation:{x:r.rotation.x,y:r.rotation.y,z:r.rotation.z},scale:{x:r.scale.x,y:r.scale.y,z:r.scale.z},visible:!1!==r.visible})}}),h.length>0&&this.selectObjects(h);try{null==(c=null==(o=null==(r=this.editorStore)?void 0:r.getState)?void 0:(l=o.call(r)).endBatch)||c.call(l)}catch{}return h}groupSelected(){var e,t,s,i,a,n,r,o,l,c,A,h,d;if(!this.objectSelector||(null==(e=this.objectSelector.selectedObjects)?void 0:e.length)<2)return!1;const u=[...this.objectSelector.selectedObjects];try{null==(a=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:(i=s.call(t)).beginBatch)||a.call(i)}catch{}const g=this.createGroup(u);if(g){this.selectObjects([g]);try{null==(l=null==(r=null==(n=this.editorStore)?void 0:n.getState)?void 0:(o=r.call(n)).endBatch)||l.call(o)}catch{}return g}try{null==(d=null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:(h=A.call(c)).endBatch)||d.call(h)}catch{}return!1}ungroupSelected(){var e,t,s,i,a,n,r,o,l,c,A,h,d;if(!this.objectSelector||1!==(null==(e=this.objectSelector.selectedObjects)?void 0:e.length))return!1;const u=this.objectSelector.selectedObjects[0];if(!this.isGroup(u))return!1;try{null==(a=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:(i=s.call(t)).beginBatch)||a.call(i)}catch{}const g=this.ungroupObject(u);if(g.length>0){this.selectObjects(g);try{null==(l=null==(r=null==(n=this.editorStore)?void 0:n.getState)?void 0:(o=r.call(n)).endBatch)||l.call(o)}catch{}return g}try{null==(d=null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:(h=A.call(c)).endBatch)||d.call(h)}catch{}return!1}applyInitialSettings(){this.objectSelector&&(this.objectSelector.setGizmoMode(this.state.mode),this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),this.objectSelector.isMagnetEnabled=this.state.magnetEnabled,this.objectSelector.showMagnetRays=this.state.magnetRaysVisible,this.objectSelector.transformControls&&(this.objectSelector.transformControls.setSpace(this.state.space),this.setupQuaternionRotation()))}setupQuaternionRotation(){var e;if(!(null==(e=this.objectSelector)?void 0:e.transformControls))return;const t=this.objectSelector.transformControls;"rotate"===this.state.mode&&(t.rotationSnap=Math.PI/12,this.setupRotationEventListeners())}setupRotationEventListeners(){var e;if(!(null==(e=this.objectSelector)?void 0:e.transformControls))return;const t=this.objectSelector.transformControls;t.addEventListener("objectChange",()=>{"rotate"===t.getMode()&&this.hasSelectedObjects()&&this.onQuaternionRotationChange()})}onQuaternionRotationChange(){const e=this.objectSelector.selectedObjects;e.forEach((e,t)=>{e.quaternion.normalize(),e.updateMatrix(),e.updateMatrixWorld()}),e.length>0&&this.getSelectedObjectRotation(e[0])}updateObjectSelector(e){this.objectSelector=e,this.applyInitialSettings()}getState(){var e,t;return{...this.state,selectedObjectsCount:(null==(t=null==(e=this.objectSelector)?void 0:e.selectedObjects)?void 0:t.length)||0,hasSelection:this.hasSelectedObjects()}}applySettings(e){e.mode&&e.mode!==this.state.mode&&this.setTransformMode(e.mode),e.space&&e.space!==this.state.space&&this.toggleSpace(),void 0!==e.snapEnabled&&e.snapEnabled!==this.state.snapEnabled&&this.toggleGridSnap(),e.gridSize&&e.gridSize!==this.state.gridSize&&this.setGridSize(e.gridSize)}rotateSelectedObjects(e){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(t=>{this.applyQuaternionRotation(t,e)}),!0}applyQuaternionRotation(e,t){e&&(e.quaternion.multiplyQuaternions(t,e.quaternion),e.updateMatrix())}rotateSelectedX(e){const t=V.degToRad(e),s=(new ee).setFromAxisAngle(new v(1,0,0),t);return this.rotateSelectedObjects(s)}rotateSelectedY(e){const t=V.degToRad(e),s=(new ee).setFromAxisAngle(new v(0,1,0),t);return this.rotateSelectedObjects(s)}rotateSelectedZ(e){const t=V.degToRad(e),s=(new ee).setFromAxisAngle(new v(0,0,1),t);return this.rotateSelectedObjects(s)}rotateSelectedAroundAxis(e,t){if(!e||0===e.length())return!1;const s=e.clone().normalize(),i=V.degToRad(t),a=(new ee).setFromAxisAngle(s,i);return this.rotateSelectedObjects(a)}rotateSelectedByEuler(e,t,s,i="XYZ"){const a=new Ye(V.degToRad(e),V.degToRad(t),V.degToRad(s),i),n=(new ee).setFromEuler(a);return this.rotateSelectedObjects(n)}rotateSelectedToLookAt(e){if(!this.hasSelectedObjects()||!e)return!1;return this.objectSelector.selectedObjects.forEach(t=>{(new v).subVectors(e,t.position).normalize();const s=new C;s.lookAt(t.position,e,new v(0,1,0));const i=(new ee).setFromRotationMatrix(s);t.quaternion.copy(i),t.updateMatrix()}),!0}resetSelectedRotation(){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(e=>{e.quaternion.set(0,0,0,1),e.updateMatrix()}),!0}getSelectedObjectRotation(e=null){const t=e||this.objectSelector.selectedObjects[0];if(!t)return null;const s=(new Ye).setFromQuaternion(t.quaternion,"XYZ");return{x:V.radToDeg(s.x),y:V.radToDeg(s.y),z:V.radToDeg(s.z),quaternion:t.quaternion.clone()}}rotateSelectedInWorldSpace(e){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(t=>{const s=new ee;if(t.getWorldQuaternion(s),s.premultiply(e),t.parent){const e=new ee;t.parent.getWorldQuaternion(e),e.invert(),t.quaternion.multiplyQuaternions(e,s)}else t.quaternion.copy(s);t.updateMatrix()}),!0}rotateSelectedAroundPoint(e,t){if(!this.hasSelectedObjects()||!e)return!1;return this.objectSelector.selectedObjects.forEach(s=>{const i=s.position.clone().sub(e);i.applyQuaternion(t),s.position.copy(e).add(i),s.quaternion.multiplyQuaternions(t,s.quaternion),s.updateMatrix()}),!0}isValidMode(e){return["translate","rotate","scale"].includes(e)}isValidGridSize(e){return"number"==typeof e&&e>0&&e<=100}hasSelectedObjects(){var e,t;return(null==(t=null==(e=this.objectSelector)?void 0:e.selectedObjects)?void 0:t.length)>0}isGroup(e){var t;return!0===(null==(t=null==e?void 0:e.userData)?void 0:t.isGroup)||"Group"===(null==e?void 0:e.type)}removeObjectFromScene(e){e&&e.parent&&(e.parent.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))}cloneObject(e){if(!e)return null;const t=e.clone();return t.position.x+=1,t.position.z+=1,t.userData={...e.userData,id:`${e.userData.id}_copy_${Date.now()}`},e.parent.add(t),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(t),t}createGroup(e){var t,s,i;if(!e||e.length<2)return null;const a=new q;a.name=`Group_${Date.now()}`,a.userData={id:`group_${Date.now()}`,type:"group",isGroup:!0};e[0].parent.add(a),e.forEach(e=>{if(e&&e.parent){const t=e.matrixWorld.clone();a.add(e),e.matrix.copy(t),e.matrix.premultiply(a.matrixWorld.clone().invert()),e.matrix.decompose(e.position,e.quaternion,e.scale)}}),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(a);try{const n=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);if((null==n?void 0:n.addObject)&&n.addObject({id:a.userData.id,name:a.name,type:"group",position:{x:a.position.x,y:a.position.y,z:a.position.z},rotation:{x:a.rotation.x,y:a.rotation.y,z:a.rotation.z},scale:{x:a.scale.x,y:a.scale.y,z:a.scale.z},visible:!0}),null==n?void 0:n.setParent)for(const t of e){const e=null==(i=null==t?void 0:t.userData)?void 0:i.id;e&&n.setParent(e,a.userData.id)}}catch{}return a}ungroupObject(e){var t,s,i,a,n,r,o;if(!this.isGroup(e))return[];const l=[...e.children],c=e.parent;l.forEach(e=>{if(e){const t=e.matrixWorld.clone();c.add(e),e.matrix.copy(t),e.matrix.premultiply(c.matrixWorld.clone().invert()),e.matrix.decompose(e.position,e.quaternion,e.scale),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(e)}});try{const e=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);if(null==e?void 0:e.setParent){const t=(null==(i=null==c?void 0:c.userData)?void 0:i.id)??null;for(const s of l){const i=null==(a=null==s?void 0:s.userData)?void 0:a.id;i&&(e.setParent(i,t),e.updateObjectTransform&&e.updateObjectTransform(i,{position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}}))}}}catch{}this.objectSelector.removeSelectableObject&&this.objectSelector.removeSelectableObject(e),c.remove(e);try{const t=null==(r=null==(n=this.editorStore)?void 0:n.getState)?void 0:r.call(n),s=null==(o=null==e?void 0:e.userData)?void 0:o.id;s&&(null==t?void 0:t.removeObjectById)&&t.removeObjectById(s)}catch{}return l}selectObjects(e){this.objectSelector&&e&&0!==e.length&&(this.objectSelector.deselectAllObjects(),1===e.length?this.objectSelector.selectSingleObject(e[0]):this.objectSelector.selectMultipleObjects(e))}logStateChange(e,t,s){}undo(){var e;try{const t=null==(e=this.editorStore)?void 0:e.getState();(null==t?void 0:t.undo)&&t.undo()}catch(t){}}redo(){var e;try{const t=null==(e=this.editorStore)?void 0:e.getState();(null==t?void 0:t.redo)&&t.redo()}catch(t){}}dispose(){this.objectSelector=null,this.editorStore=null,this.keyboardController=null}}class _a{constructor(){this.isEnabled=!0,this.pressedKeys=new Set,this.mouseState={isDown:!1,button:-1,position:{x:0,y:0},previousPosition:{x:0,y:0},dragStart:{x:0,y:0}},this.handlers={keyboard:new Map,mouse:new Map,wheel:null,contextMenu:null,resize:null},this.modifierKeys={ctrl:!1,shift:!1,alt:!1,meta:!1},this.boundHandlers={keyDown:this.handleKeyDown.bind(this),keyUp:this.handleKeyUp.bind(this),mouseDown:this.handleMouseDown.bind(this),mouseMove:this.handleMouseMove.bind(this),mouseUp:this.handleMouseUp.bind(this),wheel:this.handleWheel.bind(this),contextMenu:this.handleContextMenu.bind(this),resize:this.handleResize.bind(this)},this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",this.boundHandlers.keyDown),document.addEventListener("keyup",this.boundHandlers.keyUp),window.addEventListener("resize",this.boundHandlers.resize)}setupMouseEvents(e){this.canvas=e,e.addEventListener("mousedown",this.boundHandlers.mouseDown),document.addEventListener("mousemove",this.boundHandlers.mouseMove),document.addEventListener("mouseup",this.boundHandlers.mouseUp),e.addEventListener("wheel",this.boundHandlers.wheel),e.addEventListener("contextmenu",this.boundHandlers.contextMenu)}handleKeyDown(e){if(!this.isEnabled||this.isInputFieldActive(e.target))return;this.updateModifierKeys(e),this.pressedKeys.add(e.code);const t={code:e.code,key:e.key,ctrl:this.modifierKeys.ctrl,shift:this.modifierKeys.shift,alt:this.modifierKeys.alt,meta:this.modifierKeys.meta,originalEvent:e};this.modifierKeys.ctrl||this.modifierKeys.meta?this.executeHandler("keyboard","ctrl",t):this.executeHandler("keyboard",e.code,t)}handleKeyUp(e){if(!this.isEnabled)return;this.updateModifierKeys(e),this.pressedKeys.delete(e.code);const t={code:e.code,key:e.key,ctrl:this.modifierKeys.ctrl,shift:this.modifierKeys.shift,alt:this.modifierKeys.alt,meta:this.modifierKeys.meta,originalEvent:e};this.executeHandler("keyboard","keyup",t)}handleMouseDown(e){if(!this.isEnabled)return;this.mouseState.isDown=!0,this.mouseState.button=e.button,this.updateMousePosition(e),this.mouseState.previousPosition={...this.mouseState.position},this.mouseState.dragStart={...this.mouseState.position};const t={button:e.button,position:{...this.mouseState.position},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e};this.executeHandler("mouse","mousedown",t)}handleMouseMove(e){if(!this.isEnabled)return;this.mouseState.previousPosition={...this.mouseState.position},this.updateMousePosition(e);const t={position:{...this.mouseState.position},previousPosition:{...this.mouseState.previousPosition},dragStart:{...this.mouseState.dragStart},isDown:this.mouseState.isDown,button:this.mouseState.button,delta:{x:this.mouseState.position.x-this.mouseState.previousPosition.x,y:this.mouseState.position.y-this.mouseState.previousPosition.y},originalEvent:e};this.executeHandler("mouse","mousemove",t)}handleMouseUp(e){if(!this.isEnabled)return;const t={button:e.button,position:{...this.mouseState.position},dragStart:{...this.mouseState.dragStart},originalEvent:e};this.executeHandler("mouse","mouseup",t),this.mouseState.isDown=!1,this.mouseState.button=-1}handleWheel(e){if(!this.isEnabled)return;e.preventDefault();const t={delta:e.deltaY,position:{...this.mouseState.position},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,originalEvent:e};this.handlers.wheel&&this.handlers.wheel(t)}handleContextMenu(e){e.preventDefault(),this.handlers.contextMenu&&this.handlers.contextMenu(e)}handleResize(e){this.handlers.resize&&this.handlers.resize(e)}updateMousePosition(e){if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.mouseState.position={x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,screenX:e.clientX,screenY:e.clientY}}updateModifierKeys(e){this.modifierKeys.ctrl=e.ctrlKey,this.modifierKeys.shift=e.shiftKey,this.modifierKeys.alt=e.altKey,this.modifierKeys.meta=e.metaKey}executeHandler(e,t,s){var i;if("keyboard"===e){const e=this.handlers.keyboard.get("default");if(e)try{e(s)}catch(a){}}else{const n=null==(i=this.handlers[e])?void 0:i.get(t);if(n)try{n(s)}catch(a){}}}isInputFieldActive(e){return["INPUT","TEXTAREA","SELECT"].includes(e.tagName)||"true"===e.contentEditable}registerKeyHandler(e,t){this.handlers.keyboard.has(e)||this.handlers.keyboard.set(e,t)}registerMouseHandler(e,t){this.handlers.mouse.has(e)||this.handlers.mouse.set(e,t)}registerWheelHandler(e){this.handlers.wheel=e}registerContextMenuHandler(e){this.handlers.contextMenu=e}registerResizeHandler(e){this.handlers.resize=e}unregisterHandler(e,t){var s;"wheel"===e?this.handlers.wheel=null:"contextMenu"===e?this.handlers.contextMenu=null:null==(s=this.handlers[e])||s.delete(t)}clearAllHandlers(){this.handlers.keyboard.clear(),this.handlers.mouse.clear(),this.handlers.wheel=null,this.handlers.contextMenu=null}setEnabled(e){this.isEnabled=e}isKeyPressed(e){return this.pressedKeys.has(e)}getModifierKeys(){return{...this.modifierKeys}}getMouseState(){return{...this.mouseState}}getInputState(){return{enabled:this.isEnabled,pressedKeys:Array.from(this.pressedKeys),modifierKeys:this.getModifierKeys(),mouseState:this.getMouseState()}}dispose(){document.removeEventListener("keydown",this.boundHandlers.keyDown),document.removeEventListener("keyup",this.boundHandlers.keyUp),this.canvas&&(this.canvas.removeEventListener("mousedown",this.boundHandlers.mouseDown),this.canvas.removeEventListener("wheel",this.boundHandlers.wheel),this.canvas.removeEventListener("contextmenu",this.boundHandlers.contextMenu)),document.removeEventListener("mousemove",this.boundHandlers.mouseMove),document.removeEventListener("mouseup",this.boundHandlers.mouseUp),window.removeEventListener("resize",this.boundHandlers.resize),this.clearAllHandlers(),this.canvas=null,this.boundHandlers=null,this.pressedKeys.clear()}}class qa{constructor(e){this.inputManager=e,this.comboLocks=new Set,this.actions={transform:new Map,rotation:new Map,selection:new Map,viewport:new Map,object:new Map,system:new Map},this.setupDefaultKeyMappings(),this.registerInputHandlers()}setupDefaultKeyMappings(){this.actions.transform.set("KeyW",{name:"Move Mode",description:"이동 모드",action:null,category:"transform"}),this.actions.transform.set("KeyE",{name:"Rotate Mode",description:"회전 모드",action:null,category:"transform"}),this.actions.transform.set("KeyR",{name:"Scale Mode",description:"크기 모드",action:null,category:"transform"}),this.actions.transform.set("KeyQ",{name:"Toggle Space",description:"좌표계 전환",action:null,category:"transform"}),this.actions.transform.set("KeyX",{name:"Toggle Snap",description:"그리드 스냅 토글",action:null,category:"transform"}),this.actions.rotation.set("KeyJ",{name:"Rotate X+",description:"X축 양의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyL",{name:"Rotate X-",description:"X축 음의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyI",{name:"Rotate Y+",description:"Y축 양의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyK",{name:"Rotate Y-",description:"Y축 음의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyU",{name:"Rotate Z+",description:"Z축 양의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyO",{name:"Rotate Z-",description:"Z축 음의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyP",{name:"Reset Rotation",description:"회전 초기화",action:null,category:"rotation"}),this.actions.selection.set("Escape",{name:"Deselect All",description:"모든 선택 해제",action:null,category:"selection"}),this.actions.selection.set("KeyA",{name:"Select All",description:"전체 선택",action:null,category:"selection",requiresCtrl:!0}),this.actions.object.set("Delete",{name:"Delete Objects",description:"선택된 오브젝트 삭제",action:null,category:"object"}),this.actions.object.set("Backspace",{name:"Delete Objects",description:"선택된 오브젝트 삭제",action:null,category:"object"}),this.actions.object.set("KeyD",{name:"Duplicate Objects",description:"오브젝트 복제",action:null,category:"object",requiresCtrl:!0}),this.actions.object.set("KeyG",{name:"Group Objects",description:"오브젝트 그룹화",action:null,category:"object",requiresCtrl:!0}),this.actions.viewport.set("KeyF",{name:"Focus on Object",description:"선택된 오브젝트로 포커스",action:null,category:"viewport"}),this.actions.viewport.set("Numpad5",{name:"Toggle Projection",description:"투영 모드 전환",action:null,category:"viewport"}),this.actions.viewport.set("Numpad1",{name:"Front View",description:"정면 뷰",action:null,category:"viewport"}),this.actions.viewport.set("Numpad3",{name:"Side View",description:"측면 뷰",action:null,category:"viewport"}),this.actions.viewport.set("Numpad7",{name:"Top View",description:"상단 뷰",action:null,category:"viewport"}),this.actions.viewport.set("Numpad0",{name:"Reset Camera",description:"카메라 리셋",action:null,category:"viewport"}),this.actions.system.set("KeyZ",{name:"Undo",description:"실행 취소",action:null,category:"system",requiresCtrl:!0}),this.actions.system.set("KeyY",{name:"Redo",description:"다시 실행",action:null,category:"system",requiresCtrl:!0}),this.actions.system.set("KeyS",{name:"Save",description:"저장",action:null,category:"system",requiresCtrl:!0})}registerInputHandlers(){this.inputManager.registerKeyHandler("default",this.handleKeyInput.bind(this))}handleKeyInput(e){const{code:t,ctrl:s,shift:i,originalEvent:a}=e;"keyup"!==(null==a?void 0:a.type)?s?this.handleCtrlKeyPress(e):this.handleKeyPress(e):this.releaseComboLocksForKey(t)}handleKeyPress(e){const{code:t,ctrl:s,shift:i,originalEvent:a}=e;if(s)return;const n=this.findAction(t);n&&n.action&&!n.requiresCtrl&&(a.preventDefault(),this.executeAction(n,e))}handleCtrlKeyPress(e){const{code:t,shift:s,originalEvent:i}=e,a="KeyZ"===t||"KeyY"===t;if(a&&(null==i?void 0:i.repeat))return;const n=this.buildComboSignature(t,{ctrl:!0,shift:s});if(a&&this.comboLocks.has(n))return;const r=this.findAction(t);if(r&&r.action&&r.requiresCtrl)if(i.preventDefault(),s&&"KeyG"===t)this.executeSpecialAction("ungroupObjects",e);else if(s&&"KeyZ"===t){if(null==i?void 0:i.repeat)return;a&&this.comboLocks.add(n),this.executeSpecialAction("redo",e)}else a&&this.comboLocks.add(n),this.executeAction(r,e)}buildComboSignature(e,{ctrl:t=!1,shift:s=!1}={}){const i=[];return t&&i.push("Ctrl"),s&&i.push("Shift"),i.push(e),i.join("+")}releaseComboLocksForKey(e){const t=[];for(const s of this.comboLocks)s.endsWith(`+${e}`)&&t.push(s);for(const s of t)this.comboLocks.delete(s)}findAction(e){for(const[t,s]of Object.entries(this.actions))if(s.has(e))return s.get(e);return null}executeAction(e,t){if("function"==typeof e.action)try{e.action(t)}catch(s){}}executeSpecialAction(e,t){var s,i;const a={ungroupObjects:null==(s=this.actions.object.get("KeyG"))?void 0:s.ungroupAction,redo:null==(i=this.actions.system.get("KeyZ"))?void 0:i.redoAction}[e];if("function"==typeof a)try{a(t)}catch(n){}}registerTransformActions(e){e.setMode&&(this.actions.transform.get("KeyW").action=()=>e.setMode("translate"),this.actions.transform.get("KeyE").action=()=>e.setMode("rotate"),this.actions.transform.get("KeyR").action=()=>e.setMode("scale")),e.toggleSpace&&(this.actions.transform.get("KeyQ").action=e.toggleSpace),e.toggleSnap&&(this.actions.transform.get("KeyX").action=e.toggleSnap)}registerRotationActions(e){e.rotateX&&(this.actions.rotation.get("KeyJ").action=()=>e.rotateX(15),this.actions.rotation.get("KeyL").action=()=>e.rotateX(-15)),e.rotateY&&(this.actions.rotation.get("KeyI").action=()=>e.rotateY(15),this.actions.rotation.get("KeyK").action=()=>e.rotateY(-15)),e.rotateZ&&(this.actions.rotation.get("KeyU").action=()=>e.rotateZ(15),this.actions.rotation.get("KeyO").action=()=>e.rotateZ(-15)),e.resetRotation&&(this.actions.rotation.get("KeyP").action=e.resetRotation)}registerSelectionActions(e){e.deselectAll&&(this.actions.selection.get("Escape").action=e.deselectAll),e.selectAll&&(this.actions.selection.get("KeyA").action=e.selectAll)}registerObjectActions(e){e.deleteSelected&&(this.actions.object.get("Delete").action=e.deleteSelected,this.actions.object.get("Backspace").action=e.deleteSelected),e.duplicateSelected&&(this.actions.object.get("KeyD").action=e.duplicateSelected),e.groupSelected&&(this.actions.object.get("KeyG").action=e.groupSelected),e.ungroupSelected&&(this.actions.object.get("KeyG").ungroupAction=e.ungroupSelected)}registerViewportActions(e){e.focusOnSelected&&(this.actions.viewport.get("KeyF").action=e.focusOnSelected),e.toggleProjection&&(this.actions.viewport.get("Numpad5").action=e.toggleProjection),e.setView&&(this.actions.viewport.get("Numpad1").action=()=>e.setView("front"),this.actions.viewport.get("Numpad3").action=()=>e.setView("side"),this.actions.viewport.get("Numpad7").action=()=>e.setView("top")),e.resetCamera&&(this.actions.viewport.get("Numpad0").action=e.resetCamera)}registerSystemActions(e){e.undo&&(this.actions.system.get("KeyZ").action=e.undo),e.redo&&(this.actions.system.get("KeyZ").redoAction=e.redo,this.actions.system.has("KeyY")&&(this.actions.system.get("KeyY").action=e.redo)),e.save&&(this.actions.system.get("KeyS").action=e.save)}registerCustomKey(e,t,s,i,a="custom",n=!1){this.actions[a]||(this.actions[a]=new Map),this.actions[a].set(e,{name:t,description:s,action:i,category:a,requiresCtrl:n})}unregisterKey(e,t=null){if(t&&this.actions[t])this.actions[t].delete(e);else for(const s of Object.values(this.actions))if(s.has(e)){s.delete(e);break}}getKeyMappings(){const e={};for(const[t,s]of Object.entries(this.actions)){e[t]={};for(const[i,a]of s.entries())e[t][i]={name:a.name,description:a.description,requiresCtrl:a.requiresCtrl||!1}}return e}checkKeyConflicts(){const e=new Map,t=[];for(const[s,i]of Object.entries(this.actions))for(const[a,n]of i.entries()){const i=`${a}${n.requiresCtrl?"+Ctrl":""}`;e.has(i)?t.push({key:i,conflicting:[e.get(i),`${s}:${n.name}`]}):e.set(i,`${s}:${n.name}`)}return t.length,t}generateHelpText(){let e="Keyboard Shortcuts:\n\n";for(const[t,s]of Object.entries(this.actions))if(0!==s.size){e+=`${t.toUpperCase()}:\n`;for(const[t,i]of s.entries()){e+=`  ${this.formatKeyName(t,i.requiresCtrl).padEnd(20)} - ${i.description}\n`}e+="\n"}return e}formatKeyName(e,t=!1){const s={KeyW:"W",KeyE:"E",KeyR:"R",KeyQ:"Q",KeyX:"X",KeyV:"V",KeyC:"C",KeyA:"A",KeyD:"D",KeyG:"G",KeyF:"F",KeyZ:"Z",KeyS:"S",Escape:"ESC",Delete:"DEL",Backspace:"BACKSPACE",Numpad1:"NUM1",Numpad3:"NUM3",Numpad5:"NUM5",Numpad7:"NUM7",Numpad0:"NUM0"}[e]||e;return t?`Ctrl+${s}`:s}setEnabled(e){this.inputManager.setEnabled(e)}dispose(){for(const e of Object.values(this.actions))e.clear()}}class Ka{constructor(e){this.inputManager=e,this.transformControls=null,this.objectSelector=null,this.state={isDragging:!1,dragButton:-1,dragThreshold:5,isSelecting:!1,isPanning:!1,isOrbiting:!1,isGizmoInteracting:!1},this.handlers={leftClick:null,rightClick:null,middleClick:null,leftDrag:null,rightDrag:null,middleDrag:null,dragSelect:null,wheel:null,hover:null},this.selectionBox={element:null,startX:0,startY:0,isVisible:!1},this.registerInputHandlers()}registerInputHandlers(){this.inputManager.registerMouseHandler("mousedown",this.handleMouseDown.bind(this)),this.inputManager.registerMouseHandler("mousemove",this.handleMouseMove.bind(this)),this.inputManager.registerMouseHandler("mouseup",this.handleMouseUp.bind(this)),this.inputManager.registerWheelHandler(this.handleWheel.bind(this))}setTransformControls(e){this.transformControls=e,this.setupGizmoEventListeners()}setObjectSelector(e){this.objectSelector=e,e&&e.transformControls&&this.setTransformControls(e.transformControls)}setupGizmoEventListeners(){this.transformControls&&this.transformControls.addEventListener("dragging-changed",e=>{this.state.isGizmoInteracting=e.value})}isGizmoInteracting(){return this.state.isGizmoInteracting||this.transformControls&&this.transformControls.dragging}handleMouseDown(e){const{button:t,position:s,ctrl:i,shift:a,alt:n,originalEvent:r}=e;if(!this.isGizmoInteracting())switch(this.state.dragButton=t,t){case 0:this.handleLeftMouseDown(e);break;case 1:this.handleMiddleMouseDown(e);break;case 2:this.handleRightMouseDown(e)}}handleLeftMouseDown(e){const{position:t,ctrl:s,shift:i}=e,a=s||i;this.state.isSelecting=!0,this.selectionBox.startX=t.screenX,this.selectionBox.startY=t.screenY,this.handlers.leftClick&&this.handlers.leftClick({position:t,isMultiSelect:a,originalEvent:e.originalEvent})}handleMiddleMouseDown(e){const{alt:t,originalEvent:s}=e;s.preventDefault(),t?this.state.isOrbiting=!0:this.state.isPanning=!0,this.handlers.middleClick&&this.handlers.middleClick({isOrbiting:this.state.isOrbiting,isPanning:this.state.isPanning,originalEvent:s})}handleRightMouseDown(e){this.handlers.rightClick&&this.handlers.rightClick(e)}handleMouseMove(e){const{position:t,isDown:s,button:i,delta:a}=e;if((!this.isGizmoInteracting()||!s)&&(!s&&this.handlers.hover&&this.handlers.hover({position:t}),s)){if(!this.state.isDragging){this.calculateDragDistance(e)>this.state.dragThreshold&&(this.state.isDragging=!0,this.onDragStart(e))}this.state.isDragging&&this.handleDragMove(e),this.state.isSelecting&&0===i&&this.updateSelectionBox(e)}}onDragStart(e){}handleDragMove(e){const{button:t,delta:s}=e;switch(t){case 0:this.handlers.leftDrag&&this.handlers.leftDrag({delta:s,mouseInfo:e});break;case 1:this.state.isPanning&&this.handlers.middleDrag?this.handlers.middleDrag({type:"pan",delta:s,mouseInfo:e}):this.state.isOrbiting&&this.handlers.middleDrag&&this.handlers.middleDrag({type:"orbit",delta:s,mouseInfo:e});break;case 2:this.handlers.rightDrag&&this.handlers.rightDrag({delta:s,mouseInfo:e})}}handleMouseUp(e){const{button:t,position:s}=e;this.isGizmoInteracting()||(this.state.isSelecting&&0===t&&this.finishDragSelection(e),this.state.isDragging?this.handleDragEnd(e):this.handleClick(e)),this.resetMouseState()}handleClick(e){}handleDragEnd(e){this.state.isPanning&&this.handlers.dragEnd&&this.handlers.dragEnd({type:"pan",mouseInfo:e})}handleWheel(e){this.handlers.wheel&&this.handlers.wheel(e)}calculateDragDistance(e){const{position:t,dragStart:s}=e,i=t.screenX-s.screenX,a=t.screenY-s.screenY;return Math.sqrt(i*i+a*a)}updateSelectionBox(e){var t;const{position:s}=e,i=s.screenX,a=s.screenY,n=null==(t=this.inputManager)?void 0:t.canvas,r=n?n.getBoundingClientRect():null,o=(e,t,s)=>Math.min(Math.max(e,t),s),l=this.selectionBox.startX,c=this.selectionBox.startY,A=r?o(l,r.left,r.right):l,h=r?o(c,r.top,r.bottom):c,d=r?o(i,r.left,r.right):i,u=r?o(a,r.top,r.bottom):a,g=Math.min(A,d),p=Math.min(h,u),m=Math.abs(d-A),b=Math.abs(u-h);(m>this.state.dragThreshold||b>this.state.dragThreshold)&&(m>0&&b>0?this.showSelectionBox(g,p,m,b):this.hideSelectionBox(),this.handlers.dragSelect&&this.handlers.dragSelect({startX:A,startY:h,currentX:d,currentY:u,left:g,top:p,width:m,height:b}))}finishDragSelection(e){var t;const{position:s,ctrl:i,shift:a}=e,n=this.calculateDragDistance(e),r=i||a;if(this.hideSelectionBox(),n<this.state.dragThreshold)return;const o=null==(t=this.inputManager)?void 0:t.canvas,l=o?o.getBoundingClientRect():null,c=(e,t,s)=>Math.min(Math.max(e,t),s),A=l?c(this.selectionBox.startX,l.left,l.right):this.selectionBox.startX,h=l?c(this.selectionBox.startY,l.top,l.bottom):this.selectionBox.startY,d=l?c(s.screenX,l.left,l.right):s.screenX,u=l?c(s.screenY,l.top,l.bottom):s.screenY;l&&Math.abs(d-A)<=this.state.dragThreshold&&Math.abs(u-h)<=this.state.dragThreshold||this.handlers.dragSelectEnd&&this.handlers.dragSelectEnd({startX:A,startY:h,endX:d,endY:u,isMultiSelect:r})}showSelectionBox(e,t,s,i){this.selectionBox.element||this.createSelectionBoxElement();const a=this.selectionBox.element;a.style.left=`${e}px`,a.style.top=`${t}px`,a.style.width=`${s}px`,a.style.height=`${i}px`,a.style.display="block",this.selectionBox.isVisible=!0}hideSelectionBox(){this.selectionBox.element&&(this.selectionBox.element.style.display="none"),this.selectionBox.isVisible=!1}createSelectionBoxElement(){const e=document.createElement("div");e.style.position="fixed",e.style.border="1px dashed #007acc",e.style.backgroundColor="rgba(0, 122, 204, 0.1)",e.style.pointerEvents="none",e.style.zIndex="10000",e.style.display="none",document.body.appendChild(e),this.selectionBox.element=e}resetMouseState(){this.state.isDragging=!1,this.state.dragButton=-1,this.state.isSelecting=!1,this.state.isPanning=!1,this.state.isOrbiting=!1}onLeftClick(e){this.handlers.leftClick=e}onRightClick(e){this.handlers.rightClick=e}onMiddleClick(e){this.handlers.middleClick=e}onLeftDrag(e){this.handlers.leftDrag=e}onMiddleDrag(e){this.handlers.middleDrag=e}onRightDrag(e){this.handlers.rightDrag=e}onDragSelect(e){this.handlers.dragSelect=e}onDragSelectEnd(e){this.handlers.dragSelectEnd=e}onWheel(e){this.handlers.wheel=e}onHover(e){this.handlers.hover=e}onDragEnd(e){this.handlers.dragEnd=e}setDragThreshold(e){this.state.dragThreshold=Math.max(1,e)}getMouseState(){return{...this.state}}getSelectionBoxState(){return{...this.selectionBox}}removeHandler(e){this.handlers.hasOwnProperty(e)&&(this.handlers[e]=null)}removeAllHandlers(){for(const e in this.handlers)this.handlers[e]=null}dispose(){this.selectionBox.element&&(document.body.removeChild(this.selectionBox.element),this.selectionBox.element=null),this.removeAllHandlers(),this.resetMouseState(),this.transformControls=null,this.objectSelector=null}}class Va{constructor(e,t,s,i,a=null){var n,r,o,l;this.scene=e,this.renderer=s,this.editorStore=i,this.gizmoScene=null,this.inputManager=new _a,this.keyboardController=new qa(this.inputManager),this.mouseController=new Ka(this.inputManager),this.cameraController=new Ua(t,s,a);try{const e=this.editorStore.getState();null==(r=(n=this.cameraController).setSpeeds)||r.call(n,{pan:e.cameraPanSpeed,orbit:e.cameraOrbitSpeed,zoom:e.cameraZoomSpeed}),this._unsubCamSpeeds=this.editorStore.subscribe((e,t)=>{var s,i;e.cameraPanSpeed===t.cameraPanSpeed&&e.cameraOrbitSpeed===t.cameraOrbitSpeed&&e.cameraZoomSpeed===t.cameraZoomSpeed||null==(i=(s=this.cameraController).setSpeeds)||i.call(s,{pan:e.cameraPanSpeed,orbit:e.cameraOrbitSpeed,zoom:e.cameraZoomSpeed})})}catch{}this.objectSelector=new za(e,t,s,i),null==(l=(o=this.objectSelector).setGizmoScene)||l.call(o,null),this.mouseController.setObjectSelector(this.objectSelector),this.transformManager=new Ha(this.objectSelector,i,this.keyboardController),this._wrapSceneAddForWireframe(e),this.initializeGrid(),this.inputManager.setupMouseEvents(s.domElement),this.inputManager.registerResizeHandler(this.onWindowResize.bind(this)),this.setupMouseHandlers(),this.setupViewportActions(),this.isMouseDown=!1,this.isPanning=!1,this.isOrbiting=!1,this.isDragSelecting=!1,this.mousePosition=new f,this.previousMousePosition=new f,this.dragStartPosition=new f,this.partInspector={enabled:!1,selectedPart:null,selectedParts:new Set,solo:!1,clipping:!1,savedVisibility:new Map,clippingPlanes:[],group:null,groupPivot:"center",groupEnabled:!1},this._partRaycaster=new Ge,this._partTransformControls=null,this._initPartTransformControls(t,s)}_wrapSceneAddForWireframe(e){try{if(!e||!e.add||e.__addWrapped)return;const t=e.add.bind(e),s=this.editorStore;e.add=(...e)=>{var i;const a=t(...e);try{const t=!!s.getState().isWireframe;for(const s of e)null==(i=null==s?void 0:s.traverse)||i.call(s,e=>{e&&e.isMesh&&e.material&&(Array.isArray(e.material)?e.material.forEach(e=>{e&&(e.wireframe=t)}):e.material.wireframe=t)})}catch{}return a},e.__addWrapped=!0}catch{}}setupMouseHandlers(){this.mouseController.onLeftClick(e=>{var t;const{position:s,isMultiSelect:i}=e;if(this.updateMousePosition(s),!this.objectSelector.isDraggingGizmo()){if(this.partInspector.enabled){const e=this.raycastMeshAtNDC(this.mousePosition);return void(i?(null==(t=null==e?void 0:e.object)?void 0:t.isMesh)&&(this.partInspector.selectedParts.has(e.object)?this.partInspector.selectedParts.delete(e.object):(this.partInspector.selectedParts.add(e.object),this.partInspector.selectedPart=e.object),this._updatePartOutline()):this.selectPart((null==e?void 0:e.object)||null,(null==e?void 0:e.point)||null))}this.objectSelector.handleObjectSelection(this.mousePosition,i)}}),this.mouseController.onMiddleClick(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}const{isOrbiting:i,isPanning:a}=e;this.isOrbiting=i,this.isPanning=a}),this.mouseController.onMiddleDrag(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}const{type:i,delta:a}=e;"pan"===i?this.cameraController.pan(a.x,a.y):"orbit"===i&&this.cameraController.orbit(a.x,a.y)}),this.mouseController.onDragSelect(e=>{const{left:t,top:s,width:i,height:a}=e;this.objectSelector.showSelectionBox(t,s,i,a)}),this.mouseController.onDragSelectEnd(e=>{const{startX:t,startY:s,endX:i,endY:a,isMultiSelect:n}=e;this.partInspector.enabled?this.selectPartsInRect(t,s,i,a,n):this.finishDragSelection(t,s,i,a,n)}),this.mouseController.onWheel(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}if(this.objectSelector.isDraggingGizmo())return;const i=e.delta>0?1:-1;this.cameraController.zoom(.3*i)}),this.mouseController.onDragEnd(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}"pan"===e.type&&this.cameraController.updateRotationCenterAfterPan(this.scene,this.objectSelector.getSelectableObjects()),this.isMouseDown=!1,this.isPanning=!1,this.isOrbiting=!1,this.isDragSelecting=!1,this.objectSelector.hideSelectionBox()})}_initPartTransformControls(e,t){var s,i;try{this._partTransformControls=new ba(e,t.domElement),this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,this._partTransformControls.setSize(.9);try{const e=null==(i=(s=this._partTransformControls).getHelper)?void 0:i.call(s);if(e&&e.isObject3D){const t=()=>{var t,s,i;try{const a=null==(s=null==(t=e.children)?void 0:t.find)?void 0:s.call(t,e=>"helper"===e.name);a&&(a.visible=!1);const n=[];null==(i=e.traverse)||i.call(e,e=>{const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,s=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||s)&&n.push(e)}),n.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})}catch{}};t(),e.onBeforeRender=()=>{try{t()}catch{}},e.renderOrder=999;(this.gizmoScene||this.scene).add(e),this._partTransformControls.addEventListener("change",t),this._partTransformControls.addEventListener("dragging-changed",t),this._partTransformControls.addEventListener("mouseDown",t),this._partTransformControls.addEventListener("mouseUp",t),this._partTransformControls.addEventListener("objectChange",t)}}catch{}this._partGizmoInitial=null,this._partTransformControls.addEventListener("dragging-changed",e=>{var t,s;const i=e.value,a=this.getActivePartSet();if(0!==a.length)if(i)this._partGizmoInitial=a.map(e=>{var t,s;return{uuid:e.uuid,position:e.position.clone(),rotation:e.rotation.clone(),scale:e.scale.clone(),parentId:(null==(s=null==(t=e.parent)?void 0:t.userData)?void 0:s.id)??null}});else{if(!this._partGizmoInitial)return;const e=a.map(e=>{var t,s;return{uuid:e.uuid,parentId:(null==(s=null==(t=e.parent)?void 0:t.userData)?void 0:s.id)??null,after:{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}}}),i=new Map(this._partGizmoInitial.map(e=>[e.uuid,e])),n=[];for(const t of e){const e=i.get(t.uuid);if(!e)continue;const s={position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}},a=t.after;(s.position.x!==a.position.x||s.position.y!==a.position.y||s.position.z!==a.position.z||s.rotation.x!==a.rotation.x||s.rotation.y!==a.rotation.y||s.rotation.z!==a.rotation.z||s.scale.x!==a.scale.x||s.scale.y!==a.scale.y||s.scale.z!==a.scale.z)&&n.push({uuid:t.uuid,parentId:t.parentId,before:s,after:a})}if(n.length>0)try{const e=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);(null==e?void 0:e._pushHistory)&&e._pushHistory({type:"part-transform",parts:n})}catch{}this._partGizmoInitial=null}})}catch(a){this._partTransformControls=null}}isPartGizmoEnabled(){var e;return!!(null==(e=this.partInspector)?void 0:e.gizmo)}setPartGizmoEnabled(e){var t,s,i,a,n,r,o,l,c,A;const h=this.partInspector.selectedPart;if(!this._partTransformControls)return!1;if(!e){this.partInspector.gizmo=!1;try{this._partTransformControls.detach()}catch{}return this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,!0}if(!h&&!this.partInspector.groupEnabled)return!1;try{null==(i=null==(s=null==(t=this.objectSelector)?void 0:t.transformControls)?void 0:s.detach)||i.call(s)}catch{}this.partInspector.groupEnabled?(this._ensurePartGroup(),this.partInspector.group&&this._partTransformControls.attach(this.partInspector.group)):this._partTransformControls.attach(h);try{const e=(null==(n=null==(a=this.transformManager)?void 0:a.getState)?void 0:n.call(a).mode)||(null==(l=null==(o=null==(r=this.objectSelector)?void 0:r.transformControls)?void 0:o.getMode)?void 0:l.call(o))||"translate",t=(null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:A.call(c).gizmoSpace)||"world";this._partTransformControls.setMode(e),this._partTransformControls.setSpace(t)}catch{}return this._partTransformControls.visible=!0,this._partTransformControls.enabled=!0,this.partInspector.gizmo=!0,!0}setPartGizmoMode(e){return!!this._partTransformControls&&(!!["translate","rotate","scale"].includes(e)&&(this._partTransformControls.setMode(e),!0))}detachPartGizmo(){if(this._partTransformControls){try{this._partTransformControls.detach()}catch{}this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,this.partInspector.gizmo=!1}}setPostProcessingManager(e){var t,s;this.postProcessingManager=e;try{null==(s=null==(t=this.objectSelector)?void 0:t.setPostProcessingManager)||s.call(t,e)}catch{}}_updatePartOutline(){}setupViewportActions(){this.keyboardController.registerViewportActions({focusOnSelected:()=>{var e,t,s,i;const a=(null==(t=(e=this.objectSelector).getSelectedObjects)?void 0:t.call(e))||[],n=e=>this.resolveToThreeObject(e),r=a.map(e=>(null==e?void 0:e.isObject3D)?e:n((null==e?void 0:e.id)||e)).filter(Boolean);if(0===r.length){const e=this.editorStore.getState().selectedObject,t=this.resolveToThreeObject(e);t&&r.push(t)}if(0!==r.length){try{if((null==(i=null==(s=this.editorStore)?void 0:s.getState)?void 0:i.call(s).useBlenderControls)&&"undefined"!=typeof window&&window.__blenderControls)return void(1===r.length?window.__blenderControls.focusOnObject(r[0]):window.__blenderControls.focusOnObjects(r))}catch{}if(1===r.length)this.cameraController.focusOnObject(r[0]);else{const e=new ue;r.forEach(t=>{try{e.expandByObject(t)}catch{}});const t=e.getCenter(new v),s=e.getSize(new v),i=Math.max(s.x,s.y,s.z)||1;let a;const n=this.cameraController.getCamera();if(n.isPerspectiveCamera){const e=n.fov*(Math.PI/180);a=1.5*Math.abs(i/Math.sin(e/2))}else a=2*i;const o=(new v).subVectors(n.position,t).normalize();this.cameraController.setTarget(t),n.position.copy(t).add(o.multiplyScalar(a)),n.lookAt(t),n.updateMatrixWorld()}}},toggleProjection:()=>{const e=this.cameraController.toggleProjection();return this.objectSelector.updateCamera(e),e},setView:e=>{this.cameraController.setView(e)},resetCamera:()=>{this.cameraController.resetCamera()}})}updateMousePosition(e){void 0!==e.x&&void 0!==e.y&&(this.mousePosition.x=e.x,this.mousePosition.y=e.y)}finishDragSelection(e,t,s,i,a){const n=this.renderer.domElement.getBoundingClientRect(),r={x:(e-n.left)/n.width*2-1,y:-(t-n.top)/n.height*2+1},o={x:(s-n.left)/n.width*2-1,y:-(i-n.top)/n.height*2+1},l=this.objectSelector.getObjectsInArea(r,o);if(l.length>0)this.objectSelector.selectMultipleObjects(l,a);else if(!a){const a=Math.abs(s-e),n=Math.abs(i-t);Math.hypot(a,n)>=12&&this.objectSelector.deselectAllObjects()}this.objectSelector.hideSelectionBox()}get camera(){return this.cameraController.getCamera()}set camera(e){this.cameraController.camera=e,this.objectSelector.updateCamera(e)}onWindowResize(){this.cameraController.handleResize(),this.renderer.setSize(window.innerWidth,window.innerHeight)}addSelectableObject(e){this.objectSelector.addSelectableObject(e)}removeSelectableObject(e){this.objectSelector.removeSelectableObject(e)}updateSelectableObjects(e){this.objectSelector.updateSelectableObjects(e)}getSelectedObjects(){return this.objectSelector.getSelectedObjects()}getSelectableObjects(){return this.objectSelector.getSelectableObjects()}selectObject(e){this.objectSelector.selectSingleObject(e)}findObjectById(e){let t=null;return this.scene.traverse(s=>{s.userData&&s.userData.id===e&&(t=s)}),t}deselectAllObjects(){this.objectSelector.deselectAllObjects()}setGizmoMode(e){this.objectSelector.setGizmoMode(e)}getTransformState(){return this.transformManager.getState()}setTransformMode(e){return this.transformManager.setTransformMode(e)}toggleTransformSpace(){return this.transformManager.toggleSpace()}toggleGridSnap(){return this.transformManager.toggleGridSnap()}setGridSize(e){return this.transformManager.setGridSize(e)}duplicateSelectedObjects(){return this.transformManager.duplicateSelected()}deleteSelectedObjects(){return this.transformManager.deleteSelected()}groupSelectedObjects(){return this.transformManager.groupSelected()}ungroupSelectedObjects(){return this.transformManager.ungroupSelected()}focusOnObject(e){const t=this.resolveToThreeObject(e);t&&this.cameraController.focusOnObject(t)}updateSelectedOutlines(){this.objectSelector.updateAllSelectionOutlines()}setCameraView(e){this.cameraController.setView(e)}toggleCameraProjection(){const e=this.cameraController.toggleProjection();return this.objectSelector.updateCamera(e),e}getCameraTarget(){return this.cameraController.getTarget()}setCameraTarget(e){this.cameraController.setTarget(e)}resetCamera(){this.cameraController.resetCamera()}get transformControls(){return this.objectSelector.getTransformControls()}get selectedObjects(){return this.objectSelector.getSelectedObjects()}get isDragging(){return this.objectSelector.isDraggingGizmo()}dispose(){this.inputManager.dispose(),this.keyboardController.dispose(),this.mouseController.dispose(),this.objectSelector.dispose(),this.transformManager.dispose(),this.gridHelper&&(this.scene.remove(this.gridHelper),this.gridHelper.dispose(),this.gridHelper=null)}resolveToThreeObject(e){var t;if(!e)return null;if(e.isObject3D)return e;const s="object"==typeof e?e.id??(null==(t=e.userData)?void 0:t.id)??e:e;return this.findObjectById(s)}updateGridSnap(){this.objectSelector.updateGridSnap()}updateWireframe(){const e=this.editorStore.getState();e.scene&&e.scene.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material.forEach(t=>{t.wireframe=e.isWireframe}):t.material.wireframe=e.isWireframe)})}updateGizmoSpace(){this.objectSelector.updateGizmoSpace()}applyInitialViewState(){var e,t,s,i,a,n;try{null==(e=this.updateWireframe)||e.call(this)}catch{}try{null==(t=this.updateGridSnap)||t.call(this)}catch{}try{null==(s=this.updateGizmoSpace)||s.call(this)}catch{}try{null==(a=null==(i=this.objectSelector)?void 0:i.updateGizmoSize)||a.call(i)}catch{}try{null==(n=this.toggleGrid)||n.call(this)}catch{}}initializeGrid(){this.gridHelper=new Xe(20,20,8947848,4473924),this.gridHelper.name="EditorGrid",this.gridHelper.position.y=0,this.gridHelper.material.opacity=.8,this.gridHelper.material.transparent=!0,this.gridHelper.material.depthWrite=!1;const e=this.editorStore.getState().isGridVisible;this.gridHelper.visible=e,this.scene.add(this.gridHelper)}toggleGrid(){if(!this.gridHelper)return!1;const e=this.editorStore.getState().isGridVisible;return this.gridHelper.visible=e,this.gridHelper.updateMatrixWorld(!0),e}isGridShown(){return this.editorStore.getState().isGridVisible}setGridSize(e,t=20){if(!this.gridHelper)return;this.scene.remove(this.gridHelper),this.gridHelper.dispose();const s=this.editorStore.getState().isGridVisible;this.gridHelper=new Xe(e,t,8947848,4473924),this.gridHelper.name="EditorGrid",this.gridHelper.position.y=0,this.gridHelper.visible=s,this.gridHelper.material.opacity=.8,this.gridHelper.material.transparent=!0,this.gridHelper.material.depthWrite=!1,this.scene.add(this.gridHelper)}enablePartInspect(e){e!==this.partInspector.enabled&&(this.partInspector.enabled=!!e,e||(this.clearPartSelection(),this.setPartSolo(!1),this.setPartClipping(!1),this.detachPartGizmo()))}getSelectedPart(){return this.partInspector.selectedPart}getSelectedPartInfo(){var e,t,s,i,a,n,r,o,l;const c=this.partInspector.selectedPart;if(!c||!c.isMesh||!c.geometry)return null;const A=c.geometry,h=Array.isArray(c.material)?c.material[0]:c.material;A.boundingBox||A.computeBoundingBox(),A.boundingSphere||A.computeBoundingSphere();const d=null==(e=A.attributes)?void 0:e.position,u=A.index,g=null==(t=A.attributes)?void 0:t.uv,p=null==(s=A.attributes)?void 0:s.uv2,m=(new ue).setFromObject(c),b=m.getSize(new v),f=m.getCenter(new v),C=u?Math.floor(u.count/3):d?Math.floor(d.count/3):0,y=d?d.count:0;return{name:c.name||"(unnamed mesh)",uuid:c.uuid,drawMode:c.drawMode,geometry:{type:A.type,hasIndex:!!u,attributes:Object.keys(A.attributes||{}),vertices:y,triangles:C,bbox:{min:(null==(n=null==(a=null==(i=A.boundingBox)?void 0:i.min)?void 0:a.toArray)?void 0:n.call(a))||null,max:(null==(l=null==(o=null==(r=A.boundingBox)?void 0:r.max)?void 0:o.toArray)?void 0:l.call(o))||null},world:{size:b.toArray(),center:f.toArray()},uv:g?{count:g.count,itemSize:g.itemSize}:null,uv2:p?{count:p.count,itemSize:p.itemSize}:null},material:h?{type:h.type,name:h.name,color:h.color?`#${h.color.getHexString()}`:null,opacity:h.opacity??1,transparent:!!h.transparent,metalness:h.metalness??null,roughness:h.roughness??null,maps:{map:!!h.map,normalMap:!!h.normalMap,aoMap:!!h.aoMap,roughnessMap:!!h.roughnessMap,metalnessMap:!!h.metalnessMap,emissiveMap:!!h.emissiveMap,alphaMap:!!h.alphaMap}}:null}}raycastMeshAtNDC(e){const t=this.cameraController.getCamera();this._partRaycaster.setFromCamera(e,t);const s=[];this.scene.traverse(e=>{e.isMesh&&e.visible&&s.push(e)});const i=this._partRaycaster.intersectObjects(s,!0);if(!i||0===i.length)return null;return i.find(e=>{var t,s;return(null==(t=e.object)?void 0:t.isMesh)&&!(null==(s=e.object.userData)?void 0:s.isRayHelper)})||i[0]}selectPartsInRect(e,t,s,i,a){const n=this.renderer.domElement.getBoundingClientRect(),r=Math.min(e,s),o=Math.min(t,i),l=Math.max(e,s),c=Math.max(t,i),A=this.cameraController.getCamera(),h=new Ge,d=[];this.scene.traverse(e=>{e.isMesh&&e.visible&&d.push(e)});const u=new Set;for(let g=0;g<6;g++)for(let e=0;e<6;e++){const t=o+(e+.5)/6*(c-o),s=new f((r+(g+.5)/6*(l-r)-n.left)/n.width*2-1,-(t-n.top)/n.height*2+1);h.setFromCamera(s,A);const i=h.intersectObjects(d,!0);if(i&&i.length){const e=i[0].object;(null==e?void 0:e.isMesh)&&u.add(e)}}a||this.partInspector.selectedParts.clear(),u.forEach(e=>this.partInspector.selectedParts.add(e)),this.partInspector.selectedPart=this.partInspector.selectedParts.values().next().value||null,this._updatePartOutline()}selectPart(e,t=null){if(this._restorePartHighlight(),this.partInspector.selectedPart=e&&e.isMesh?e:null,this.partInspector.selectedPart&&this.partInspector.selectedParts.add(this.partInspector.selectedPart),this.partInspector.selectedPart){const e=this.partInspector.selectedPart.material,t=Array.isArray(e)?e[0]:e;t&&"emissive"in t&&(t.userData||(t.userData={}),t.userData._origEmissive=t.emissive.clone(),t.userData._origEmissiveIntensity=t.emissiveIntensity??1,t.emissive=new A(65535),t.emissiveIntensity=.6,t.needsUpdate=!0),this.partInspector.clipping&&this.setPartClipping(!0),this.partInspector.solo&&this.setPartSolo(!0),this.partInspector.gizmo&&this.setPartGizmoEnabled(!0)}else this.setPartSolo(!1),this.setPartClipping(!1),this.detachPartGizmo(),this.partInspector.selectedParts.clear();this._updatePartOutline()}clearPartSelection(){this._restorePartHighlight(),this.partInspector.selectedPart=null,this.partInspector.selectedParts.clear()}_restorePartHighlight(){const e=this.partInspector.selectedPart;if(!e)return;const t=Array.isArray(e.material)?e.material[0]:e.material;t&&t.userData&&t.userData._origEmissive&&(t.emissive.copy(t.userData._origEmissive),t.emissiveIntensity=t.userData._origEmissiveIntensity??1,delete t.userData._origEmissive,delete t.userData._origEmissiveIntensity,t.needsUpdate=!0)}getActivePartSet(){return this.partInspector.groupEnabled&&this.partInspector.selectedParts.size>0?Array.from(this.partInspector.selectedParts):this.partInspector.selectedPart?[this.partInspector.selectedPart]:[]}selectAllChildParts(){const e=this.partInspector.selectedPart;if(!e)return 0;const t=this.partInspector.selectedParts,s=[];return(e.parent||e).traverse(e=>{e.isMesh&&(t.add(e),s.push(e))}),this._updatePartOutline(),s.length}clearAllPartSelections(){this.partInspector.selectedParts.clear(),this._updatePartOutline()}isPartGroupGizmoEnabled(){return!!this.partInspector.groupEnabled}setPartGroupGizmoEnabled(e){this.partInspector.groupEnabled=!!e,e?(this._ensurePartGroup(),this.setPartGizmoEnabled(!0)):(this._detachPartGroup(),this.partInspector.selectedPart&&this.setPartGizmoEnabled(!0)),this._updatePartOutline()}getPartGroupPivot(){return this.partInspector.groupPivot}setPartGroupPivot(e){["center","first","last"].includes(e)&&(this.partInspector.groupPivot=e,this.partInspector.groupEnabled&&this._ensurePartGroup(!0))}_ensurePartGroup(e=!1){const t=this.getActivePartSet();if(0===t.length)return;this.partInspector.group||(this.partInspector.group=new q,this.partInspector.group.name="PartGroupPivot",this.partInspector.group.userData.isSystemObject=!0,this.scene.add(this.partInspector.group));const s=this.partInspector.group;let i=new v;if("first"===this.partInspector.groupPivot)i.copy(t[0].getWorldPosition(new v));else if("last"===this.partInspector.groupPivot)i.copy(t[t.length-1].getWorldPosition(new v));else{const e=new ue;for(const s of t)e.expandByObject(s);e.getCenter(i)}s.position.copy(i)}_detachPartGroup(){var e,t;if(this.partInspector.group){try{null==(t=null==(e=this._partTransformControls)?void 0:e.detach)||t.call(e)}catch{}try{this.scene.remove(this.partInspector.group)}catch{}this.partInspector.group=null}}setPartSolo(e){const t=this.partInspector;if(!e)return t.savedVisibility.forEach((e,t)=>{t.visible=e}),t.savedVisibility.clear(),void(t.solo=!1);const s=t.selectedPart;s&&(t.savedVisibility.clear(),this.scene.traverse(e=>{var i;e.isObject3D&&((null==(i=e.userData)?void 0:i.isSystemObject)||e===this.gridHelper||(t.savedVisibility.set(e,e.visible),e.visible=e===s||e.isBone||this._isAncestorOf(e,s)||this._isAncestorOf(s,e)))}),t.solo=!0)}_isAncestorOf(e,t){let s=null==t?void 0:t.parent;for(;s;){if(s===e)return!0;s=s.parent}return!1}setPartClipping(e,t=.01){const s=this.renderer,i=this.partInspector;if(!e)return s.clippingPlanes=[],s.localClippingEnabled=!1,i.clippingPlanes=[],void(i.clipping=!1);const a=i.selectedPart;if(!a)return;const n=(new ue).setFromObject(a);n.expandByScalar(t);const r=n.min,o=n.max,l=[new Ze(new v(1,0,0),-o.x),new Ze(new v(-1,0,0),r.x),new Ze(new v(0,1,0),-o.y),new Ze(new v(0,-1,0),r.y),new Ze(new v(0,0,1),-o.z),new Ze(new v(0,0,-1),r.z)];s.clippingPlanes=l,s.localClippingEnabled=!0,i.clippingPlanes=l,i.clipping=!0}}class Ya{constructor(e,t){if(!e||!t)throw new Error("BlenderControls requires camera and domElement");this.camera=e,this.domElement=t,this.enabled=!0,this.target=new v(0,0,0),this.rotateSpeed=1,this.panSpeed=1,this.zoomSpeed=1,this.minDistance=.1,this.maxDistance=1/0,this.minPolarAngle=1e-4,this.maxPolarAngle=Math.PI-1e-4,this.enableDamping=!0,this.dampingFactor=.15,this._spherical=new We,this._sphericalDelta=new We(0,0,0),this._panOffset=new v,this._zoomScale=1,this._state="none",this._isAltDown=!1,this._isShiftDown=!1,this._isCtrlDown=!1,this._pointer=new f,this._pointerPrev=new f,this._lastPointerForPick=new f,this._raycaster=new Ge,this._scene=null,this._onContextMenu=this._onContextMenu.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onPointerMovePassive=e=>{this._lastPointerForPick.set(e.clientX,e.clientY)},this._onMouseUp=this._onMouseUp.bind(this),this._onWheel=this._onWheel.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._updateSphericalFromCamera(),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("mousedown",this._onMouseDown),this.domElement.addEventListener("wheel",this._onWheel,{passive:!1}),this.domElement.addEventListener("mousemove",this._onPointerMovePassive),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp)}setSpeeds({rotate:e,pan:t,zoom:s}={}){Number.isFinite(e)&&(this.rotateSpeed=e),Number.isFinite(t)&&(this.panSpeed=t),Number.isFinite(s)&&(this.zoomSpeed=s)}setCamera(e){e&&(this.camera=e,this._updateSphericalFromCamera())}setScene(e){this._scene=e}focusOnObject(e){if(!e)return!1;const t=(new ue).setFromObject(e),s=t.getCenter(new v),i=t.getSize(new v),a=Math.max(i.x,i.y,i.z)||1;let n;if(this.camera.isPerspectiveCamera){const e=(this.camera.fov||75)*Math.PI/180;n=1.2*Math.abs(a/Math.sin(e/2))}else n=2*a;const r=(new v).subVectors(this.camera.position,this.target).normalize();this.target.copy(s),this.camera.position.copy(s).add(r.multiplyScalar(n)),this._updateSphericalFromCamera();{const e=(new C).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}return!0}focusOnObjects(e){const t=Array.isArray(e)?e.filter(Boolean):[e];if(!t||0===t.length)return!1;const s=new ue;for(const l of t)try{s.expandByObject(l)}catch{}if(!isFinite(s.min.x)||!isFinite(s.max.x))return!1;const i=s.getCenter(new v),a=s.getSize(new v),n=Math.max(a.x,a.y,a.z)||1;let r;if(this.camera.isPerspectiveCamera){const e=(this.camera.fov||75)*Math.PI/180;r=1.2*Math.abs(n/Math.sin(e/2))}else r=2*n;const o=(new v).subVectors(this.camera.position,this.target).normalize();this.target.copy(i),this.camera.position.copy(i).add(o.multiplyScalar(r)),this._updateSphericalFromCamera();{const e=(new C).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}return!0}update(){if(!this.enabled)return!1;const e=new v;e.copy(this.camera.position).sub(this.target),this._spherical.setFromVector3(e),this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi,this._spherical.radius*=this._zoomScale,this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.theta>Math.PI&&(this._spherical.theta-=2*Math.PI),this._spherical.theta<-Math.PI&&(this._spherical.theta+=2*Math.PI),this._spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this._spherical.radius)),this.target.add(this._panOffset);const t=(new v).setFromSpherical(this._spherical).add(this.target);this.camera.position.copy(t);{const e=(new C).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}if(this.enableDamping){this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor),Math.abs(this._sphericalDelta.theta)<1e-6&&(this._sphericalDelta.theta=0),Math.abs(this._sphericalDelta.phi)<1e-6&&(this._sphericalDelta.phi=0),this._panOffset.lengthSq()<1e-10&&this._panOffset.set(0,0,0);const e=Math.pow(1-this.dampingFactor,2);this._zoomScale=1+(this._zoomScale-1)*e,Math.abs(this._zoomScale-1)<1e-4&&(this._zoomScale=1)}else this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0),this._zoomScale=1;return!0}dispose(){this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.removeEventListener("mousedown",this._onMouseDown),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("mousemove",this._onPointerMovePassive),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)}_onContextMenu(e){e.preventDefault()}_onKeyDown(e){("Alt"===e.key||e.altKey)&&(this._isAltDown=!0),("Shift"===e.key||e.shiftKey)&&(this._isShiftDown=!0),("Control"===e.key||e.ctrlKey)&&(this._isCtrlDown=!0)}_onKeyUp(e){e.altKey||(this._isAltDown=!1),e.shiftKey||(this._isShiftDown=!1),e.ctrlKey||(this._isCtrlDown=!1)}_onMouseDown(e){this.enabled&&1===e.button&&(e.preventDefault(),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._pointerPrev.set(e.clientX,e.clientY),this._state=this._isAltDown?"rotate":"pan")}_onMouseMove(e){if(!this.enabled||"none"===this._state)return;e.preventDefault(),this._pointer.set(e.clientX,e.clientY),this._lastPointerForPick.set(e.clientX,e.clientY);const t=this._pointer.x-this._pointerPrev.x,s=this._pointer.y-this._pointerPrev.y;this._pointerPrev.copy(this._pointer),"rotate"===this._state?this._handleRotate(t,s):"pan"===this._state&&this._handlePan(t,s)}_onMouseUp(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._state="none"}_onWheel(e){if(!this.enabled)return;e.preventDefault();const t=e.deltaY,s=Math.pow(.95,this.zoomSpeed);t<0?this._dollyIn(s):t>0&&this._dollyOut(s)}_updateSphericalFromCamera(){const e=(new v).copy(this.camera.position).sub(this.target);this._spherical.setFromVector3(e)}_handleRotate(e,t){const{clientWidth:s,clientHeight:i}=this.domElement,a=2*Math.PI*e/Math.max(1,s)*this.rotateSpeed,n=2*Math.PI*t/Math.max(1,i)*this.rotateSpeed;this._sphericalDelta.theta-=a,this._sphericalDelta.phi-=n}_handlePan(e,t){const s=this.domElement;if(this._isShiftDown&&(t=0),this._isCtrlDown&&(e=0),this.camera.isPerspectiveCamera){const i=(new v).copy(this.camera.position).sub(this.target).length(),a=(this.camera.fov||75)*Math.PI/180,n=i*Math.tan(a/2),r=n*(s.clientWidth/Math.max(1,s.clientHeight)),o=e*this.panSpeed*(2*r)/Math.max(1,s.clientWidth),l=t*this.panSpeed*(2*n)/Math.max(1,s.clientHeight);this._panLeft(o),this._panUp(l)}else if(this.camera.isOrthographicCamera){const i=(this.camera.right-this.camera.left)/Math.max(1,s.clientWidth),a=(this.camera.top-this.camera.bottom)/Math.max(1,s.clientHeight);this._panLeft(e*this.panSpeed*i),this._panUp(t*this.panSpeed*a)}else{const s=.002*e*this.panSpeed,i=.002*t*this.panSpeed;this._panLeft(s),this._panUp(i)}}_panLeft(e){const t=new v;t.setFromMatrixColumn(this.camera.matrix,0),t.multiplyScalar(-e),this._panOffset.add(t)}_panUp(e){const t=new v;t.setFromMatrixColumn(this.camera.matrix,1),t.multiplyScalar(e),this._panOffset.add(t)}_dollyIn(e){this._zoomScale*=Math.max(1e-6,e)}_dollyOut(e){this._zoomScale/=Math.max(1e-6,e)}}const Wa={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class Ja{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const Xa=new Y(-1,1,1,-1,0,1);const Za=new class extends P{constructor(){super(),this.setAttribute("position",new He([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new He([0,2,0,0,2,0],2))}};class $a{constructor(e){this._mesh=new G(Za,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Xa)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class en extends Ja{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof $e?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=et.clone(e.uniforms),this.material=new $e({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new $a(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class tn extends Ja{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),a=e.state;let n,r;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(n=0,r=1):(n=1,r=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),a.buffers.stencil.setFunc(i.ALWAYS,n,4294967295),a.buffers.stencil.setClear(r),a.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.color.setMask(!0),a.buffers.depth.setMask(!0),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(i.EQUAL,1,4294967295),a.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),a.buffers.stencil.setLocked(!0)}}class sn extends Ja{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class an{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const s=e.getSize(new f);this._width=s.width,this._height=s.height,(t=new tt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:De})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new en(Wa),this.copyPass.material.blending=st,this.clock=new it}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,a=this.passes.length;i<a;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),t.needsSwap){if(s){const t=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==tn&&(t instanceof tn?s=!0:t instanceof sn&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new f);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class nn extends Ja{constructor(e,t,s=null,i=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new A}render(e,t,s){const i=e.autoClear;let a,n;e.autoClear=!1,null!==this.overrideMaterial&&(n=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(a=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(a),null!==this.overrideMaterial&&(this.scene.overrideMaterial=n),e.autoClear=i}}const rn={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:"\n\t\tprecision highp float;\n\n\t\tuniform mat4 modelViewMatrix;\n\t\tuniform mat4 projectionMatrix;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\t#include <tonemapping_pars_fragment>\n\t\t#include <colorspace_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// tone mapping\n\n\t\t\t#ifdef LINEAR_TONE_MAPPING\n\n\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( AGX_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\n\t\t\t#endif\n\n\t\t\t// color space\n\n\t\t\t#ifdef SRGB_TRANSFER\n\n\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\n\t\t\t#endif\n\n\t\t}"};class on extends Ja{constructor(){super();const e=rn;this.uniforms=et.clone(e.uniforms),this.material=new at({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new $a(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},$.getTransfer(this._outputColorSpace)===nt&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===rt?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ot?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===lt?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===ct?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===At?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===ht&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),!0===this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const ln={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new A(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class cn extends Ja{constructor(e,t,s,i){super(),this.strength=void 0!==t?t:1,this.radius=s,this.threshold=i,this.resolution=void 0!==e?new f(e.x,e.y):new f(256,256),this.clearColor=new A(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);this.renderTargetBright=new tt(a,n,{type:De}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let c=0;c<this.nMips;c++){const e=new tt(a,n,{type:De});e.texture.name="UnrealBloomPass.h"+c,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const t=new tt(a,n,{type:De});t.texture.name="UnrealBloomPass.v"+c,t.texture.generateMipmaps=!1,this.renderTargetsVertical.push(t),a=Math.round(a/2),n=Math.round(n/2)}const r=ln;this.highPassUniforms=et.clone(r.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new $e({uniforms:this.highPassUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.separableBlurMaterials=[];const o=[3,5,7,9,11];a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);for(let c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(o[c])),this.separableBlurMaterials[c].uniforms.invSize.value=new f(1/a,1/n),a=Math.round(a/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new v(1,1,1),new v(1,1,1),new v(1,1,1),new v(1,1,1),new v(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const l=Wa;this.copyUniforms=et.clone(l.uniforms),this.blendMaterial=new $e({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:dt,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new A,this.oldClearAlpha=1,this.basic=new p,this.fsQuad=new $a(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let s=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(s,i);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(s,i),this.renderTargetsVertical[a].setSize(s,i),this.separableBlurMaterials[a].uniforms.invSize.value=new f(1/s,1/i),s=Math.round(s/2),i=Math.round(i/2)}render(e,t,s,i,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=s.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let r=this.renderTargetBright;for(let o=0;o<this.nMips;o++)this.fsQuad.material=this.separableBlurMaterials[o],this.separableBlurMaterials[o].uniforms.colorTexture.value=r.texture,this.separableBlurMaterials[o].uniforms.direction.value=cn.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[o]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[o].uniforms.colorTexture.value=this.renderTargetsHorizontal[o].texture,this.separableBlurMaterials[o].uniforms.direction.value=cn.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[o]),e.clear(),this.fsQuad.render(e),r=this.renderTargetsVertical[o];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}getSeperableBlurMaterial(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return new $e({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new f(.5,.5)},direction:{value:new f(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new $e({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}cn.BlurDirectionX=new f(1,0),cn.BlurDirectionY=new f(0,1);const An={name:"FilmShader",uniforms:{tDiffuse:{value:null},time:{value:0},intensity:{value:.5},grayscale:{value:!1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tuniform float intensity;\n\t\tuniform bool grayscale;\n\t\tuniform float time;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat noise = rand( fract( vUv + time ) );\n\n\t\t\tvec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );\n\n\t\t\tcolor = mix( base.rgb, color, intensity );\n\n\t\t\tif ( grayscale ) {\n\n\t\t\t\tcolor = vec3( luminance( color ) ); // assuming linear-srgb\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( color, base.a );\n\n\t\t}"};class hn extends Ja{constructor(e=.5,t=!1){super();const s=An;this.uniforms=et.clone(s.uniforms),this.material=new $e({name:s.name,uniforms:this.uniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),this.uniforms.intensity.value=e,this.uniforms.grayscale.value=t,this.fsQuad=new $a(this.material)}render(e,t,s,i){this.uniforms.tDiffuse.value=s.texture,this.uniforms.time.value+=i,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const dn={name:"DotScreenShader",uniforms:{tDiffuse:{value:null},tSize:{value:new f(256,256)},center:{value:new f(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec2 center;\n\t\tuniform float angle;\n\t\tuniform float scale;\n\t\tuniform vec2 tSize;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tfloat pattern() {\n\n\t\t\tfloat s = sin( angle ), c = cos( angle );\n\n\t\t\tvec2 tex = vUv * tSize - center;\n\t\t\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n\n\t\t\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat average = ( color.r + color.g + color.b ) / 3.0;\n\n\t\t\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n\n\t\t}"};class un extends Ja{constructor(e,t,s){super();const i=dn;this.uniforms=et.clone(i.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==s&&(this.uniforms.scale.value=s),this.material=new $e({name:i.name,uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),this.fsQuad=new $a(this.material)}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.tSize.value.set(s.width,s.height),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const gn={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\tuniform int byp; //should we apply the glitch ?\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDisp;\n\n\t\tuniform float amount;\n\t\tuniform float angle;\n\t\tuniform float seed;\n\t\tuniform float seed_x;\n\t\tuniform float seed_y;\n\t\tuniform float distortion_x;\n\t\tuniform float distortion_y;\n\t\tuniform float col_s;\n\n\t\tvarying vec2 vUv;\n\n\n\t\tfloat rand(vec2 co){\n\t\t\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif(byp<1) {\n\t\t\t\tvec2 p = vUv;\n\t\t\t\tfloat xs = floor(gl_FragCoord.x / 0.5);\n\t\t\t\tfloat ys = floor(gl_FragCoord.y / 0.5);\n\t\t\t\t//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n\t\t\t\tfloat disp = texture2D(tDisp, p*seed*seed).r;\n\t\t\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {\n\t\t\t\t\tif(seed_x>0.){\n\t\t\t\t\t\tp.y = 1. - (p.y + distortion_y);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.y = distortion_y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {\n\t\t\t\t\tif(seed_y>0.){\n\t\t\t\t\t\tp.x=distortion_x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.x = 1. - (p.x + distortion_x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.x+=disp*seed_x*(seed/5.);\n\t\t\t\tp.y+=disp*seed_y*(seed/5.);\n\t\t\t\t//base from RGB shift shader\n\t\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\t\tvec4 cr = texture2D(tDiffuse, p + offset);\n\t\t\t\tvec4 cga = texture2D(tDiffuse, p);\n\t\t\t\tvec4 cb = texture2D(tDiffuse, p - offset);\n\t\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\t\t\t\t//add noise\n\t\t\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);\n\t\t\t\tgl_FragColor = gl_FragColor+ snow;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl_FragColor=texture2D (tDiffuse, vUv);\n\t\t\t}\n\t\t}"};class pn extends Ja{constructor(e=64){super();const t=gn;this.uniforms=et.clone(t.uniforms),this.heightMap=this.generateHeightmap(e),this.uniforms.tDisp.value=this.heightMap,this.material=new $e({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new $a(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=V.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=V.randFloat(-1,1),this.uniforms.seed_y.value=V.randFloat(-1,1),this.uniforms.distortion_x.value=V.randFloat(0,1),this.uniforms.distortion_y.value=V.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=V.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=V.randFloat(0,1),this.uniforms.distortion_y.value=V.randFloat(0,1),this.uniforms.seed_x.value=V.randFloat(-.3,.3),this.uniforms.seed_y.value=V.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}generateTrigger(){this.randX=V.randInt(120,240)}generateHeightmap(e){const t=new Float32Array(e*e),s=e*e;for(let a=0;a<s;a++){const e=V.randFloat(0,1);t[a]=e}const i=new Re(t,e,e,Le,Te);return i.needsUpdate=!0,i}dispose(){this.material.dispose(),this.heightMap.dispose(),this.fsQuad.dispose()}}class mn extends Ja{constructor(e,t,s,i={}){super(),this.pixelSize=e,this.resolution=new f,this.renderResolution=new f,this.pixelatedMaterial=this.createPixelatedMaterial(),this.normalMaterial=new ut,this.fsQuad=new $a(this.pixelatedMaterial),this.scene=t,this.camera=s,this.normalEdgeStrength=i.normalEdgeStrength||.3,this.depthEdgeStrength=i.depthEdgeStrength||.4,this.beautyRenderTarget=new tt,this.beautyRenderTarget.texture.minFilter=D,this.beautyRenderTarget.texture.magFilter=D,this.beautyRenderTarget.texture.type=De,this.beautyRenderTarget.depthTexture=new gt,this.normalRenderTarget=new tt,this.normalRenderTarget.texture.minFilter=D,this.normalRenderTarget.texture.magFilter=D,this.normalRenderTarget.texture.type=De}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.pixelatedMaterial.dispose(),this.normalMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.resolution.set(e,t),this.renderResolution.set(e/this.pixelSize|0,t/this.pixelSize|0);const{x:s,y:i}=this.renderResolution;this.beautyRenderTarget.setSize(s,i),this.normalRenderTarget.setSize(s,i),this.fsQuad.material.uniforms.resolution.value.set(s,i,1/s,1/i)}setPixelSize(e){this.pixelSize=e,this.setSize(this.resolution.x,this.resolution.y)}render(e,t){const s=this.fsQuad.material.uniforms;s.normalEdgeStrength.value=this.normalEdgeStrength,s.depthEdgeStrength.value=this.depthEdgeStrength,e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera);const i=this.scene.overrideMaterial;e.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,e.render(this.scene,this.camera),this.scene.overrideMaterial=i,s.tDiffuse.value=this.beautyRenderTarget.texture,s.tDepth.value=this.beautyRenderTarget.depthTexture,s.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}createPixelatedMaterial(){return new $e({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new pt(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:"\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tuniform sampler2D tDiffuse;\n\t\t\t\tuniform sampler2D tDepth;\n\t\t\t\tuniform sampler2D tNormal;\n\t\t\t\tuniform vec4 resolution;\n\t\t\t\tuniform float normalEdgeStrength;\n\t\t\t\tuniform float depthEdgeStrength;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tfloat getDepth(int x, int y) {\n\n\t\t\t\t\treturn texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;\n\n\t\t\t\t}\n\n\t\t\t\tvec3 getNormal(int x, int y) {\n\n\t\t\t\t\treturn texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tfloat depthEdgeIndicator(float depth, vec3 normal) {\n\n\t\t\t\t\tfloat diff = 0.0;\n\t\t\t\t\tdiff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);\n\t\t\t\t\treturn floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;\n\n\t\t\t\t}\n\n\t\t\t\tfloat neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {\n\n\t\t\t\t\tfloat depthDiff = getDepth(x, y) - depth;\n\t\t\t\t\tvec3 neighborNormal = getNormal(x, y);\n\n\t\t\t\t\t// Edge pixels should yield to faces who's normals are closer to the bias normal.\n\t\t\t\t\tvec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.\n\t\t\t\t\tfloat normalDiff = dot(normal - neighborNormal, normalEdgeBias);\n\t\t\t\t\tfloat normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);\n\n\t\t\t\t\t// Only the shallower pixel should detect the normal edge.\n\t\t\t\t\tfloat depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);\n\n\t\t\t\t\treturn (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;\n\n\t\t\t\t}\n\n\t\t\t\tfloat normalEdgeIndicator(float depth, vec3 normal) {\n\n\t\t\t\t\tfloat indicator = 0.0;\n\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(0, -1, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(0, 1, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(1, 0, depth, normal);\n\n\t\t\t\t\treturn step(0.1, indicator);\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\t\t\tfloat depth = 0.0;\n\t\t\t\t\tvec3 normal = vec3(0.0);\n\n\t\t\t\t\tif (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {\n\n\t\t\t\t\t\tdepth = getDepth(0, 0);\n\t\t\t\t\t\tnormal = getNormal(0, 0);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat dei = 0.0;\n\t\t\t\t\tif (depthEdgeStrength > 0.0)\n\t\t\t\t\t\tdei = depthEdgeIndicator(depth, normal);\n\n\t\t\t\t\tfloat nei = 0.0;\n\t\t\t\t\tif (normalEdgeStrength > 0.0)\n\t\t\t\t\t\tnei = normalEdgeIndicator(depth, normal);\n\n\t\t\t\t\tfloat Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);\n\n\t\t\t\t\tgl_FragColor = texel * Strength;\n\n\t\t\t\t}\n\t\t\t"})}}const bn={name:"SMAAEdgesShader",defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new f(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\n\t\tvoid SMAAEdgeDetectionVS( vec2 texcoord ) {\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAAEdgeDetectionVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\n\t\tvec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n\t\t\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );\n\n\t\t\t// Calculate color deltas:\n\t\t\tvec4 delta;\n\t\t\tvec3 C = texture2D( colorTex, texcoord ).rgb;\n\n\t\t\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;\n\t\t\tvec3 t = abs( C - Cleft );\n\t\t\tdelta.x = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;\n\t\t\tt = abs( C - Ctop );\n\t\t\tdelta.y = max( max( t.r, t.g ), t.b );\n\n\t\t\t// We do the usual threshold:\n\t\t\tvec2 edges = step( threshold, delta.xy );\n\n\t\t\t// Then discard if there is no edge:\n\t\t\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )\n\t\t\t\tdiscard;\n\n\t\t\t// Calculate right and bottom deltas:\n\t\t\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;\n\t\t\tt = abs( C - Cright );\n\t\t\tdelta.z = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;\n\t\t\tt = abs( C - Cbottom );\n\t\t\tdelta.w = max( max( t.r, t.g ), t.b );\n\n\t\t\t// Calculate the maximum delta in the direct neighborhood:\n\t\t\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );\n\n\t\t\t// Calculate left-left and top-top deltas:\n\t\t\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;\n\t\t\tt = abs( C - Cleftleft );\n\t\t\tdelta.z = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;\n\t\t\tt = abs( C - Ctoptop );\n\t\t\tdelta.w = max( max( t.r, t.g ), t.b );\n\n\t\t\t// Calculate the final maximum delta:\n\t\t\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );\n\n\t\t\t// Local contrast adaptation in action:\n\t\t\tedges.xy *= step( 0.5 * maxDelta, delta.xy );\n\n\t\t\treturn vec4( edges, 0.0, 0.0 );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );\n\n\t\t}"},fn={name:"SMAAWeightsShader",defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new f(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\t\tvarying vec2 vPixcoord;\n\n\t\tvoid SMAABlendingWeightCalculationVS( vec2 texcoord ) {\n\t\t\tvPixcoord = texcoord / resolution;\n\n\t\t\t// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components\n\n\t\t\t// And these for the searches, they indicate the ends of the loops:\n\t\t\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAABlendingWeightCalculationVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tArea;\n\t\tuniform sampler2D tSearch;\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[3];\n\t\tvarying vec2 vPixcoord;\n\n\t\t#if __VERSION__ == 100\n\t\tvec2 round( vec2 x ) {\n\t\t\treturn sign( x ) * floor( abs( x ) + 0.5 );\n\t\t}\n\t\t#endif\n\n\t\tfloat SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {\n\t\t\t// Not required if searchTex accesses are set to point:\n\t\t\t// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n\t\t\t// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n\t\t\t//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n\t\t\te.r = bias + e.r * scale;\n\t\t\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;\n\t\t}\n\n\t\tfloat SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\t/**\n\t\t\t\t* @PSEUDO_GATHER4\n\t\t\t\t* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to\n\t\t\t\t* sample between edge, thus fetching four edges in a row.\n\t\t\t\t* Sampling with different offsets in each direction allows to disambiguate\n\t\t\t\t* which edges are active from the four fetched ones.\n\t\t\t\t*/\n\t\t\tvec2 e = vec2( 0.0, 1.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;\n\t\t\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\t// We correct the previous (-0.25, -0.125) offset we applied:\n\t\t\ttexcoord.x += 0.25 * resolution.x;\n\n\t\t\t// The searches are bias by 1, so adjust the coords accordingly:\n\t\t\ttexcoord.x += resolution.x;\n\n\t\t\t// Disambiguate the length added by the last step:\n\t\t\ttexcoord.x += 2.0 * resolution.x; // Undo last step\n\t\t\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n\t\t\treturn texcoord.x;\n\t\t}\n\n\t\tfloat SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 0.0, 1.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;\n\t\t\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.x -= 0.25 * resolution.x;\n\t\t\ttexcoord.x -= resolution.x;\n\t\t\ttexcoord.x -= 2.0 * resolution.x;\n\t\t\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n\t\t\treturn texcoord.x;\n\t\t}\n\n\t\tfloat SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 1.0, 0.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign\n\t\t\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign\n\n\t\t\treturn texcoord.y;\n\t\t}\n\n\t\tfloat SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 1.0, 0.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign\n\t\t\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign\n\n\t\t\treturn texcoord.y;\n\t\t}\n\n\t\tvec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {\n\t\t\t// Rounding prevents precision errors of bilinear filtering:\n\t\t\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;\n\n\t\t\t// We do a scale and bias for mapping to texel space:\n\t\t\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );\n\n\t\t\t// Move to proper place, according to the subpixel offset:\n\t\t\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n\t\t\treturn texture2D( areaTex, texcoord, 0.0 ).rg;\n\t\t}\n\n\t\tvec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {\n\t\t\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tvec2 e = texture2D( edgesTex, texcoord ).rg;\n\n\t\t\tif ( e.g > 0.0 ) { // Edge at north\n\t\t\t\tvec2 d;\n\n\t\t\t\t// Find the distance to the left:\n\t\t\t\tvec2 coords;\n\t\t\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );\n\t\t\t\tcoords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)\n\t\t\t\td.x = coords.x;\n\n\t\t\t\t// Now fetch the left crossing edges, two at a time using bilinear\n\t\t\t\t// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n\t\t\t\t// discern what value each edge has:\n\t\t\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;\n\n\t\t\t\t// Find the distance to the right:\n\t\t\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );\n\t\t\t\td.y = coords.x;\n\n\t\t\t\t// We want the distances to be in pixel units (doing this here allow to\n\t\t\t\t// better interleave arithmetic and memory accesses):\n\t\t\t\td = d / resolution.x - pixcoord.x;\n\n\t\t\t\t// SMAAArea below needs a sqrt, as the areas texture is compressed\n\t\t\t\t// quadratically:\n\t\t\t\tvec2 sqrt_d = sqrt( abs( d ) );\n\n\t\t\t\t// Fetch the right crossing edges:\n\t\t\t\tcoords.y -= 1.0 * resolution.y; // WebGL port note: Added\n\t\t\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;\n\n\t\t\t\t// Ok, we know how this pattern looks like, now it is time for getting\n\t\t\t\t// the actual area:\n\t\t\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );\n\t\t\t}\n\n\t\t\tif ( e.r > 0.0 ) { // Edge at west\n\t\t\t\tvec2 d;\n\n\t\t\t\t// Find the distance to the top:\n\t\t\t\tvec2 coords;\n\n\t\t\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );\n\t\t\t\tcoords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;\n\t\t\t\td.x = coords.y;\n\n\t\t\t\t// Fetch the top crossing edges:\n\t\t\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;\n\n\t\t\t\t// Find the distance to the bottom:\n\t\t\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );\n\t\t\t\td.y = coords.y;\n\n\t\t\t\t// We want the distances to be in pixel units:\n\t\t\t\td = d / resolution.y - pixcoord.y;\n\n\t\t\t\t// SMAAArea below needs a sqrt, as the areas texture is compressed\n\t\t\t\t// quadratically:\n\t\t\t\tvec2 sqrt_d = sqrt( abs( d ) );\n\n\t\t\t\t// Fetch the bottom crossing edges:\n\t\t\t\tcoords.y -= 1.0 * resolution.y; // WebGL port note: Added\n\t\t\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;\n\n\t\t\t\t// Get the area for this direction:\n\t\t\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );\n\t\t\t}\n\n\t\t\treturn weights;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );\n\n\t\t}"},Cn={name:"SMAABlendShader",uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new f(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 2 ];\n\n\t\tvoid SMAANeighborhoodBlendingVS( vec2 texcoord ) {\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAANeighborhoodBlendingVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tColor;\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 2 ];\n\n\t\tvec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {\n\t\t\t// Fetch the blending weights for current pixel:\n\t\t\tvec4 a;\n\t\t\ta.xz = texture2D( blendTex, texcoord ).xz;\n\t\t\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;\n\t\t\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;\n\n\t\t\t// Is there any blending weight with a value greater than 0.0?\n\t\t\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {\n\t\t\t\treturn texture2D( colorTex, texcoord, 0.0 );\n\t\t\t} else {\n\t\t\t\t// Up to 4 lines can be crossing a pixel (one through each edge). We\n\t\t\t\t// favor blending by choosing the line with the maximum weight for each\n\t\t\t\t// direction:\n\t\t\t\tvec2 offset;\n\t\t\t\toffset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n\t\t\t\toffset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n\t\t\t\t// Then we go in the direction that has the maximum weight:\n\t\t\t\tif ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical\n\t\t\t\t\toffset.y = 0.0;\n\t\t\t\t} else {\n\t\t\t\t\toffset.x = 0.0;\n\t\t\t\t}\n\n\t\t\t\t// Fetch the opposite color and lerp by hand:\n\t\t\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );\n\t\t\t\ttexcoord += sign( offset ) * resolution;\n\t\t\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );\n\t\t\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );\n\n\t\t\t\t// WebGL port note: Added gamma correction\n\t\t\t\tC.xyz = pow(C.xyz, vec3(2.2));\n\t\t\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));\n\t\t\t\tvec4 mixed = mix(C, Cop, s);\n\t\t\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n\t\t\t\treturn mixed;\n\t\t\t}\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );\n\n\t\t}"};class vn extends Ja{constructor(e,t){super(),this.edgesRT=new tt(e,t,{depthBuffer:!1,type:De}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new tt(e,t,{depthBuffer:!1,type:De}),this.weightsRT.texture.name="SMAAPass.weights";const s=this,i=new Image;i.src=this.getAreaTexture(),i.onload=function(){s.areaTexture.needsUpdate=!0},this.areaTexture=new ce,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=i,this.areaTexture.minFilter=Q,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const a=new Image;a.src=this.getSearchTexture(),a.onload=function(){s.searchTexture.needsUpdate=!0},this.searchTexture=new ce,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=a,this.searchTexture.magFilter=D,this.searchTexture.minFilter=D,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=et.clone(bn.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new $e({defines:Object.assign({},bn.defines),uniforms:this.uniformsEdges,vertexShader:bn.vertexShader,fragmentShader:bn.fragmentShader}),this.uniformsWeights=et.clone(fn.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new $e({defines:Object.assign({},fn.defines),uniforms:this.uniformsWeights,vertexShader:fn.vertexShader,fragmentShader:fn.fragmentShader}),this.uniformsBlend=et.clone(Cn.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new $e({uniforms:this.uniformsBlend,vertexShader:Cn.vertexShader,fragmentShader:Cn.fragmentShader}),this.fsQuad=new $a(null)}render(e,t,s){this.uniformsEdges.tDiffuse.value=s.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=s.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}setSize(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)}getAreaTexture(){return"data:image/png;base64,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"}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}dispose(){this.edgesRT.dispose(),this.weightsRT.dispose(),this.areaTexture.dispose(),this.searchTexture.dispose(),this.materialEdges.dispose(),this.materialWeights.dispose(),this.materialBlend.dispose(),this.fsQuad.dispose()}}class yn{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,s){return e[0]*t+e[1]*s}dot3(e,t,s,i){return e[0]*t+e[1]*s+e[2]*i}dot4(e,t,s,i,a){return e[0]*t+e[1]*s+e[2]*i+e[3]*a}noise(e,t){let s,i,a;const n=(e+t)*(.5*(Math.sqrt(3)-1)),r=Math.floor(e+n),o=Math.floor(t+n),l=(3-Math.sqrt(3))/6,c=(r+o)*l,A=e-(r-c),h=t-(o-c);let d,u;A>h?(d=1,u=0):(d=0,u=1);const g=A-d+l,p=h-u+l,m=A-1+2*l,b=h-1+2*l,f=255&r,C=255&o,v=this.perm[f+this.perm[C]]%12,y=this.perm[f+d+this.perm[C+u]]%12,x=this.perm[f+1+this.perm[C+1]]%12;let I=.5-A*A-h*h;I<0?s=0:(I*=I,s=I*I*this.dot(this.grad3[v],A,h));let E=.5-g*g-p*p;E<0?i=0:(E*=E,i=E*E*this.dot(this.grad3[y],g,p));let B=.5-m*m-b*b;return B<0?a=0:(B*=B,a=B*B*this.dot(this.grad3[x],m,b)),70*(s+i+a)}noise3d(e,t,s){let i,a,n,r;const o=(e+t+s)*(1/3),l=Math.floor(e+o),c=Math.floor(t+o),A=Math.floor(s+o),h=1/6,d=(l+c+A)*h,u=e-(l-d),g=t-(c-d),p=s-(A-d);let m,b,f,C,v,y;u>=g?g>=p?(m=1,b=0,f=0,C=1,v=1,y=0):u>=p?(m=1,b=0,f=0,C=1,v=0,y=1):(m=0,b=0,f=1,C=1,v=0,y=1):g<p?(m=0,b=0,f=1,C=0,v=1,y=1):u<p?(m=0,b=1,f=0,C=0,v=1,y=1):(m=0,b=1,f=0,C=1,v=1,y=0);const x=u-m+h,I=g-b+h,E=p-f+h,B=u-C+2*h,w=g-v+2*h,S=p-y+2*h,Q=u-1+.5,j=g-1+.5,M=p-1+.5,D=255&l,T=255&c,R=255&A,k=this.perm[D+this.perm[T+this.perm[R]]]%12,O=this.perm[D+m+this.perm[T+b+this.perm[R+f]]]%12,F=this.perm[D+C+this.perm[T+v+this.perm[R+y]]]%12,L=this.perm[D+1+this.perm[T+1+this.perm[R+1]]]%12;let P=.6-u*u-g*g-p*p;P<0?i=0:(P*=P,i=P*P*this.dot3(this.grad3[k],u,g,p));let N=.6-x*x-I*I-E*E;N<0?a=0:(N*=N,a=N*N*this.dot3(this.grad3[O],x,I,E));let G=.6-B*B-w*w-S*S;G<0?n=0:(G*=G,n=G*G*this.dot3(this.grad3[F],B,w,S));let U=.6-Q*Q-j*j-M*M;return U<0?r=0:(U*=U,r=U*U*this.dot3(this.grad3[L],Q,j,M)),32*(i+a+n+r)}noise4d(e,t,s,i){const a=this.grad4,n=this.simplex,r=this.perm,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,A,h,d,u;const g=(e+t+s+i)*o,p=Math.floor(e+g),m=Math.floor(t+g),b=Math.floor(s+g),f=Math.floor(i+g),C=(p+m+b+f)*l,v=e-(p-C),y=t-(m-C),x=s-(b-C),I=i-(f-C),E=(v>y?32:0)+(v>x?16:0)+(y>x?8:0)+(v>I?4:0)+(y>I?2:0)+(x>I?1:0),B=n[E][0]>=3?1:0,w=n[E][1]>=3?1:0,S=n[E][2]>=3?1:0,Q=n[E][3]>=3?1:0,j=n[E][0]>=2?1:0,M=n[E][1]>=2?1:0,D=n[E][2]>=2?1:0,T=n[E][3]>=2?1:0,R=n[E][0]>=1?1:0,k=n[E][1]>=1?1:0,O=n[E][2]>=1?1:0,F=n[E][3]>=1?1:0,L=v-B+l,P=y-w+l,N=x-S+l,G=I-Q+l,U=v-j+2*l,z=y-M+2*l,H=x-D+2*l,_=I-T+2*l,q=v-R+3*l,K=y-k+3*l,V=x-O+3*l,Y=I-F+3*l,W=v-1+4*l,J=y-1+4*l,X=x-1+4*l,Z=I-1+4*l,$=255&p,ee=255&m,te=255&b,se=255&f,ie=r[$+r[ee+r[te+r[se]]]]%32,ae=r[$+B+r[ee+w+r[te+S+r[se+Q]]]]%32,ne=r[$+j+r[ee+M+r[te+D+r[se+T]]]]%32,re=r[$+R+r[ee+k+r[te+O+r[se+F]]]]%32,oe=r[$+1+r[ee+1+r[te+1+r[se+1]]]]%32;let le=.6-v*v-y*y-x*x-I*I;le<0?c=0:(le*=le,c=le*le*this.dot4(a[ie],v,y,x,I));let ce=.6-L*L-P*P-N*N-G*G;ce<0?A=0:(ce*=ce,A=ce*ce*this.dot4(a[ae],L,P,N,G));let Ae=.6-U*U-z*z-H*H-_*_;Ae<0?h=0:(Ae*=Ae,h=Ae*Ae*this.dot4(a[ne],U,z,H,_));let he=.6-q*q-K*K-V*V-Y*Y;he<0?d=0:(he*=he,d=he*he*this.dot4(a[re],q,K,V,Y));let de=.6-W*W-J*J-X*X-Z*Z;return de<0?u=0:(de*=de,u=de*de*this.dot4(a[oe],W,J,X,Z)),27*(c+A+h+d+u)}}const xn={name:"SSAOShader",defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new f},cameraProjectionMatrix:{value:new C},cameraInverseProjectionMatrix:{value:new C},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\tuniform highp sampler2D tNormal;\n\t\tuniform highp sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\n\t\t\tif ( depth == 1.0 ) {\n\n\t\t\t\tgl_FragColor = vec4( 1.0 ); // don't influence background\n\t\t\t\t\n\t\t\t} else {\n\n\t\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\t\tvec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );\n\n\t\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t\t\tfloat occlusion = 0.0;\n\n\t\t\t\tfor ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t\t}\n\n\t\t}"},In={name:"SSAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},En={name:"SSAOBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new f}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};class Bn extends Ja{constructor(e,t,s,i,a=32){super(),this.width=void 0!==s?s:512,this.height=void 0!==i?i:512,this.clear=!0,this.needsSwap=!1,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(a),this.generateRandomKernelRotations();const n=new gt;n.format=mt,n.type=bt,this.normalRenderTarget=new tt(this.width,this.height,{minFilter:D,magFilter:D,type:De,depthTexture:n}),this.ssaoRenderTarget=new tt(this.width,this.height,{type:De}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new $e({defines:Object.assign({},xn.defines),uniforms:et.clone(xn.uniforms),vertexShader:xn.vertexShader,fragmentShader:xn.fragmentShader,blending:st}),this.ssaoMaterial.defines.KERNEL_SIZE=a,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ut,this.normalMaterial.blending=st,this.blurMaterial=new $e({defines:Object.assign({},En.defines),uniforms:et.clone(En.uniforms),vertexShader:En.vertexShader,fragmentShader:En.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new $e({defines:Object.assign({},In.defines),uniforms:et.clone(In.uniforms),vertexShader:In.vertexShader,fragmentShader:In.fragmentShader,blending:st}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new $e({uniforms:et.clone(Wa.uniforms),vertexShader:Wa.vertexShader,fragmentShader:Wa.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:ft,blendDst:Ct,blendEquation:vt,blendSrcAlpha:yt,blendDstAlpha:Ct,blendEquationAlpha:vt}),this.fsQuad=new $a(null),this.originalClearColor=new A}dispose(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t,s){switch(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case Bn.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=st,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s);break;case Bn.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=st,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s);break;case Bn.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:s);break;case Bn.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=st,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s);break;case Bn.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=xt,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s)}}renderPass(e,t,s,i,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),r=e.autoClear;e.setRenderTarget(s),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=r,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,s,i,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),r=e.autoClear;e.setRenderTarget(s),e.autoClear=!1,i=t.clearColor||i,a=t.clearAlpha||a,null!=i&&(e.setClearColor(i),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=r,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.width=e,this.height=t,this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(e){const t=this.kernel;for(let s=0;s<e;s++){const i=new v;i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=Math.random(),i.normalize();let a=s/e;a=V.lerp(.1,1,a*a),i.multiplyScalar(a),t.push(i)}}generateRandomKernelRotations(){const e=new yn,t=new Float32Array(16);for(let s=0;s<16;s++){const i=2*Math.random()-1,a=2*Math.random()-1,n=0;t[s]=e.noise3d(i,a,n)}this.noiseTexture=new Re(t,4,4,Le,Te),this.noiseTexture.wrapS=M,this.noiseTexture.wrapT=M,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(e){const s=t.get(e);e.visible=s}),t.clear()}}Bn.OUTPUT={Default:0,SSAO:1,Blur:2,Depth:3,Normal:4};const wn={name:"ColorCorrectionShader",uniforms:{tDiffuse:{value:null},powRGB:{value:new v(2,2,2)},mulRGB:{value:new v(1,1,1)},addRGB:{value:new v(0,0,0)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 powRGB;\n\t\tuniform vec3 mulRGB;\n\t\tuniform vec3 addRGB;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );\n\n\t\t}"},Sn={name:"VignetteShader",uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}"},Qn={name:"SepiaShader",uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float amount;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\t\t\tvec3 c = color.rgb;\n\n\t\t\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n\t\t\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n\t\t\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n\n\t\t\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n\n\t\t}"},jn={name:"HueSaturationShader",uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float hue;\n\t\tuniform float saturation;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// hue\n\t\t\tfloat angle = hue * 3.14159265;\n\t\t\tfloat s = sin(angle), c = cos(angle);\n\t\t\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\t\t\tfloat len = length(gl_FragColor.rgb);\n\t\t\tgl_FragColor.rgb = vec3(\n\t\t\t\tdot(gl_FragColor.rgb, weights.xyz),\n\t\t\t\tdot(gl_FragColor.rgb, weights.zxy),\n\t\t\t\tdot(gl_FragColor.rgb, weights.yzx)\n\t\t\t);\n\n\t\t\t// saturation\n\t\t\tfloat average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;\n\t\t\tif (saturation > 0.0) {\n\t\t\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n\t\t\t} else {\n\t\t\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);\n\t\t\t}\n\n\t\t}"},Mn={name:"BrightnessContrastShader",uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float brightness;\n\t\tuniform float contrast;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\tgl_FragColor.rgb += brightness;\n\n\t\t\tif (contrast > 0.0) {\n\t\t\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n\t\t\t} else {\n\t\t\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n\t\t\t}\n\n\t\t}"};class Dn{constructor(e,t,s){this.scene=e,this.camera=t,this.renderer=s,this.composer=null,this.renderPass=null,this.outputPass=null,this.activeEffects=new Map,this.effectSettings={bloom:{enabled:!1,strength:1.5,radius:.4,threshold:.85},film:{enabled:!1,noiseIntensity:.5,scanlinesIntensity:.05,scanlinesCount:648,grayscale:!1},fxaa:{enabled:!1},ssao:{enabled:!1,kernelRadius:8,minDistance:.005,maxDistance:.1},toneMapping:{enabled:!0,mapping:"ACESFilmic",exposure:1},colorCorrection:{enabled:!1,powRGB:{x:2,y:2,z:2},mulRGB:{x:1,y:1,z:1},addRGB:{x:0,y:0,z:0}},vignette:{enabled:!1,offset:1,darkness:1},sepia:{enabled:!1,amount:1},hueSaturation:{enabled:!1,hue:0,saturation:0},brightnessContrast:{enabled:!1,brightness:0,contrast:0},glitch:{enabled:!1,factor:.1},pixelate:{enabled:!1,pixelSize:6},dotScreen:{enabled:!1,center:{x:.5,y:.5},angle:1.57,scale:1}},this.initializeComposer()}initializeComposer(){if(this.composer)try{for(const e of this.composer.passes||[])try{e.dispose&&e.dispose()}catch{}this.composer.dispose()}catch{}this.composer=new an(this.renderer),this.renderPass=new nn(this.scene,this.camera),this.composer.addPass(this.renderPass),this.outputPass=new on,this.updateComposer()}setCamera(e){e&&(this.camera=e,this.renderPass&&(this.renderPass.camera=e),this.updateComposer())}updateComposer(){try{const e=(this.composer.passes||[]).filter(e=>e!==this.renderPass);for(const t of e)try{t.dispose&&t.dispose()}catch{}}catch{}this.composer.passes=[this.renderPass],this.activeEffects.clear(),this.addActiveEffects(),this.composer.addPass(this.outputPass)}addActiveEffects(){this.effectSettings.ssao.enabled&&this.addSSAOEffect(),this.effectSettings.bloom.enabled&&this.addBloomEffect(),this.effectSettings.colorCorrection.enabled&&this.addColorCorrectionEffect(),this.effectSettings.brightnessContrast.enabled&&this.addBrightnessContrastEffect(),this.effectSettings.hueSaturation.enabled&&this.addHueSaturationEffect(),this.effectSettings.sepia.enabled&&this.addSepiaEffect(),this.effectSettings.vignette.enabled&&this.addVignetteEffect(),this.effectSettings.pixelate.enabled&&this.addPixelateEffect(),this.effectSettings.dotScreen.enabled&&this.addDotScreenEffect(),this.effectSettings.glitch.enabled&&this.addGlitchEffect(),this.effectSettings.film.enabled&&this.addFilmEffect(),this.effectSettings.fxaa.enabled&&this.addFXAAEffect(),this.applyToneMapping()}addBloomEffect(){const e=this.effectSettings.bloom,t=new f(window.innerWidth,window.innerHeight),s=new cn(t,e.strength,e.radius,e.threshold);this.composer.addPass(s),this.activeEffects.set("bloom",s)}addFilmEffect(){const e=this.effectSettings.film,t=new hn(e.noiseIntensity,e.scanlinesIntensity,e.scanlinesCount,e.grayscale);this.composer.addPass(t),this.activeEffects.set("film",t)}addFXAAEffect(){{const e=this.renderer.getPixelRatio(),t=new vn(Math.max(1,Math.floor(window.innerWidth*e)),Math.max(1,Math.floor(window.innerHeight*e)));return this.composer.addPass(t),void this.activeEffects.set("fxaa",t)}}addSSAOEffect(){var e,t;const s=this.effectSettings.ssao,i=Math.max(1,(null==(t=(e=this.renderer).getPixelRatio)?void 0:t.call(e))||window.devicePixelRatio||1),a=new Bn(this.scene,this.camera,Math.max(1,Math.floor(window.innerWidth*i)),Math.max(1,Math.floor(window.innerHeight*i)));a.kernelRadius=s.kernelRadius,a.minDistance=s.minDistance,a.maxDistance=s.maxDistance,this.composer.addPass(a),this.activeEffects.set("ssao",a)}applyToneMapping(){const e=this.effectSettings.toneMapping||{enabled:!0,mapping:"ACESFilmic",exposure:1},t=this._resolveToneMappingConst(e.mapping);try{this.renderer.toneMapping=e.enabled?t:It,this.renderer.toneMappingExposure=e.exposure??1}catch{}}_resolveToneMappingConst(e){switch((e||"").toLowerCase()){case"none":return It;case"linear":return rt;case"reinhard":return ot;case"cineon":return lt;default:return ct}}addColorCorrectionEffect(){const e=this.effectSettings.colorCorrection,t=new en(wn);t.material.uniforms.powRGB.value=new v(e.powRGB.x,e.powRGB.y,e.powRGB.z),t.material.uniforms.mulRGB.value=new v(e.mulRGB.x,e.mulRGB.y,e.mulRGB.z),t.material.uniforms.addRGB.value=new v(e.addRGB.x,e.addRGB.y,e.addRGB.z),this.composer.addPass(t),this.activeEffects.set("colorCorrection",t)}addVignetteEffect(){const e=this.effectSettings.vignette,t=new en(Sn);t.material.uniforms.offset.value=e.offset,t.material.uniforms.darkness.value=e.darkness,this.composer.addPass(t),this.activeEffects.set("vignette",t)}addSepiaEffect(){const e=this.effectSettings.sepia,t=new en(Qn);t.material.uniforms.amount.value=e.amount,this.composer.addPass(t),this.activeEffects.set("sepia",t)}addHueSaturationEffect(){const e=this.effectSettings.hueSaturation,t=new en(jn);t.material.uniforms.hue.value=e.hue,t.material.uniforms.saturation.value=e.saturation,this.composer.addPass(t),this.activeEffects.set("hueSaturation",t)}addBrightnessContrastEffect(){const e=this.effectSettings.brightnessContrast,t=new en(Mn);t.material.uniforms.brightness.value=e.brightness,t.material.uniforms.contrast.value=e.contrast,this.composer.addPass(t),this.activeEffects.set("brightnessContrast",t)}addGlitchEffect(){const e=new pn;e.factor=this.effectSettings.glitch.factor,this.composer.addPass(e),this.activeEffects.set("glitch",e)}addPixelateEffect(){const e=this.effectSettings.pixelate,t=new mn(e.pixelSize,this.scene,this.camera);this.composer.addPass(t),this.activeEffects.set("pixelate",t)}addDotScreenEffect(){const e=this.effectSettings.dotScreen,t=new un(new f(e.center.x,e.center.y),e.angle,e.scale);this.composer.addPass(t),this.activeEffects.set("dotScreen",t)}setEffectEnabled(t,s){if(t in this.effectSettings&&(this.effectSettings[t].enabled=s,this.updateComposer(),"toneMapping"===t))try{e(()=>Promise.resolve().then(()=>Vi),void 0).then(e=>{try{e.saveEnvironmentSettings({toneMapping:{...this.effectSettings.toneMapping}})}catch{}}).catch(()=>{})}catch{}}updateEffectSettings(t,s){if(this.effectSettings[t]&&(Object.assign(this.effectSettings[t],s),this.effectSettings[t].enabled&&this.updateComposer(),"toneMapping"===t))try{e(()=>Promise.resolve().then(()=>Vi),void 0).then(e=>{try{e.saveEnvironmentSettings({toneMapping:{...this.effectSettings.toneMapping}})}catch{}}).catch(()=>{})}catch{}}render(){this.composer.render()}handleResize(e,t){var s,i,a,n;const r=Math.max(1,(null==(i=(s=this.renderer).getPixelRatio)?void 0:i.call(s))||window.devicePixelRatio||1);"function"==typeof this.composer.setPixelRatio&&this.composer.setPixelRatio(r),this.composer.setSize(e,t);const o=this.activeEffects.get("fxaa");if(o){const s=this.renderer.getPixelRatio();"function"==typeof o.setSize?o.setSize(Math.max(1,Math.floor(e*s)),Math.max(1,Math.floor(t*s))):(null==(n=null==(a=o.material)?void 0:a.uniforms)?void 0:n.resolution)&&(o.material.uniforms.resolution.value.x=1/(e*s),o.material.uniforms.resolution.value.y=1/(t*s))}}setOutlineSelectedObjects(){}setOutlineActiveObjects(){}getSettings(){return JSON.parse(JSON.stringify(this.effectSettings))}loadSettings(e){Object.assign(this.effectSettings,e),this.updateComposer()}applyPreset(t="default"){const s=String(t||"default").toLowerCase(),i={...this.effectSettings};switch(i.fxaa.enabled=!0,i.ssao.enabled=!1,i.bloom.enabled=!1,s){case"high":i.ssao.enabled=!0,i.bloom.enabled=!0,i.bloom.strength=i.bloom.strength??1.5,i.bloom.radius=i.bloom.radius??.4,i.bloom.threshold=i.bloom.threshold??.85,i.ssao.kernelRadius=i.ssao.kernelRadius??12;break;case"medium":i.ssao.enabled=!0,i.ssao.kernelRadius=i.ssao.kernelRadius??8}this.effectSettings=i,this.updateComposer();try{e(()=>Promise.resolve().then(()=>Vi),void 0).then(e=>{try{e.saveEnvironmentSettings({postProcessing:{preset:t}})}catch{}}).catch(()=>{})}catch{}}dispose(){try{for(const e of this.activeEffects.values())try{e.dispose&&e.dispose()}catch{}if(this.activeEffects.clear(),this.composer){for(const e of this.composer.passes||[])try{e.dispose&&e.dispose()}catch{}this.composer.dispose()}}catch{}this.composer=null,this.renderPass=null,this.outputPass=null}}const Tn={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class Rn{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(e){return new ur(e)}),this.register(function(e){return new gr(e)}),this.register(function(e){return new fr(e)}),this.register(function(e){return new Cr(e)}),this.register(function(e){return new vr(e)}),this.register(function(e){return new yr(e)}),this.register(function(e){return new pr(e)}),this.register(function(e){return new mr(e)}),this.register(function(e){return new br(e)}),this.register(function(e){return new xr(e)}),this.register(function(e){return new Ir(e)}),this.register(function(e){return new Er(e)}),this.register(function(e){return new Br(e)}),this.register(function(e){return new wr(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,s,i){const a=new dr,n=[];for(let r=0,o=this.pluginCallbacks.length;r<o;r++)n.push(this.pluginCallbacks[r](a));a.setPlugins(n),a.setTextureUtils(this.textureUtils),a.writeAsync(e,t,i).catch(s)}parseAsync(e,t){const s=this;return new Promise(function(i,a){s.parse(e,i,a,t)})}}const kn=0,On=1,Fn=2,Ln=3,Pn=4,Nn=5120,Gn=5121,Un=5122,zn=5123,Hn=5124,_n=5125,qn=5126,Kn=34962,Vn=34963,Yn=9728,Wn=9729,Jn=9984,Xn=9985,Zn=9986,$n=9987,er=33071,tr=33648,sr=10497,ir="KHR_mesh_quantization",ar={};ar[D]=Yn,ar[te]=Jn,ar[ie]=Zn,ar[Q]=Wn,ar[se]=Xn,ar[j]=$n,ar[ae]=er,ar[M]=sr,ar[ne]=tr;const nr={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},rr=new A;function or(e,t){return e.length===t.length&&e.every(function(e,s){return e===t[s]})}function lr(e){return 4*Math.ceil(e/4)}function cr(e,t=0){const s=lr(e.byteLength);if(s!==e.byteLength){const i=new Uint8Array(s);if(i.set(new Uint8Array(e)),0!==t)for(let a=e.byteLength;a<s;a++)i[a]=t;return i.buffer}return e}function Ar(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function hr(e,t){if(void 0!==e.toBlob)return new Promise(s=>e.toBlob(s,t));let s;return"image/jpeg"===t?s=.92:"image/webp"===t&&(s=.8),e.convertToBlob({type:t,quality:s})}class dr{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+Et}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const i=this,a=i.buffers,n=i.json;s=i.options;const r=i.extensionsUsed,o=i.extensionsRequired,l=new Blob(a,{type:"application/octet-stream"}),c=Object.keys(r),A=Object.keys(o);if(c.length>0&&(n.extensionsUsed=c),A.length>0&&(n.extensionsRequired=A),n.buffers&&n.buffers.length>0&&(n.buffers[0].byteLength=l.size),!0===s.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const s=cr(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,s.byteLength,!0),i.setUint32(4,5130562,!0);const a=cr((r=JSON.stringify(n),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,a.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const A=12+o.byteLength+a.byteLength+i.byteLength+s.byteLength;c.setUint32(8,A,!0);const h=new Blob([l,o,a,i,s],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(h),d.onloadend=function(){t(d.result)}}}else if(n.buffers&&n.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const s=e.result;n.buffers[0].uri=s,t(n)}}else t(n)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const s=this.options,i=this.extensionsUsed;try{const a=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&a.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in a.gltfExtensions)t.extensions[e]=a.gltfExtensions[e],i[e]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(t.extras=a)}catch(a){}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new v;for(let s=0,i=e.count;s<i;s++)if(Math.abs(t.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),i=new v;for(let a=0,n=s.count;a<n;a++)i.fromBufferAttribute(s,a),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),s.setXYZ(a,i.x,i.y,i.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),s=!0),0!==t.rotation&&(i.rotation=t.rotation,s=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,t){if(e===t)return e;function s(e){return e.colorSpace===m?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof fe&&(e=await this.decompressTextureAsync(e)),t instanceof fe&&(t=await this.decompressTextureAsync(t));const i=e?e.image:null,a=t?t.image:null,n=Math.max(i?i.width:0,a?a.width:0),r=Math.max(i?i.height:0,a?a.height:0),o=Ar();o.width=n,o.height=r;const l=o.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,n,r);const c=l.getImageData(0,0,n,r);if(i){l.drawImage(i,0,0,n,r);const t=s(e),a=l.getImageData(0,0,n,r).data;for(let e=2;e<a.length;e+=4)c.data[e]=256*t(a[e]/256)}if(a){l.drawImage(a,0,0,n,r);const e=s(t),i=l.getImageData(0,0,n,r).data;for(let t=1;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}l.putImageData(c,0,0);const A=(e||t).clone();return A.source=new Bt(o),A.colorSpace=Oe,A.channel=(e||t).channel,e&&t&&(e.channel,t.channel),A}async decompressTextureAsync(e,t=1/0){if(null===this.textureUtils)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,i,a){const n=this.json;let r;switch(n.bufferViews||(n.bufferViews=[]),t){case Nn:case Gn:r=1;break;case Un:case zn:r=2;break;default:r=4}let o=e.itemSize*r;a===Kn&&(o=4*Math.ceil(o/4));const l=lr(i*o),c=new DataView(new ArrayBuffer(l));let A=0;for(let d=s;d<s+i;d++){for(let s=0;s<e.itemSize;s++){let i;e.itemSize>4?i=e.array[d*e.itemSize+s]:(0===s?i=e.getX(d):1===s?i=e.getY(d):2===s?i=e.getZ(d):3===s&&(i=e.getW(d)),!0===e.normalized&&(i=V.normalize(i,e.array))),t===qn?c.setFloat32(A,i,!0):t===Hn?c.setInt32(A,i,!0):t===_n?c.setUint32(A,i,!0):t===Un?c.setInt16(A,i,!0):t===zn?c.setUint16(A,i,!0):t===Nn?c.setInt8(A,i):t===Gn&&c.setUint8(A,i),A+=r}A%o!==0&&(A+=o-A%o)}const h={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};void 0!==a&&(h.target=a),a===Kn&&(h.byteStride=o),this.byteOffset+=l,n.bufferViews.push(h);return{id:n.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(i){const a=new FileReader;a.readAsArrayBuffer(e),a.onloadend=function(){const e=cr(a.result),n={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(s.bufferViews.push(n)-1)}})}processAccessor(e,t,s,i){const a=this.json;let n;if(e.array.constructor===Float32Array)n=qn;else if(e.array.constructor===Int32Array)n=Hn;else if(e.array.constructor===Uint32Array)n=_n;else if(e.array.constructor===Int16Array)n=Un;else if(e.array.constructor===Uint16Array)n=zn;else if(e.array.constructor===Int8Array)n=Nn;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);n=Gn}if(void 0===s&&(s=0),void 0!==i&&i!==1/0||(i=e.count),0===i)return null;const r=function(e,t,s){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let a=t;a<t+s;a++)for(let t=0;t<e.itemSize;t++){let s;e.itemSize>4?s=e.array[a*e.itemSize+t]:(0===t?s=e.getX(a):1===t?s=e.getY(a):2===t?s=e.getZ(a):3===t&&(s=e.getW(a)),!0===e.normalized&&(s=V.normalize(s,e.array))),i.min[t]=Math.min(i.min[t],s),i.max[t]=Math.max(i.max[t],s)}return i}(e,s,i);let o;void 0!==t&&(o=e===t.index?Vn:Kn);const l=this.processBufferView(e,n,s,i,o),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:n,count:i,max:r.max,min:r.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(c)-1}processImage(e,t,s,i="image/png"){if(null!==e){const t=this,a=t.cache,n=t.json,r=t.options,o=t.pending;a.images.has(e)||a.images.set(e,{});const l=a.images.get(e),c=i+":flipY/"+s.toString();if(void 0!==l[c])return l[c];n.images||(n.images=[]);const A={mimeType:i},h=Ar();h.width=Math.min(e.width,r.maxTextureSize),h.height=Math.min(e.height,r.maxTextureSize);const d=h.getContext("2d",{willReadFrequently:!0});if(!0===s&&(d.translate(0,h.height),d.scale(1,-1)),void 0!==e.data){e.width>r.maxTextureSize||(e.height,r.maxTextureSize);const t=new Uint8ClampedArray(e.height*e.width*4);for(let s=0;s<t.length;s+=4)t[s+0]=e.data[s+0],t[s+1]=e.data[s+1],t[s+2]=e.data[s+2],t[s+3]=e.data[s+3];d.putImageData(new ImageData(t,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");d.drawImage(e,0,0,h.width,h.height)}!0===r.binary?o.push(hr(h,i).then(e=>t.processBufferViewImage(e)).then(e=>{A.bufferView=e})):void 0!==h.toDataURL?A.uri=h.toDataURL(i):o.push(hr(h,i).then(e=>(new FileReader).readAsDataURL(e)).then(e=>{A.uri=e}));const u=n.images.push(A)-1;return l[c]=u,u}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:ar[e.magFilter],minFilter:ar[e.minFilter],wrapS:ar[e.wrapS],wrapT:ar[e.wrapT]};return t.samplers.push(s)-1}async processTextureAsync(e){const t=this.options,s=this.cache,i=this.json;if(s.textures.has(e))return s.textures.get(e);i.textures||(i.textures=[]),e instanceof fe&&(e=await this.decompressTextureAsync(e,t.maxTextureSize));let a=e.userData.mimeType;"image/webp"===a&&(a="image/png");const n={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(n.name=e.name),await this._invokeAllAsync(async function(t){t.writeTexture&&await t.writeTexture(e,n)});const r=i.textures.push(n)-1;return s.textures.set(e,r),r}async processMaterialAsync(e){const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return null;s.materials||(s.materials=[]);const i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&e.isMeshBasicMaterial;const a=e.color.toArray().concat([e.opacity]);if(or(a,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=a),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),s={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(s,t),i.pbrMetallicRoughness.metallicRoughnessTexture=s}if(e.map){const t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){const t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){const t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===F&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),await this._invokeAllAsync(async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,i)});const n=s.materials.push(i)-1;return t.materials.set(e,n),n}async processMeshAsync(e){const t=this.cache,s=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let C=0,v=e.material.length;C<v;C++)i.push(e.material[C].uuid);else i.push(e.material.uuid);const a=i.join(":");if(t.meshes.has(a))return t.meshes.get(a);const n=e.geometry;let r;r=e.isLineSegments?On:e.isLineLoop?Fn:e.isLine?Ln:e.isPoints?kn:e.material.wireframe?On:Pn;const o={},l={},c=[],A=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=n.getAttribute("normal");void 0===d||this.isNormalizedNormalAttribute(d)||n.setAttribute("normal",this.createNormalizedNormalAttribute(d));let u=null;for(let C in n.attributes){if("morph"===C.slice(0,5))continue;const e=n.attributes[C];C=h[C]||C.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(C)||(C="_"+C),t.attributes.has(this.getUID(e))){l[C]=t.attributes.get(this.getUID(e));continue}u=null;const s=e.array;"JOINTS_0"!==C||s instanceof Uint16Array||s instanceof Uint8Array?(s instanceof Uint32Array||s instanceof Int32Array)&&!C.startsWith("_")&&(u=Rn.Utils.toFloat32BufferAttribute(e)):u=new w(new Uint16Array(s),e.itemSize,e.normalized);const i=this.processAccessor(u||e,n);null!==i&&(C.startsWith("_")||this.detectMeshQuantization(C,e),l[C]=i,t.attributes.set(this.getUID(e),i))}if(void 0!==d&&n.setAttribute("normal",d),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const s=[],i=[],a={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)a[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){const o={};let l=!1;for(const e in n.morphAttributes){if("position"!==e&&"normal"!==e){l||(l=!0);continue}const s=n.morphAttributes[e][r],i=e.toUpperCase(),a=n.attributes[e];if(t.attributes.has(this.getUID(s,!0))){o[i]=t.attributes.get(this.getUID(s,!0));continue}const c=s.clone();if(!n.morphTargetsRelative)for(let e=0,t=s.count;e<t;e++)for(let i=0;i<s.itemSize;i++)0===i&&c.setX(e,s.getX(e)-a.getX(e)),1===i&&c.setY(e,s.getY(e)-a.getY(e)),2===i&&c.setZ(e,s.getZ(e)-a.getZ(e)),3===i&&c.setW(e,s.getW(e)-a.getW(e));o[i]=this.processAccessor(c,n),t.attributes.set(this.getUID(a,!0),o[i])}A.push(o),s.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&i.push(a[r])}o.weights=s,i.length>0&&(o.extras={},o.extras.targetNames=i)}const g=Array.isArray(e.material);if(g&&0===n.groups.length)return null;let p=!1;if(g&&null===n.index){const e=[];for(let t=0,s=n.attributes.position.count;t<s;t++)e[t]=t;n.setIndex(e),p=!0}const m=g?e.material:[e.material],b=g?n.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let C=0,v=b.length;C<v;C++){const e={mode:r,attributes:l};if(this.serializeUserData(n,e),A.length>0&&(e.targets=A),null!==n.index){let s=this.getUID(n.index);void 0===b[C].start&&void 0===b[C].count||(s+=":"+b[C].start+":"+b[C].count),t.attributes.has(s)?e.indices=t.attributes.get(s):(e.indices=this.processAccessor(n.index,n,b[C].start,b[C].count),t.attributes.set(s,e.indices)),null===e.indices&&delete e.indices}const s=await this.processMaterialAsync(m[b[C].materialIndex]);null!==s&&(e.material=s),c.push(e)}!0===p&&n.setIndex(null),o.primitives=c,s.meshes||(s.meshes=[]),await this._invokeAllAsync(function(t){t.writeMesh&&t.writeMesh(e,o)});const f=s.meshes.push(o)-1;return t.meshes.set(a,f),f}detectMeshQuantization(e,t){if(this.extensionsUsed[ir])return;let s;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");const i=e.split("_",1)[0];Tn[i]&&Tn[i].includes(s)&&(this.extensionsUsed[ir]=!0,this.extensionsRequired[ir]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,i={type:s?"orthographic":"perspective"};return s?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:V.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const s=this.json,i=this.nodeMap;s.animations||(s.animations=[]);const a=(e=Rn.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,n=[],r=[];for(let o=0;o<a.length;++o){const e=a[o],s=L.parseTrackName(e.name);let l=L.findNode(t,s.nodeName);const c=nr[s.propertyName];if("bones"===s.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(s.objectIndex):void 0),!l||!c)continue;const A=1;let h,d=e.values.length/e.times.length;c===nr.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",d/=3):h=e.getInterpolation()===re?"STEP":"LINEAR",r.push({input:this.processAccessor(new w(e.times,A)),output:this.processAccessor(new w(e.values,d)),interpolation:h}),n.push({sampler:r.length-1,target:{node:i.get(l),path:c}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:r,channels:n}),s.animations.length-1}processSkin(e){const t=this.json,s=this.nodeMap,i=t.nodes[s.get(e)],a=e.skeleton;if(void 0===a)return null;const n=e.skeleton.bones[0];if(void 0===n)return null;const r=[],o=new Float32Array(16*a.bones.length),l=new C;for(let c=0;c<a.bones.length;++c)r.push(s.get(a.bones[c])),l.copy(a.boneInverses[c]),l.multiply(e.bindMatrix).toArray(o,16*c);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new w(o,16)),joints:r,skeleton:s.get(n)});return i.skin=t.skins.length-1}async processNodeAsync(e){const t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const a={};if(s.trs){const t=e.quaternion.toArray(),s=e.position.toArray(),i=e.scale.toArray();or(t,[0,0,0,1])||(a.rotation=t),or(s,[0,0,0])||(a.translation=s),or(i,[1,1,1])||(a.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===or(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(a.matrix=e.matrix.elements);if(""!==e.name&&(a.name=String(e.name)),this.serializeUserData(e,a),e.isMesh||e.isLine||e.isPoints){const t=await this.processMeshAsync(e);null!==t&&(a.mesh=t)}else e.isCamera&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,a=e.children.length;i<a;i++){const a=e.children[i];if(a.visible||!1===s.onlyVisible){const e=await this.processNodeAsync(a);null!==e&&t.push(e)}}t.length>0&&(a.children=t)}await this._invokeAllAsync(function(t){t.writeNode&&t.writeNode(e,a)});const n=t.nodes.push(a)-1;return i.set(e,n),n}async processSceneAsync(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const a=[];for(let n=0,r=e.children.length;n<r;n++){const t=e.children[n];if(t.visible||!1===s.onlyVisible){const e=await this.processNodeAsync(t);null!==e&&a.push(e)}}a.length>0&&(i.nodes=a),this.serializeUserData(e,i)}async processObjectsAsync(e){const t=new wt;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);await this.processSceneAsync(t)}async processInputAsync(e){const t=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync(function(t){t.beforeParse&&t.beforeParse(e)});const s=[];for(let i=0;i<e.length;i++)e[i]instanceof wt?await this.processSceneAsync(e[i]):s.push(e[i]);s.length>0&&await this.processObjectsAsync(s);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);await this._invokeAllAsync(function(t){t.afterParse&&t.afterParse(e)})}async _invokeAllAsync(e){for(let t=0,s=this.plugins.length;t<s;t++)await e(this.plugins[t])}}class ur{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return;const s=this.writer,i=s.json,a=s.extensionsUsed,n={};e.name&&(n.name=e.name),n.color=e.color.toArray(),n.intensity=e.intensity,e.isDirectionalLight?n.type="directional":e.isPointLight?(n.type="point",e.distance>0&&(n.range=e.distance)):e.isSpotLight&&(n.type="spot",e.distance>0&&(n.range=e.distance),n.spot={},n.spot.innerConeAngle=(1-e.penumbra)*e.angle,n.spot.outerConeAngle=e.angle),void 0!==e.decay&&e.decay,e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||e.target.position.z),a[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},a[this.name]=!0);const r=i.extensions[this.name].lights;r.push(n),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}}class gr{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class pr{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const s=this.writer,i=s.extensionsUsed,a={};if(a.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:await s.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(t,e.clearcoatMap),a.clearcoatTexture=t}if(a.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:await s.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(t,e.clearcoatRoughnessMap),a.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:await s.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(t,e.clearcoatNormalMap),a.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class mr{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;const s=this.writer.extensionsUsed,i={};i.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class br{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const s=this.writer,i=s.extensionsUsed,a={};if(a.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:await s.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(t,e.iridescenceMap),a.iridescenceTexture=t}if(a.iridescenceIor=e.iridescenceIOR,a.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],a.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:await s.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(t,e.iridescenceThicknessMap),a.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class fr{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const s=this.writer,i=s.extensionsUsed,a={};if(a.transmissionFactor=e.transmission,e.transmissionMap){const t={index:await s.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(t,e.transmissionMap),a.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class Cr{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const s=this.writer,i=s.extensionsUsed,a={};if(a.thicknessFactor=e.thickness,e.thicknessMap){const t={index:await s.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(t,e.thicknessMap),a.thicknessTexture=t}e.attenuationDistance!==1/0&&(a.attenuationDistance=e.attenuationDistance),a.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class vr{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const s=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class yr{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(rr)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,i=s.extensionsUsed,a={};if(e.specularIntensityMap){const t={index:await s.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(t,e.specularIntensityMap),a.specularTexture=t}if(e.specularColorMap){const t={index:await s.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(t,e.specularColorMap),a.specularColorTexture=t}a.specularFactor=e.specularIntensity,a.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class xr{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const s=this.writer,i=s.extensionsUsed,a={};if(e.sheenRoughnessMap){const t={index:await s.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(t,e.sheenRoughnessMap),a.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:await s.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(t,e.sheenColorMap),a.sheenColorTexture=t}a.sheenRoughnessFactor=e.sheenRoughness,a.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class Ir{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const s=this.writer,i=s.extensionsUsed,a={};if(e.anisotropyMap){const t={index:await s.processTextureAsync(e.anisotropyMap)};s.applyTextureTransform(t,e.anisotropyMap),a.anisotropyTexture=t}a.anisotropyStrength=e.anisotropy,a.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class Er{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const s=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class Br{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const s=this.writer,i=s.extensionsUsed,a={};if(e.bumpMap){const t={index:await s.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(t,e.bumpMap),a.bumpTexture=t}a.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=a,i[this.name]=!0}}class wr{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const s=this.writer,i=e,a=new Float32Array(3*i.count),n=new Float32Array(4*i.count),r=new Float32Array(3*i.count),o=new C,l=new v,c=new ee,A=new v;for(let d=0;d<i.count;d++)i.getMatrixAt(d,o),o.decompose(l,c,A),l.toArray(a,3*d),c.toArray(n,4*d),A.toArray(r,3*d);const h={TRANSLATION:s.processAccessor(new w(a,3)),ROTATION:s.processAccessor(new w(n,4)),SCALE:s.processAccessor(new w(r,3))};i.instanceColor&&(h._COLOR_0=s.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:h},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}Rn.Utils={insertKeyframe:function(e,t){const s=.001,i=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),n=new e.ValueBufferType(e.values.length+i),r=e.createInterpolant(new e.ValueBufferType(i));let o;if(0===e.times.length){a[0]=t;for(let e=0;e<i;e++)n[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<s)return 0;a[0]=t,a.set(e.times,1),n.set(r.evaluate(t),0),n.set(e.values,i),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<s)return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),n.set(e.values,0),n.set(r.evaluate(t),e.values.length),o=a.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<s)return l;if(e.times[l]<t&&e.times[l+1]>t){a.set(e.times.slice(0,l+1),0),a[l+1]=t,a.set(e.times.slice(l+1),l+2),n.set(e.values.slice(0,(l+1)*i),0),n.set(r.evaluate(t),(l+1)*i),n.set(e.values.slice((l+1)*i),(l+2)*i),o=l+1;break}}return e.times=a,e.values=n,o},mergeMorphTargetTracks:function(e,t){const s=[],i={},a=e.tracks;for(let n=0;n<a.length;++n){let e=a[n];const r=L.parseTrackName(e.name),o=L.findNode(t,r.nodeName);if("morphTargetInfluences"!==r.propertyName||void 0===r.propertyIndex){s.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");e=e.clone(),e.setInterpolation(Z)}const l=o.morphTargetInfluences.length,c=o.morphTargetDictionary[r.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+r.propertyIndex);let A;if(void 0===i[o.uuid]){A=e.clone();const t=new A.ValueBufferType(l*A.times.length);for(let e=0;e<A.times.length;e++)t[e*l+c]=A.values[e];A.name=(r.nodeName||"")+".morphTargetInfluences",A.values=t,i[o.uuid]=A,s.push(A);continue}const h=e.createInterpolant(new e.ValueBufferType(1));A=i[o.uuid];for(let t=0;t<A.times.length;t++)A.values[t*l+c]=h.evaluate(A.times[t]);for(let t=0;t<e.times.length;t++){const s=this.insertKeyframe(A,e.times[t]);A.values[s*l+c]=e.values[t]}}return e.tracks=s,e},toFloat32BufferAttribute:function(e){const t=new w(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return t.array.set(e.array),t;for(let s=0,i=e.count;s<i;s++)for(let a=0;a<e.itemSize;a++)t.setComponent(s,a,e.getComponent(s,a));return t}};class Sr{constructor(){this.loader=Si(),this.exporter=new Rn,this.thumbnailRenderer=null,this.initThumbnailRenderer(),(async()=>{try{const e=localStorage.getItem("customMeshes");if(!e)return!1;const t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return localStorage.removeItem("customMeshes"),!1;for(const s of t)await Xi(s);return localStorage.removeItem("customMeshes"),!0}catch(e){return!1}})()}initThumbnailRenderer(){if(this.thumbnailRenderer&&this.thumbnailRenderer.renderer)try{this.thumbnailRenderer.renderer.dispose()}catch{}this.thumbnailRenderer={scene:new wt,camera:new K(75,1,.1,1e3),renderer:new St({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,powerPreference:"low-power"})};const{scene:e,camera:t,renderer:s}=this.thumbnailRenderer;s.setSize(128,128),s.setClearColor(2763306,1),this.setupLighting(e);try{wi(s)}catch{}}setupLighting(e){const t=new Qt(4210752,.6);e.add(t);const s=new g(16777215,.8);s.position.set(1,1,1),e.add(s);const i=new g(16777215,.4);i.position.set(-1,-1,-1),e.add(i)}safeRotationCopy(e,t){if(e&&t)try{void 0!==e.order?t.copy(e):t.set(e.x||0,e.y||0,e.z||0,"XYZ")}catch(s){t.set(0,0,0,"XYZ")}}createSafeClone(e){var t,s;try{if(!e||"object"!=typeof e)return new I;if("Group"===e.type||e.isGroup){const t=new q;return t.name=e.name||"",Array.isArray(e.children)&&e.children.forEach(e=>{try{const s=this.createSafeClone(e);t.add(s)}catch(s){}}),e.position&&t.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,t.rotation),e.scale&&t.scale.copy(e.scale),t}if(e.isMesh){const i=e.geometry?e.geometry.clone():null,a=e.material?this.cloneMaterial(e.material):null,n=new G(i,a);try{const e=!("undefined"==typeof window||!window.__editorControls||!(null==(s=null==(t=window.__editorControls.editorStore)?void 0:t.getState)?void 0:s.call(t).isWireframe));Array.isArray(n.material)?n.material.forEach(t=>{t&&(t.wireframe=e)}):n.material&&(n.material.wireframe=e)}catch{}return n.name=e.name||"",e.position&&n.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,n.rotation),e.scale&&n.scale.copy(e.scale),n}const i=new I;return i.name=e.name||"",Array.isArray(e.children)&&e.children.forEach(e=>{try{const t=this.createSafeClone(e);i.add(t)}catch(t){}}),e.position&&i.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,i.rotation),e.scale&&i.scale.copy(e.scale),i}catch(i){const t=new I;return t.name=e&&e.name||"fallback_object",t}}cloneMaterial(e){return Array.isArray(e)?e.map(e=>e.clone?e.clone():e):e.clone?e.clone():e}async loadLibraryMeshes(){try{const t=[{filename:"111.glb",name:"메쉬 111"},{filename:"222.glb",name:"메쉬 222"},{filename:"SM_MERGED_BP_C_GY_Floor_C_1.glb",name:"바닥 메쉬"},{filename:"SM_MERGED_BP_GY_Ceil_C_1.glb",name:"천장 메쉬"},{filename:"SM_MERGED_BP_GY_Pillar_C_1.glb",name:"기둥 메쉬"},{filename:"SM_MERGED_BP_GY_Wall_C_1.glb",name:"벽 메쉬"},{filename:"SM_MERGED_StaticMeshActor_0.glb",name:"정적 메쉬"}],s=[];for(const i of t){const t=`/library/mesh/${i.filename}`;try{if(!(await fetch(t,{method:"HEAD"})).ok)continue}catch(e){continue}const a={id:`library_${i.filename.replace(".glb","")}`,name:i.name,type:"library",geometry:"LibraryMesh",glbUrl:t,filename:i.filename,thumbnail:null,isLoadingThumbnail:!0};s.push(a)}return s}catch(e){return[]}}async generateThumbnailFromURL(e){return new Promise((t,s)=>{this.loader.load(e,e=>{try{const{scene:s,camera:i,renderer:a}=this.thumbnailRenderer,n=[];s.traverse(e=>{e.isMesh&&n.push(e)}),n.forEach(e=>s.remove(e));const r=e.scene;s.add(r);const o=(new ue).setFromObject(r),l=o.getCenter(new v),c=o.getSize(new v);r.position.sub(l);const A=Math.max(c.x,c.y,c.z),h=i.fov*(Math.PI/180);let d=Math.abs(A/2/Math.tan(h/2));d*=1.5,i.position.set(.7*d,.5*d,d),i.lookAt(0,0,0),a.render(s,i);const u=a.domElement.toDataURL("image/png");s.remove(r),t(u)}catch(i){s(i)}},e=>{},e=>{s(e)})})}generateThumbnailFromObject(e,t=128){const{scene:s,camera:i,renderer:a}=this.thumbnailRenderer;for(a.setSize(t,t),a.setClearColor(2763306,1);s.children.length;)s.remove(s.children[0]);let n;this.setupLighting(s);try{n="function"==typeof e.clone?e.clone():this.createSafeClone(e)}catch(u){n=this.createSafeClone(e)}s.add(n);const r=(new ue).setFromObject(n),o=r.getCenter(new v),l=r.getSize(new v);n.position.sub(o);const c=Math.max(l.x,l.y,l.z),A=i.fov*(Math.PI/180);let h=Math.abs(c/2/Math.tan(A/2));h*=1.5,i.position.set(.7*h,.5*h,h),i.lookAt(0,0,0),a.render(s,i);const d=a.domElement.toDataURL("image/png");return s.clear(),d}async exportObjectToGLB(e,t={}){const{preserveTransform:s=!1}=t;return new Promise((t,i)=>{let a;try{a="function"==typeof e.clone?e.clone():this.createSafeClone(e)}catch(r){a=this.createSafeClone(e)}if(!a||"object"!=typeof a)return void i(new Error("객체 복제에 실패했습니다."));if(s);else try{a.position&&"function"==typeof a.position.set&&a.position.set(0,0,0),a.rotation&&"function"==typeof a.rotation.set&&a.rotation.set(0,0,0,"XYZ"),a.scale&&"function"==typeof a.scale.set&&a.scale.set(1,1,1)}catch(o){}const n=e=>{if(e&&"object"==typeof e){if(e.material)try{e.material=this.cloneMaterial(e.material)}catch(r){}Array.isArray(e.children)&&e.children.forEach(e=>{try{n(e)}catch(t){}})}};n(a),this.exporter.parse(a,e=>{t(e)},e=>{i(e)},{binary:!0,includeCustomExtensions:!0,embedImages:!0,maxTextureSize:1024,forcePowerOfTwoTextures:!1,truncateDrawRange:!1})})}async addCustomMesh(e,t,s={}){const{preserveTransform:i=!0}=s;try{const s=await this.exportObjectToGLB(e,{preserveTransform:i}),a=this.generateThumbnailFromObject(e),n=Date.now(),r={id:`custom_${n}`,name:t||"커스텀 메쉬",fileName:`custom_${n}.glb`,thumbnail:a,type:"custom",glbData:s,createdAt:n,transform:{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}};return await this.saveCustomMesh(r),r}catch(a){throw new Error("ADD_CUSTOM_MESH_FAILED")}}async saveCustomMesh(e){try{await Xi(e)}catch(t){throw new Error("IDB_SAVE_FAILED")}}async getCustomMeshes(){return(await Ji()).map(e=>{const t={...e};if(e&&e.thumbnail&&"object"==typeof e.thumbnail&&"size"in e.thumbnail)try{t.thumbnail=URL.createObjectURL(e.thumbnail)}catch{}return t})}async deleteCustomMesh(e){try{await Zi(e)}catch(t){throw new Error("IDB_DELETE_FAILED")}return await Ji()}createBlobURL(e){try{let t;if(e instanceof ArrayBuffer)t=e;else if(e instanceof Uint8Array)t=e.buffer;else if("object"==typeof e&&"Buffer"===e.type)t=new Uint8Array(e.data||e).buffer;else{if(!Array.isArray(e))throw new Error("GLB 데이터를 처리할 수 없습니다.");t=new Uint8Array(e).buffer}const s=new Blob([t],{type:"model/gltf-binary"});return URL.createObjectURL(s)}catch(t){throw t}}async loadGLBModel(e){return new Promise((t,s)=>{this.loader.load(e,e=>{t(e.scene)},e=>{},e=>{s(e)})})}dispose(){this.thumbnailRenderer&&(this.thumbnailRenderer.renderer.dispose(),this.thumbnailRenderer.scene.clear(),this.thumbnailRenderer=null)}}let Qr=null;const jr=()=>(Qr||(Qr=new Sr),Qr);function Mr({onEditorControlsReady:e,onPostProcessingReady:i,onContextMenu:a}){const n=s.useRef(null),r=s.useRef(null),o=s.useRef(null),l=s.useRef(null),c=s.useRef(null),h=s.useRef(new Map),m=s.useRef(null),b=s.useRef({animId:null,t:0,target:0,start:0,startTime:0,duration:220,easing:"easeInOutQuad",maxOpacity:.6}),{objects:C,walls:y,setScene:x,setSelectedObject:I}=sa(),E=s.useRef(sa.getState().isPostProcessingEnabled);return s.useEffect(()=>{const e=sa.subscribe((e,t)=>{e.isPostProcessingEnabled!==t.isPostProcessingEnabled&&(E.current=e.isPostProcessingEnabled)});return()=>e()},[]),s.useEffect(()=>{var t,s,C,y,B,w,S,Q;if(!n.current)return;const j=new wt,M=new wt;j.background=new A(2763306);const D=new K(75,window.innerWidth/window.innerHeight,.1,1e3);D.position.set(15,20,15),D.lookAt(0,0,0);const T=(()=>{try{return sa.getState().rendererAA||"msaa"}catch{return"msaa"}})(),R=new St({antialias:"msaa"===T,powerPreference:"high-performance"});try{const e=sa.getState(),s=(null==(t=e.safeMode)?void 0:t.enabled)?e.safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);R.setPixelRatio(s)}catch{R.setPixelRatio(Math.min(2,window.devicePixelRatio||1))}R.setSize(window.innerWidth,window.innerHeight),R.shadowMap.enabled=!0,R.shadowMap.type=jt,R.sortObjects=!1,R.autoClear=!1,n.current.appendChild(R.domElement);try{wi(R)}catch{}const k=e=>{e.preventDefault()},L=()=>{try{R.setSize(window.innerWidth,window.innerHeight),l.current&&(l.current.initializeComposer(),l.current.handleResize(window.innerWidth,window.innerHeight))}catch{}};R.domElement.addEventListener("webglcontextlost",k,!1),R.domElement.addEventListener("webglcontextrestored",L,!1);const P=e=>{a&&a(e)};R.domElement.addEventListener("contextmenu",P),c.current=j,x(j,D,R);const N=new Va(j,D,R,sa,e=>{var t,s,i,a;x(j,e,R);try{null==(s=null==(t=l.current)?void 0:t.setCamera)||s.call(t,e)}catch{}try{null==(a=null==(i=o.current)?void 0:i.setCamera)||a.call(i,e)}catch{}});N.gizmoScene=M,r.current=N;try{window.__editorControls=N}catch{}window.runSmokeTest=()=>function(e,t){var s,i;try{if(!e||!t)return!1;const n=t.getState();try{null==(s=e.applyInitialViewState)||s.call(e)}catch(a){return null==a||a.message,!1}n.isWireframe,t.getState().toggleWireframe();try{null==(i=e.updateWireframe)||i.call(e)}catch{}t.getState().isWireframe;const r=new O,o=new Ne(1,1,1),l=new G(o,r);try{e.scene.add(l),l.material.wireframe}catch(a){return null==a||a.message,!1}finally{try{e.scene.remove(l),o.dispose(),r.dispose()}catch{}}return!0}catch(a){return null==a||a.message,!1}}(N,sa);try{null==(s=N.applyInitialViewState)||s.call(N)}catch{}try{if(!!sa.getState().useBlenderControls){const e=new Ya(N.camera,R.domElement);e.setScene(j);const t=sa.getState();e.setSpeeds({rotate:.01*t.cameraOrbitSpeed,pan:.02*t.cameraPanSpeed,zoom:t.cameraZoomSpeed}),o.current=e;try{window.__blenderControls=e}catch{}try{const t=sa.subscribe((t,s)=>{t.cameraPanSpeed===s.cameraPanSpeed&&t.cameraOrbitSpeed===s.cameraOrbitSpeed&&t.cameraZoomSpeed===s.cameraZoomSpeed||e.setSpeeds({rotate:.01*t.cameraOrbitSpeed,pan:.02*t.cameraPanSpeed,zoom:t.cameraZoomSpeed})}),s=null==(C=N.dispose)?void 0:C.bind(N);N.dispose=()=>{try{null==t||t()}catch{}null==s||s()}}catch{}}}catch{}const U=new Dn(j,D,R);l.current=U;try{U.setCamera(D)}catch{}try{const e=null==_i?void 0:_i();e&&(e.toneMapping&&(U.updateEffectSettings("toneMapping",{...e.toneMapping}),U.setEffectEnabled("toneMapping",!1!==e.toneMapping.enabled)),(null==(y=e.postProcessing)?void 0:y.preset)&&(null==(B=U.applyPreset)||B.call(U,e.postProcessing.preset)))}catch{}try{N.setPostProcessingManager(U)}catch{}try{sa.getState().setPostProcessingManager(U)}catch{}try{const e=sa.getState(),t="fxaa"===e.rendererAA&&!(null==(w=e.safeMode)?void 0:w.enabled);U.setEffectEnabled("fxaa",!!t)}catch{}try{sa.getState().estimateVRAMUsage()}catch{}e&&e(N),i&&i(U),null==(Q=(S=N.objectSelector).setGizmoScene)||Q.call(S,M);const z=new Qt(4210752,.6);j.add(z);const H=new g(16777215,.8);H.position.set(50,50,50),H.castShadow=!0,H.shadow.mapSize.width=1024,H.shadow.mapSize.height=1024,j.add(H);const _=new u(16755336,1,100);_.position.set(0,6,6),j.add(_);const q=new O({color:8421504,roughness:.9,metalness:0}),V=new Ve(200,200),Y=new G(V,q);Y.rotation.x=-Math.PI/2,Y.receiveShadow=!0,Y.position.y=0,Y.name="Ground",Y.userData.isSystemObject=!0,j.add(Y);const W=new Ne(2,2,2),J=new O({color:16711680}),X=new G(W,J);X.position.set(0,1,0),X.castShadow=!0,X.userData.name="Test Cube",X.userData.id="test_cube",j.add(X);const Z=new ze(.5,.5,3),$=new O({color:9127187}),te=new G(Z,$);te.position.set(5,1.5,0),te.castShadow=!0,te.userData.name="Tree Trunk",te.userData.id="tree_trunk",j.add(te);const se=new qe(2),ie=new O({color:2263842}),ae=new G(se,ie);ae.position.set(5,4,0),ae.castShadow=!0,ae.userData.name="Tree Leaves",ae.userData.id="tree_leaves",j.add(ae),h.current.set("test_cube",X),h.current.set("tree_trunk",te),h.current.set("tree_leaves",ae),N.addSelectableObject(X),N.addSelectableObject(te),N.addSelectableObject(ae);let ne=!0;const re=()=>{ne=!0};try{window.__requestRender=re}catch{}const oe=()=>{var e,t,s,i,a,n;const c=(()=>{try{return sa.getState().renderMode||"continuous"}catch{return"continuous"}})();if(requestAnimationFrame(oe),X.rotation.y+=.005,r.current&&r.current.updateSelectedOutlines(),m.current){const e=m.current,t=b.current;if(t&&t.duration>0&&(t.t<1||e.material.opacity!==t.target)){const s=performance.now(),i=Math.min(1,(s-t.startTime)/t.duration);let a;switch(t.easing){case"linear":a=i;break;case"easeOutCubic":a=1-Math.pow(1-i,3);break;case"easeInCubic":a=Math.pow(i,3);break;default:a=i<.5?2*i*i:(4-2*i)*i-1}const n=t.start+(t.target-t.start)*a;e.material&&(e.material.opacity=Math.max(0,Math.min(1,n))),t.t=i,i>=1&&0===t.target&&e.visible&&(e.visible=!1)}}if((()=>{var e,t;try{return null==(t=null==(e=o.current)?void 0:e.update)?void 0:t.call(e)}catch{return!1}})()&&(ne=!0),"on-demand"===c&&!ne)return;ne=!1,R.clear();const A=r.current?r.current.camera:D;if(E.current&&!!l.current){try{l.current.setCamera(A)}catch{}l.current.render()}else R.render(j,A);try{null==(s=null==(t=null==(e=r.current)?void 0:e.objectSelector)?void 0:t.forceHideGizmoLines)||s.call(t)}catch{}R.clearDepth(),R.render(M,A);try{null==(n=null==(a=null==(i=r.current)?void 0:i.objectSelector)?void 0:a.forceHideGizmoLines)||n.call(a)}catch{}};oe();const le=R.domElement,ce=(e,t=220)=>{var s;const i=m.current;if(!i)return;const a=b.current;a.start=(null==(s=i.material)?void 0:s.opacity)??0;const{dropIndicator:n}=sa.getState();a.target=Math.min(e,(null==n?void 0:n.maxOpacity)??.6),a.t=0,a.duration=t,a.easing=(null==n?void 0:n.easing)??"easeInOutQuad",a.maxOpacity=(null==n?void 0:n.maxOpacity)??.6,a.startTime=performance.now(),e>0&&(i.visible=!0)};le.addEventListener("dragover",e=>{e.preventDefault();try{const t=le.getBoundingClientRect(),s=new f;s.x=(e.clientX-t.left)/t.width*2-1,s.y=-(e.clientY-t.top)/t.height*2+1;const i=new Ge,a=r.current?r.current.camera:D;i.setFromCamera(s,a);const n=[];j.traverse(e=>{e.isMesh&&e.visible&&n.push(e)});const o=i.intersectObjects(n,!0);if(o&&o.length>0){const e=o[0],t=e.point,s=e.face&&e.face.normal?e.face.normal.clone():new v(0,1,0);if(e.object&&e.object.isMesh&&e.object.normalMatrix&&s.applyMatrix3(e.object.normalMatrix).normalize(),m.current){const e=m.current;e.position.copy(t);const i=new v(0,1,0),a=(new ee).setFromUnitVectors(i,s.clone().normalize());e.quaternion.copy(a),e.visible=!0}else{const e=new Mt(.6,.75,48),i=new p({color:43775,transparent:!0,opacity:0,side:F}),a=new G(e,i);a.position.copy(t);const n=new v(0,1,0),r=(new ee).setFromUnitVectors(n,s.clone().normalize());a.quaternion.copy(r),a.userData.isSystemObject=!0,j.add(a),m.current=a}const i=a.position.distanceTo(t),n=Math.max(.5,Math.min(4,.06*i));m.current.scale.setScalar(n);const r=sa.getState().dropIndicator;ce((null==r?void 0:r.maxOpacity)??.6,(null==r?void 0:r.inMs)??200)}else{const e=new Ze(new v(0,1,0),0),t=new v;if(i.ray.intersectPlane(e,t)){if(m.current)m.current.position.copy(t),m.current.rotation.set(-Math.PI/2,0,0),m.current.visible=!0;else{const e=new Mt(.6,.75,48),s=new p({color:43775,transparent:!0,opacity:0,side:F}),i=new G(e,s);i.rotation.x=-Math.PI/2,i.position.copy(t),i.userData.isSystemObject=!0,j.add(i),m.current=i}const e=a.position.distanceTo(t),s=Math.max(.5,Math.min(4,.06*e));m.current.scale.setScalar(s);const i=sa.getState().dropIndicator;ce((null==i?void 0:i.maxOpacity)??.6,(null==i?void 0:i.inMs)??200)}}}catch{}}),le.addEventListener("drop",e=>{if(e.preventDefault(),m.current){const e=sa.getState().dropIndicator;ce(0,(null==e?void 0:e.outMs)??180)}try{const s=e.dataTransfer.getData("text/plain");if(s){const i=JSON.parse(s);if("start_position"===i.type||"directional_light"===i.type||"point_light"===i.type||"spot_light"===i.type||"ambient_light"===i.type||"audio_source"===i.type||"fog"===i.type||"skybox"===i.type||"post_process"===i.type||"camera_helper"===i.type||"grid_helper"===i.type||"axes_helper"===i.type){const t=le.getBoundingClientRect(),s=new f;s.x=(e.clientX-t.left)/t.width*2-1,s.y=-(e.clientY-t.top)/t.height*2+1;const a=new Ge;a.setFromCamera(s,D);const n=new Ze(new v(0,1,0),0),r=new v;let o;switch(a.ray.intersectPlane(n,r),i.type){case"start_position":const e=new Ot(.3,1,8),t=new O({color:65280});o=new G(e,t),o.position.copy(r);break;case"directional_light":const s=new g(16777215,1);s.position.set(r.x+5,r.y+10,r.z+5),s.target.position.copy(r),s.castShadow=!0,s.shadow.mapSize.width=2048,s.shadow.mapSize.height=2048;const i=new kt(s,1);j.add(i),o=s,j.add(s.target);break;case"point_light":const a=new u(16777215,1,10,2);a.position.set(r.x,r.y+3,r.z),a.castShadow=!0;const n=new Rt(a,.5);j.add(n),o=a;break;case"spot_light":const l=new d(16777215,1,10,Math.PI/6,.1,2);l.position.set(r.x,r.y+5,r.z),l.target.position.copy(r),l.castShadow=!0;const c=new Tt(l);j.add(c),o=l,j.add(l.target);break;case"ambient_light":const A=new Qt(4210752,.3),h=new qe(.5,16,16),m=new p({color:4210752,wireframe:!0,transparent:!0,opacity:.5});o=new G(h,m),o.position.copy(r),j.add(A);break;case"audio_source":const b=new qe(.3,16,16),f=new O({color:16750848});o=new G(b,f),o.position.set(r.x,r.y+1,r.z);break;case"grid_helper":o=new Xe(10,10),o.position.copy(r);break;case"axes_helper":o=new Dt(2),o.position.copy(r);break;default:const C=new Ne(.5,.5,.5),v=new O({color:8947848});o=new G(C,v),o.position.copy(r)}if(o){o.isMesh&&(o.castShadow=!0,o.receiveShadow=!0);const e=`${i.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;o.name=e,o.userData={id:e,name:i.name,type:i.type,originalData:i},j.add(o),N.addSelectableObject(o),h.current.set(e,o);(0,sa.getState().addObject)({id:e,name:i.name,type:i.type,position:{x:o.position.x,y:o.position.y,z:o.position.z},rotation:{x:o.rotation.x,y:o.rotation.y,z:o.rotation.z},scale:{x:o.scale.x,y:o.scale.y,z:o.scale.z},visible:!0,userData:o.userData}),I(e)}return}if("custom"===i.type||"library"===i.type){const s=le.getBoundingClientRect(),a=new f;a.x=(e.clientX-s.left)/s.width*2-1,a.y=-(e.clientY-s.top)/s.height*2+1;const n=new Ge;n.setFromCamera(a,D);const r=new Ze(new v(0,1,0),0),o=new v;n.ray.intersectPlane(r,o);const l=Si();let c;if("custom"===i.type)try{const e=jr();c=e.createBlobURL(i.glbData)}catch(t){return}else"library"===i.type&&(c=i.glbUrl);return void l.load(c,e=>{const t=e.scene;t.position.copy(o),t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),j.add(t),N.addSelectableObject(t);const s=`${i.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.name=s,t.userData={id:s,name:i.name,type:i.type,originalData:i},h.current.set(s,t);(0,sa.getState().addObject)({id:s,name:i.name,type:"mesh",position:{x:o.x,y:o.y,z:o.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:t.userData}),I(s),"custom"===i.type&&URL.revokeObjectURL(c)},void 0,e=>{"custom"===i.type&&URL.revokeObjectURL(c)})}const a=le.getBoundingClientRect(),n=new f;n.x=(e.clientX-a.left)/a.width*2-1,n.y=-(e.clientY-a.top)/a.height*2+1;const r=new Ge;r.setFromCamera(n,D);const o=new Ze(new v(0,1,0),0),l=new v;r.ray.intersectPlane(o,l);const c=new O({color:5025616,roughness:.3,metalness:.1});let A,m;switch(i.geometry){case"BoxGeometry":A=new Ne(...i.params);break;case"SphereGeometry":A=new qe(...i.params);break;case"CylinderGeometry":A=new ze(...i.params);break;case"ConeGeometry":A=new Ot(...i.params);break;case"PlaneGeometry":A=new Ve(...i.params);break;case"TorusGeometry":A=new Ke(...i.params);break;case"CustomGeometry":if(i.glbData)try{const e=jr().createBlobURL(i.glbData);return void Si().load(e,t=>{const s=t.scene;s.position.copy(l);const a=`${i.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;s.name=a,s.userData={id:a,name:i.name,type:i.type||"custom",originalName:i.name},s.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),j.add(s),N.addSelectableObject(s),h.current.set(a,s);(0,sa.getState().addObject)({id:a,name:i.name,type:"mesh",position:{x:l.x,y:l.y,z:l.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:s.userData}),I(a),URL.revokeObjectURL(e)},void 0,t=>{URL.revokeObjectURL(e)})}catch(t){return}else A=i.originalObject&&i.originalObject.geometry?i.originalObject.geometry.clone():new Ne(1,1,1);break;case"LibraryMesh":if(i.glbUrl){return void Si().load(i.glbUrl,e=>{const t=e.scene;t.position.copy(l);const s=`${i.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.name=s,t.userData={id:s,name:i.name,type:i.type||"library",originalName:i.name},t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),j.add(t),N.addSelectableObject(t),h.current.set(s,t);(0,sa.getState().addObject)({id:s,name:i.name,type:"mesh",position:{x:l.x,y:l.y,z:l.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:t.userData}),I(s)},void 0,e=>{})}A=new Ne(1,1,1);break;default:A=new Ne(1,1,1)}m=new G(A,c),m.position.copy(l),"PlaneGeometry"===i.geometry&&(m.rotation.x=-Math.PI/2),m.castShadow=!0,m.receiveShadow=!0;const b=`${i.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;m.name=b,m.userData={id:b,name:i.name,type:i.type||"basic",originalName:i.name},j.add(m),N.addSelectableObject(m),h.current.set(b,m);(0,sa.getState().addObject)({id:b,name:i.name,type:"mesh",position:{x:l.x,y:l.y,z:l.z},rotation:{x:m.rotation.x,y:m.rotation.y,z:m.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:m.userData}),I(b)}}catch(t){}}),le.addEventListener("dragleave",()=>{if(m.current){const e=sa.getState().dropIndicator;ce(0,(null==e?void 0:e.outMs)??220)}});const Ae=["mousedown","mouseup","mousemove","wheel","keydown","keyup","resize"],he=()=>{var e;try{"on-demand"===(sa.getState().renderMode||"continuous")&&(null==(e=window.__requestRender)||e.call(window))}catch{}};Ae.forEach(e=>window.addEventListener(e,he,{passive:!0})),le.addEventListener("dragover",he,{passive:!0}),le.addEventListener("drop",he,{passive:!0});const de=()=>{var e;try{const t=sa.getState(),s=(null==(e=t.safeMode)?void 0:e.enabled)?t.safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);R.setPixelRatio(s)}catch{}r.current?r.current.onWindowResize():(D.aspect=window.innerWidth/window.innerHeight,D.updateProjectionMatrix(),R.setPixelRatio(Math.min(2,window.devicePixelRatio||1)),R.setSize(window.innerWidth,window.innerHeight)),l.current&&l.current.handleResize(window.innerWidth,window.innerHeight);try{sa.getState().estimateVRAMUsage()}catch{}};return window.addEventListener("resize",de),()=>{try{Ae.forEach(e=>window.removeEventListener(e,he))}catch{}try{le.removeEventListener("dragover",he),le.removeEventListener("drop",he)}catch{}if(window.removeEventListener("resize",de),R.domElement&&(R.domElement.removeEventListener("contextmenu",P),R.domElement.removeEventListener("webglcontextlost",k),R.domElement.removeEventListener("webglcontextrestored",L)),r.current&&r.current.dispose(),o.current)try{o.current.dispose()}catch{}l.current&&l.current.dispose(),n.current&&R.domElement&&n.current.removeChild(R.domElement),R.dispose()}},[x]),s.useEffect(()=>{var e;if(!c.current||!r.current)return;const t=c.current,s=Si();C.forEach(e=>{if(!h.current.has(e.id))if("glb"===e.type&&(e.file||e.url)){const i=e.file||e.url;s.load(i,s=>{var i,a,n,o,l,c,A,d;const u=s.scene,g=(new ue).setFromObject(u);g.getSize(new v);const p=g.getCenter(new v);u.position.sub(p),u.position.set(e.position.x,e.position.y,e.position.z),u.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),u.scale.set(e.scale.x,e.scale.y,e.scale.z),u.name=e.name,u.userData={id:e.id,type:e.type},u.visible=!1!==e.visible,u.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});try{const e=!!sa.getState().isWireframe;u.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material.forEach(t=>t.wireframe=e):t.material.wireframe=e)})}catch{}t.add(u),r.current.addSelectableObject(u),h.current.set(e.id,u),I(e.id);try{null==(a=(i=r.current).updateWireframe)||a.call(i)}catch{}try{null==(o=(n=r.current).updateGridSnap)||o.call(n)}catch{}try{null==(c=(l=r.current).updateGizmoSpace)||c.call(l)}catch{}try{null==(d=null==(A=r.current.objectSelector)?void 0:A.updateGizmoSize)||d.call(A)}catch{}r.current.selectObject(u)},void 0,s=>{const i=new Ne(1,1,1),a=new Ft({color:16739179,transparent:!0,opacity:.7}),n=new G(i,a);n.position.set(e.position.x,e.position.y,e.position.z),n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),n.scale.set(e.scale.x,e.scale.y,e.scale.z),n.name=`${e.name} (로딩실패)`,n.userData={id:e.id,type:e.type,loadError:!0},n.castShadow=!0,n.receiveShadow=!0,n.visible=!1!==e.visible,t.add(n),r.current.addSelectableObject(n),h.current.set(e.id,n),I(e.id),r.current.selectObject(n)})}else if("glb"===e.type&&e.glbData){let i;if(e.glbData instanceof ArrayBuffer)i=e.glbData;else if(e.glbData instanceof Uint8Array)i=e.glbData.buffer;else if(Array.isArray(e.glbData))i=new Uint8Array(e.glbData).buffer;else{if("object"!=typeof e.glbData||"Buffer"!==e.glbData.type)return;i=new Uint8Array(e.glbData.data||e.glbData).buffer}const a=new Blob([i],{type:"model/gltf-binary"}),n=URL.createObjectURL(a);s.load(n,s=>{const i=s.scene,a=(new ue).setFromObject(i);a.getSize(new v);const o=a.getCenter(new v);i.position.sub(o),i.position.set(e.position.x,e.position.y,e.position.z),i.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),i.scale.set(e.scale.x,e.scale.y,e.scale.z),i.name=e.name,i.userData={id:e.id,type:e.type},i.visible=!1!==e.visible,i.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),t.add(i),r.current.addSelectableObject(i),h.current.set(e.id,i),I(e.id),r.current.selectObject(i),URL.revokeObjectURL(n)},e=>{},e=>{URL.revokeObjectURL(n)})}else if("cube"===e.type){const s=new Ne(e.size.x,e.size.y,e.size.z),i=new Ft({color:e.material.color}),a=new G(s,i);a.position.set(e.position.x,e.position.y,e.position.z),a.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),a.name=e.name,a.userData={id:e.id,type:e.type},a.castShadow=!0,a.receiveShadow=!0,t.add(a),r.current.addSelectableObject(a),h.current.set(e.id,a),I(e.id),r.current.selectObject(a)}else if("basic"===e.type||e.geometry&&e.params){const s=new O({color:5025616,roughness:.3,metalness:.1});let i;switch(e.geometry){case"BoxGeometry":i=new Ne(...e.params);break;case"SphereGeometry":i=new qe(...e.params);break;case"CylinderGeometry":i=new ze(...e.params);break;case"ConeGeometry":i=new Ot(...e.params);break;case"PlaneGeometry":i=new Ve(...e.params);break;case"TorusGeometry":i=new Ke(...e.params);break;default:i=new Ne(1,1,1)}const a=new G(i,s);a.position.set(e.position.x,e.position.y,e.position.z),a.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),a.scale.set(e.scale.x,e.scale.y,e.scale.z),a.name=e.name,a.userData={id:e.id,type:e.type},a.castShadow=!0,a.receiveShadow=!0,a.visible=!1!==e.visible,"PlaneGeometry"===e.geometry&&(a.rotation.x=-Math.PI/2),t.add(a),r.current.addSelectableObject(a),h.current.set(e.id,a),I(e.id),r.current.selectObject(a)}});const i=new Set(C.map(e=>e.id));for(const[a,n]of h.current)if(!i.has(a)){if(null==(e=n.userData)?void 0:e.isSystemObject)continue;t.remove(n),r.current.removeSelectableObject(n),h.current.delete(a)}},[C,I]),s.useEffect(()=>{c.current&&(C.forEach(e=>{const t=h.current.get(e.id);t&&(t.visible=!1!==e.visible)}),y.forEach(e=>{const t=h.current.get(e.id);t&&(t.visible=!1!==e.visible)}))},[C,y]),t.jsx("div",{ref:n,style:{width:"100%",height:"100vh",position:"relative"}})}function Dr(e,t,s=!0){if(!e||!e.isObject3D)return!1;if(t&&!t.isObject3D)return!1;if(e===t)return!1;if(t&&function(e,t){if(!(e&&t&&e.isObject3D&&t.isObject3D))return!1;let s=t.parent;for(;s;){if(s===e)return!0;s=s.parent}return!1}(e,t))return!1;let i=null;if(s&&(e.updateMatrixWorld(!0),i=e.matrixWorld.clone()),e.parent)try{e.parent.remove(e)}catch{}if(t)try{t.add(e)}catch{}if(s&&i){const t=e.parent&&e.parent.matrixWorld?e.parent.matrixWorld:new C,s=(new C).copy(t).invert(),a=(new C).copy(s).multiply(i),n=new v,r=new ee,o=new v;a.decompose(n,r,o),e.position.copy(n),e.quaternion.copy(r),e.scale.copy(o),e.updateMatrix(),e.updateMatrixWorld(!0)}return!0}class Tr{constructor(e){this.editorControls=e,this.selectedObject=null,this.threeObject=null,this.changeCallbacks=[]}onPropertyChange(e){this.changeCallbacks.push(e)}notifyPropertyChange(e,t,s){this.changeCallbacks.forEach(i=>{i({type:e,property:t,value:s,object:this.selectedObject})})}setSelectedObject(e){if(this.selectedObject=e,this.threeObject=null,e)if(e.isObject3D||e.isMesh||e.isLight||e.isCamera)this.threeObject=e;else if(this.editorControls){const t=e.id||e;this.threeObject=this.editorControls.findObjectById(t),!this.threeObject&&this.editorControls.selectedObjects&&this.editorControls.selectedObjects.length>0&&(this.threeObject=this.editorControls.selectedObjects[0])}}getObjectType(){return this.threeObject?this.threeObject.isLight?"light":this.threeObject.isCamera?"camera":this.threeObject.isHelper?"helper":this.threeObject.isMesh?"mesh":this.threeObject.isGroup?"group":"mesh":"unknown"}setTransformProperty(e,t,s){if(!this.threeObject)return!1;const i=parseFloat(s);if(isNaN(i))return!1;switch(e){case"position":this.threeObject.position[t]=i;break;case"rotation":this.threeObject.rotation[t]=i*Math.PI/180;break;case"scale":this.threeObject.scale[t]=i}return this.notifyPropertyChange("transform",e,{[t]:i}),!0}getTransformProperty(e,t){return this.threeObject?"rotation"===e?(180*this.threeObject[e][t]/Math.PI).toFixed(1):this.threeObject[e][t].toFixed(2):0}setLightProperty(e,t){if(!this.threeObject||!this.threeObject.isLight)return!1;switch(e){case"color":this.threeObject.color.setHex(t.replace("#","0x"));break;case"intensity":this.threeObject.intensity=parseFloat(t);break;case"distance":void 0!==this.threeObject.distance&&(this.threeObject.distance=parseFloat(t));break;case"angle":void 0!==this.threeObject.angle&&(this.threeObject.angle=parseFloat(t));break;case"penumbra":void 0!==this.threeObject.penumbra&&(this.threeObject.penumbra=parseFloat(t));break;case"decay":void 0!==this.threeObject.decay&&(this.threeObject.decay=parseFloat(t))}return this.notifyPropertyChange("light",e,t),!0}getLightProperty(e){if(!this.threeObject||!this.threeObject.isLight)return null;switch(e){case"type":return this.threeObject.type;case"color":return"#"+this.threeObject.color.getHexString();case"intensity":return this.threeObject.intensity;case"distance":return this.threeObject.distance||0;case"angle":return this.threeObject.angle||0;case"penumbra":return this.threeObject.penumbra||0;case"decay":return this.threeObject.decay||1;default:return null}}setCameraProperty(e,t){if(!this.threeObject||!this.threeObject.isCamera)return!1;switch(e){case"fov":this.threeObject.isPerspectiveCamera&&(this.threeObject.fov=parseFloat(t),this.threeObject.updateProjectionMatrix());break;case"near":this.threeObject.near=parseFloat(t),this.threeObject.updateProjectionMatrix();break;case"far":this.threeObject.far=parseFloat(t),this.threeObject.updateProjectionMatrix()}return this.notifyPropertyChange("camera",e,t),!0}getCameraProperty(e){if(!this.threeObject||!this.threeObject.isCamera)return null;switch(e){case"type":return this.threeObject.type;case"fov":return this.threeObject.fov||75;case"near":return this.threeObject.near||.1;case"far":return this.threeObject.far||1e3;default:return null}}setMaterialProperty(e,t){if(!this.threeObject||!this.threeObject.isMesh)return!1;const s=this.threeObject.material;if(!s)return!1;switch(e){case"color":s.color&&s.color.setHex(t.replace("#","0x"));break;case"metalness":void 0!==s.metalness&&(s.metalness=parseFloat(t));break;case"roughness":void 0!==s.roughness&&(s.roughness=parseFloat(t));break;case"emissive":s.emissive&&s.emissive.setHex(t.replace("#","0x"));break;case"emissiveIntensity":void 0!==s.emissiveIntensity&&(s.emissiveIntensity=parseFloat(t));break;case"opacity":s.opacity=parseFloat(t),s.transparent=s.opacity<1}return s.needsUpdate=!0,this.notifyPropertyChange("material",e,t),!0}getMaterialProperty(e){if(!this.threeObject||!this.threeObject.isMesh)return null;const t=this.threeObject.material;if(!t)return null;switch(e){case"color":return t.color?"#"+t.color.getHexString():"#ffffff";case"metalness":return t.metalness||0;case"roughness":return t.roughness||.8;case"emissive":return t.emissive?"#"+t.emissive.getHexString():"#000000";case"emissiveIntensity":return t.emissiveIntensity||0;case"opacity":return t.opacity||1;default:return null}}getObjectInfo(){var e;if(!this.threeObject)return null;return{name:this.threeObject.name||"Unnamed Object",type:this.getObjectType(),id:(null==(e=this.threeObject.userData)?void 0:e.id)||this.threeObject.id,position:{x:this.getTransformProperty("position","x"),y:this.getTransformProperty("position","y"),z:this.getTransformProperty("position","z")},rotation:{x:this.getTransformProperty("rotation","x"),y:this.getTransformProperty("rotation","y"),z:this.getTransformProperty("rotation","z")},scale:{x:this.getTransformProperty("scale","x"),y:this.getTransformProperty("scale","y"),z:this.getTransformProperty("scale","z")}}}dispose(){this.selectedObject=null,this.threeObject=null,this.editorControls=null,this.changeCallbacks=[]}}function Rr({objects:e,selectedIds:i=[],dragUseSelectionForDnD:a=!1,onSelect:n,onReparent:r,onReorder:o,onBatchStart:l,onBatchEnd:c,onToggleVisibility:A,onToggleFreeze:h}){const d=s.useRef({draggingId:null}),[u,g]=s.useState(null),[p,m]=s.useState(null),[b,f]=s.useState(()=>new Set),C=s.useMemo(()=>new Map((e||[]).map(e=>[e.id,e])),[e]),v=s.useMemo(()=>{const t=new Map;(e||[]).forEach(e=>{const s=e.parentId??null;t.has(s)||t.set(s,[]),t.get(s).push(e)});for(const e of t.values())e.sort((e,t)=>(e.order??0)-(t.order??0));return t},[e]),y=v.get(null)||[],x=s.useCallback((e,t)=>{if(null==e||null==t)return!1;let s=C.get(t);const i=new Set;for(;s&&!i.has(s.id);){if(i.add(s.id),s.id===e)return!0;const t=s.parentId??null;s=null!=t?C.get(t):null}return!1},[C]),I=(e,t)=>{d.current.draggingId=t;const s=new Set(Array.isArray(i)?i:[]);let n=(a||s.has(t))&&s.size>0?Array.from(s):[t];const r=new Set(n);n=n.filter(e=>!(e=>{let t=C.get(e);const s=new Set;for(;t&&!s.has(t.id);){s.add(t.id);const e=t.parentId??null;if(null==e)return!1;if(r.has(e))return!0;t=C.get(e)}return!1})(e));try{const t=JSON.stringify({ids:n});e.dataTransfer.setData("application/json",t),e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move"}catch{}},E=(t,s)=>{t.preventDefault();let i=null;try{const e=t.dataTransfer.getData("application/json")||t.dataTransfer.getData("text/plain")||"";e&&(i=JSON.parse(e))}catch{}const a=Array.isArray(null==i?void 0:i.ids)&&i.ids.length?i.ids:d.current.draggingId?[d.current.draggingId]:[];if(g(null),m(null),!a.length)return;const A=C.get(s);if(!A)return;const h=p||"inside";if("inside"===h)a.length>1&&(null==l||l()),a.forEach(e=>{e!==s&&(x(e,s)||null==r||r(e,s))}),a.length>1&&(null==c||c());else{const t=A.parentId??null;a.length>1&&(null==l||l());const i=a.filter(e=>{if(e===s)return!1;return null==t||!x(e,t)});i.forEach(e=>null==r?void 0:r(e,t)),i.length&&((t,s,i,a)=>{const n=(e||[]).filter(e=>(e.parentId??null)===(t??null)),r=new Set(s),l=n.map(e=>e.id).filter(e=>!r.has(e)),c=l.indexOf(i),A="above"===a?Math.max(0,c):Math.min(l.length,c+1),h=[...l.slice(0,A),...s,...l.slice(A)];null==o||o(t??null,h)})(t,i,s,h),a.length>1&&(null==c||c())}const u=a[0];null!=u&&(null==n||n(u))},B=(e,s=0)=>{const a=i.includes(e.id),o=v.get(e.id)||[],l=b.has(e.id),c=u===e.id,d=c?p||"inside":null,C=12*Math.max(0,s),y=!1!==e.visible,x=!0===e.frozen,w="camera"===e.type?"📷":"light"===e.type?"💡":"🔶";return t.jsxs("div",{className:"tree-node "+(a?"selected":""),draggable:!0,onDragStart:t=>I(t,e.id),onDragOver:t=>((e,t)=>{e.preventDefault(),g(t??null);try{const t=e.currentTarget.getBoundingClientRect(),s=e.clientY-t.top,i=t.height||1;m(s<.25*i?"above":s>.75*i?"below":"inside")}catch{m("inside")}e.dataTransfer.dropEffect="move"})(t,e.id),onDragLeave:t=>{return s=e.id,g(e=>e===s?null:e),void m(e=>u===s?null:e);var s},onDrop:t=>E(t,e.id),onClick:()=>null==n?void 0:n(e.id),style:{margin:"2px 0",borderRadius:3,background:a?"#ff8c00":c&&"inside"===d?"#2d2d2d":"transparent",outline:a?"2px solid #ff6600":"none",borderLeft:a?"3px solid #ff6600":"3px solid transparent",borderTop:c&&"above"===d?"2px solid #00b894":void 0,borderBottom:c&&"below"===d?"2px solid #00b894":void 0,boxShadow:a?"0 0 8px rgba(255,140,0,0.6)":"none",paddingLeft:8+C,transition:"all .15s ease"},children:[t.jsxs("div",{className:"tree-row",style:{display:"flex",alignItems:"center",gap:6,padding:"4px 6px"},children:[t.jsx("button",{title:l?"펼치기":"접기",onClick:t=>{var s;t.stopPropagation(),s=e.id,f(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},style:{width:16,height:20,background:"none",border:"none",color:"#aaa",cursor:"pointer"},children:o.length>0?l?"▸":"▾":"·"}),t.jsx("span",{className:"tree-type",style:{opacity:.8},children:w}),t.jsx("span",{className:"tree-name",style:{color:a?"#fff":"#ccc",fontWeight:a?"bold":"normal",userSelect:"none",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),t.jsxs("div",{className:"tree-actions",style:{display:"flex",alignItems:"center",gap:4},children:[null!=e.parentId&&t.jsx("button",{className:"icon-btn unparent",title:"부모 해제 (루트로 이동)",onClick:t=>{t.stopPropagation(),null==r||r(e.id,null)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:"#ddd"},children:"⏏"}),t.jsx("button",{className:"icon-btn eye "+(y?"on":"off"),title:y?"숨기기":"보이기",onClick:t=>{t.stopPropagation(),null==A||A(e)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:y?"#ddd":"#666"},children:y?"👁":"🙈"}),t.jsx("button",{className:"icon-btn lock "+(x?"on":"off"),title:x?"잠금 해제":"잠금",onClick:t=>{t.stopPropagation(),null==h||h(e)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:x?"#ddd":"#666"},children:x?"🔒":"🔓"})]})]}),o.length>0&&!l&&t.jsx("div",{className:"tree-children",children:o.map(e=>B(e,s+1))})]},e.id)};return t.jsxs("div",{className:"scene-hierarchy-panel",children:[t.jsx("div",{className:"panel-header",children:t.jsx("h3",{children:"계층"})}),t.jsx("div",{className:"panel-content",children:(y||[]).map(e=>B(e,0))})]})}const kr=s.memo(function({objects:e,walls:i,selectedIds:a,setSelectedIds:n,setParent:r,reorderSiblings:o,selectedObject:l,onObjectVisibilityToggle:c,onObjectFreezeToggle:A,onObjectSelect:h,onObjectRemove:d,onObjectFocus:u,onObjectRename:g,onContextMenu:p,editorControls:m,postProcessingManager:b,onObjectUpdate:f,onClose:C}){var v;const[y,x]=s.useState("transform"),[I,E]=s.useState(null),[B,w]=s.useState(0),S=s.useRef(null),Q=s.useRef(0),j=s.useRef(0),M=s.useRef(!1);s.useEffect(()=>{const e=new Tr(m);return e.onPropertyChange(e=>{try{f&&f(e)}catch{}const t=Date.now();t-(Q.current||0)>=50&&(Q.current=t,w(e=>e+1))}),E(e),()=>{e.dispose()}},[m,f]),s.useEffect(()=>{I&&l&&(I.setSelectedObject(l),w(e=>e+1))},[I,l]),s.useEffect(()=>{var e,t,s,i,a;if(!l||!I||!m)return;const n=1e-4,r=()=>{const e=I.threeObject;return e?{p:[e.position.x,e.position.y,e.position.z],r:[e.rotation.x,e.rotation.y,e.rotation.z],s:[e.scale.x,e.scale.y,e.scale.z]}:null},o=()=>{try{j.current&&cancelAnimationFrame(j.current)}catch{}S.current=r(),w(e=>e+1);const e=()=>{if(!M.current)return void(j.current=0);const t=r(),s=Date.now();t&&((e,t)=>{if(!e||!t)return!0;for(let s=0;s<3;s++){if(Math.abs(e.p[s]-t.p[s])>n)return!0;if(Math.abs(e.r[s]-t.r[s])>n)return!0;if(Math.abs(e.s[s]-t.s[s])>n)return!0}return!1})(t,S.current)&&s-(Q.current||0)>=80&&(S.current=t,Q.current=s,w(e=>e+1)),j.current=requestAnimationFrame(e)};j.current=requestAnimationFrame(e)},c=null==(e=null==m?void 0:m.objectSelector)?void 0:e.transformControls,A=null==m?void 0:m._partTransformControls,h=e=>{M.current=!!(null==e?void 0:e.value),M.current?o():(j.current&&cancelAnimationFrame(j.current),j.current=0,w(e=>e+1))},d=()=>{M.current||(()=>{const e=Date.now();e-(Q.current||0)>=100&&(Q.current=e,w(e=>e+1))})()};return null==(t=null==c?void 0:c.addEventListener)||t.call(c,"dragging-changed",h),null==(s=null==c?void 0:c.addEventListener)||s.call(c,"objectChange",d),null==(i=null==A?void 0:A.addEventListener)||i.call(A,"dragging-changed",h),null==(a=null==A?void 0:A.addEventListener)||a.call(A,"objectChange",d),()=>{var e,t,s,i;try{null==(e=null==c?void 0:c.removeEventListener)||e.call(c,"dragging-changed",h)}catch{}try{null==(t=null==c?void 0:c.removeEventListener)||t.call(c,"objectChange",d)}catch{}try{null==(s=null==A?void 0:A.removeEventListener)||s.call(A,"dragging-changed",h)}catch{}try{null==(i=null==A?void 0:A.removeEventListener)||i.call(A,"objectChange",d)}catch{}j.current&&cancelAnimationFrame(j.current),j.current=0,M.current=!1}},[l,I,m]);const D=(null==I?void 0:I.getObjectType())||"unknown",T=null==I?void 0:I.getObjectInfo(),R=(null==(v=null==m?void 0:m.getSelectedPartInfo)?void 0:v.call(m))||null,k=(()=>{if(!l)return[];const e=[{id:"transform",label:"트랜스폼",icon:"🔄"}];return e.push({id:"object",label:"오브젝트",icon:"📦"}),"mesh"===D&&e.push({id:"material",label:"머티리얼",icon:"🎨"}),"light"===D&&e.push({id:"light",label:"라이트",icon:"💡"}),"camera"===D&&e.push({id:"camera",label:"카메라",icon:"📷"}),"mesh"===D&&e.push({id:"part",label:"파트",icon:"🧩"}),e})();s.useEffect(()=>{k.length>0&&!k.some(e=>e.id===y)&&x(k[0].id)},[k,y]);const O=()=>T?t.jsxs("div",{className:"transform-properties",children:[t.jsxs("div",{className:"transform-row",children:[t.jsx("div",{className:"transform-label",children:"Position"}),t.jsxs("div",{className:"transform-inputs",children:[t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"X"}),t.jsx("input",{type:"number",step:"0.1",value:T.position.x,onChange:e=>null==I?void 0:I.setTransformProperty("position","x",e.target.value)})]}),t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"Y"}),t.jsx("input",{type:"number",step:"0.1",value:T.position.y,onChange:e=>null==I?void 0:I.setTransformProperty("position","y",e.target.value)})]}),t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"Z"}),t.jsx("input",{type:"number",step:"0.1",value:T.position.z,onChange:e=>null==I?void 0:I.setTransformProperty("position","z",e.target.value)})]})]})]}),t.jsxs("div",{className:"transform-row",children:[t.jsx("div",{className:"transform-label",children:"Rotation"}),t.jsxs("div",{className:"transform-inputs",children:[t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"X"}),t.jsx("input",{type:"number",step:"1",value:T.rotation.x,onChange:e=>null==I?void 0:I.setTransformProperty("rotation","x",e.target.value)})]}),t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"Y"}),t.jsx("input",{type:"number",step:"1",value:T.rotation.y,onChange:e=>null==I?void 0:I.setTransformProperty("rotation","y",e.target.value)})]}),t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"Z"}),t.jsx("input",{type:"number",step:"1",value:T.rotation.z,onChange:e=>null==I?void 0:I.setTransformProperty("rotation","z",e.target.value)})]})]})]}),t.jsxs("div",{className:"transform-row",children:[t.jsx("div",{className:"transform-label",children:"Scale"}),t.jsxs("div",{className:"transform-inputs",children:[t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"X"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",value:T.scale.x,onChange:e=>null==I?void 0:I.setTransformProperty("scale","x",e.target.value)})]}),t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"Y"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",value:T.scale.y,onChange:e=>null==I?void 0:I.setTransformProperty("scale","y",e.target.value)})]}),t.jsxs("div",{className:"transform-input-group",children:[t.jsx("span",{className:"input-label",children:"Z"}),t.jsx("input",{type:"number",step:"0.1",min:"0.1",value:T.scale.z,onChange:e=>null==I?void 0:I.setTransformProperty("scale","z",e.target.value)})]})]})]})]}):t.jsx("div",{style:{color:"red",padding:"20px"},children:"objectInfo가 없습니다"});return t.jsxs("div",{className:"inspector-panel",children:[t.jsxs("div",{className:"inspector-header",children:[t.jsx("h3",{children:"인스펙터"}),t.jsx("button",{className:"close-btn",onClick:C,children:"×"})]}),t.jsxs("div",{className:"inspector-content",children:[t.jsxs("div",{className:"hierarchy-section",children:[t.jsx("div",{className:"section-header",children:t.jsx("h4",{children:"씬 계층구조"})}),t.jsx("div",{className:"hierarchy-container",children:t.jsx(Rr,{objects:e,selectedIds:a||[],dragUseSelectionForDnD:(()=>{try{return sa.getState().dragUseSelectionForDnD}catch{return!1}})(),onBatchStart:()=>{var e,t;try{null==(t=(e=sa.getState()).beginBatch)||t.call(e)}catch{}},onBatchEnd:()=>{var e,t;try{null==(t=(e=sa.getState()).endBatch)||t.call(e)}catch{}},onSelect:e=>{var t,s;null==n||n([e]);const i=null==(t=null==m?void 0:m.findObjectById)?void 0:t.call(m,e);i&&(null==(s=null==m?void 0:m.selectObject)||s.call(m,i))},onReparent:(e,t)=>{var s,i;null==r||r(e,t);try{const a=null==(s=null==m?void 0:m.findObjectById)?void 0:s.call(m,e);if(a)if(null==t)!function(e,t,s=!0){!(!e||!e.isObject3D)&&Dr(e,t&&t.isScene?t:null,s)}(a,null==m?void 0:m.scene,!0);else{const e=null==(i=null==m?void 0:m.findObjectById)?void 0:i.call(m,t);e&&a!==e&&Dr(a,e,!0)}}catch{}try{clearTimeout(window.__reparentOutlineT)}catch{}try{window.__reparentOutlineT=setTimeout(()=>{var e,t;null==(t=null==(e=null==m?void 0:m.objectSelector)?void 0:e.updateAllSelectionOutlines)||t.call(e),window.__reparentOutlineT=null},0)}catch{}},onReorder:(e,t)=>{null==o||o(e,t)},onToggleVisibility:e=>null==c?void 0:c(e),onToggleFreeze:e=>null==A?void 0:A(e)})})]}),t.jsxs("div",{className:"properties-section-wrapper",children:[t.jsxs("div",{className:"section-header",children:[t.jsx("h4",{children:"속성"}),l&&T&&t.jsxs("div",{className:"object-info",children:[t.jsx("span",{className:"object-name",children:T.name}),t.jsxs("span",{className:"object-type",children:["(",D,")"]})]})]}),l&&k.length>0&&t.jsx("div",{className:"properties-tabs",children:k.map(e=>t.jsxs("button",{className:"tab-button "+(y===e.id?"active":""),onClick:()=>x(e.id),children:[t.jsx("span",{className:"tab-icon",children:e.icon}),t.jsx("span",{className:"tab-label",children:e.label})]},e.id))}),t.jsx("div",{className:"properties-container",children:(()=>{if(!l)return t.jsxs("div",{className:"no-selection",children:[t.jsx("div",{className:"no-selection-icon",children:"📦"}),t.jsx("div",{className:"no-selection-text",children:"오브젝트를 선택하세요"}),t.jsxs("div",{className:"no-selection-hint",children:["씬 계층구조에서 오브젝트를 클릭하거나",t.jsx("br",{}),"3D 뷰에서 직접 선택할 수 있습니다"]})]});switch(y){case"transform":default:return O();case"object":return T?t.jsxs("div",{className:"object-properties",children:[t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Name"}),t.jsx("input",{type:"text",value:T.name,onChange:e=>{(null==I?void 0:I.threeObject)&&(I.threeObject.name=e.target.value,I.notifyPropertyChange("object","name",e.target.value))}})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Type"}),t.jsx("span",{className:"readonly-value",children:T.type})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"ID"}),t.jsx("span",{className:"readonly-value",children:T.id})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Visible"}),t.jsx("input",{type:"checkbox",checked:!1!==(null==(e=null==I?void 0:I.threeObject)?void 0:e.visible),onChange:e=>{(null==I?void 0:I.threeObject)&&(I.threeObject.visible=e.target.checked,I.notifyPropertyChange("object","visible",e.target.checked))}})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Cast Shadow"}),t.jsx("input",{type:"checkbox",checked:(null==(s=null==I?void 0:I.threeObject)?void 0:s.castShadow)||!1,onChange:e=>{(null==I?void 0:I.threeObject)&&(I.threeObject.castShadow=e.target.checked,I.notifyPropertyChange("object","castShadow",e.target.checked))}})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Receive Shadow"}),t.jsx("input",{type:"checkbox",checked:(null==(i=null==I?void 0:I.threeObject)?void 0:i.receiveShadow)||!1,onChange:e=>{(null==I?void 0:I.threeObject)&&(I.threeObject.receiveShadow=e.target.checked,I.notifyPropertyChange("object","receiveShadow",e.target.checked))}})]})]}):t.jsx("div",{style:{color:"red",padding:"20px"},children:"objectInfo가 없습니다"});case"material":return"mesh"!==D?t.jsx("div",{className:"not-available",children:"메시 객체가 아닙니다"}):t.jsxs("div",{className:"material-properties",children:[t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Color"}),t.jsx("input",{type:"color",value:(null==I?void 0:I.getMaterialProperty("color"))||"#ffffff",onChange:e=>null==I?void 0:I.setMaterialProperty("color",e.target.value)})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Metalness"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==I?void 0:I.getMaterialProperty("metalness"))||0,onChange:e=>null==I?void 0:I.setMaterialProperty("metalness",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getMaterialProperty("metalness"))||0).toFixed(2)})]})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Roughness"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==I?void 0:I.getMaterialProperty("roughness"))||.8,onChange:e=>null==I?void 0:I.setMaterialProperty("roughness",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getMaterialProperty("roughness"))||.8).toFixed(2)})]})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Emissive"}),t.jsx("input",{type:"color",value:(null==I?void 0:I.getMaterialProperty("emissive"))||"#000000",onChange:e=>null==I?void 0:I.setMaterialProperty("emissive",e.target.value)})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Emissive Intensity"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==I?void 0:I.getMaterialProperty("emissiveIntensity"))||0,onChange:e=>null==I?void 0:I.setMaterialProperty("emissiveIntensity",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getMaterialProperty("emissiveIntensity"))||0).toFixed(2)})]})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Opacity"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==I?void 0:I.getMaterialProperty("opacity"))||1,onChange:e=>null==I?void 0:I.setMaterialProperty("opacity",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getMaterialProperty("opacity"))||1).toFixed(2)})]})]})]});case"part":return(()=>{var e,s,i,a,n,r,o,l,c,A,h,d,u,g,p,f,C,v,y,x,I;if("mesh"!==D)return t.jsx("div",{className:"not-available",children:"메시 객체가 아닙니다"});const E=!!(null==(e=null==m?void 0:m.partInspector)?void 0:e.enabled),B=!!(null==(s=null==m?void 0:m.partInspector)?void 0:s.solo),w=!!(null==(i=null==m?void 0:m.partInspector)?void 0:i.clipping),S=!!(null==(a=null==m?void 0:m.partInspector)?void 0:a.gizmo),Q=R;return t.jsxs("div",{className:"part-properties",children:[t.jsxs("div",{className:"property-group",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("label",{children:"파트 인스펙션"}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:E,onChange:e=>{var t;return null==(t=null==m?void 0:m.enablePartInspect)?void 0:t.call(m,e.target.checked)}})," 사용"]}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:B,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartSolo)?void 0:t.call(m,e.target.checked)},disabled:!E})," 솔로 뷰"]}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:w,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartClipping)?void 0:t.call(m,e.target.checked)},disabled:!E})," 클리핑"]}),t.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.clearPartSelection)?void 0:e.call(m)},disabled:!E,children:"파트 선택 해제"})]}),E&&t.jsxs("div",{className:"property-group",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("label",{children:"파트 기즈모"}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:S,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGizmoEnabled)?void 0:t.call(m,e.target.checked)},disabled:!(null==(n=null==m?void 0:m.getSelectedPart)?void 0:n.call(m))})," 활성화"]}),t.jsxs("div",{style:{display:"inline-flex",gap:6},children:[t.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"translate")},disabled:!S,children:"이동"}),t.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"rotate")},disabled:!S,children:"회전"}),t.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"scale")},disabled:!S,children:"스케일"})]})]}),t.jsxs("div",{className:"property-group",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"8px 12px"},children:[t.jsx("div",{style:{gridColumn:"1 / span 2",fontWeight:600},children:"포스트프로세싱"}),t.jsx("label",{children:"Bloom"}),t.jsx("input",{type:"checkbox",checked:!!(null==(o=null==(r=null==b?void 0:b.effectSettings)?void 0:r.bloom)?void 0:o.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"bloom",e.target.checked)}catch{}}}),t.jsx("label",{children:"AA (SMAA)"}),t.jsx("input",{type:"checkbox",checked:!!(null==(c=null==(l=null==b?void 0:b.effectSettings)?void 0:l.fxaa)?void 0:c.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"fxaa",e.target.checked)}catch{}}}),t.jsx("label",{children:"SSAO"}),t.jsx("input",{type:"checkbox",checked:!!(null==(h=null==(A=null==b?void 0:b.effectSettings)?void 0:A.ssao)?void 0:h.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"ssao",e.target.checked)}catch{}}}),t.jsx("label",{children:"Tone Mapping"}),t.jsx("input",{type:"checkbox",checked:!1!==(null==(u=null==(d=null==b?void 0:b.effectSettings)?void 0:d.toneMapping)?void 0:u.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"toneMapping",e.target.checked)}catch{}}})]}),t.jsxs("div",{className:"property-group",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"8px 12px"},children:[t.jsx("div",{style:{gridColumn:"1 / span 2",fontWeight:600},children:"톤 매핑"}),t.jsx("label",{children:"모드"}),t.jsxs("select",{value:(null==(p=null==(g=null==b?void 0:b.effectSettings)?void 0:g.toneMapping)?void 0:p.mapping)||"ACESFilmic",onChange:e=>{var t;try{null==(t=null==b?void 0:b.updateEffectSettings)||t.call(b,"toneMapping",{mapping:e.target.value})}catch{}},children:[t.jsx("option",{value:"None",children:"None"}),t.jsx("option",{value:"Linear",children:"Linear"}),t.jsx("option",{value:"Reinhard",children:"Reinhard"}),t.jsx("option",{value:"Cineon",children:"Cineon"}),t.jsx("option",{value:"ACESFilmic",children:"ACESFilmic"})]}),t.jsx("label",{children:"노출"}),t.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.05",value:(null==(C=null==(f=null==b?void 0:b.effectSettings)?void 0:f.toneMapping)?void 0:C.exposure)??1,onChange:e=>{var t;const s=parseFloat(e.target.value);try{null==(t=null==b?void 0:b.updateEffectSettings)||t.call(b,"toneMapping",{exposure:s})}catch{}}})]}),E&&t.jsxs("div",{className:"property-group",children:[t.jsx("div",{style:{fontSize:12,color:"#aaa",marginBottom:6},children:"서브메시를 클릭해 선택하세요."}),Q?t.jsxs("div",{className:"mesh-info",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"6px 12px"},children:[t.jsx("div",{children:"이름"}),t.jsx("div",{children:Q.name}),t.jsx("div",{children:"UUID"}),t.jsx("div",{style:{wordBreak:"break-all"},children:Q.uuid}),t.jsx("div",{children:"지오메트리"}),t.jsxs("div",{children:[Q.geometry.type," ",Q.geometry.hasIndex?"(Indexed)":""]}),t.jsx("div",{children:"버텍스/트라이"}),t.jsxs("div",{children:[Q.geometry.vertices," / ",Q.geometry.triangles]}),t.jsx("div",{children:"속성"}),t.jsx("div",{children:Q.geometry.attributes.join(", ")}),t.jsx("div",{children:"월드 크기"}),t.jsx("div",{children:Q.geometry.world.size.map(e=>e.toFixed(3)).join(", ")}),t.jsx("div",{children:"월드 중심"}),t.jsx("div",{children:Q.geometry.world.center.map(e=>e.toFixed(3)).join(", ")}),t.jsx("div",{children:"UV"}),t.jsx("div",{children:Q.geometry.uv?`${Q.geometry.uv.count}x${Q.geometry.uv.itemSize}`:"없음"}),t.jsx("div",{children:"UV2"}),t.jsx("div",{children:Q.geometry.uv2?`${Q.geometry.uv2.count}x${Q.geometry.uv2.itemSize}`:"없음"}),Q.material&&t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"머티리얼"}),t.jsxs("div",{children:[Q.material.type," ",Q.material.name?`(${Q.material.name})`:""]}),t.jsx("div",{children:"색상/불투명"}),t.jsxs("div",{children:[Q.material.color||"-"," / ",Q.material.opacity]}),t.jsx("div",{children:"Metal/Rough"}),t.jsxs("div",{children:[Q.material.metalness??"-"," / ",Q.material.roughness??"-"]}),t.jsx("div",{children:"맵들"}),t.jsx("div",{children:Object.entries(Q.material.maps).filter(([,e])=>e).map(([e])=>e).join(", ")||"없음"})]})]}):t.jsx("div",{style:{color:"#aaa"},children:"선택된 파트가 없습니다."}),t.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.selectAllChildParts)?void 0:e.call(m)},disabled:!(null==(v=null==m?void 0:m.getSelectedPart)?void 0:v.call(m)),children:"자식 파트 전체 선택"}),t.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.clearAllPartSelections)?void 0:e.call(m)},disabled:!(null==(y=null==m?void 0:m.getSelectedPart)?void 0:y.call(m)),children:"모든 파트 선택 해제"}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("input",{type:"checkbox",checked:!!(null==(x=null==m?void 0:m.isPartGroupGizmoEnabled)?void 0:x.call(m)),onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGroupGizmoEnabled)?void 0:t.call(m,e.target.checked)}})," 그룹 기즈모(일괄 변형)"]}),t.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:["피벗",t.jsxs("select",{value:(null==(I=null==m?void 0:m.getPartGroupPivot)?void 0:I.call(m))||"center",onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGroupPivot)?void 0:t.call(m,e.target.value)},children:[t.jsx("option",{value:"center",children:"선택 중심"}),t.jsx("option",{value:"first",children:"첫 파트"}),t.jsx("option",{value:"last",children:"마지막 파트"})]})]})]})]})]})})();case"light":return(()=>{if("light"!==D)return t.jsx("div",{className:"not-available",children:"라이트 객체가 아닙니다"});const e=null==I?void 0:I.getLightProperty("type");return t.jsxs("div",{className:"light-properties",children:[t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Type"}),t.jsx("span",{className:"readonly-value",children:e})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Color"}),t.jsx("input",{type:"color",value:(null==I?void 0:I.getLightProperty("color"))||"#ffffff",onChange:e=>null==I?void 0:I.setLightProperty("color",e.target.value)})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Intensity"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:(null==I?void 0:I.getLightProperty("intensity"))||1,onChange:e=>null==I?void 0:I.setLightProperty("intensity",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getLightProperty("intensity"))||1).toFixed(1)})]})]}),"SpotLight"===e&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Distance"}),t.jsx("input",{type:"number",min:"0",step:"1",value:(null==I?void 0:I.getLightProperty("distance"))||0,onChange:e=>null==I?void 0:I.setLightProperty("distance",e.target.value)})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Angle"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"1.57",step:"0.01",value:(null==I?void 0:I.getLightProperty("angle"))||0,onChange:e=>null==I?void 0:I.setLightProperty("angle",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getLightProperty("angle"))||0).toFixed(2)})]})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Penumbra"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==I?void 0:I.getLightProperty("penumbra"))||0,onChange:e=>null==I?void 0:I.setLightProperty("penumbra",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getLightProperty("penumbra"))||0).toFixed(2)})]})]})]}),("PointLight"===e||"SpotLight"===e)&&t.jsxs(t.Fragment,{children:["PointLight"===e&&t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Distance"}),t.jsx("input",{type:"number",min:"0",step:"1",value:(null==I?void 0:I.getLightProperty("distance"))||0,onChange:e=>null==I?void 0:I.setLightProperty("distance",e.target.value)})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Decay"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:(null==I?void 0:I.getLightProperty("decay"))||1,onChange:e=>null==I?void 0:I.setLightProperty("decay",e.target.value)}),t.jsx("span",{children:((null==I?void 0:I.getLightProperty("decay"))||1).toFixed(1)})]})]})]})]})})();case"camera":return"camera"!==D?t.jsx("div",{className:"not-available",children:"카메라 객체가 아닙니다"}):t.jsxs("div",{className:"camera-properties",children:[t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Type"}),t.jsx("span",{className:"readonly-value",children:null==I?void 0:I.getCameraProperty("type")})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"FOV"}),t.jsxs("div",{className:"range-input",children:[t.jsx("input",{type:"range",min:"10",max:"120",step:"1",value:(null==I?void 0:I.getCameraProperty("fov"))||75,onChange:e=>null==I?void 0:I.setCameraProperty("fov",e.target.value)}),t.jsxs("span",{children:[(null==I?void 0:I.getCameraProperty("fov"))||75,"°"]})]})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Near"}),t.jsx("input",{type:"number",min:"0.01",step:"0.01",value:(null==I?void 0:I.getCameraProperty("near"))||.1,onChange:e=>null==I?void 0:I.setCameraProperty("near",e.target.value)})]}),t.jsxs("div",{className:"property-group",children:[t.jsx("label",{children:"Far"}),t.jsx("input",{type:"number",min:"1",step:"1",value:(null==I?void 0:I.getCameraProperty("far"))||1e3,onChange:e=>null==I?void 0:I.setCameraProperty("far",e.target.value)})]})]})}var e,s,i})()})]})]})]})}),Or=({onObjectDrop:e,onClose:i,forceRefresh:a=0})=>{const[n,r]=s.useState(!1),[o,l]=s.useState([]),[c,A]=s.useState([]),h=s.useRef(null),{customMeshes:d,loadCustomMeshes:u}=sa(),g=s.useRef(jr()),p=s.useRef(new Set);s.useEffect(()=>((async()=>{const e=await g.current.getCustomMeshes();u(e)})(),()=>{const e=p.current;for(const t of e)try{URL.revokeObjectURL(t)}catch{}e.clear()}),[u]),s.useEffect(()=>{const e=async()=>{const e=await g.current.getCustomMeshes();u(e)};return window.addEventListener("customMeshAdded",e),()=>{window.removeEventListener("customMeshAdded",e)}},[u]),s.useEffect(()=>{const e=p.current,t=new Set((d||[]).map(e=>"string"==typeof e.thumbnail&&e.thumbnail.startsWith("blob:")?e.thumbnail:null).filter(Boolean));for(const s of e)if(!t.has(s))try{URL.revokeObjectURL(s)}catch{}p.current=t},[d]),s.useEffect(()=>{(()=>{const e=JSON.parse(localStorage.getItem("customObjects")||"[]");l(e)})()},[a]),s.useEffect(()=>{(async()=>{try{const t=await g.current.loadLibraryMeshes();A(t);for(let s=0;s<t.length;s++){const i=t[s];try{const e=await g.current.generateThumbnailFromURL(i.glbUrl);A(t=>t.map(t=>t.id===i.id?{...t,thumbnail:e,isLoadingThumbnail:!1}:t))}catch(e){A(e=>e.map(e=>e.id===i.id?{...e,isLoadingThumbnail:!1}:e))}}}catch(e){}})()},[]);const m=(e,t)=>{r(!0),h.current=t;let s=t;"custom"===t.type&&(s={...t,type:"custom"});const i=document.createElement("canvas");i.width=50,i.height=50;const a=i.getContext("2d");a.fillStyle="rgba(100, 150, 255, 0.8)",a.fillRect(0,0,50,50),a.fillStyle="white",a.font="12px Arial",a.textAlign="center",a.fillText(t.name,25,30),e.dataTransfer.setDragImage(i,25,25),e.dataTransfer.setData("text/plain",JSON.stringify(s))},b=()=>{r(!1),h.current=null},f=t=>{if(e)if("custom"===t.type)try{const s={...t,type:"custom"};e(s,{x:0,y:0,z:0})}catch(s){alert("커스텀 메쉬를 로드할 수 없습니다. 데이터가 손상되었을 수 있습니다.")}else t.type,e(t,{x:0,y:0,z:0})};return t.jsxs("div",{className:"library-panel",children:[t.jsxs("div",{className:"library-header",children:[t.jsx("h3",{children:"라이브러리"}),t.jsx("button",{className:"close-btn",onClick:i,children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]}),t.jsxs("div",{className:"library-content",children:[t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"기본 도형"}),t.jsx("div",{className:"object-grid",children:[{id:"cube",name:"정육면체",type:"basic",geometry:"BoxGeometry",params:[1,1,1]},{id:"sphere",name:"구체",type:"basic",geometry:"SphereGeometry",params:[.5,32,16]},{id:"cylinder",name:"원기둥",type:"basic",geometry:"CylinderGeometry",params:[.5,.5,1,32]},{id:"cone",name:"원뿔",type:"basic",geometry:"ConeGeometry",params:[.5,1,32]},{id:"plane",name:"평면",type:"basic",geometry:"PlaneGeometry",params:[1,1]},{id:"torus",name:"도넛",type:"basic",geometry:"TorusGeometry",params:[.5,.2,16,100]}].map(e=>t.jsx("div",{className:"library-item",draggable:!0,onDragStart:t=>m(t,e),onDragEnd:b,onClick:()=>f(e),title:e.name,children:t.jsx("div",{className:"library-thumbnail",children:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:["cube"===e.id&&t.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"}),"sphere"===e.id&&t.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}),"cylinder"===e.id&&t.jsx("path",{d:"M12,2C8.14,2 5,3.79 5,6V18C5,20.21 8.14,22 12,22C15.86,22 19,20.21 19,18V6C19,3.79 15.86,2 12,2M12,4C14.67,4 17,4.9 17,6C17,7.1 14.67,8 12,8C9.33,8 7,7.1 7,6C7,4.9 9.33,4 12,4M7,9.5C8.21,10.72 9.86,11.26 12,11.26C14.14,11.26 15.79,10.72 17,9.5V18C17,19.1 14.67,20 12,20C9.33,20 7,19.1 7,18V9.5Z"}),"cone"===e.id&&t.jsx("path",{d:"M12,2L1,21H23L12,2M12,6L19.53,19H4.47L12,6Z"}),"plane"===e.id&&t.jsx("path",{d:"M3,3V21H21V3H3M19,19H5V5H19V19Z"}),"torus"===e.id&&t.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"})]})})},e.id))})]}),c.length>0&&t.jsx("div",{className:"section-divider"}),c.length>0&&t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"라이브러리 메쉬"}),t.jsx("div",{className:"object-grid",children:c.map(e=>t.jsx("div",{className:"library-item library-mesh",draggable:!0,onDragStart:t=>m(t,e),onDragEnd:b,onClick:()=>f(e),title:`${e.name} (라이브러리)`,children:t.jsx("div",{className:"library-thumbnail",children:e.isLoadingThumbnail?t.jsx("div",{className:"thumbnail-loading",children:t.jsx("div",{className:"loading-spinner"})}):e.thumbnail?t.jsx("img",{src:e.thumbnail,alt:e.name,className:"thumbnail-image"}):t.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M12,2L2,7L12,12L22,7L12,2M2,17L12,22L22,17L20.84,16.47L12,21.17L3.16,16.47L2,17Z"})})})},e.id))})]}),t.jsx("div",{className:"section-divider"}),t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"커스텀 메쉬"}),t.jsx("div",{className:"object-grid",children:d.length>0?d.map(e=>t.jsxs("div",{className:"library-item custom-mesh",draggable:!0,onDragStart:t=>m(t,e),onDragEnd:b,onClick:()=>f(e),title:e.name,children:[t.jsxs("div",{className:"library-thumbnail",children:[t.jsx("img",{src:e.thumbnail,alt:e.name,width:"40",height:"40",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}),t.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",style:{display:"none"},children:t.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})]}),t.jsx("button",{className:"delete-btn",onClick:t=>(async(e,s)=>{if(s.stopPropagation(),window.confirm(`"${e.name}"을(를) 라이브러리에서 삭제하시겠습니까?`))try{await g.current.deleteCustomMesh(e.id);const t=await g.current.getCustomMeshes();u(t),window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제되었습니다.",type:"success",duration:2e3}}))}catch(t){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}})(e,t),title:"삭제",children:t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})})})]},e.id)):t.jsx("div",{className:"empty-library"})})]}),o.length>0&&t.jsx("div",{className:"section-divider"}),o.length>0&&t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"사용자 정의"}),t.jsx("div",{className:"object-grid",children:o.map(e=>t.jsxs("div",{className:"library-item custom-object",draggable:!0,onDragStart:t=>m(t,e),onDragEnd:b,onClick:()=>f(e),title:`${e.name} (사용자 정의)`,children:[t.jsx("div",{className:"library-thumbnail",children:e.thumbnail?t.jsx("img",{src:e.thumbnail,alt:e.name,style:{width:"24px",height:"24px",objectFit:"cover",borderRadius:"2px"}}):t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M12,2L13.09,8.26L22,9L14.74,14.74L17.18,22L12,18.5L6.82,22L9.26,14.74L2,9L10.91,8.26L12,2Z"})})}),t.jsx("button",{className:"delete-btn",onClick:t=>((e,t)=>{if(t.stopPropagation(),window.confirm(`"${e.name}"을(를) 라이브러리에서 삭제하시겠습니까?`)){e.glbUrl&&URL.revokeObjectURL(e.glbUrl);const t=JSON.parse(localStorage.getItem("customObjects")||"[]").filter(t=>t.id!==e.id);localStorage.setItem("customObjects",JSON.stringify(t)),l(t)}})(e,t),title:"삭제",children:t.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]},e.id))})]})]})]})},Fr=({onAssetDrop:e,onClose:s})=>t.jsxs("div",{className:"assets-panel",children:[t.jsxs("div",{className:"assets-header",children:[t.jsx("h3",{children:"기본 에셋"}),t.jsx("button",{className:"close-btn",onClick:s,children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]}),t.jsx("div",{className:"assets-content",children:t.jsx("div",{className:"assets-grid",children:[{id:"start_position",name:"스타트 위치",type:"start_position",description:"플레이어 시작 위치 마커"},{id:"point_light",name:"포인트 라이트",type:"point_light",description:"점 조명"},{id:"spot_light",name:"스포트 라이트",type:"spot_light",description:"스포트 조명"},{id:"axes_helper",name:"축 헬퍼",type:"axes_helper",description:"XYZ 축 표시"}].map(s=>t.jsx("div",{className:"asset-item",draggable:!0,onDragStart:e=>((e,t)=>{const s=document.createElement("canvas");s.width=50,s.height=50;const i=s.getContext("2d");i.fillStyle="rgba(255, 165, 0, 0.8)",i.fillRect(0,0,50,50),i.fillStyle="white",i.font="12px Arial",i.textAlign="center",i.fillText(t.name.substring(0,6),25,20),i.fillText("Asset",25,35),e.dataTransfer.setDragImage(s,25,25),e.dataTransfer.setData("text/plain",JSON.stringify(t))})(e,s),onClick:()=>(t=>{e&&e(t,{x:0,y:0,z:0})})(s),title:`${s.name}: ${s.description}`,children:t.jsx("div",{className:"asset-name",children:s.name})},s.id))})})]}),Lr=({postProcessingManager:e,onClose:i})=>{const[a,n]=s.useState({}),[r,o]=s.useState("basic"),l=sa(e=>e.isPostProcessingEnabled),c=sa(e=>e.togglePostProcessingEnabled),A=sa(e=>e.postProcessingPreset),h=sa(e=>e.setPostProcessingPreset);s.useEffect(()=>{e&&n(e.getSettings())},[e]);const d=t=>{var s;if(!e)return;const i=!(null==(s=a[t])?void 0:s.enabled);e.setEffectEnabled(t,i),n(e=>({...e,[t]:{...e[t],enabled:i}}))},u=(t,s,i)=>{if(!e)return;const a={[s]:i};e.updateEffectSettings(t,a),n(e=>({...e,[t]:{...e[t],[s]:i}}))};return t.jsxs("div",{className:"post-processing-panel",children:[t.jsxs("div",{className:"panel-header",children:[t.jsx("h2",{children:"포스트프로세싱 효과"}),t.jsxs("label",{className:"checkbox-label",style:{marginLeft:"auto",marginRight:8},children:[t.jsx("input",{type:"checkbox",checked:l,onChange:c})," 전체 사용"]}),t.jsx("button",{className:"close-button",onClick:i,children:"×"})]}),!l&&t.jsx("div",{style:{background:"rgba(255, 194, 61, 0.12)",border:"1px solid rgba(255, 194, 61, 0.35)",color:"#b78200",padding:"8px 10px",borderRadius:6,margin:"8px 12px"},children:'포스트프로세싱이 꺼져 있어 효과가 화면에 보이지 않습니다. 상단의 "전체 사용"을 켜세요.'}),t.jsxs("div",{className:"panel-tabs",children:[t.jsx("button",{className:"tab-button "+("basic"===r?"active":""),onClick:()=>o("basic"),children:"기본"}),t.jsx("button",{className:"tab-button "+("color"===r?"active":""),onClick:()=>o("color"),children:"색상"}),t.jsx("button",{className:"tab-button "+("artistic"===r?"active":""),onClick:()=>o("artistic"),children:"아티스틱"})]}),t.jsxs("div",{className:"panel-content",children:["basic"===r&&t.jsxs("div",{className:"effect-group",children:[t.jsx("h3",{children:"기본 효과"}),t.jsx("div",{className:"effect-item",children:t.jsxs("div",{className:"effect-header",children:[t.jsx("label",{style:{color:"#ccc",fontSize:12,marginRight:8},children:"프리셋"}),t.jsxs("select",{value:A,onChange:t=>{var s;const i=t.target.value;h(i);try{null==(s=null==e?void 0:e.applyPreset)||s.call(e,i)}catch{}},children:[t.jsx("option",{value:"default",children:"Default"}),t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]})}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(g=a.bloom)?void 0:g.enabled)||!1,onChange:()=>d("bloom")}),"Bloom (발광)"]})}),(null==(p=a.bloom)?void 0:p.enabled)&&t.jsxs("div",{className:"effect-controls",children:[t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"강도:"}),t.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:(null==(m=a.bloom)?void 0:m.strength)||1.5,onChange:e=>u("bloom","strength",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(b=a.bloom)?void 0:b.strength)||1.5})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"반경:"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(f=a.bloom)?void 0:f.radius)||.4,onChange:e=>u("bloom","radius",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(C=a.bloom)?void 0:C.radius)||.4})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"임계값:"}),t.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(v=a.bloom)?void 0:v.threshold)||.85,onChange:e=>u("bloom","threshold",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(y=a.bloom)?void 0:y.threshold)||.85})]})]})]}),t.jsx("div",{className:"effect-item",children:t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(x=a.fxaa)?void 0:x.enabled)||!1,onChange:()=>d("fxaa")}),"FXAA (안티앨리어싱)"]})})}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(I=a.ssao)?void 0:I.enabled)||!1,onChange:()=>d("ssao")}),"SSAO (주변광 차폐)"]})}),(null==(E=a.ssao)?void 0:E.enabled)&&t.jsx("div",{className:"effect-controls",children:t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"커널 반경:"}),t.jsx("input",{type:"range",min:"1",max:"32",step:"1",value:(null==(B=a.ssao)?void 0:B.kernelRadius)||8,onChange:e=>u("ssao","kernelRadius",parseInt(e.target.value))}),t.jsx("span",{children:(null==(w=a.ssao)?void 0:w.kernelRadius)||8})]})})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(S=a.toneMapping)?void 0:S.enabled)??!0,onChange:()=>d("toneMapping")}),"Tone Mapping (톤 매핑)"]})}),!1!==(null==(Q=a.toneMapping)?void 0:Q.enabled)&&t.jsxs("div",{className:"effect-controls",children:[t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"모드:"}),t.jsxs("select",{value:(null==(j=a.toneMapping)?void 0:j.mapping)||"ACESFilmic",onChange:e=>u("toneMapping","mapping",e.target.value),children:[t.jsx("option",{value:"None",children:"None"}),t.jsx("option",{value:"Linear",children:"Linear"}),t.jsx("option",{value:"Reinhard",children:"Reinhard"}),t.jsx("option",{value:"Cineon",children:"Cineon"}),t.jsx("option",{value:"ACESFilmic",children:"ACESFilmic"})]})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"노출:"}),t.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.05",value:(null==(M=a.toneMapping)?void 0:M.exposure)??1,onChange:e=>u("toneMapping","exposure",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(D=a.toneMapping)?void 0:D.exposure)??1})]})]})]})]}),"color"===r&&(()=>{var e,s,i,n,r,o,l,c,A,h,g,p,m,b,f,C,v,y,x,I,E,B,w,S,Q,j,M,D;return t.jsxs("div",{className:"effect-group",children:[t.jsx("h3",{children:"색상 효과"}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(e=a.colorCorrection)?void 0:e.enabled)||!1,onChange:()=>d("colorCorrection")}),"Color Correction (색상 보정)"]})}),(null==(s=a.colorCorrection)?void 0:s.enabled)&&t.jsx("div",{className:"effect-controls",children:t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"Red Power:"}),t.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:(null==(n=null==(i=a.colorCorrection)?void 0:i.powRGB)?void 0:n.x)||2,onChange:e=>u("colorCorrection","powRGB",{...a.colorCorrection.powRGB,x:parseFloat(e.target.value)})}),t.jsx("span",{children:(null==(o=null==(r=a.colorCorrection)?void 0:r.powRGB)?void 0:o.x)||2})]})})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(l=a.brightnessContrast)?void 0:l.enabled)||!1,onChange:()=>d("brightnessContrast")}),"Brightness/Contrast (밝기/대비)"]})}),(null==(c=a.brightnessContrast)?void 0:c.enabled)&&t.jsxs("div",{className:"effect-controls",children:[t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"밝기:"}),t.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(A=a.brightnessContrast)?void 0:A.brightness)||0,onChange:e=>u("brightnessContrast","brightness",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(h=a.brightnessContrast)?void 0:h.brightness)||0})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"대비:"}),t.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(g=a.brightnessContrast)?void 0:g.contrast)||0,onChange:e=>u("brightnessContrast","contrast",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(p=a.brightnessContrast)?void 0:p.contrast)||0})]})]})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(m=a.hueSaturation)?void 0:m.enabled)||!1,onChange:()=>d("hueSaturation")}),"Hue/Saturation (색조/채도)"]})}),(null==(b=a.hueSaturation)?void 0:b.enabled)&&t.jsxs("div",{className:"effect-controls",children:[t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"색조:"}),t.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(f=a.hueSaturation)?void 0:f.hue)||0,onChange:e=>u("hueSaturation","hue",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(C=a.hueSaturation)?void 0:C.hue)||0})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"채도:"}),t.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(v=a.hueSaturation)?void 0:v.saturation)||0,onChange:e=>u("hueSaturation","saturation",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(y=a.hueSaturation)?void 0:y.saturation)||0})]})]})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(x=a.sepia)?void 0:x.enabled)||!1,onChange:()=>d("sepia")}),"Sepia (세피아)"]})}),(null==(I=a.sepia)?void 0:I.enabled)&&t.jsx("div",{className:"effect-controls",children:t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"강도:"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(E=a.sepia)?void 0:E.amount)||1,onChange:e=>u("sepia","amount",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(B=a.sepia)?void 0:B.amount)||1})]})})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(w=a.vignette)?void 0:w.enabled)||!1,onChange:()=>d("vignette")}),"Vignette (비네트)"]})}),(null==(S=a.vignette)?void 0:S.enabled)&&t.jsxs("div",{className:"effect-controls",children:[t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"오프셋:"}),t.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(Q=a.vignette)?void 0:Q.offset)||1,onChange:e=>u("vignette","offset",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(j=a.vignette)?void 0:j.offset)||1})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"어둠:"}),t.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(M=a.vignette)?void 0:M.darkness)||1,onChange:e=>u("vignette","darkness",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(D=a.vignette)?void 0:D.darkness)||1})]})]})]})]})})(),"artistic"===r&&(()=>{var e,s,i,n,r,o,l,c,A,h,g,p,m,b,f,C,v,y,x;return t.jsxs("div",{className:"effect-group",children:[t.jsx("h3",{children:"아티스틱 효과"}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(e=a.film)?void 0:e.enabled)||!1,onChange:()=>d("film")}),"Film (필름 효과)"]})}),(null==(s=a.film)?void 0:s.enabled)&&t.jsxs("div",{className:"effect-controls",children:[t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"노이즈:"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(i=a.film)?void 0:i.noiseIntensity)||.5,onChange:e=>u("film","noiseIntensity",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(n=a.film)?void 0:n.noiseIntensity)||.5})]}),t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"스캔라인:"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(r=a.film)?void 0:r.scanlinesIntensity)||.05,onChange:e=>u("film","scanlinesIntensity",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(o=a.film)?void 0:o.scanlinesIntensity)||.05})]}),t.jsx("div",{className:"control-row",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(l=a.film)?void 0:l.grayscale)||!1,onChange:e=>u("film","grayscale",e.target.checked)}),"흑백"]})})]})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(c=a.pixelate)?void 0:c.enabled)||!1,onChange:()=>d("pixelate")}),"Pixelate (픽셀화)"]})}),(null==(A=a.pixelate)?void 0:A.enabled)&&t.jsx("div",{className:"effect-controls",children:t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"픽셀 크기:"}),t.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:(null==(h=a.pixelate)?void 0:h.pixelSize)||6,onChange:e=>u("pixelate","pixelSize",parseInt(e.target.value))}),t.jsx("span",{children:(null==(g=a.pixelate)?void 0:g.pixelSize)||6})]})})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(p=a.dotScreen)?void 0:p.enabled)||!1,onChange:()=>d("dotScreen")}),"Dot Screen (도트 스크린)"]})}),(null==(m=a.dotScreen)?void 0:m.enabled)&&t.jsx("div",{className:"effect-controls",children:t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"스케일:"}),t.jsx("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:(null==(b=a.dotScreen)?void 0:b.scale)||1,onChange:e=>u("dotScreen","scale",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(f=a.dotScreen)?void 0:f.scale)||1})]})})]}),t.jsxs("div",{className:"effect-item",children:[t.jsx("div",{className:"effect-header",children:t.jsxs("label",{className:"checkbox-label",children:[t.jsx("input",{type:"checkbox",checked:(null==(C=a.glitch)?void 0:C.enabled)||!1,onChange:()=>d("glitch")}),"Glitch (글리치)"]})}),(null==(v=a.glitch)?void 0:v.enabled)&&t.jsx("div",{className:"effect-controls",children:t.jsxs("div",{className:"control-row",children:[t.jsx("label",{children:"강도:"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(y=a.glitch)?void 0:y.factor)||.1,onChange:e=>u("glitch","factor",parseFloat(e.target.value))}),t.jsx("span",{children:(null==(x=a.glitch)?void 0:x.factor)||.1})]})})]})]})})()]})]});var g,p,m,b,f,C,v,y,x,I,E,B,w,S,Q,j,M,D};function Pr({scene:e,onClose:i}){const a=sa(e=>e.hdriSettings),n=sa(e=>e.updateHDRISettings),r=sa(e=>e.sunLightRef);sa(e=>e.setSunLightRef);const o=sa(e=>e.saveHDRISettings),[l,c]=s.useState(!1),[h,d]=s.useState(null),u=s.useRef(null),{currentHDRI:g,hdriIntensity:p,hdriRotation:m,sunLightEnabled:b,sunIntensity:f,timeOfDay:C,sunAzimuth:v,sunElevation:y,sunColor:x}=a,I=(e,t="info")=>{d({message:e,type:t}),setTimeout(()=>d(null),3e3)},B=async(t,s)=>{if(!e)throw new Error("씬이 초기화되지 않았습니다");const i=new Promise((e,t)=>{setTimeout(()=>t(new Error("로드 시간 초과")),3e4)});try{const a=await Promise.race([w(t),i]);a.mapping=Lt,(null==g?void 0:g.texture)&&g.texture.dispose(),e.environment=a,e.background=a,void 0!==e.backgroundIntensity&&(e.backgroundIntensity=p),void 0!==e.environmentIntensity&&(e.environmentIntensity=p),n({currentHDRI:{name:s,texture:a,url:t}})}catch(a){if(t.startsWith("blob:")&&URL.revokeObjectURL(t),a.message.includes("Bad File Format"))try{const i=await S(t);return i.mapping=Lt,(null==g?void 0:g.texture)&&g.texture.dispose(),e.environment=i,e.background=i,void n({currentHDRI:{name:s+" (폴백)",texture:i,url:t}})}catch(r){}throw a}},w=async e=>{const t=new Nt;return new Promise((s,i)=>{t.load(e,e=>{e&&e.image?s(e):i(new Error("텍스처 데이터가 유효하지 않습니다"))},void 0,e=>{i(e)})})},S=async e=>{const t=new E;return new Promise((s,i)=>{t.load(e,e=>{e&&e.image?s(e):i(new Error("폴백 텍스처 데이터가 유효하지 않습니다"))},void 0,e=>{i(e)})})},Q=(e,t,s)=>{const i=t*Math.PI/180,a=s*Math.PI/180,n=Math.sin(i)*Math.cos(a)*100,r=100*Math.sin(a),o=Math.cos(i)*Math.cos(a)*100;e.position.set(n,r,o),e.lookAt(0,0,0)},j=e=>{n({timeOfDay:e}),r&&(e=>{let t="#ffffff";t=e>=5&&e<7?"#ff6b47":e>=7&&e<10?"#ffaa80":e>=10&&e<16?"#ffffff":e>=16&&e<18?"#ffcc99":e>=18&&e<20?"#ff8c66":"#4a6fa5",n({sunColor:t}),r&&r.color.setHex(t.replace("#","0x"))})(e)};return s.useEffect(()=>()=>{},[e]),s.useEffect(()=>{e&&setTimeout(()=>o(),100)},[a,e,o]),s.useEffect(()=>{e&&g&&g.type&&g.texture&&"none"!==g.type&&(void 0!==e.backgroundIntensity&&(e.backgroundIntensity=p),void 0!==e.environmentIntensity&&(e.environmentIntensity=p),g.texture.rotation=m*Math.PI/180)},[e,g,p,m]),t.jsxs("div",{className:"hdri-panel",children:[t.jsxs("div",{className:"hdri-header",children:[t.jsx("h3",{children:"HDRI 환경"}),t.jsxs("div",{className:"header-controls",children:[t.jsx("span",{className:"auto-save-indicator",title:"설정이 자동으로 저장됩니다",children:"💾"}),t.jsx("button",{className:"close-btn",onClick:i,children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]})]}),t.jsxs("div",{className:"hdri-content",children:[t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"현재 환경"}),t.jsx("div",{className:"current-hdri-display",children:g?t.jsx("span",{className:"hdri-name",children:g.name}):t.jsx("span",{className:"no-hdri",children:"환경 없음"})})]}),t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"환경맵 업로드"}),t.jsx("input",{type:"file",ref:u,onChange:async e=>{const t=e.target.files[0];if(!t)return;const s=[".hdr",".exr",".hdri"],i=[...s,".jpg",".jpeg",".png",".webp",".bmp"],a=t.name.toLowerCase().substring(t.name.lastIndexOf("."));if(!i.includes(a))return void I("지원하는 형식: HDRI(.hdr, .exr, .hdri) 또는 이미지(.jpg, .png, .webp)","error");if(t.size>209715200)return void I("파일 크기가 너무 큽니다 (최대 200MB)","error");if(t.size<100)return void I("파일이 너무 작습니다","error");const n=s.includes(a);if(n)try{const e=await t.slice(0,20).arrayBuffer(),s=new Uint8Array(e),i=String.fromCharCode(...s.slice(0,20));if(".hdr"===a){i.includes("#?RADIANCE")||i.includes("#?RGBE")||i.includes("RADIANCE")||35===s[0]||I("HDR 파일 형식이 표준과 다를 수 있습니다. 일반 이미지로 시도합니다.","info")}}catch(r){}else I("일반 이미지 파일을 환경맵으로 사용합니다","info");c(!0);try{const e=URL.createObjectURL(t);await B(e,t.name),I((n?"HDRI":"이미지")+" 환경이 로드되었습니다","success")}catch(o){let e="파일을 로드할 수 없습니다";o.message.includes("Bad File Format")?e="파일 형식을 읽을 수 없습니다. 다른 파일을 시도해보세요.":o.message.includes("network")?e="네트워크 오류로 파일을 로드할 수 없습니다":o.message.includes("로드 시간 초과")&&(e="파일 로드 시간이 초과되었습니다"),I(e,"error")}finally{c(!1),e.target.value=""}},accept:".hdr,.exr,.hdri,.jpg,.jpeg,.png,.webp,.bmp",style:{display:"none"}}),t.jsxs("button",{className:"hdri-upload-btn",onClick:()=>{var e;return null==(e=u.current)?void 0:e.click()},disabled:l,children:[t.jsx("div",{className:"upload-icon",children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})}),t.jsx("span",{children:l?"로딩중...":"파일 선택"})]}),t.jsx("div",{className:"upload-hint",children:".hdr, .exr, .hdri 지원"})]}),t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"기본 환경"}),t.jsx("div",{className:"hdri-grid",children:[{name:"컨트리 로드",type:"preset",url:"/hdr/sunny_country_road_2k.hdr",description:"햇살 좋은 시골길"},{name:"기본 스카이박스",type:"gradient",description:"그라디언트 스카이박스"},{name:"기본 배경",type:"none",description:"회색 배경"}].map((s,i)=>t.jsxs("div",{className:"hdri-item "+((null==g?void 0:g.name)===s.name?"active":""),onClick:()=>(async(t,s=null)=>{if(e)switch(t){case"preset":if(s&&s.url)try{c(!0),await B(s.url,s.name),I(`${s.name} 환경이 적용되었습니다`,"success")}catch(i){I("프리셋 환경을 로드할 수 없습니다","error")}finally{c(!1)}break;case"gradient":e.background&&e.background.isTexture&&e.background.dispose(),e.background=new A(8900331),e.environment=null,n({currentHDRI:{name:"기본 스카이박스",type:"gradient"}});break;case"none":e.background&&e.background.isTexture&&e.background.dispose(),e.background=new A(2763306),e.environment=null,n({currentHDRI:{name:"기본 배경",type:"none"}})}})(s.type,s),title:s.description,children:[t.jsx("div",{className:"hdri-thumbnail",children:t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:["preset"===s.type&&t.jsx("path",{d:"M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V10.5L17.5,9L16,10.5L14.5,9L11.5,12L9,9.5L7.5,11L6,9.5L5,10.5V5H19Z"}),"gradient"===s.type&&t.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}),"none"===s.type&&t.jsx("path",{d:"M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"})]})}),t.jsx("div",{className:"hdri-label",children:s.name})]},i))})]}),g&&"none"!==g.type&&t.jsx("div",{className:"section-divider"}),g&&"none"!==g.type&&t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"환경 설정"}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"강도"}),t.jsxs("div",{className:"slider-container",children:[t.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:p,onChange:t=>{return s=parseFloat(t.target.value),n({hdriIntensity:s}),void(e&&g&&g.texture&&"none"!==g.type&&(e.backgroundIntensity=s,e.environmentIntensity=s));var s},className:"hdri-slider"}),t.jsx("span",{className:"slider-value",children:p.toFixed(1)})]})]}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"회전"}),t.jsxs("div",{className:"slider-container",children:[t.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:m,onChange:t=>{return s=parseFloat(t.target.value),n({hdriRotation:s}),void(e&&g&&g.texture&&"none"!==g.type&&(g.texture.rotation=s*Math.PI/180));var s},className:"hdri-slider"}),t.jsxs("span",{className:"slider-value",children:[m,"°"]})]})]})]}),t.jsxs("div",{className:"category-section",children:[t.jsx("h4",{className:"category-title",children:"태양 조명"}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"활성화"}),t.jsx("input",{type:"checkbox",checked:b,onChange:e=>{return t=e.target.checked,void n({sunLightEnabled:t});var t},className:"setting-checkbox"})]}),b&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"시간"}),t.jsxs("div",{className:"slider-container",children:[t.jsx("input",{type:"range",min:"0",max:"24",step:"0.5",value:C,onChange:e=>j(Number(e.target.value)),className:"hdri-slider"}),t.jsxs("span",{className:"slider-value",children:[C,"시"]})]})]}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"강도"}),t.jsxs("div",{className:"slider-container",children:[t.jsx("input",{type:"range",min:"0",max:"20",step:"0.1",value:f,onChange:e=>{return t=Number(e.target.value),n({sunIntensity:t}),void(r&&(r.intensity=t));var t},className:"hdri-slider"}),t.jsx("span",{className:"slider-value",children:f})]})]}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"방위각"}),t.jsxs("div",{className:"slider-container",children:[t.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:v,onChange:e=>{return t=Number(e.target.value),n({sunAzimuth:t}),void(r&&Q(r,t,y));var t},className:"hdri-slider"}),t.jsxs("span",{className:"slider-value",children:[v,"°"]})]})]}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"고도각"}),t.jsxs("div",{className:"slider-container",children:[t.jsx("input",{type:"range",min:"0",max:"90",step:"1",value:y,onChange:e=>{return t=Number(e.target.value),n({sunElevation:t}),void(r&&Q(r,v,t));var t},className:"hdri-slider"}),t.jsxs("span",{className:"slider-value",children:[y,"°"]})]})]}),t.jsxs("div",{className:"setting-item",children:[t.jsx("label",{children:"색상"}),t.jsx("div",{className:"color-preview",style:{backgroundColor:x,padding:"4px 8px",borderRadius:"4px",fontSize:"12px",textAlign:"center"},children:C<6||C>20?"밤":C<10?"아침":C<16?"낮":"저녁"})]})]})]})]}),h&&t.jsx("div",{className:`hdri-toast hdri-toast-${h.type}`,children:h.message})]})}const Nr=({x:e,y:i,isVisible:a,onClose:n,selectedObject:r,onAddToLibrary:o})=>{const l=s.useRef(null);if(s.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&n()},t=e=>{"Escape"===e.key&&n()};if(a)return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[a,n]),!a)return null;const c=Math.min(e,window.innerWidth-200),A=Math.min(i,window.innerHeight-150);return t.jsxs("div",{ref:l,className:"context-menu",style:{left:c,top:A},children:[t.jsx("div",{className:"context-menu-header",children:t.jsx("span",{children:"메쉬 옵션"})}),t.jsxs("div",{className:"context-menu-items",children:[t.jsxs("button",{className:"context-menu-item",onClick:()=>{r&&o&&o(r),n()},children:[t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})}),t.jsx("span",{children:"라이브러리에 추가"})]}),t.jsxs("button",{className:"context-menu-item disabled",disabled:!0,children:[t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"})}),t.jsx("span",{children:"복제 (곧 제공)"})]}),t.jsxs("button",{className:"context-menu-item disabled",disabled:!0,children:[t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})}),t.jsx("span",{children:"삭제 (곧 제공)"})]})]}),r&&t.jsx("div",{className:"context-menu-info",children:t.jsx("span",{className:"selected-object-name",children:r.name||"이름 없음"})})]})},Gr=({message:e,type:i="info",isVisible:a,onClose:n})=>{if(s.useEffect(()=>{if(a){const e=setTimeout(()=>{n()},3e3);return()=>clearTimeout(e)}},[a,n]),!a)return null;return t.jsxs("div",{className:`toast toast-${i} ${a?"toast-visible":""}`,children:[t.jsx("div",{className:"toast-icon",children:(()=>{switch(i){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}})()}),t.jsx("div",{className:"toast-message",children:e}),t.jsx("button",{className:"toast-close",onClick:n,children:"×"})]})};function Ur({editorControls:e,postProcessingManager:i,onAddToLibrary:a,showInspector:n,onToggleInspector:r}){const{selectedObject:o,transformMode:l,objects:c,walls:A,savedObjects:h,selectedIds:d,setSelectedIds:u,setParent:g,reorderSiblings:p,setTransformMode:m,addWall:b,addObject:f,removeObject:C,addAsset:v,saveMap:y,loadMap:x,clearMap:I,toggleObjectVisibility:E,toggleObjectFreeze:B,renameObject:w,setSelectedObject:S}=sa();s.useState(""),s.useState("");const Q=sa(e=>e.showLibrary),j=sa(e=>e.showAssets),M=sa(e=>e.showHDRI),D=sa(e=>e.isPostProcessingPanelOpen),T=sa(e=>e.setShowLibrary),R=sa(e=>e.setShowAssets),k=sa(e=>e.setShowHDRI),O=sa(e=>e.setIsPostProcessingPanelOpen),[F,L]=s.useState({isVisible:!1,x:0,y:0}),[P,N]=s.useState(0),[G,U]=s.useState({message:"",type:"info",isVisible:!1});s.useEffect(()=>{const e=e=>{"f"!==e.key&&"F"!==e.key||(e.preventDefault(),(null==o?void 0:o.id)&&H(o))},t=e=>{(e=>{o&&(e.preventDefault(),L({isVisible:!0,x:e.clientX,y:e.clientY}))})(e.detail.originalEvent)};return window.addEventListener("keydown",e),window.addEventListener("editorContextMenu",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("editorContextMenu",t)}},[o]);const z=t=>{if(!t)return e&&e.deselectAllObjects(),void S(null);if(e){const s=e.findObjectById(t.id);s&&e.selectObject(s)}S(t)},H=t=>{if(z(t),e){const s=e.findObjectById(t.id);s&&e.focusOnObject(s)}};return t.jsxs("div",{className:"editor-ui",children:[t.jsx("div",{className:"tool-panel",children:t.jsxs("div",{className:"tool-section",children:[t.jsx("button",{className:"tool-btn assets-btn "+(j?"active":""),onClick:()=>{const e=!j;R(e),e&&(Q&&T(!1),D&&O(!1),M&&k(!1))},title:"기본 에셋",children:t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M12,2L13.09,8.26L22,9L14.74,14.74L17.18,22L12,18.5L6.82,22L9.26,14.74L2,9L10.91,8.26L12,2Z"})})}),t.jsx("button",{className:"tool-btn library-btn "+(Q?"active":""),onClick:()=>{const e=!Q;T(e),e&&(j&&R(!1),D&&O(!1),M&&k(!1))},title:"라이브러리",children:t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M4,6H20V8H4V6M4,11H20V13H4V11M4,16H20V18H4V16Z"})})}),t.jsx("button",{className:"tool-btn post-processing-btn "+(D?"active":""),onClick:()=>{const e=!D;O(e),e&&(Q&&T(!1),j&&R(!1),M&&k(!1))},title:"포스트프로세싱 효과",children:t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M9,12L11,14L15,10L20,15H4L9,12Z"})})}),t.jsx("button",{className:"tool-btn hdri-btn "+(M?"active":""),onClick:()=>{const e=!M;k(e),e&&(Q&&T(!1),j&&R(!1),D&&O(!1))},title:"HDRI 환경",children:t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:t.jsx("path",{d:"M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,2L14.39,5.42C13.65,5.15 12.84,5 12,5C11.16,5 10.35,5.15 9.61,5.42L12,2M3.34,7L7.5,6.65C6.9,7.16 6.36,7.78 5.94,8.5C5.5,9.24 5.25,10 5.11,10.79L3.34,7M3.36,17L5.12,13.23C5.26,14 5.53,14.78 5.95,15.5C6.37,16.24 6.91,16.86 7.5,17.37L3.36,17M20.65,7L18.88,10.79C18.74,10 18.47,9.23 18.05,8.5C17.63,7.78 17.1,7.15 16.5,6.64L20.65,7M20.64,17L16.5,17.36C17.09,16.85 17.62,16.22 18.04,15.5C18.46,14.77 18.73,14 18.87,13.21L20.64,17Z"})})}),D&&t.jsx(Lr,{postProcessingManager:i,onClose:()=>O(!1)})]})}),j&&t.jsx(Fr,{onAssetDrop:(e,t)=>{let s;switch(e.type){case"start_position":s={id:Date.now(),type:"start_position",name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},color:65280,geometry:"marker"};break;case"directional_light":s={id:Date.now(),type:"directional_light",name:e.name,position:t||{x:5,y:10,z:5},rotation:{x:-Math.PI/4,y:Math.PI/4,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,castShadow:!0};break;case"point_light":s={id:Date.now(),type:"point_light",name:e.name,position:t||{x:0,y:3,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,distance:10,decay:2};break;case"spot_light":s={id:Date.now(),type:"spot_light",name:e.name,position:t||{x:0,y:5,z:0},rotation:{x:-Math.PI/2,y:0,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,distance:10,angle:Math.PI/6,penumbra:.1};break;case"ambient_light":s={id:Date.now(),type:"ambient_light",name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},intensity:.3,color:4210752};break;case"audio_source":s={id:Date.now(),type:"audio_source",name:e.name,position:t||{x:0,y:1,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},volume:1,loop:!1,autoplay:!1};break;default:s={id:Date.now(),type:e.type,name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}f(s),setTimeout(()=>{S(s)},100),((e,t="info")=>{U({message:e,type:t,isVisible:!0}),setTimeout(()=>{U(e=>({...e,isVisible:!1}))},3e3)})(`${e.name}이(가) 씬에 추가되었습니다.`,"success")},onClose:()=>R(!1)}),Q&&t.jsx(Or,{onObjectDrop:(e,t)=>{let s;s="library"===e.type?{id:Date.now(),type:"glb",url:e.glbUrl,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name}:"custom"===e.type?{id:Date.now(),type:"glb",glbData:e.glbData,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name}:{id:Date.now(),type:e.type||"basic",geometry:e.geometry,params:e.params,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name},f(s),setTimeout(()=>{S(s)},100)},onClose:()=>T(!1),forceRefresh:P}),M&&t.jsx(Pr,{scene:null==e?void 0:e.scene,onClose:()=>k(!1)}),t.jsx(Gr,{message:G.message,type:G.type,isVisible:G.isVisible,onClose:()=>{U(e=>({...e,isVisible:!1}))}}),t.jsx(Nr,{x:F.x,y:F.y,isVisible:F.isVisible,onClose:()=>{L({isVisible:!1,x:0,y:0})},selectedObject:o,onAddToLibrary:a}),n&&t.jsx(kr,{objects:c,walls:A,selectedIds:d,setSelectedIds:u,setParent:g,reorderSiblings:p,selectedObject:o,onObjectVisibilityToggle:e=>{E(e)},onObjectFreezeToggle:e=>{B(e)},onObjectSelect:z,onObjectRemove:t=>{if(e&&e.objectSelector){if(e.objectSelector.transformControls)try{e.objectSelector.transformControls.detach()}catch(s){}try{const s=e.findObjectById(t.id);s&&e.objectSelector.removeSelectionOutline(s)}catch(s){}}if(o&&o.id===t.id){if(e)try{e.deselectAllObjects()}catch(s){}S(null)}setTimeout(()=>{try{C(t)}catch(s){}},50)},onObjectFocus:H,onObjectRename:(e,t)=>{if(w(e.id,t),(null==o?void 0:o.id)===e.id){const e={...o,name:t};S(e)}},onContextMenu:(e,t)=>{e.preventDefault(),z(t),L({isVisible:!0,x:e.clientX,y:e.clientY})},editorControls:e,postProcessingManager:i,onObjectUpdate:t=>{if(e&&t.id){const s=e.findObjectById(t.id);s&&(t.position&&s.position.set(t.position.x,t.position.y,t.position.z),t.rotation&&s.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),t.scale&&s.scale.set(t.scale.x,t.scale.y,t.scale.z),t.name&&(s.name=t.name))}(null==o?void 0:o.id)===t.id&&S(t)},onClose:()=>r(!1)})]})}const zr=({onMenuAction:e})=>{const[a,n]=s.useState(null),r=e=>{e.target.closest(".menu-bar")||n(null)};return i.useEffect(()=>(document.addEventListener("click",r),()=>{document.removeEventListener("click",r)}),[]),t.jsx("div",{className:"menu-bar",children:t.jsx("div",{className:"menu-items",children:[{title:"파일",items:[{label:"새 맵",action:"new-map",shortcut:"Ctrl+N"},{label:"불러오기",action:"load-map",shortcut:"Ctrl+O"},{label:"저장하기",action:"save-map",shortcut:"Ctrl+S"},{type:"separator"},{label:"임포트",action:"import"},{label:"익스포트",action:"export"},{type:"separator"},{label:"나가기",action:"exit",shortcut:"Alt+F4"}]},{title:"에디터",items:[{label:"실행 취소",action:"undo",shortcut:"Ctrl+Z"},{label:"다시 실행",action:"redo",shortcut:"Ctrl+Y"},{type:"separator"},{label:"복사",action:"copy",shortcut:"Ctrl+C"},{label:"붙여넣기",action:"paste",shortcut:"Ctrl+V"},{label:"삭제",action:"delete",shortcut:"Delete"},{type:"separator"},{label:"전체 선택",action:"select-all",shortcut:"Ctrl+A"},{label:"선택 해제",action:"deselect-all",shortcut:"Ctrl+D"}]},{title:"윈도우",items:[{label:"뷰포트 리셋",action:"reset-viewport"},{label:"카메라 리셋",action:"reset-camera"},{type:"separator"},{label:"그리드 토글",action:"toggle-grid"},{label:"통계 표시",action:"toggle-stats"},{type:"separator"},{label:"인스펙터",action:"toggle-inspector",shortcut:"I"},{type:"separator"},{label:"전체화면",action:"fullscreen",shortcut:"F11"}]},{title:"정보",items:[{label:"단축키",action:"show-shortcuts"},{label:"도움말",action:"show-help",shortcut:"F1"},{type:"separator"},{label:"프로그램 정보",action:"about"}]}].map((s,i)=>t.jsxs("div",{className:"menu-item "+(a===i?"active":""),onClick:()=>{var e;n(a===(e=i)?null:e)},children:[t.jsx("span",{className:"menu-title",children:s.title}),a===i&&t.jsx("div",{className:"dropdown-menu",children:s.items.map((s,i)=>"separator"===s.type?t.jsx("div",{className:"menu-separator"},i):t.jsxs("div",{className:"dropdown-item",onClick:t=>{var i;t.stopPropagation(),i=s.action,n(null),e&&e(i)},children:[t.jsx("span",{className:"item-label",children:s.label}),s.shortcut&&t.jsx("span",{className:"item-shortcut",children:s.shortcut})]},i))})]},i))})})};function Hr({editorControls:e}){const{isWireframe:i,isGridSnap:a,isGridVisible:n,gizmoSpace:r,gizmoSize:o,snapMove:l,snapRotateDeg:c,snapScale:A,cameraPanSpeed:h,cameraOrbitSpeed:d,cameraZoomSpeed:u,toggleWireframe:g,toggleGridSnap:p,toggleGridVisible:m,toggleGizmoSpace:b,setGizmoSize:f,setSnapMove:C,setSnapRotateDeg:v,setSnapScale:y,setCameraPanSpeed:x,setCameraOrbitSpeed:I,setCameraZoomSpeed:E}=sa(),B=sa(e=>e.isViewGizmoSettingsOpen),w=sa(e=>e.setIsViewGizmoSettingsOpen),S=sa(e=>e.isPostProcessingEnabled),Q=sa(e=>e.togglePostProcessingEnabled),j=sa(e=>e.safeMode),M=sa(e=>e.toggleSafeMode),D=sa(e=>e.setSafeModePixelRatio),T=(e,t=80)=>{let s;return(...i)=>{s&&clearTimeout(s),s=setTimeout(()=>e(...i),t)}},R=s.useMemo(()=>T(()=>{var t;try{null==(t=null==e?void 0:e.updateWireframe)||t.call(e)}catch{}},80),[e]),k=s.useMemo(()=>T(()=>{var t;try{null==(t=null==e?void 0:e.updateGridSnap)||t.call(e)}catch{}},80),[e]),O=s.useMemo(()=>T(()=>{var t,s;try{null==(s=null==(t=null==e?void 0:e.objectSelector)?void 0:t.updateGizmoSize)||s.call(t)}catch{}},80),[e]),F=B;return s.useEffect(()=>{O()},[O,o]),s.useEffect(()=>{k()},[k,l,c,A,a]),s.useEffect(()=>{var t,s,i,a,n;if(e){try{null==(t=e.updateWireframe)||t.call(e)}catch{}try{null==(s=e.updateGridSnap)||s.call(e)}catch{}try{null==(i=e.updateGizmoSpace)||i.call(e)}catch{}try{null==(n=null==(a=e.objectSelector)?void 0:a.updateGizmoSize)||n.call(a)}catch{}}},[e]),t.jsxs("div",{className:"viewport-controls",children:[t.jsx("button",{className:"viewport-control-btn "+(n?"active":""),onClick:()=>{var t;m();try{null==(t=null==e?void 0:e.toggleGrid)||t.call(e)}catch{}},title:"그리드 표시/숨기기",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M3 3h18v18H3z"}),t.jsx("path",{d:"M8 3v18"}),t.jsx("path",{d:"M13 3v18"}),t.jsx("path",{d:"M18 3v18"}),t.jsx("path",{d:"M3 8h18"}),t.jsx("path",{d:"M3 13h18"}),t.jsx("path",{d:"M3 18h18"})]})}),t.jsx("button",{className:"viewport-control-btn "+("local"===r?"active":""),onClick:()=>{var t;b();try{null==(t=null==e?void 0:e.updateGizmoSpace)||t.call(e)}catch{}},title:`기즈모 좌표계 (${"world"===r?"월드":"로컬"})`,children:t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:"world"===r?t.jsxs(t.Fragment,{children:[t.jsx("circle",{cx:"12",cy:"12",r:"9"}),t.jsx("path",{d:"M12 3v18"}),t.jsx("path",{d:"M3 12h18"}),t.jsx("path",{d:"M8 8l8 8"}),t.jsx("path",{d:"M16 8l-8 8"})]}):t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),t.jsx("path",{d:"M12 4v16"}),t.jsx("path",{d:"M4 12h16"}),t.jsx("circle",{cx:"12",cy:"12",r:"2"})]})})}),t.jsx("button",{className:"viewport-control-btn "+(F?"active":""),onClick:()=>w(!B),title:"뷰/기즈모 설정",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M12 1v22"}),t.jsx("path",{d:"M5 5h14"}),t.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),F&&t.jsxs("div",{className:"viewport-settings-pop",children:[t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"포스트프로세싱"}),t.jsx("input",{type:"checkbox",checked:S,onChange:Q})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"안전모드"}),t.jsx("input",{type:"checkbox",checked:!!(null==j?void 0:j.enabled),onChange:()=>M()})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"픽셀 비율"}),t.jsx("input",{type:"number",min:"0.5",max:"2",step:"0.05",value:Number((null==j?void 0:j.pixelRatio)??1).toFixed(2),disabled:!(null==j?void 0:j.enabled),onChange:e=>D(parseFloat(e.target.value))})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"와이어프레임"}),t.jsx("input",{type:"checkbox",checked:i,onChange:()=>{g(),R()}})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"그리드 스냅"}),t.jsx("input",{type:"checkbox",checked:a,onChange:()=>{p(),k()}})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"기즈모 크기"}),t.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:o,onChange:e=>f(e.target.value)}),t.jsx("span",{children:Number(o).toFixed(1)})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"이동 스냅"}),t.jsx("input",{type:"number",step:"0.1",value:l,onChange:e=>C(e.target.value)})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"회전 스냅(도)"}),t.jsx("input",{type:"number",step:"1",value:c,onChange:e=>v(e.target.value)})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{children:"크기 스냅"}),t.jsx("input",{type:"number",step:"0.01",value:A,onChange:e=>y(e.target.value)})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{style:{opacity:.8},children:"카메라 Pan"}),t.jsx("input",{type:"number",step:"1",value:h,onChange:e=>x(e.target.value)})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{style:{opacity:.8},children:"카메라 Orbit"}),t.jsx("input",{type:"number",step:"1",value:d,onChange:e=>I(e.target.value)})]}),t.jsxs("div",{className:"row",children:[t.jsx("label",{style:{opacity:.8},children:"카메라 Zoom"}),t.jsx("input",{type:"number",step:"0.05",value:u,onChange:e=>E(e.target.value)})]}),t.jsx("div",{className:"hint",children:"스냅은 그리드 스냅이 활성화되어야 적용됩니다."})]})]})}const _r="새 맵을 만들면 현재 작업이 사라집니다. 계속하시겠습니까?",qr="익스포트 기능은 준비 중입니다.",Kr="에디터를 종료하시겠습니까?",Vr="실행 취소 기능은 준비 중입니다.",Yr="다시 실행 기능은 준비 중입니다.",Wr="전체 선택 기능은 준비 중입니다.",Jr="선택 해제 기능은 준비 중입니다.",Xr="뷰포트 리셋 기능은 준비 중입니다.",Zr="카메라 리셋: 키패드 0번을 누르세요.",$r="통계 표시 기능은 준비 중입니다.",eo="단축키 정보:\nW/E/R: 기즈모 모드\nF: 오브젝트 포커스\nESC: 선택 해제\n키패드 0: 카메라 리셋\n키패드 5: 카메라 모드 토글\n키패드 1/3/7/9: 뷰 변경",to="도움말:\n• 좌클릭: 오브젝트 선택\n• Shift+좌클릭: 다중 선택\n• 중간클릭: 팬 이동\n• Alt+중간클릭: 카메라 회전\n• 마우스 휠: 줌",so="ThirdPersonTreeJS Editor\nVersion 1.0.0\n3D 에디터 프로그램";function io(){const e=Gt(),{clearMap:i,saveMap:a,loadMap:n,addObject:r,setSelectedObject:o,addCustomMesh:l,selectedObject:c,selectedIds:h,toggleGridVisible:d,scene:u,hdriSettings:p,sunLightRef:m,setSunLightRef:b,saveHDRISettings:f,objects:C,setSelectedIds:v,setParent:y,reorderSiblings:x,copyObject:I,pasteObject:E,deleteSelectedObject:B,hasClipboardData:w}=sa(),[S,Q]=s.useState(null),[j,M]=s.useState(""),[D,T]=s.useState(null),[R,k]=s.useState(!0),O=s.useRef(null),[F,L]=s.useState(null),P=s.useRef(null),N=s.useRef(jr()),G=s.useRef(new Set);s.useEffect(()=>{let e=!1;return(async()=>{try{const t=await N.current.getCustomMeshes();if(!e&&0===(sa.getState().customMeshes||[]).length){const e=t.map(e=>"string"==typeof e.thumbnail&&e.thumbnail.startsWith("blob:")?e.thumbnail:null).filter(Boolean);G.current=new Set(e),sa.getState().loadCustomMeshes(t)}}catch{}})(),()=>{e=!0;for(const e of G.current)try{URL.revokeObjectURL(e)}catch{}G.current.clear()}},[]),s.useEffect(()=>{const e=e=>{const{message:t,type:s="info",duration:i=3e3}=e.detail||{};t&&(T({message:t,type:s}),i>0&&setTimeout(()=>T(null),i))};return window.addEventListener("appToast",e),()=>window.removeEventListener("appToast",e)},[]),s.useEffect(()=>{u&&p.sunLightEnabled&&!m?U():u&&!p.sunLightEnabled&&m&&z()},[u,p.sunLightEnabled,m]),s.useEffect(()=>{u&&p.currentHDRI&&"none"===p.currentHDRI.type&&(u.background=new A(2763306),u.environment=null)},[u,p.currentHDRI]),s.useEffect(()=>{const e=e=>{var t;if("i"!==e.key&&"I"!==e.key||e.ctrlKey||e.altKey||e.shiftKey||(e.preventDefault(),k(e=>!e)),e.ctrlKey&&("c"===e.key||"C"===e.key))if(e.preventDefault(),c){let e=null;if(O.current){const s=c.id||c;e=O.current.findObjectById(s),!e&&(null==(t=O.current.selectedObjects)?void 0:t.length)>0&&(e=O.current.selectedObjects[0])}e?(I(e),T({message:`"${e.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3)):(I(c),T({message:`"${c.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3))}else T({message:"복사할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>T(null),2e3);if(e.ctrlKey&&("v"===e.key||"V"===e.key))if(e.preventDefault(),w()){const e=E();e?(T({message:`"${e.name}"이(가) 붙여넣기되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3)):(T({message:"붙여넣기에 실패했습니다",type:"error"}),setTimeout(()=>T(null),2e3))}else T({message:"붙여넣을 객체가 클립보드에 없습니다",type:"warning"}),setTimeout(()=>T(null),2e3);if("Delete"===e.key)if(e.preventDefault(),c){const e=C.find(e=>e.id===c);if(e){const t=e.name;B(),T({message:`"${t}"이(가) 삭제되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3)}else T({message:"삭제할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>T(null),2e3)}else T({message:"삭제할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>T(null),2e3)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[c,C,I,E,B,w,T]);const U=()=>{if(!u)return;const e=new g(p.sunColor,p.sunIntensity),t=p.sunAzimuth*Math.PI/180,s=p.sunElevation*Math.PI/180,i=Math.sin(t)*Math.cos(s)*100,a=100*Math.sin(s),n=Math.cos(t)*Math.cos(s)*100;e.position.set(i,a,n),e.lookAt(0,0,0),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.name="sunLight",b(e),u.add(e)},z=()=>{u&&m&&(u.remove(m),m.dispose&&m.dispose(),b(null))};s.useEffect(()=>{u&&setTimeout(()=>f(),100)},[p,u,f]);const H=()=>{if("save"===S&&j.trim())a(j.trim()),alert(`맵이 "${j.trim()}"으로 저장되었습니다.`);else if("load"===S&&j.trim()){n(j.trim())?alert(`맵 "${j.trim()}"을 불러왔습니다.`):alert(`맵 "${j.trim()}"을 찾을 수 없습니다.`)}Q(null),M("")},_=()=>{Q(null),M("")};return t.jsxs("div",{className:"editor-page",children:[t.jsx(zr,{onMenuAction:t=>{switch(t){case"new-map":confirm(_r)&&i();break;case"load-map":Q("load");break;case"save-map":Q("save");break;case"import":(()=>{const e=document.createElement("input");e.type="file",e.accept=".glb,.gltf",e.multiple=!1,e.onchange=e=>{const t=e.target.files[0];if(!t)return;const s=URL.createObjectURL(t),i=t.name.replace(/\.[^/.]+$/,""),a={id:Date.now(),type:"glb",file:s,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:i};r(a),setTimeout(()=>{o(a.id)},100)},e.click()})();break;case"export":alert(qr);break;case"exit":confirm(Kr)&&e("/");break;case"undo":alert(Vr);break;case"redo":alert(Yr);break;case"copy":if(c){const e=C.find(e=>e.id===c);e?(I(e),T({message:`"${e.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3)):(T({message:"복사할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>T(null),2e3))}else T({message:"복사할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>T(null),2e3);break;case"paste":if(w()){const e=E();e?(T({message:`"${e.name}"이(가) 붙여넣기되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3)):(T({message:"붙여넣기에 실패했습니다",type:"error"}),setTimeout(()=>T(null),2e3))}else T({message:"붙여넣을 객체가 클립보드에 없습니다",type:"warning"}),setTimeout(()=>T(null),2e3);break;case"delete":if(c){const e=C.find(e=>e.id===c);if(e){const t=e.name;B(),T({message:`"${t}"이(가) 삭제되었습니다`,type:"success"}),setTimeout(()=>T(null),2e3)}else T({message:"삭제할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>T(null),2e3)}else T({message:"삭제할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>T(null),2e3);break;case"select-all":alert(Wr);break;case"deselect-all":alert(Jr);break;case"reset-viewport":alert(Xr);break;case"reset-camera":alert(Zr);break;case"toggle-grid":d();const t=sa.getState().isGridVisible;O.current&&O.current.toggleGrid(),T({message:`그리드가 ${t?"표시":"숨김"} 되었습니다`,type:"info"}),setTimeout(()=>T(null),2e3);break;case"toggle-stats":alert($r);break;case"toggle-inspector":k(e=>!e),T({message:`인스펙터가 ${R?"숨김":"표시"} 되었습니다`,type:"info"}),setTimeout(()=>T(null),2e3);break;case"fullscreen":document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();break;case"show-shortcuts":alert(eo);break;case"show-help":alert(to);break;case"about":alert(so)}}}),t.jsxs("div",{className:"editor-container",children:[t.jsx(Mr,{onEditorControlsReady:e=>{O.current=e,L(e)},onPostProcessingReady:e=>{P.current=e},onContextMenu:e=>{const t=new CustomEvent("editorContextMenu",{detail:{originalEvent:e}});window.dispatchEvent(t)}}),t.jsx(Hr,{editorControls:F}),t.jsx(Ur,{editorControls:F,postProcessingManager:P.current,onAddToLibrary:async e=>{try{const t=prompt("메쉬 이름을 입력하세요:",e.name||"커스텀 메쉬");if(!t)return;const s=confirm('현재 객체의 크기, 회전, 위치 변경사항을 GLB에 적용하시겠습니까?\n\n- "확인": 현재 변환 상태가 적용된 메쉬로 저장\n- "취소": 원본 상태로 저장 (변환 값 초기화)');T({message:"라이브러리에 추가 중...",type:"info"});const i=await N.current.addCustomMesh(e,t,{preserveTransform:s});if((sa.getState().customMeshes||[]).some(e=>e.id===i.id)){if(!confirm("동일 ID의 커스텀 메쉬가 이미 있습니다.\n\n- 기존 항목을 덮어쓸까요?"))return T({message:"추가가 취소되었습니다(중복 ID).",type:"warning"}),void setTimeout(()=>T(null),2500);await Xi(i);const e=(sa.getState().customMeshes||[]).map(e=>e.id===i.id?i:e);sa.getState().loadCustomMeshes(e)}else await l(i);window.dispatchEvent(new CustomEvent("customMeshAdded",{detail:i}));T({message:`"${t}"이(가) 라이브러리에 추가되었습니다!${s?" (변환 상태 적용됨)":" (원본 상태로 저장됨)"}`,type:"success"}),setTimeout(()=>T(null),5e3)}catch(t){T({message:"라이브러리 추가에 실패했습니다.",type:"error"}),setTimeout(()=>T(null),5e3)}},showInspector:R,onToggleInspector:k})]}),S&&t.jsx("div",{className:"dialog-overlay",children:t.jsxs("div",{className:"dialog",children:[t.jsx("h3",{children:"save"===S?"맵 저장":"맵 불러오기"}),t.jsx("input",{type:"text",value:j,onChange:e=>M(e.target.value),placeholder:"맵 이름을 입력하세요",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&H(),"Escape"===e.key&&_()}}),t.jsxs("div",{className:"dialog-buttons",children:[t.jsx("button",{onClick:H,children:"확인"}),t.jsx("button",{onClick:_,children:"취소"})]})]})}),D&&t.jsx(Gr,{message:D.message,type:D.type,onClose:()=>T(null)})]})}export{io as default};
