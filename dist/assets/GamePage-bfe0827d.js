import{j as e}from"./index-cf425c8d.js";import{r as s}from"./react-vendor-773f2c06.js";import{c as t}from"./state-55578a0b.js";import{C as a,S as n,b as i,P as o,W as r,c as l,A as c,d,e as m,M as u,f as h,B as w,g as p}from"./three-de9c1ea3.js";import{u as x}from"./router-34a0800b.js";const j=t((e,s)=>({isPlaying:!0,isPaused:!1,isLoading:!0,scene:null,camera:null,renderer:null,player:null,mixer:null,clock:new a,playerPosition:{x:0,y:1,z:0},playerRotation:0,cameraState:{distance:10,height:5,followMode:!0,rotationSpeed:.002,zoomSpeed:1,minDistance:3,maxDistance:50,phi:Math.PI/4,theta:0},keys:{},mouseState:{isMouseDown:!1,prevMousePos:{x:0,y:0},sensitivity:.002},trees:[],items:[],walls:[],setLoading:s=>e({isLoading:s}),setScene:(s,t,a)=>e({scene:s,camera:t,renderer:a}),setPlayer:s=>e({player:s}),updatePlayerPosition:s=>e({playerPosition:s}),updatePlayerRotation:s=>e({playerRotation:s}),setKey:(s,t)=>e(e=>({keys:{...e.keys,[s]:t}})),pause:()=>e({isPaused:!0}),resume:()=>e({isPaused:!1}),restart:()=>e({isPlaying:!0,isPaused:!1,playerPosition:{x:0,y:1,z:0},playerRotation:0}),toggleCameraFollowMode:()=>e(e=>({cameraState:{...e.cameraState,followMode:!e.cameraState.followMode}})),updateCameraDistance:s=>e(e=>({cameraState:{...e.cameraState,distance:Math.max(e.cameraState.minDistance,Math.min(e.cameraState.maxDistance,s))}})),updateCameraAngles:(s,t)=>e(e=>({cameraState:{...e.cameraState,phi:Math.max(.1,Math.min(Math.PI-.1,s)),theta:t}})),setMouseDown:(s,t)=>e(e=>({mouseState:{...e.mouseState,isMouseDown:s,prevMousePos:t||e.mouseState.prevMousePos}})),addItem:s=>e(e=>({items:[...e.items,s]})),removeItem:s=>e(e=>({items:e.items.filter(e=>e.id!==s)})),setTrees:s=>e({trees:s}),addWall:s=>e(e=>({walls:[...e.walls,s]})),clearWalls:()=>e({walls:[]}),setMixer:s=>e({mixer:s})}));function v(){const t=s.useRef(null);return s.useEffect(()=>{if(!t.current)return;const e=new n;e.background=new i(8900331);const s=new o(75,window.innerWidth/window.innerHeight,.1,1e3);s.position.set(0,5,10),s.lookAt(0,0,0);const a=new r({antialias:!0});a.setSize(window.innerWidth,window.innerHeight),a.shadowMap.enabled=!0,a.shadowMap.type=l,t.current.appendChild(a.domElement);const x=new c(4210752,.6);e.add(x);const j=new d(16777215,.8);j.position.set(10,10,5),j.castShadow=!0,e.add(j);const v=new m(20,20),y=new u({color:65280}),g=new h(v,y);g.rotation.x=-Math.PI/2,g.receiveShadow=!0,e.add(g);const f=new w(2,2,2),S=new u({color:16711680}),b=new h(f,S);b.position.set(0,1,0),b.castShadow=!0,e.add(b);const M=new p(1,32,32),N=new u({color:255}),P=new h(M,N);P.position.set(3,1,0),P.castShadow=!0,e.add(P);const k=()=>{requestAnimationFrame(k),b.rotation.x+=.01,b.rotation.y+=.01,P.rotation.y+=.02,a.render(e,s)};k();const C=()=>{s.aspect=window.innerWidth/window.innerHeight,s.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),t.current&&a.domElement&&t.current.removeChild(a.domElement),a.dispose()}},[]),e.jsx("div",{ref:t,style:{width:"100vw",height:"100vh",position:"absolute",top:0,left:0,zIndex:1}})}function y(){const{isPaused:t,pause:a,resume:n,restart:i,toggleCameraFollowMode:o,cameraState:r,playerPosition:l}=j(),[c,d]=s.useState(!1),[m,u]=s.useState(10);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"crosshair"}),e.jsx("div",{className:"game-message"}),t&&e.jsxs("div",{className:"pause-overlay",children:[e.jsx("h2",{children:"게임 일시정지"}),e.jsx("button",{onClick:n,className:"resume-btn",children:"계속하기"}),e.jsx("button",{onClick:i,className:"restart-btn",children:"재시작"})]}),e.jsxs("div",{className:"controls-info",children:[e.jsx("div",{children:"WASD: 이동"}),e.jsx("div",{children:"마우스: 카메라 회전"}),e.jsx("div",{children:"스크롤: 줌"}),e.jsx("div",{children:"ESC: 일시정지"}),e.jsxs("div",{children:["위치: (",Math.round(l.x),", ",Math.round(l.z),")"]})]}),e.jsx("button",{className:"sidebar-toggle-btn",onClick:()=>d(!c),children:"⚙️"}),e.jsxs("div",{className:"sidebar "+(c?"open":""),children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h3",{children:"게임 설정"}),e.jsx("button",{className:"close-btn",onClick:()=>d(!1),children:"✕"})]}),e.jsxs("div",{className:"sidebar-content",children:[e.jsxs("div",{className:"section",children:[e.jsx("h4",{children:"플레이어 모델"}),e.jsx("input",{type:"file",accept:".glb,.gltf",onChange:e=>{e.target.files[0]},style:{display:"none"},id:"model-file-input"}),e.jsx("button",{className:"upload-btn",onClick:()=>document.getElementById("model-file-input").click(),children:"모델 업로드"}),e.jsx("button",{className:"reset-btn",onClick:()=>{window.confirm("캐릭터를 기본 모델로 되돌리시겠습니까?")},children:"기본 모델로 리셋"}),e.jsx("div",{className:"model-info",children:"기본 모델 사용 중"})]}),e.jsxs("div",{className:"section",children:[e.jsxs("h4",{children:["나무 개수: ",m]}),e.jsx("input",{type:"range",min:"0",max:"20",value:m,onChange:e=>{const s=parseInt(e.target.value,10);u(s)},className:"slider"})]}),e.jsxs("div",{className:"section",children:[e.jsx("h4",{children:"카메라"}),e.jsx("button",{className:"camera-btn "+(r.followMode?"active":""),onClick:o,children:r.followMode?"따라가기 모드":"고정 모드"})]}),e.jsxs("div",{className:"section",children:[e.jsx("h4",{children:"맵 선택"}),e.jsx("select",{className:"map-select",children:e.jsx("option",{value:"default",children:"기본 맵"})}),e.jsx("button",{className:"apply-map-btn",children:"맵 적용"})]})]})]})]})}function g(){const t=x(),{isLoading:a,setLoading:n,pause:i,restart:o,setKey:r}=j(),[l,c]=s.useState("게임 로딩 중...");return s.useEffect(()=>{(async()=>{try{c("게임 엔진 초기화 중..."),await new Promise(e=>setTimeout(e,1e3)),c("게임 준비 완료!"),setTimeout(()=>{n(!1)},500)}catch(e){c(`❌ 게임 로딩 실패: ${e.message}`)}})()},[n]),s.useEffect(()=>{const e=e=>{"Escape"===e.code&&i(),"KeyR"===e.code&&o(),"KeyH"===e.code&&t("/")};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[i,o,t]),s.useEffect(()=>{const e=document.querySelector("canvas");e&&e.addEventListener("click",()=>{e.requestPointerLock()})},[a]),e.jsxs("div",{className:"game-page",children:[a&&e.jsxs("div",{className:"loading-screen",children:[e.jsx("div",{className:"loader"}),e.jsx("p",{className:"loading-status",children:l})]}),!a&&e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx(y,{}),e.jsx("button",{className:"home-btn",onClick:()=>t("/"),title:"홈으로 돌아가기 (H)",children:"🏠"})]})]})}export{g as default};
