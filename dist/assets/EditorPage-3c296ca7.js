var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{_ as s,j as i}from"./index-87c3ef52.js";import{c as n,g as a,r,b as o,a as l}from"./react-vendor-773f2c06.js";import{h as c,i as A,T as d,j as h,k as u,l as p,m as g,n as m,b,o as f,p as v,q as y,d as C,r as x,s as I,t as w,V as E,u as B,v as S,I as Q,w as j,O as M,x as D,y as T,z as R,L as k,E as O,R as L,N as F,G as P,J as N,K as G,Q as _,U as z,X as U,Y as H,f as q,Z as K,_ as W,$ as V,a0 as Y,a1 as J,P as X,a2 as Z,a3 as $,a4 as ee,a5 as te,a6 as se,a7 as ie,a8 as ne,a9 as ae,aa as re,ab as oe,ac as le,ad as ce,ae as Ae,af as de,ag as he,ah as ue,ai as pe,aj as ge,ak as me,al as be,am as fe,an as ve,ao as ye,ap as Ce,aq as xe,ar as Ie,as as we,at as Ee,au as Be,av as Se,aw as Qe,ax as je,ay as Me,az as De,aA as Te,aB as Re,aC as ke,aD as Oe,H as Le,F as Fe,aE as Pe,aF as Ne,aG as Ge,aH as _e,aI as ze,aJ as Ue,B as He,aK as qe,aL as Ke,aM as We,aN as Ve,aO as Ye,g as Je,aP as Xe,e as Ze,aQ as $e,aR as et,aS as tt,aT as st,aU as it,aV as nt,aW as at,aX as rt,aY as ot,C as lt,aZ as ct,a_ as At,a$ as dt,b0 as ht,b1 as ut,b2 as pt,b3 as gt,b4 as mt,b5 as bt,b6 as ft,b7 as vt,b8 as yt,b9 as Ct,ba as xt,bb as It,bc as wt,bd as Et,be as Bt,bf as St,bg as Qt,bh as jt,bi as Mt,S as Dt,W as Tt,A as Rt,c as kt,bj as Ot,bk as Lt,bl as Ft,bm as Pt,bn as Nt,bo as Gt,M as _t,bp as zt,bq as Ut}from"./three-989b717a.js";import{c as Ht}from"./state-55578a0b.js";import{R as qt}from"./three-stdlib-87f034b1.js";import{u as Kt}from"./router-34a0800b.js";function Wt(e){let t,s,i,n=-1,a=0;for(let c=0;c<e.length;++c){const r=e[c];if(void 0===t&&(t=r.array.constructor),t!==r.array.constructor)return null;if(void 0===s&&(s=r.itemSize),s!==r.itemSize)return null;if(void 0===i&&(i=r.normalized),i!==r.normalized)return null;if(-1===n&&(n=r.gpuType),n!==r.gpuType)return null;a+=r.count*s}const r=new t(a),o=new A(r,s,i);let l=0;for(let c=0;c<e.length;++c){const t=e[c];if(t.isInterleavedBufferAttribute){const e=l/s;for(let i=0,n=t.count;i<n;i++)for(let a=0;a<s;a++){const s=t.getComponent(i,a);o.setComponent(i+e,a,s)}}else r.set(t.array,l);l+=t.count*s}return void 0!==n&&(o.gpuType=n),o}function Vt(e,t){if(t===d)return e;if(t===h||t===u){let s=e.getIndex();if(null===s){const t=[],i=e.getAttribute("position");if(void 0===i)return e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const i=s.count-2,n=[];if(t===h)for(let e=1;e<=i;e++)n.push(s.getX(0)),n.push(s.getX(e)),n.push(s.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(s.getX(e)),n.push(s.getX(e+1)),n.push(s.getX(e+2))):(n.push(s.getX(e+2)),n.push(s.getX(e+1)),n.push(s.getX(e)));n.length;const a=e.clone();return a.setIndex(n),a.clearGroups(),a}return e}class Yt extends p{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new ts(e)}),this.register(function(e){return new ss(e)}),this.register(function(e){return new ds(e)}),this.register(function(e){return new hs(e)}),this.register(function(e){return new us(e)}),this.register(function(e){return new ns(e)}),this.register(function(e){return new as(e)}),this.register(function(e){return new rs(e)}),this.register(function(e){return new os(e)}),this.register(function(e){return new es(e)}),this.register(function(e){return new ls(e)}),this.register(function(e){return new is(e)}),this.register(function(e){return new As(e)}),this.register(function(e){return new cs(e)}),this.register(function(e){return new Zt(e)}),this.register(function(e){return new ps(e)}),this.register(function(e){return new gs(e)})}load(e,t,s,i){const n=this;let a;if(""!==this.resourcePath)a=this.resourcePath;else if(""!==this.path){const t=g.extractUrlBase(e);a=g.resolveURL(t,this.path)}else a=g.extractUrlBase(e);this.manager.itemStart(e);const r=function(t){i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)},o=new m(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(s){try{n.parse(s,a,function(s){t(s),n.manager.itemEnd(e)},r)}catch(i){r(i)}},s,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let n;const a={},r={},o=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer){if(o.decode(new Uint8Array(e,0,4))===ms){try{a[Xt.KHR_BINARY_GLTF]=new vs(e)}catch(c){return void(i&&i(c))}n=JSON.parse(a[Xt.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(e))}else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new qs(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let A=0;A<this.pluginCallbacks.length;A++){const e=this.pluginCallbacks[A](l);e.name,r[e.name]=e,a[e.name]=!0}if(n.extensionsUsed)for(let A=0;A<n.extensionsUsed.length;++A){const e=n.extensionsUsed[A],t=n.extensionsRequired||[];switch(e){case Xt.KHR_MATERIALS_UNLIT:a[e]=new $t;break;case Xt.KHR_DRACO_MESH_COMPRESSION:a[e]=new ys(n,this.dracoLoader);break;case Xt.KHR_TEXTURE_TRANSFORM:a[e]=new Cs;break;case Xt.KHR_MESH_QUANTIZATION:a[e]=new xs;break;default:t.indexOf(e)>=0&&r[e]}}l.setExtensions(a),l.setPlugins(r),l.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,n){s.parse(e,t,i,n)})}}function Jt(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Xt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Zt{constructor(e){this.parser=e,this.name=Xt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const n=t.json,a=((n.extensions&&n.extensions[this.name]||{}).lights||[])[e];let r;const o=new b(16777215);void 0!==a.color&&o.setRGB(a.color[0],a.color[1],a.color[2],f);const l=void 0!==a.range?a.range:0;switch(a.type){case"directional":r=new C(o),r.target.position.set(0,0,-1),r.add(r.target);break;case"point":r=new y(o),r.distance=l;break;case"spot":r=new v(o),r.distance=l,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,r.angle=a.spot.outerConeAngle,r.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return r.position.set(0,0,0),r.decay=2,Ns(r,a),void 0!==a.intensity&&(r.intensity=a.intensity),r.name=t.createUniqueName(a.name||"light_"+e),i=Promise.resolve(r),t.cache.add(s,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return s._getNodeRef(t.cache,n,e)})}}let $t=class{constructor(){this.name=Xt.KHR_MATERIALS_UNLIT}getMaterialType(){return x}extendParams(e,t,s){const i=[];e.color=new b(1,1,1),e.opacity=1;const n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],f),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(s.assignTexture(e,"map",n.baseColorTexture,I))}return Promise.all(i)}},es=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}},ts=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(s.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(s.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(s.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new E(e,e)}return Promise.all(n)}},ss=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}},is=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(s.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(s.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}},ns=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[];t.sheenColor=new b(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=i.extensions[this.name];if(void 0!==a.sheenColorFactor){const e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],f)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(s.assignTexture(t,"sheenColorMap",a.sheenColorTexture,I)),void 0!==a.sheenRoughnessTexture&&n.push(s.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}},as=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}},rs=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(s.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return t.attenuationColor=(new b).setRGB(r[0],r[1],r[2],f),Promise.all(n)}},os=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}},ls=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(s.assignTexture(t,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return t.specularColor=(new b).setRGB(r[0],r[1],r[2],f),void 0!==a.specularColorTexture&&n.push(s.assignTexture(t,"specularColorMap",a.specularColorTexture,I)),Promise.all(n)}},cs=class{constructor(e){this.parser=e,this.name=Xt.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(s.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}},As=class{constructor(e){this.parser=e,this.name=Xt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?w:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(s.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}};class ds{constructor(e){this.parser=e,this.name=Xt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const n=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,a)}}class hs{constructor(e){this.parser=e,this.name=Xt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const a=n.extensions[t],r=i.images[a.source];let o=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class us{constructor(e){this.parser=e,this.name=Xt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;const a=n.extensions[t],r=i.images[a.source];let o=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class ps{constructor(e){this.name=Xt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(t){const s=e.byteOffset||0,i=e.byteLength||0,a=e.count,r=e.byteStride,o=new Uint8Array(t,s,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,r,o,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){const t=new ArrayBuffer(a*r);return n.decodeGltfBuffer(new Uint8Array(t),a,r,o,e.mode,e.filter),t})})}return null}}let gs=class{constructor(e){this.name=Xt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const i=t.meshes[s.mesh];for(const o of i.primitives)if(o.mode!==Bs.TRIANGLES&&o.mode!==Bs.TRIANGLE_STRIP&&o.mode!==Bs.TRIANGLE_FAN&&void 0!==o.mode)return null;const n=s.extensions[this.name].attributes,a=[],r={};for(const o in n)a.push(this.parser.getDependency("accessor",n[o]).then(e=>(r[o]=e,r[o])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{const t=e.pop(),s=t.isGroup?t.children:[t],i=e[0].count,n=[];for(const a of s){const e=new B,t=new S,s=new ae,o=new S(1,1,1),l=new Q(a.geometry,a.material,i);for(let n=0;n<i;n++)r.TRANSLATION&&t.fromBufferAttribute(r.TRANSLATION,n),r.ROTATION&&s.fromBufferAttribute(r.ROTATION,n),r.SCALE&&o.fromBufferAttribute(r.SCALE,n),l.setMatrixAt(n,e.compose(t,s,o));for(const i in r)if("_COLOR_0"===i){const e=r[i];l.instanceColor=new j(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==i&&"ROTATION"!==i&&"SCALE"!==i&&a.geometry.setAttribute(i,r[i]);M.prototype.copy.call(l,a),this.parser.assignFinalMaterial(l),n.push(l)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]}))}};const ms="glTF",bs=1313821514,fs=5130562;class vs{constructor(e){this.name=Xt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ms)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-12,n=new DataView(e,12);let a=0;for(;a<i;){const t=n.getUint32(a,!0);a+=4;const i=n.getUint32(a,!0);if(a+=4,i===bs){const i=new Uint8Array(e,12+a,t);this.content=s.decode(i)}else if(i===fs){const s=12+a;this.body=e.slice(s,s+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ys{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Xt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,r={},o={},l={};for(const c in a){const e=Ds[c]||c.toLowerCase();r[e]=a[c]}for(const c in e.attributes){const t=Ds[c]||c.toLowerCase();if(void 0!==a[c]){const i=s.accessors[e.attributes[c]],n=Ss[i.componentType];l[t]=n.name,o[t]=!0===i.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t,s){i.decodeDracoFile(e,function(e){for(const t in e.attributes){const s=e.attributes[t],i=o[t];void 0!==i&&(s.normalized=i)}t(e)},r,l,f,s)})})}}class Cs{constructor(){this.name=Xt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class xs{constructor(){this.name=Xt.KHR_MESH_QUANTIZATION}}class Is extends ye{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let a=0;a!==i;a++)t[a]=s[n+a];return t}interpolate_(e,t,s,i){const n=this.resultBuffer,a=this.sampleValues,r=this.valueSize,o=2*r,l=3*r,c=i-t,A=(s-t)/c,d=A*A,h=d*A,u=e*l,p=u-l,g=-2*h+3*d,m=h-d,b=1-g,f=m-d+A;for(let v=0;v!==r;v++){const e=a[p+v+r],t=a[p+v+o]*c,s=a[u+v+r],i=a[u+v]*c;n[v]=b*e+f*t+g*s+m*i}return n}}const ws=new ae;class Es extends Is{interpolate_(e,t,s,i){const n=super.interpolate_(e,t,s,i);return ws.fromArray(n).normalize().toArray(n),n}}const Bs={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ss={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qs={9728:F,9729:k,9984:re,9985:oe,9986:le,9987:O},js={33071:ce,33648:Ae,10497:L},Ms={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ds={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ts={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Rs={CUBICSPLINE:void 0,LINEAR:ie,STEP:de},ks="OPAQUE",Os="MASK",Ls="BLEND";function Fs(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new _({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:he})),e.DefaultMaterial}function Ps(e,t,s){for(const i in s.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=s.extensions[i])}function Ns(e,t){void 0!==t.extras&&"object"==typeof t.extras&&Object.assign(e.userData,t.extras)}function Gs(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,i=t.weights.length;s<i;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,i=s.length;t<i;t++)e.morphTargetDictionary[s[t]]=t}}}function _s(e){let t;const s=e.extensions&&e.extensions[Xt.KHR_DRACO_MESH_COMPRESSION];if(t=s?"draco:"+s.bufferView+":"+s.indices+":"+zs(s.attributes):e.indices+":"+zs(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,n=e.targets.length;i<n;i++)t+=":"+zs(e.targets[i]);return t}function zs(e){let t="";const s=Object.keys(e).sort();for(let i=0,n=s.length;i<n;i++)t+=s[i]+":"+e[s[i]]+";";return t}function Us(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Hs=new B;class qs{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Jt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=-1,n=!1,a=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;s=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);i=s&&t?parseInt(t[1],10):-1,n=e.indexOf("Firefox")>-1,a=n?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||s&&i<17||n&&a<98?this.textureLoader=new D(this.options.manager):this.textureLoader=new T(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new m(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(t){const a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:s,userData:{}};return Ps(n,a,i),Ns(a,i),Promise.all(s._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){for(const e of a.scenes)e.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){const s=t[i].joints;for(let t=0,i=s.length;t<i;t++)e[s[t]].isBone=!0}for(let i=0,n=e.length;i<n;i++){const t=e[i];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(s[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),n=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[i,a]of e.children.entries())n(a,t.children[i])};return n(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const n=e(t[i]);n&&s.push(n)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Xt.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,n){s.load(g.resolveURL(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){const s=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+s)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=Ms[i.type],t=Ss[i.componentType],s=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new A(n,e,s))}const n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){const n=e[0],a=Ms[i.type],r=Ss[i.componentType],o=r.BYTES_PER_ELEMENT,l=o*a,c=i.byteOffset||0,d=void 0!==i.bufferView?s.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let u,p;if(d&&d!==l){const e=Math.floor(c/d),s="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let l=t.cache.get(s);l||(u=new r(n,e*d,i.count*d/o),l=new R(u,d/o),t.cache.add(s,l)),p=new ue(l,a,c%d/o,h)}else u=null===n?new r(i.count*a):new r(n,c,i.count*a),p=new A(u,a,h);if(void 0!==i.sparse){const t=Ms.SCALAR,s=Ss[i.sparse.indices.componentType],o=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,c=new s(e[1],o,i.sparse.count*t),d=new r(e[2],l,i.sparse.count*a);null!==n&&(p=new A(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let e=0,i=c.length;e<i;e++){const t=c[e];if(p.setX(t,d[e*a]),a>=2&&p.setY(t,d[e*a+1]),a>=3&&p.setZ(t,d[e*a+2]),a>=4&&p.setW(t,d[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=h}return p})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,n=t.images[i];let a=this.textureLoader;if(n.uri){const e=s.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,s){const i=this,n=this.json,a=n.textures[e],r=n.images[t],o=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const l=this.loadImageSource(t,s).then(function(t){t.flipY=!1,t.name=a.name||r.name||"",""===t.name&&"string"==typeof r.uri&&!1===r.uri.startsWith("data:image/")&&(t.name=r.uri);const s=(n.samplers||{})[a.sampler]||{};return t.magFilter=Qs[s.magFilter]||k,t.minFilter=Qs[s.minFilter]||O,t.wrapS=js[s.wrapS]||L,t.wrapT=js[s.wrapT]||L,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==F&&t.minFilter!==k,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[o]=l,l}loadImageSource(e,t){const s=this,i=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());const a=i.images[e],r=self.URL||self.webkitURL;let o=a.uri||"",l=!1;if(void 0!==a.bufferView)o=s.getDependency("bufferView",a.bufferView).then(function(e){l=!0;const t=new Blob([e],{type:a.mimeType});return o=r.createObjectURL(t),o});else if(void 0===a.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(o).then(function(e){return new Promise(function(s,i){let a=s;!0===t.isImageBitmapLoader&&(a=function(e){const t=new pe(e);t.needsUpdate=!0,s(t)}),t.load(g.resolveURL(e,n.path),a,void 0,i)})}).then(function(e){var t;return!0===l&&r.revokeObjectURL(o),Ns(e,a),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e}).catch(function(e){throw e});return this.sourceCache[e]=c,c}assignTexture(e,t,s,i){const n=this;return this.getDependency("texture",s.index).then(function(a){if(!a)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((a=a.clone()).channel=s.texCoord),n.extensions[Xt.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[Xt.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(a);a=n.extensions[Xt.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==i&&(a.colorSpace=i),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new P,N.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new G,N.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,this.cache.add(e,t)),s=t}if(i||n||a){let e="ClonedMaterial:"+s.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return _}loadMaterial(e){const t=this,s=this.json,i=this.extensions,n=s.materials[e];let a;const r={},o=[];if((n.extensions||{})[Xt.KHR_MATERIALS_UNLIT]){const e=i[Xt.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),o.push(e.extendParams(r,n,t))}else{const s=n.pbrMetallicRoughness||{};if(r.color=new b(1,1,1),r.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;r.color.setRGB(e[0],e[1],e[2],f),r.opacity=e[3]}void 0!==s.baseColorTexture&&o.push(t.assignTexture(r,"map",s.baseColorTexture,I)),r.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,r.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(o.push(t.assignTexture(r,"metalnessMap",s.metallicRoughnessTexture)),o.push(t.assignTexture(r,"roughnessMap",s.metallicRoughnessTexture))),a=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),o.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,r)})))}!0===n.doubleSided&&(r.side=z);const l=n.alphaMode||ks;if(l===Ls?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,l===Os&&(r.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&a!==x&&(o.push(t.assignTexture(r,"normalMap",n.normalTexture)),r.normalScale=new E(1,1),void 0!==n.normalTexture.scale)){const e=n.normalTexture.scale;r.normalScale.set(e,e)}if(void 0!==n.occlusionTexture&&a!==x&&(o.push(t.assignTexture(r,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(r.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&a!==x){const e=n.emissiveFactor;r.emissive=(new b).setRGB(e[0],e[1],e[2],f)}return void 0!==n.emissiveTexture&&a!==x&&o.push(t.assignTexture(r,"emissiveMap",n.emissiveTexture,I)),Promise.all(o).then(function(){const s=new a(r);return n.name&&(s.name=n.name),Ns(s,n),t.associations.set(s,{materials:e}),n.extensions&&Ps(i,s,n),s})}createUniqueName(e){const t=U.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function n(e){return s[Xt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(s){return Ks(s,e,t)})}const a=[];for(let r=0,o=e.length;r<o;r++){const s=e[r],o=_s(s),l=i[o];if(l)a.push(l.promise);else{let e;e=s.extensions&&s.extensions[Xt.KHR_DRACO_MESH_COMPRESSION]?n(s):Ks(new c,s,t),i[o]={primitive:s,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,s=this.json,i=this.extensions,n=s.meshes[e],a=n.primitives,r=[];for(let o=0,l=a.length;o<l;o++){const e=void 0===a[o].material?Fs(this.cache):this.getDependency("material",a[o].material);r.push(e)}return r.push(t.loadGeometries(a)),Promise.all(r).then(function(s){const r=s.slice(0,s.length-1),o=s[s.length-1],l=[];for(let A=0,d=o.length;A<d;A++){const s=o[A],c=a[A];let d;const p=r[A];if(c.mode===Bs.TRIANGLES||c.mode===Bs.TRIANGLE_STRIP||c.mode===Bs.TRIANGLE_FAN||void 0===c.mode)d=!0===n.isSkinnedMesh?new H(s,p):new q(s,p),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),c.mode===Bs.TRIANGLE_STRIP?d.geometry=Vt(d.geometry,u):c.mode===Bs.TRIANGLE_FAN&&(d.geometry=Vt(d.geometry,h));else if(c.mode===Bs.LINES)d=new K(s,p);else if(c.mode===Bs.LINE_STRIP)d=new W(s,p);else if(c.mode===Bs.LINE_LOOP)d=new V(s,p);else{if(c.mode!==Bs.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);d=new Y(s,p)}Object.keys(d.geometry.morphAttributes).length>0&&Gs(d,n),d.name=t.createUniqueName(n.name||"mesh_"+e),Ns(d,n),c.extensions&&Ps(i,d,c),t.assignFinalMaterial(d),l.push(d)}for(let i=0,n=l.length;i<n;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return n.extensions&&Ps(i,l[0],n),l[0];const c=new J;n.extensions&&Ps(i,c,n),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(i)return"perspective"===s.type?t=new X(Z.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===s.type&&(t=new $(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),Ns(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let i=0,n=t.joints.length;i<n;i++)s.push(this._loadNodeShallow(t.joints[i]));return void 0!==t.inverseBindMatrices?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(e){const t=e.pop(),s=e,i=[],n=[];for(let a=0,r=s.length;a<r;a++){const e=s[a];if(e){i.push(e);const s=new B;null!==t&&s.fromArray(t.array,16*a),n.push(s)}}return new ee(i,n)})}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,a=[],r=[],o=[],l=[],c=[];for(let A=0,d=i.channels.length;A<d;A++){const e=i.channels[A],t=i.samplers[e.sampler],s=e.target,n=s.node,d=void 0!==i.parameters?i.parameters[t.input]:t.input,h=void 0!==i.parameters?i.parameters[t.output]:t.output;void 0!==s.node&&(a.push(this.getDependency("node",n)),r.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",h)),l.push(t),c.push(s))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(e){const t=e[0],i=e[1],a=e[2],r=e[3],o=e[4],l=[];for(let n=0,c=t.length;n<c;n++){const e=t[n],c=i[n],A=a[n],d=r[n],h=o[n];if(void 0===e)continue;e.updateMatrix&&e.updateMatrix();const u=s._createAnimationTracks(e,c,A,d,h);if(u)for(let t=0;t<u.length;t++)l.push(u[t])}return new te(n,void 0,l)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return void 0===i.mesh?null:s.getDependency("mesh",i.mesh).then(function(e){const t=s._getNodeRef(s.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){const t=this,s=this.json.nodes[e],i=t._loadNodeShallow(e),n=[],a=s.children||[];for(let o=0,l=a.length;o<l;o++)n.push(t.getDependency("node",a[o]));const r=void 0===s.skin?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([i,Promise.all(n),r]).then(function(e){const t=e[0],s=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,Hs)});for(let n=0,a=s.length;n<a;n++)t.add(s[n]);return t})}_loadNodeShallow(e){const t=this.json,s=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const n=t.nodes[e],a=n.name?i.createUniqueName(n.name):"",r=[],o=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return o&&r.push(o),void 0!==n.camera&&r.push(i.getDependency("camera",n.camera).then(function(e){return i._getNodeRef(i.cameraCache,n.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){r.push(e)}),this.nodeCache[e]=Promise.all(r).then(function(t){let r;if(r=!0===n.isBone?new se:t.length>1?new J:1===t.length?t[0]:new M,r!==t[0])for(let e=0,s=t.length;e<s;e++)r.add(t[e]);if(n.name&&(r.userData.name=n.name,r.name=a),Ns(r,n),n.extensions&&Ps(s,r,n),void 0!==n.matrix){const e=new B;e.fromArray(n.matrix),r.applyMatrix4(e)}else void 0!==n.translation&&r.position.fromArray(n.translation),void 0!==n.rotation&&r.quaternion.fromArray(n.rotation),void 0!==n.scale&&r.scale.fromArray(n.scale);return i.associations.has(r)||i.associations.set(r,{}),i.associations.get(r).nodes=e,r}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,n=new J;s.name&&(n.name=i.createUniqueName(s.name)),Ns(n,s),s.extensions&&Ps(t,n,s);const a=s.nodes||[],r=[];for(let o=0,l=a.length;o<l;o++)r.push(i.getDependency("node",a[o]));return Promise.all(r).then(function(e){for(let t=0,s=e.length;t<s;t++)n.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[s,n]of i.associations)(s instanceof N||s instanceof pe)&&t.set(s,n);return e.traverse(e=>{const s=i.associations.get(e);null!=s&&t.set(e,s)}),t})(n),n})}_createAnimationTracks(e,t,s,i,n){const a=[],r=e.name?e.name:e.uuid,o=[];let l;switch(Ts[n.path]===Ts.weights?e.traverse(function(e){e.morphTargetInfluences&&o.push(e.name?e.name:e.uuid)}):o.push(r),Ts[n.path]){case Ts.weights:l=me;break;case Ts.rotation:l=be;break;case Ts.position:case Ts.scale:l=ge;break;default:if(1===s.itemSize)l=me;else l=ge}const c=void 0!==i.interpolation?Rs[i.interpolation]:ie,A=this._getArrayFromAccessor(s);for(let d=0,h=o.length;d<h;d++){const e=new l(o[d]+"."+Ts[n.path],t.array,A,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(e),a.push(e)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Us(t.constructor),s=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)s[i]=t[i]*e;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof be?Es:Is)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ks(e,t,s){const i=t.attributes,n=[];function a(t,i){return s.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(const r in i){const t=Ds[r]||r.toLowerCase();t in e.attributes||n.push(a(i[r],t))}if(void 0!==t.indices&&!e.index){const i=s.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(i)}return ne.workingColorSpace,Ns(e,t),function(e,t,s){const i=t.attributes,n=new fe;if(void 0===i.POSITION)return;{const e=s.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return;if(n.set(new S(t[0],t[1],t[2]),new S(a[0],a[1],a[2])),e.normalized){const t=Us(Ss[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new S,t=new S;for(let i=0,n=a.length;i<n;i++){const n=a[i];if(void 0!==n.POSITION){const i=s.json.accessors[n.POSITION],a=i.min,r=i.max;if(void 0!==a&&void 0!==r){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(r[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(r[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(r[2]))),i.normalized){const e=Us(Ss[i.componentType]);t.multiplyScalar(e)}e.max(t)}}}n.expandByVector(e)}e.boundingBox=n;const r=new ve;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=r}(e,t,s),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,s){let i=!1,n=!1,a=!1;for(let c=0,A=t.length;c<A;c++){const e=t[c];if(void 0!==e.POSITION&&(i=!0),void 0!==e.NORMAL&&(n=!0),void 0!==e.COLOR_0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(e);const r=[],o=[],l=[];for(let c=0,A=t.length;c<A;c++){const A=t[c];if(i){const t=void 0!==A.POSITION?s.getDependency("accessor",A.POSITION):e.attributes.position;r.push(t)}if(n){const t=void 0!==A.NORMAL?s.getDependency("accessor",A.NORMAL):e.attributes.normal;o.push(t)}if(a){const t=void 0!==A.COLOR_0?s.getDependency("accessor",A.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(l)]).then(function(t){const s=t[0],r=t[1],o=t[2];return i&&(e.morphAttributes.position=s),n&&(e.morphAttributes.normal=r),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,s):e})}const Ws=new WeakMap;class Vs extends p{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,i){const n=new m(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{this.parse(e,t,i)},s,i)}parse(e,t,s=()=>{}){this.decodeDracoFile(e,t,null,null,I,s).catch(s)}decodeDracoFile(e,t,s,i,n=f,a=()=>{}){const r={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:n};return this.decodeGeometry(e,r).then(t).catch(a)}decodeGeometry(e,t){const s=JSON.stringify(t);if(Ws.has(e)){const t=Ws.get(e);if(t.key===s)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const n=this.workerNextTaskID++,a=e.byteLength,r=this._getWorker(n,a).then(s=>(i=s,new Promise((s,a)=>{i._callbacks[n]={resolve:s,reject:a},i.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return r.catch(()=>!0).then(()=>{i&&n&&this._releaseTask(i,n)}),Ws.set(e,{key:s,promise:r}),r}_createGeometry(e){const t=new c;e.index&&t.setIndex(new A(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const i=e.attributes[s],n=i.name,a=i.array,r=i.itemSize,o=new A(a,r);"color"===n&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=a instanceof Float32Array==!1),t.setAttribute(n,o)}return t}_assignVertexColorSpace(e,t){if(t!==I)return;const s=new b;for(let i=0,n=e.count;i<n;i++)s.fromBufferAttribute(e,i),ne.toWorkingColorSpace(s,I),e.setXYZ(i,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new m(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((t,i)=>{s.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const s=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=Ys.toString(),n=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const s=t.data;switch(s.type){case"decode":e._callbacks[s.id].resolve(s);break;case"error":e._callbacks[s.id].reject(s)}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Ys(){let e,t;function s(e,t,s,i,n,a){const r=a.num_components(),o=s.num_points()*r,l=o*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),A=e._malloc(l);t.GetAttributeDataArrayForAllPoints(s,a,c,l,A);const d=new n(e.HEAPF32.buffer,A,o).slice();return e._free(A),{name:i,array:d,itemSize:r}}onmessage=function(i){const n=i.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":const i=n.buffer,a=n.taskConfig;t.then(e=>{const t=e.draco,r=new t.Decoder;try{const e=function(e,t,i,n){const a=n.attributeIDs,r=n.attributeTypes;let o,l;const c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)o=new e.Mesh,l=t.DecodeArrayToMesh(i,i.byteLength,o);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new e.PointCloud,l=t.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const A={index:null,attributes:[]};for(const d in a){const i=self[r[d]];let l,c;if(n.useUniqueIDs)c=a[d],l=t.GetAttributeByUniqueId(o,c);else{if(c=t.GetAttributeId(o,e[a[d]]),-1===c)continue;l=t.GetAttribute(o,c)}const h=s(e,t,o,d,i,l);"color"===d&&(h.vertexColorSpace=n.vertexColorSpace),A.attributes.push(h)}c===e.TRIANGULAR_MESH&&(A.index=function(e,t,s){const i=s.num_faces(),n=3*i,a=4*n,r=e._malloc(a);t.GetTrianglesUInt32Array(s,a,r);const o=new Uint32Array(e.HEAPF32.buffer,r,n).slice();return e._free(r),{array:o,itemSize:1}}(e,t,o));return e.destroy(o),A}(t,r,new Int8Array(i),a),o=e.attributes.map(e=>e.array.buffer);e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},o)}catch(o){self.postMessage({type:"error",id:n.id,error:o.message})}finally{t.destroy(r)}})}}}class Js{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:t,msg:s,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(s,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(s=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=s,this.workers[i].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Xs=9,Zs=15,$s=16,ei=22,ti=37,si=43,ii=76,ni=83,ai=97,ri=100,oi=103,li=109,ci=165,Ai=166,di=1000066e3;class hi{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class ui{constructor(e,t,s,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const s=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,i)}}const pi=[171,75,84,88,32,50,48,187,13,10,26,10];function gi(e){return(new TextDecoder).decode(e)}let mi,bi,fi;const vi={env:{emscripten_notify_memory_growth:function(e){fi=new Uint8Array(bi.exports.memory.buffer)}}};class yi{init(){return mi||(mi="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Ci).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,vi)).then(this._init):WebAssembly.instantiate(Buffer.from(Ci,"base64"),vi).then(this._init),mi)}_init(e){bi=e.instance,vi.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!bi)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,i=bi.exports.malloc(s);fi.set(e,i),t=t||Number(bi.exports.ZSTD_findDecompressedSize(i,s));const n=bi.exports.malloc(t),a=bi.exports.ZSTD_decompress(n,t,i,s),r=fi.slice(n,n+a);return bi.exports.free(i),bi.exports.free(n),r}}const Ci="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",xi=new WeakMap;let Ii;class wi extends p{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Js,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new m(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new m(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([e,t])=>{const s=wi.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(wi.EngineFormat),"let _EngineType = "+JSON.stringify(wi.EngineType),"let _TranscoderFormat = "+JSON.stringify(wi.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(wi.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})})}return this.transcoderPending}load(e,t,s,i){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const n=new m(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,e=>{this.parse(e,t,i)},s,i)}parse(e,t,s){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(xi.has(e)){return xi.get(e).promise.then(t).catch(s)}this._createTexture(e).then(e=>t?t(e):null).catch(s)}_createTextureFrom(e,t){const{type:s,error:i,data:{faces:n,width:a,height:r,format:o,type:l,dfdFlags:c}}=e;if("error"===s)return Promise.reject(i);let A;if(6===t.faceCount)A=new Ce(n,o,l);else{const e=n[0].mipmaps;A=t.layerCount>1?new xe(e,a,r,t.layerCount,o,l):new Ie(e,a,r,o,l)}return A.minFilter=1===n[0].mipmaps.length?k:O,A.magFilter=k,A.generateMipmaps=!1,A.needsUpdate=!0,A.colorSpace=Qi(t),A.premultiplyAlpha=!!(1&c),A}async _createTexture(e,t={}){const s=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,pi.length);if(t[0]!==pi[0]||t[1]!==pi[1]||t[2]!==pi[2]||t[3]!==pi[3]||t[4]!==pi[4]||t[5]!==pi[5]||t[6]!==pi[6]||t[7]!==pi[7]||t[8]!==pi[8]||t[9]!==pi[9]||t[10]!==pi[10]||t[11]!==pi[11])throw new Error("Missing KTX 2.0 identifier.");const s=new hi,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new ui(e,pi.length,i,!0);s.vkFormat=n._nextUint32(),s.typeSize=n._nextUint32(),s.pixelWidth=n._nextUint32(),s.pixelHeight=n._nextUint32(),s.pixelDepth=n._nextUint32(),s.layerCount=n._nextUint32(),s.faceCount=n._nextUint32();const a=n._nextUint32();s.supercompressionScheme=n._nextUint32();const r=n._nextUint32(),o=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),A=n._nextUint64(),d=n._nextUint64(),h=new ui(e,pi.length+i,3*a*8,!0);for(let R=0;R<a;R++)s.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+h._nextUint64(),h._nextUint64()),uncompressedByteLength:h._nextUint64()});const u=new ui(e,r,o,!0),p={vendorId:u._skip(4)._nextUint16(),descriptorType:u._nextUint16(),versionNumber:u._nextUint16(),descriptorBlockSize:u._nextUint16(),colorModel:u._nextUint8(),colorPrimaries:u._nextUint8(),transferFunction:u._nextUint8(),flags:u._nextUint8(),texelBlockDimension:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],bytesPlane:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],samples:[]},g=(p.descriptorBlockSize/4-6)/4;for(let R=0;R<g;R++){const e={bitOffset:u._nextUint16(),bitLength:u._nextUint8(),channelType:u._nextUint8(),samplePosition:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=u._nextInt32(),e.sampleUpper=u._nextInt32()):(e.sampleLower=u._nextUint32(),e.sampleUpper=u._nextUint32()),p.samples[R]=e}s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(p);const m=new ui(e,l,c,!0);for(;m._offset<c;){const e=m._nextUint32(),t=m._scan(e),i=gi(t);if(s.keyValue[i]=m._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){const e=gi(s.keyValue[i]);s.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}m._skip(e%4?4-e%4:0)}if(d<=0)return s;const b=new ui(e,A,d,!0),f=b._nextUint16(),v=b._nextUint16(),y=b._nextUint32(),C=b._nextUint32(),x=b._nextUint32(),I=b._nextUint32(),w=[];for(let R=0;R<a;R++)w.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const E=A+b._offset,B=E+y,S=B+C,Q=S+x,j=new Uint8Array(e.buffer,e.byteOffset+E,y),M=new Uint8Array(e.buffer,e.byteOffset+B,C),D=new Uint8Array(e.buffer,e.byteOffset+S,x),T=new Uint8Array(e.buffer,e.byteOffset+Q,I);return s.globalData={endpointCount:f,selectorCount:v,imageDescs:w,endpointsData:j,selectorsData:M,tablesData:D,extendedData:T},s}(new Uint8Array(e)),i=s.vkFormat===di&&167===s.dataFormatDescriptor[0].colorModel;if(!(0===s.vkFormat||i&&!this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===Bi[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let s;2===e.supercompressionScheme&&(Ii||(Ii=new Promise(async e=>{const t=new yi;await t.init(),e(t)})),s=await Ii);const i=[];for(let a=0;a<e.levels.length;a++){const n=Math.max(1,e.pixelWidth>>a),r=Math.max(1,e.pixelHeight>>a),o=e.pixelDepth?Math.max(1,e.pixelDepth>>a):0,l=e.levels[a];let c,A;if(0===e.supercompressionScheme)c=l.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=s.decode(l.levelData,l.uncompressedByteLength)}A=Si[t]===Fe?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):Si[t]===Le?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,i.push({data:A,width:n,height:r,depth:o})}let n;if(Ei.has(Bi[t]))n=0===e.pixelDepth?new Pe(i[0].data,e.pixelWidth,e.pixelHeight):new Ne(i[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");n=new Ie(i,e.pixelWidth,e.pixelHeight)}return n.mipmaps=i,n.type=Si[t],n.format=Bi[t],n.colorSpace=Qi(e),n.needsUpdate=!0,Promise.resolve(n)}(s);const n=t,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(e=>this._createTextureFrom(e.data,s));return xi.set(e,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}wi.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},wi.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},wi.EngineFormat={RGBAFormat:we,RGBA_ASTC_4x4_Format:Ee,RGB_BPTC_UNSIGNED_Format:Be,RGBA_BPTC_Format:Se,RGBA_ETC2_EAC_Format:Qe,RGBA_PVRTC_4BPPV1_Format:je,RGBA_S3TC_DXT5_Format:Me,RGB_ETC1_Format:De,RGB_ETC2_Format:Te,RGB_PVRTC_4BPPV1_Format:Re,RGBA_S3TC_DXT1_Format:ke},wi.EngineType={UnsignedByteType:Oe,HalfFloatType:Le,FloatType:Fe},wi.BasisWorker=function(){let e,t,s;const i=_EngineFormat,n=_EngineType,a=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(i){const a=i.data;switch(a.type){case"init":e=a.config,o=a.transcoderBinary,t=new Promise(e=>{s={wasmBinary:o,onRuntimeInitialized:e},BASIS(s)}).then(()=>{s.initializeBasis(),s.KTX2File});break;case"transcode":t.then(()=>{try{const{faces:t,buffers:i,width:o,height:d,hasAlpha:h,format:u,type:p,dfdFlags:g}=function(t){const i=new s.KTX2File(new Uint8Array(t));function a(){i.close(),i.delete()}if(!i.isValid())throw a(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let o;if(i.isUASTC())o=r.UASTC;else if(i.isETC1S())o=r.ETC1S;else{if(!i.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");o=r.UASTC_HDR}const d=i.getWidth(),h=i.getHeight(),u=i.getLayers()||1,p=i.getLevels(),g=i.getFaces(),m=i.getHasAlpha(),b=i.getDFDFlags(),{transcoderFormat:f,engineFormat:v,engineType:y}=function(t,s,i,n){const a=l[t];for(let r=0;r<a.length;r++){const o=a[r];if(o.if&&!e[o.if])continue;if(!o.basisFormat.includes(t))continue;if(n&&o.transcoderFormat.length<2)continue;if(o.needsPowerOfTwo&&(!c(s)||!c(i)))continue;return{transcoderFormat:o.transcoderFormat[n?1:0],engineFormat:o.engineFormat[n?1:0],engineType:o.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(o,d,h,m);if(!d||!h||!p)throw a(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!i.startTranscoding())throw a(),new Error("THREE.KTX2Loader: .startTranscoding failed");const C=[],x=[];for(let e=0;e<g;e++){const t=[];for(let s=0;s<p;s++){const r=[];let o,l;for(let t=0;t<u;t++){const c=i.getImageLevelInfo(s,t,e);0===e&&0===s&&0===t&&(c.origWidth%4!=0||c.origHeight),p>1?(o=c.origWidth,l=c.origHeight):(o=c.width,l=c.height);let A=new Uint8Array(i.getImageTranscodedSizeInBytes(s,t,0,f));const d=i.transcodeImage(A,s,t,e,f,0,-1,-1);if(y===n.HalfFloatType&&(A=new Uint16Array(A.buffer,A.byteOffset,A.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!d)throw a(),new Error("THREE.KTX2Loader: .transcodeImage failed.");r.push(A)}const c=A(r);t.push({data:c,width:o,height:l}),x.push(c.buffer)}C.push({mipmaps:t,width:d,height:h,format:v,type:y})}return a(),{faces:C,buffers:x,width:d,height:h,hasAlpha:m,dfdFlags:b,format:v,type:y}}(a.buffer);self.postMessage({type:"transcode",id:a.id,data:{faces:t,width:o,height:d,hasAlpha:h,format:u,type:p,dfdFlags:g}},i)}catch(t){self.postMessage({type:"error",id:a.id,error:t.message})}})}var o});const o=[{if:"astcSupported",basisFormat:[r.UASTC],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[n.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[n.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.BC1,a.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[n.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[n.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[n.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[n.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[r.UASTC_HDR],transcoderFormat:[a.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[n.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[r.ETC1S,r.UASTC],transcoderFormat:[a.RGBA32,a.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[n.UnsignedByteType,n.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[r.UASTC_HDR],transcoderFormat:[a.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[n.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[r.ETC1S]:o.filter(e=>e.basisFormat.includes(r.ETC1S)).sort((e,t)=>e.priorityUASTC-t.priorityUASTC),[r.UASTC]:o.filter(e=>e.basisFormat.includes(r.UASTC)).sort((e,t)=>e.priorityUASTC-t.priorityUASTC),[r.UASTC_HDR]:o.filter(e=>e.basisFormat.includes(r.UASTC_HDR)).sort((e,t)=>e.priorityHDR-t.priorityHDR)};function c(e){return e<=2||!(e&e-1)&&0!==e}function A(e){if(1===e.length)return e[0];let t=0;for(let n=0;n<e.length;n++){t+=e[n].byteLength}const s=new Uint8Array(t);let i=0;for(let n=0;n<e.length;n++){const t=e[n];s.set(t,i),i+=t.byteLength}return s}};const Ei=new Set([we,_e,ze]),Bi={[li]:we,[ai]:we,[ti]:we,[si]:we,[oi]:_e,[ni]:_e,[$s]:_e,[ei]:_e,[ri]:ze,[ii]:ze,[Zs]:ze,[Xs]:ze,[di]:Ee,[Ai]:Ue,[ci]:Ue},Si={[li]:Fe,[ai]:Le,[ti]:Oe,[si]:Oe,[oi]:Fe,[ni]:Le,[$s]:Oe,[ei]:Oe,[ri]:Fe,[ii]:Le,[Zs]:Oe,[Xs]:Oe,[di]:Le,[Ai]:Oe,[ci]:Oe};function Qi(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?I:f:10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(t.colorPrimaries,Ge)}var ji=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var s,i=WebAssembly.validate(e)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",n=WebAssembly.instantiate(a(i),{}).then(function(e){(s=e.instance).exports.__wasm_call_ctors()});function a(e){for(var s=new Uint8Array(e.length),i=0;i<e.length;++i){var n=e.charCodeAt(i);s[i]=n>96?n-97:n>64?n-39:n+4}var a=0;for(i=0;i<e.length;++i)s[a++]=s[i]<60?t[s[i]]:64*(s[i]-60)+s[++i];return s.buffer.slice(0,a)}function r(e,t,i,n,a,r){var o=s.exports.sbrk,l=i+3&-4,c=o(l*n),A=o(a.length),d=new Uint8Array(s.exports.memory.buffer);d.set(a,A);var h=e(c,i,n,A,a.length);if(0==h&&r&&r(c,l,n),t.set(d.subarray(c,c+i*n)),o(c-o(0)),0!=h)throw new Error("Malformed buffer data: "+h)}var o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},l={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],A=0;function d(e){var t={object:new Worker(e),pending:0,requests:{}};return t.object.onmessage=function(e){var s=e.data;t.pending-=s.count,t.requests[s.id][s.action](s.value),delete t.requests[s.id]},t}function h(e){for(var t="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+r.toString()+u.toString(),s=new Blob([t],{type:"text/javascript"}),n=URL.createObjectURL(s),o=0;o<e;++o)c[o]=d(n);URL.revokeObjectURL(n)}function u(e){n.then(function(){var t=e.data;try{var i=new Uint8Array(t.count*t.size);r(s.exports[t.mode],i,t.count,t.size,t.source,s.exports[t.filter]),self.postMessage({id:t.id,count:t.count,action:"resolve",value:i},[i.buffer])}catch(n){self.postMessage({id:t.id,count:t.count,action:"reject",value:n})}})}return{ready:n,supported:!0,useWorkers:function(e){h(e)},decodeVertexBuffer:function(e,t,i,n,a){r(s.exports.meshopt_decodeVertexBuffer,e,t,i,n,s.exports[o[a]])},decodeIndexBuffer:function(e,t,i,n){r(s.exports.meshopt_decodeIndexBuffer,e,t,i,n)},decodeIndexSequence:function(e,t,i,n){r(s.exports.meshopt_decodeIndexSequence,e,t,i,n)},decodeGltfBuffer:function(e,t,i,n,a,c){r(s.exports[l[a]],e,t,i,n,s.exports[o[c]])},decodeGltfBufferAsync:function(e,t,i,a,d){return c.length>0?function(e,t,s,i,n){for(var a=c[0],r=1;r<c.length;++r)c[r].pending<a.pending&&(a=c[r]);return new Promise(function(r,o){var l=new Uint8Array(s),c=A++;a.pending+=e,a.requests[c]={resolve:r,reject:o},a.object.postMessage({id:c,count:e,size:t,source:l,mode:i,filter:n},[l.buffer])})}(e,t,i,l[a],o[d]):n.then(function(){var n=new Uint8Array(e*t);return r(s.exports[l[a]],n,e,t,i,s.exports[o[d]]),n})}}}();let Mi=null,Di=null,Ti=!1;function Ri(e){try{if(!e)return;Di||(Di=(new wi).setTranscoderPath("/libs/basis/")),Ti||(Di.detectSupport(e),Ti=!0)}catch{}}function ki(){Mi||(Mi=new Vs,Mi.setDecoderPath("/libs/draco/")),Di||(Di=(new wi).setTranscoderPath("/libs/basis/"));const e=new Yt;try{e.setDRACOLoader(Mi)}catch{}try{e.setKTX2Loader(Di)}catch{}try{e.setMeshoptDecoder(ji)}catch{}return e}var Oi={exports:{}};const Li=n(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Fi,Pi,Ni;Pi=void 0,Ni=function(e){return Pi||(Pi=new Promise(function(s,i){var n,a=void 0!==e?e:{},r=a.onAbort;a.onAbort=function(e){i(new Error(e)),r&&r(e)},a.postRun=a.postRun||[],a.postRun.push(function(){s(a)}),Fi=void 0,n||(n=void 0!==a?a:{});var o="object"==typeof window,l="undefined"!=typeof WorkerGlobalScope,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type;n.onRuntimeInitialized=function(){function e(e,t){switch(typeof t){case"boolean":X(e,t?1:0);break;case"number":z(e,t);break;case"string":K(e,t,-1,-1);break;case"object":if(null===t)H(e);else if(null!=t.length){var s=ft(t,bt);Y(e,s,t.length,-1),Et(s)}else Z(e,"Wrong API use : tried to return a value of an unknown type ("+t+").",-1);break;default:H(e)}}function t(e,t){for(var s=[],i=0;i<e;i+=1){var n=U(t+4*i,"i32"),a=F(n);if(1===a||2===a)n=_(n);else if(3===a)n=N(n);else if(4===a){n=P(a=n),a=G(a);for(var r=new Uint8Array(n),o=0;o<n;o+=1)r[o]=C[a+o];n=r}else n=null;s.push(n)}return s}function s(e,t){this.Qa=e,this.db=t,this.Oa=1,this.lb=[]}function i(e,t){if(this.db=t,t=te(e)+1,this.eb=wt(t),null===this.eb)throw Error("Unable to allocate memory for the SQL string");se(e,x,this.eb,t),this.kb=this.eb,this.Za=this.pb=null}function a(e){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=e){var t=this.filename,s="/",i=t;if(s&&(s="string"==typeof s?s:Ie(s),i=t?J(s+"/"+t):s),i=function(e,t=438){return Ge(e,4095&t|32768,0)}(i,t=Ae(!0,!0)),e){if("string"==typeof e){s=Array(e.length);for(var n=0,a=e.length;n<a;++n)s[n]=e.charCodeAt(n);e=s}Ve(i,146|t),et(s=Je(i,577),e,0,e.length,0),Xe(s),Ve(i,t)}}this.handleError(l(this.filename,r)),this.db=U(r,"i32"),ee(this.db),this.fb={},this.Sa={}}var r=jt(4),o=n.cwrap,l=o("sqlite3_open","number",["string","number"]),c=o("sqlite3_close_v2","number",["number"]),A=o("sqlite3_exec","number",["number","string","number","number","number"]),d=o("sqlite3_changes","number",["number"]),h=o("sqlite3_prepare_v2","number",["number","string","number","number","number"]),u=o("sqlite3_sql","string",["number"]),p=o("sqlite3_normalized_sql","string",["number"]),g=o("sqlite3_prepare_v2","number",["number","number","number","number","number"]),m=o("sqlite3_bind_text","number",["number","number","number","number","number"]),b=o("sqlite3_bind_blob","number",["number","number","number","number","number"]),f=o("sqlite3_bind_double","number",["number","number","number"]),v=o("sqlite3_bind_int","number",["number","number","number"]),y=o("sqlite3_bind_parameter_index","number",["number","string"]),I=o("sqlite3_step","number",["number"]),w=o("sqlite3_errmsg","string",["number"]),E=o("sqlite3_column_count","number",["number"]),B=o("sqlite3_data_count","number",["number"]),S=o("sqlite3_column_double","number",["number","number"]),Q=o("sqlite3_column_text","string",["number","number"]),j=o("sqlite3_column_blob","number",["number","number"]),M=o("sqlite3_column_bytes","number",["number","number"]),D=o("sqlite3_column_type","number",["number","number"]),T=o("sqlite3_column_name","string",["number","number"]),R=o("sqlite3_reset","number",["number"]),k=o("sqlite3_clear_bindings","number",["number"]),O=o("sqlite3_finalize","number",["number"]),L=o("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),F=o("sqlite3_value_type","number",["number"]),P=o("sqlite3_value_bytes","number",["number"]),N=o("sqlite3_value_text","string",["number"]),G=o("sqlite3_value_blob","number",["number"]),_=o("sqlite3_value_double","number",["number"]),z=o("sqlite3_result_double","",["number","number"]),H=o("sqlite3_result_null","",["number"]),K=o("sqlite3_result_text","",["number","string","number","number"]),Y=o("sqlite3_result_blob","",["number","number","number","number"]),X=o("sqlite3_result_int","",["number","number"]),Z=o("sqlite3_result_error","",["number","string","number"]),$=o("sqlite3_aggregate_context","number",["number","number"]),ee=o("RegisterExtensionFunctions","number",["number"]),ne=o("sqlite3_update_hook","number",["number","number","number"]);s.prototype.bind=function(e){if(!this.Qa)throw"Statement closed";return this.reset(),Array.isArray(e)?this.Cb(e):null==e||"object"!=typeof e||this.Db(e)},s.prototype.step=function(){if(!this.Qa)throw"Statement closed";this.Oa=1;var e=I(this.Qa);switch(e){case 100:return!0;case 101:return!1;default:throw this.db.handleError(e)}},s.prototype.wb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),S(this.Qa,e)},s.prototype.Gb=function(e){if(null==e&&(e=this.Oa,this.Oa+=1),e=Q(this.Qa,e),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(e)},s.prototype.Hb=function(e){return null==e&&(e=this.Oa,this.Oa+=1),Q(this.Qa,e)},s.prototype.getBlob=function(e){null==e&&(e=this.Oa,this.Oa+=1);var t=M(this.Qa,e);e=j(this.Qa,e);for(var s=new Uint8Array(t),i=0;i<t;i+=1)s[i]=C[e+i];return s},s.prototype.get=function(e,t){t=t||{},null!=e&&this.bind(e)&&this.step(),e=[];for(var s=B(this.Qa),i=0;i<s;i+=1)switch(D(this.Qa,i)){case 1:var n=t.useBigInt?this.Gb(i):this.wb(i);e.push(n);break;case 2:e.push(this.wb(i));break;case 3:e.push(this.Hb(i));break;case 4:e.push(this.getBlob(i));break;default:e.push(null)}return e},s.prototype.getColumnNames=function(){for(var e=[],t=E(this.Qa),s=0;s<t;s+=1)e.push(T(this.Qa,s));return e},s.prototype.getAsObject=function(e,t){e=this.get(e,t),t=this.getColumnNames();for(var s={},i=0;i<t.length;i+=1)s[t[i]]=e[i];return s},s.prototype.getSQL=function(){return u(this.Qa)},s.prototype.getNormalizedSQL=function(){return p(this.Qa)},s.prototype.run=function(e){return null!=e&&this.bind(e),this.step(),this.reset()},s.prototype.sb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),e=ie(e);var s=ft(e,bt);this.lb.push(s),this.db.handleError(m(this.Qa,t,s,e.length-1,0))},s.prototype.Bb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1);var s=ft(e,bt);this.lb.push(s),this.db.handleError(b(this.Qa,t,s,e.length,0))},s.prototype.rb=function(e,t){null==t&&(t=this.Oa,this.Oa+=1),this.db.handleError((e===(0|e)?v:f)(this.Qa,t,e))},s.prototype.Eb=function(e){null==e&&(e=this.Oa,this.Oa+=1),b(this.Qa,e,0,0,0)},s.prototype.tb=function(e,t){switch(null==t&&(t=this.Oa,this.Oa+=1),typeof e){case"string":return void this.sb(e,t);case"number":return void this.rb(e,t);case"bigint":return void this.sb(e.toString(),t);case"boolean":return void this.rb(e+0,t);case"object":if(null===e)return void this.Eb(t);if(null!=e.length)return void this.Bb(e,t)}throw"Wrong API use : tried to bind a value of an unknown type ("+e+")."},s.prototype.Db=function(e){var t=this;return Object.keys(e).forEach(function(s){var i=y(t.Qa,s);0!==i&&t.tb(e[s],i)}),!0},s.prototype.Cb=function(e){for(var t=0;t<e.length;t+=1)this.tb(e[t],t+1);return!0},s.prototype.reset=function(){return this.freemem(),0===k(this.Qa)&&0===R(this.Qa)},s.prototype.freemem=function(){for(var e;void 0!==(e=this.lb.pop());)Et(e)},s.prototype.free=function(){this.freemem();var e=0===O(this.Qa);return delete this.db.fb[this.Qa],this.Qa=0,e},i.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.Za&&(this.Za.free(),this.Za=null),!this.db.db)throw this.mb(),Error("Database closed");var e=Mt(),t=jt(4);q(r),q(t);try{this.db.handleError(g(this.db.db,this.kb,-1,r,t)),this.kb=U(t,"i32");var i=U(r,"i32");return 0===i?(this.mb(),{done:!0}):(this.Za=new s(i,this.db),this.db.fb[i]=this.Za,{value:this.Za,done:!1})}catch(n){throw this.pb=V(this.kb),this.mb(),n}finally{Qt(e)}},i.prototype.mb=function(){Et(this.eb),this.eb=null},i.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:V(this.kb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(i.prototype[Symbol.iterator]=function(){return this}),a.prototype.run=function(e,t){if(!this.db)throw"Database closed";if(t){e=this.prepare(e,t);try{e.step()}finally{e.free()}}else this.handleError(A(this.db,e,0,0,r));return this},a.prototype.exec=function(e,t,i){if(!this.db)throw"Database closed";var n=Mt(),a=null;try{var o=mt(e),l=jt(4);for(e=[];0!==U(o,"i8");){q(r),q(l),this.handleError(g(this.db,o,-1,r,l));var c=U(r,"i32");if(o=U(l,"i32"),0!==c){var A=null;for(a=new s(c,this),null!=t&&a.bind(t);a.step();)null===A&&(A={columns:a.getColumnNames(),values:[]},e.push(A)),A.values.push(a.get(null,i));a.free()}}return e}catch(d){throw a&&a.free(),d}finally{Qt(n)}},a.prototype.each=function(e,t,s,i,n){"function"==typeof t&&(i=s,s=t,t=void 0),e=this.prepare(e,t);try{for(;e.step();)s(e.getAsObject(null,n))}finally{e.free()}if("function"==typeof i)return i()},a.prototype.prepare=function(e,t){if(q(r),this.handleError(h(this.db,e,-1,r,0)),0===(e=U(r,"i32")))throw"Nothing to prepare";var i=new s(e,this);return null!=t&&i.bind(t),this.fb[e]=i},a.prototype.iterateStatements=function(e){return new i(e,this)},a.prototype.export=function(){Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(yt),this.Sa={},this.handleError(c(this.db));var e=function(e){var t,s=Je(e,s||0);e=Ke(e).size;var i=new Uint8Array(e);return $e(s,i,0,e,0),t=i,Xe(s),t}(this.filename);return this.handleError(l(this.filename,r)),this.db=U(r,"i32"),ee(this.db),e},a.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach(function(e){e.free()}),Object.values(this.Sa).forEach(yt),this.Sa={},this.Ya&&(yt(this.Ya),this.Ya=void 0),this.handleError(c(this.db)),qe("/"+this.filename),this.db=null)},a.prototype.handleError=function(e){if(0===e)return null;throw e=w(this.db),Error(e)},a.prototype.getRowsModified=function(){return d(this.db)},a.prototype.create_function=function(s,i){Object.prototype.hasOwnProperty.call(this.Sa,s)&&(yt(this.Sa[s]),delete this.Sa[s]);var n=Ct(function(s,n,a){n=t(n,a);try{var r=i.apply(null,n)}catch(o){return void Z(s,o,-1)}e(s,r)},"viii");return this.Sa[s]=n,this.handleError(L(this.db,s,i.length,1,0,n,0,0,0)),this},a.prototype.create_aggregate=function(s,i){var n=i.init||function(){return null},a=i.finalize||function(e){return e},r=i.step;if(!r)throw"An aggregate function must have a step function in "+s;var o={};Object.hasOwnProperty.call(this.Sa,s)&&(yt(this.Sa[s]),delete this.Sa[s]),i=s+"__finalize",Object.hasOwnProperty.call(this.Sa,i)&&(yt(this.Sa[i]),delete this.Sa[i]);var l=Ct(function(e,s,i){var a=$(e,1);Object.hasOwnProperty.call(o,a)||(o[a]=n()),s=t(s,i),s=[o[a]].concat(s);try{o[a]=r.apply(null,s)}catch(l){delete o[a],Z(e,l,-1)}},"viii"),c=Ct(function(t){var s=$(t,1);try{var i=a(o[s])}catch(n){return delete o[s],void Z(t,n,-1)}e(t,i),delete o[s]},"vi");return this.Sa[s]=l,this.Sa[i]=c,this.handleError(L(this.db,s,r.length-1,1,0,0,l,c,0)),this},a.prototype.updateHook=function(e){this.Ya&&(ne(this.db,0,0),yt(this.Ya),this.Ya=void 0),e&&(this.Ya=Ct(function(t,s,i,n,a){switch(s){case 18:t="insert";break;case 23:t="update";break;case 9:t="delete";break;default:throw"unknown operationCode in updateHook callback: "+s}if(i=i?W(x,i):"",n=n?W(x,n):"",a>Number.MAX_SAFE_INTEGER)throw"rowId too big to fit inside a Number";e(t,i,n,Number(a))},"viiiij"),ne(this.db,this.Ya,0))},n.Database=a};var A,d,h={...n},u="./this.program",p=(e,t)=>{throw t},g="";if(c){var m=Li;g=__dirname+"/",d=e=>(e=D(e)?new URL(e):e,m.readFileSync(e)),A=async e=>(e=D(e)?new URL(e):e,m.readFileSync(e,void 0)),!n.thisProgram&&1<process.argv.length&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),Fi.exports=n,p=(e,t)=>{throw process.exitCode=e,t}}else(o||l)&&(l?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),g=g.startsWith("blob:")?"":g.slice(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),l&&(d=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),A=async e=>{if(D(e))return new Promise((t,s)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{200==i.status||0==i.status&&i.response?t(i.response):s(i.status)},i.onerror=s,i.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)});var b=n.print||function(){}.bind(),f=n.printErr||function(){}.bind();Object.assign(n,h),h=null,n.thisProgram&&(u=n.thisProgram);var v,y,C,x,I,w,E,B,S,Q,j=n.wasmBinary,M=!1,D=e=>e.startsWith("file://");function T(){var e=v.buffer;n.HEAP8=C=new Int8Array(e),n.HEAP16=I=new Int16Array(e),n.HEAPU8=x=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=w=new Int32Array(e),n.HEAPU32=E=new Uint32Array(e),n.HEAPF32=B=new Float32Array(e),n.HEAPF64=Q=new Float64Array(e),n.HEAP64=S=new BigInt64Array(e),n.HEAPU64=new BigUint64Array(e)}var R,k=0,O=null;function L(e){var t;throw null==(t=n.onAbort)||t.call(n,e),f(e="Aborted("+e+")"),M=!0,new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info.")}async function F(e,t){try{var s=await async function(e){if(!j)try{var t=await A(e);return new Uint8Array(t)}catch{}if(e==R&&j)e=new Uint8Array(j);else{if(!d)throw"both async and sync fetching of the wasm failed";e=d(e)}return e}(e);return await WebAssembly.instantiate(s,t)}catch(i){f(`failed to asynchronously prepare wasm: ${i}`),L(i)}}class P{constructor(e){t(this,"name","ExitStatus"),this.message=`Program terminated with exit(${e})`,this.status=e}}var N=e=>{for(;0<e.length;)e.shift()(n)},G=[],_=[],z=()=>{var e=n.preRun.shift();_.unshift(e)};function U(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return C[e];case"i16":return I[e>>1];case"i32":return w[e>>2];case"i64":return S[e>>3];case"float":return B[e>>2];case"double":return Q[e>>3];case"*":return E[e>>2];default:L(`invalid type for getValue: ${t}`)}}var H=n.noExitRuntime||!0;function q(e){var t="i32";switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":C[e]=0;break;case"i16":I[e>>1]=0;break;case"i32":w[e>>2]=0;break;case"i64":S[e>>3]=BigInt(0);break;case"float":B[e>>2]=0;break;case"double":Q[e>>3]=0;break;case"*":E[e>>2]=0;break;default:L(`invalid type for setValue: ${t}`)}}var K="undefined"!=typeof TextDecoder?new TextDecoder:void 0,W=(e,t=0,s=NaN)=>{var i=t+s;for(s=t;e[s]&&!(s>=i);)++s;if(16<s-t&&e.buffer&&K)return K.decode(e.subarray(t,s));for(i="";t<s;){var n=e[t++];if(128&n){var a=63&e[t++];if(192==(224&n))i+=String.fromCharCode((31&n)<<6|a);else{var r=63&e[t++];65536>(n=224==(240&n)?(15&n)<<12|a<<6|r:(7&n)<<18|a<<12|r<<6|63&e[t++])?i+=String.fromCharCode(n):(n-=65536,i+=String.fromCharCode(55296|n>>10,56320|1023&n))}}else i+=String.fromCharCode(n)}return i},V=(e,t)=>e?W(x,e,t):"",Y=(e,t)=>{for(var s=0,i=e.length-1;0<=i;i--){var n=e[i];"."===n?e.splice(i,1):".."===n?(e.splice(i,1),s++):s&&(e.splice(i,1),s--)}if(t)for(;s;s--)e.unshift("..");return e},J=e=>{var t="/"===e.charAt(0),s="/"===e.slice(-1);return(e=Y(e.split("/").filter(e=>!!e),!t).join("/"))||t||(e="."),e&&s&&(e+="/"),(t?"/":"")+e},X=e=>{var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.slice(0,-1)),e+t):"."},Z=e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],$=e=>{($=(()=>{if(c){var e=Li;return t=>e.randomFillSync(t)}return e=>crypto.getRandomValues(e)})())(e)},ee=[],te=e=>{for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);127>=i?t++:2047>=i?t+=2:55296<=i&&57343>=i?(t+=4,++s):t+=3}return t},se=(e,t,s,i)=>{if(!(0<i))return 0;var n=s;i=s+i-1;for(var a=0;a<e.length;++a){var r=e.charCodeAt(a);if(55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++a)),127>=r){if(s>=i)break;t[s++]=r}else{if(2047>=r){if(s+1>=i)break;t[s++]=192|r>>6}else{if(65535>=r){if(s+2>=i)break;t[s++]=224|r>>12}else{if(s+3>=i)break;t[s++]=240|r>>18,t[s++]=128|r>>12&63}t[s++]=128|r>>6&63}t[s++]=128|63&r}}return t[s]=0,s-n},ie=(e,t)=>{var s=Array(te(e)+1);return e=se(e,s,0,s.length),t&&(s.length=e),s},ne=[];function ae(e,t){ne[e]={input:[],output:[],cb:t},Pe(e,re)}var re={open(e){var t=ne[e.node.rdev];if(!t)throw new ve(43);e.tty=t,e.seekable=!1},close(e){e.tty.cb.fsync(e.tty)},fsync(e){e.tty.cb.fsync(e.tty)},read(e,t,s,i){if(!e.tty||!e.tty.cb.xb)throw new ve(60);for(var n=0,a=0;a<i;a++){try{var r=e.tty.cb.xb(e.tty)}catch(o){throw new ve(29)}if(void 0===r&&0===n)throw new ve(6);if(null==r)break;n++,t[s+a]=r}return n&&(e.node.atime=Date.now()),n},write(e,t,s,i){if(!e.tty||!e.tty.cb.qb)throw new ve(60);try{for(var n=0;n<i;n++)e.tty.cb.qb(e.tty,t[s+n])}catch(a){throw new ve(29)}return i&&(e.node.mtime=e.node.ctime=Date.now()),n}},oe={xb(){e:{if(!ee.length){var e=null;if(c){var t=Buffer.alloc(256),s=0,i=process.stdin.fd;try{s=m.readSync(i,t,0,256)}catch(n){if(!n.toString().includes("EOF"))throw n;s=0}0<s&&(e=t.slice(0,s).toString("utf-8"))}else"undefined"!=typeof window&&"function"==typeof window.prompt&&null!==(e=window.prompt("Input: "))&&(e+="\n");if(!e){e=null;break e}ee=ie(e,!0)}e=ee.shift()}return e},qb(e,t){null===t||10===t?(b(W(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){var t;0<(null==(t=e.output)?void 0:t.length)&&(b(W(e.output)),e.output=[])},Tb:()=>({Ob:25856,Qb:5,Nb:191,Pb:35387,Mb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),Ub:()=>0,Vb:()=>[24,80]},le={qb(e,t){null===t||10===t?(f(W(e.output)),e.output=[]):0!=t&&e.output.push(t)},fsync(e){var t;0<(null==(t=e.output)?void 0:t.length)&&(f(W(e.output)),e.output=[])}},ce={Wa:null,Xa:()=>ce.createNode(null,"/",16895,0),createNode(e,t,s,i){if(24576==(61440&s)||4096==(61440&s))throw new ve(63);return ce.Wa||(ce.Wa={dir:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua,lookup:ce.La.lookup,hb:ce.La.hb,rename:ce.La.rename,unlink:ce.La.unlink,rmdir:ce.La.rmdir,readdir:ce.La.readdir,symlink:ce.La.symlink},stream:{Va:ce.Ma.Va}},file:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua},stream:{Va:ce.Ma.Va,read:ce.Ma.read,write:ce.Ma.write,ib:ce.Ma.ib,jb:ce.Ma.jb}},link:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua,readlink:ce.La.readlink},stream:{}},ub:{node:{Ta:ce.La.Ta,Ua:ce.La.Ua},stream:Fe}}),Qe((s=Se(e,t,s,i)).mode)?(s.La=ce.Wa.dir.node,s.Ma=ce.Wa.dir.stream,s.Na={}):32768==(61440&s.mode)?(s.La=ce.Wa.file.node,s.Ma=ce.Wa.file.stream,s.Ra=0,s.Na=null):40960==(61440&s.mode)?(s.La=ce.Wa.link.node,s.Ma=ce.Wa.link.stream):8192==(61440&s.mode)&&(s.La=ce.Wa.ub.node,s.Ma=ce.Wa.ub.stream),s.atime=s.mtime=s.ctime=Date.now(),e&&(e.Na[t]=s,e.atime=e.mtime=e.ctime=s.atime),s},Sb:e=>e.Na?e.Na.subarray?e.Na.subarray(0,e.Ra):new Uint8Array(e.Na):new Uint8Array(0),La:{Ta(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Qe(e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.Ra:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},Ua(e,t){for(var s of["mode","atime","mtime","ctime"])null!=t[s]&&(e[s]=t[s]);void 0!==t.size&&(t=t.size,e.Ra!=t&&(0==t?(e.Na=null,e.Ra=0):(s=e.Na,e.Na=new Uint8Array(t),s&&e.Na.set(s.subarray(0,Math.min(t,e.Ra))),e.Ra=t)))},lookup(){throw ce.vb},hb:(e,t,s,i)=>ce.createNode(e,t,s,i),rename(e,t,s){try{var i=Be(t,s)}catch(a){}if(i){if(Qe(e.mode))for(var n in i.Na)throw new ve(55);Ee(i)}delete e.parent.Na[e.name],t.Na[s]=e,e.name=s,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.Na[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){var s,i=Be(e,t);for(s in i.Na)throw new ve(55);delete e.Na[t],e.ctime=e.mtime=Date.now()},readdir:e=>[".","..",...Object.keys(e.Na)],symlink:(e,t,s)=>((e=ce.createNode(e,t,41471,0)).link=s,e),readlink(e){if(40960!=(61440&e.mode))throw new ve(28);return e.link}},Ma:{read(e,t,s,i,n){var a=e.node.Na;if(n>=e.node.Ra)return 0;if(8<(e=Math.min(e.node.Ra-n,i))&&a.subarray)t.set(a.subarray(n,n+e),s);else for(i=0;i<e;i++)t[s+i]=a[n+i];return e},write(e,t,s,i,n,a){if(t.buffer===C.buffer&&(a=!1),!i)return 0;if((e=e.node).mtime=e.ctime=Date.now(),t.subarray&&(!e.Na||e.Na.subarray)){if(a)return e.Na=t.subarray(s,s+i),e.Ra=i;if(0===e.Ra&&0===n)return e.Na=t.slice(s,s+i),e.Ra=i;if(n+i<=e.Ra)return e.Na.set(t.subarray(s,s+i),n),i}a=n+i;var r=e.Na?e.Na.length:0;if(r>=a||(a=Math.max(a,r*(1048576>r?2:1.125)>>>0),0!=r&&(a=Math.max(a,256)),r=e.Na,e.Na=new Uint8Array(a),0<e.Ra&&e.Na.set(r.subarray(0,e.Ra),0)),e.Na.subarray&&t.subarray)e.Na.set(t.subarray(s,s+i),n);else for(a=0;a<i;a++)e.Na[n+a]=t[s+a];return e.Ra=Math.max(e.Ra,n+i),i},Va(e,t,s){if(1===s?t+=e.position:2===s&&32768==(61440&e.node.mode)&&(t+=e.node.Ra),0>t)throw new ve(28);return t},ib(e,t,s,i,n){if(32768!=(61440&e.node.mode))throw new ve(43);if(e=e.node.Na,2&n||!e||e.buffer!==C.buffer){n=!0,i=65536*Math.ceil(t/65536);var a=Bt(65536,i);if(a&&x.fill(0,a,a+i),!(i=a))throw new ve(48);e&&((0<s||s+t<e.length)&&(e=e.subarray?e.subarray(s,s+t):Array.prototype.slice.call(e,s,s+t)),C.set(e,i))}else n=!1,i=e.byteOffset;return{Kb:i,Ab:n}},jb:(e,t,s,i)=>(ce.Ma.write(e,t,0,i,s,!1),0)}},Ae=(e,t)=>{var s=0;return e&&(s|=365),t&&(s|=146),s},de=null,he={},ue=[],pe=1,ge=null,me=!1,be=!0,fe={},ve=class{constructor(e){t(this,"name","ErrnoError"),this.Pa=e}},ye=class{constructor(){t(this,"gb",{}),t(this,"node",null)}get flags(){return this.gb.flags}set flags(e){this.gb.flags=e}get position(){return this.gb.position}set position(e){this.gb.position=e}},Ce=class{constructor(e,s,i,n){t(this,"La",{}),t(this,"Ma",{}),t(this,"ab",null),e||(e=this),this.parent=e,this.Xa=e.Xa,this.id=pe++,this.name=s,this.mode=i,this.rdev=n,this.atime=this.mtime=this.ctime=Date.now()}get read(){return!(365&~this.mode)}set read(e){e?this.mode|=365:this.mode&=-366}get write(){return!(146&~this.mode)}set write(e){e?this.mode|=146:this.mode&=-147}};function xe(e,t={}){if(!e)throw new ve(44);t.nb??(t.nb=!0),"/"===e.charAt(0)||(e="//"+e);var s=0;e:for(;40>s;s++){e=e.split("/").filter(e=>!!e);for(var i=de,n="/",a=0;a<e.length;a++){var r=a===e.length-1;if(r&&t.parent)break;if("."!==e[a])if(".."===e[a])n=X(n),i=i.parent;else{n=J(n+"/"+e[a]);try{i=Be(i,e[a])}catch(o){if(44===(null==o?void 0:o.Pa)&&r&&t.Jb)return{path:n};throw o}if(!i.ab||r&&!t.nb||(i=i.ab.root),40960==(61440&i.mode)&&(!r||t.$a)){if(!i.La.readlink)throw new ve(52);"/"===(i=i.La.readlink(i)).charAt(0)||(i=X(n)+"/"+i),e=i+"/"+e.slice(a+1).join("/");continue e}}}return{path:n,node:i}}throw new ve(32)}function Ie(e){for(var t;;){if(e===e.parent)return e=e.Xa.zb,t?"/"!==e[e.length-1]?`${e}/${t}`:e+t:e;t=t?`${e.name}/${t}`:e.name,e=e.parent}}function we(e,t){for(var s=0,i=0;i<t.length;i++)s=(s<<5)-s+t.charCodeAt(i)|0;return(e+s>>>0)%ge.length}function Ee(e){var t=we(e.parent.id,e.name);if(ge[t]===e)ge[t]=e.bb;else for(t=ge[t];t;){if(t.bb===e){t.bb=e.bb;break}t=t.bb}}function Be(e,t){var s=Qe(e.mode)?(s=Me(e,"x"))?s:e.La.lookup?0:2:54;if(s)throw new ve(s);for(s=ge[we(e.id,t)];s;s=s.bb){var i=s.name;if(s.parent.id===e.id&&i===t)return s}return e.La.lookup(e,t)}function Se(e,t,s,i){return t=we((e=new Ce(e,t,s,i)).parent.id,e.name),e.bb=ge[t],ge[t]=e}function Qe(e){return 16384==(61440&e)}function je(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function Me(e,t){return be?0:!t.includes("r")||292&e.mode?t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0:2}function De(e,t){if(!Qe(e.mode))return 54;try{return Be(e,t),20}catch(s){}return Me(e,"wx")}function Te(e,t,s){try{var i=Be(e,t)}catch(n){return n.Pa}if(e=Me(e,"wx"))return e;if(s){if(!Qe(i.mode))return 54;if(i===i.parent||"/"===Ie(i))return 10}else if(Qe(i.mode))return 31;return 0}function Re(e){if(!e)throw new ve(63);return e}function ke(e){if(!(e=ue[e]))throw new ve(8);return e}function Oe(e,t=-1){if(e=Object.assign(new ye,e),-1==t)e:{for(t=0;4096>=t;t++)if(!ue[t])break e;throw new ve(33)}return e.fd=t,ue[t]=e}function Le(e,t,s){var i=null==e?void 0:e.Ma.Ua;e=i?e:t,i??(i=t.La.Ua),Re(i),i(e,s)}var Fe={open(e){var t,s;e.Ma=he[e.node.rdev].Ma,null==(s=(t=e.Ma).open)||s.call(t,e)},Va(){throw new ve(70)}};function Pe(e,t){he[e]={Ma:t}}function Ne(e,t){var s="/"===t;if(s&&de)throw new ve(10);if(!s&&t){var i=xe(t,{nb:!1});if(t=i.path,(i=i.node).ab)throw new ve(10);if(!Qe(i.mode))throw new ve(54)}t={type:e,Wb:{},zb:t,Ib:[]},(e=e.Xa(t)).Xa=t,t.root=e,s?de=e:i&&(i.ab=t,i.Xa&&i.Xa.Ib.push(t))}function Ge(e,t,s){var i=xe(e,{parent:!0}).node;if(!(e=Z(e)))throw new ve(28);if("."===e||".."===e)throw new ve(20);var n=De(i,e);if(n)throw new ve(n);if(!i.La.hb)throw new ve(63);return i.La.hb(i,e,t,s)}function _e(e,t=511){return Ge(e,1023&t|16384,0)}function ze(e,t,s){void 0===s&&(s=t,t=438),Ge(e,8192|t,s)}function Ue(e,t){if(!((...e)=>{for(var t="",s=!1,i=e.length-1;-1<=i&&!s;i--){if("string"!=typeof(s=0<=i?e[i]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";t=s+"/"+t,s="/"===s.charAt(0)}return(s?"/":"")+(t=Y(t.split("/").filter(e=>!!e),!s).join("/"))||"."})(e))throw new ve(44);var s=xe(t,{parent:!0}).node;if(!s)throw new ve(44);var i=De(s,t=Z(t));if(i)throw new ve(i);if(!s.La.symlink)throw new ve(63);s.La.symlink(s,t,e)}function He(e){var t=xe(e,{parent:!0}).node,s=Be(t,e=Z(e)),i=Te(t,e,!0);if(i)throw new ve(i);if(!t.La.rmdir)throw new ve(63);if(s.ab)throw new ve(10);t.La.rmdir(t,e),Ee(s)}function qe(e){var t=xe(e,{parent:!0}).node;if(!t)throw new ve(44);var s=Be(t,e=Z(e)),i=Te(t,e,!1);if(i)throw new ve(i);if(!t.La.unlink)throw new ve(63);if(s.ab)throw new ve(10);t.La.unlink(t,e),Ee(s)}function Ke(e,t){return Re((e=xe(e,{$a:!t}).node).La.Ta)(e)}function We(e,t,s,i){Le(e,t,{mode:4095&s|-4096&t.mode,ctime:Date.now(),Fb:i})}function Ve(e,t){We(null,e="string"==typeof e?xe(e,{$a:!0}).node:e,t)}function Ye(e,t,s){if(Qe(t.mode))throw new ve(31);if(32768!=(61440&t.mode))throw new ve(28);var i=Me(t,"w");if(i)throw new ve(i);Le(e,t,{size:s,timestamp:Date.now()})}function Je(e,t,s=438){if(""===e)throw new ve(44);if("string"==typeof t){var i={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[t];if(void 0===i)throw Error(`Unknown file open mode: ${t}`);t=i}if(s=64&t?4095&s|32768:0,"object"==typeof e)i=e;else{var a=e.endsWith("/");i=(e=xe(e,{$a:!(131072&t),Jb:!0})).node,e=e.path}var r=!1;if(64&t)if(i){if(128&t)throw new ve(20)}else{if(a)throw new ve(31);i=Ge(e,511|s,0),r=!0}if(!i)throw new ve(44);if(8192==(61440&i.mode)&&(t&=-513),65536&t&&!Qe(i.mode))throw new ve(54);if(!r&&(a=i?40960==(61440&i.mode)?32:Qe(i.mode)&&("r"!==je(t)||576&t)?31:Me(i,je(t)):44))throw new ve(a);return 512&t&&!r&&Ye(null,a="string"==typeof(a=i)?xe(a,{$a:!0}).node:a,0),t&=-131713,(a=Oe({node:i,path:Ie(i),flags:t,seekable:!0,position:0,Ma:i.Ma,Lb:[],error:!1})).Ma.open&&a.Ma.open(a),r&&Ve(i,511&s),!n.logReadFiles||1&t||e in fe||(fe[e]=1),a}function Xe(e){if(null===e.fd)throw new ve(8);e.ob&&(e.ob=null);try{e.Ma.close&&e.Ma.close(e)}catch(t){throw t}finally{ue[e.fd]=null}e.fd=null}function Ze(e,t,s){if(null===e.fd)throw new ve(8);if(!e.seekable||!e.Ma.Va)throw new ve(70);if(0!=s&&1!=s&&2!=s)throw new ve(28);e.position=e.Ma.Va(e,t,s),e.Lb=[]}function $e(e,t,s,i,n){if(0>i||0>n)throw new ve(28);if(null===e.fd)throw new ve(8);if(1==(2097155&e.flags))throw new ve(8);if(Qe(e.node.mode))throw new ve(31);if(!e.Ma.read)throw new ve(28);var a=void 0!==n;if(a){if(!e.seekable)throw new ve(70)}else n=e.position;return t=e.Ma.read(e,t,s,i,n),a||(e.position+=t),t}function et(e,t,s,i,n){if(0>i||0>n)throw new ve(28);if(null===e.fd)throw new ve(8);if(!(2097155&e.flags))throw new ve(8);if(Qe(e.node.mode))throw new ve(31);if(!e.Ma.write)throw new ve(28);e.seekable&&1024&e.flags&&Ze(e,0,2);var a=void 0!==n;if(a){if(!e.seekable)throw new ve(70)}else n=e.position;return t=e.Ma.write(e,t,s,i,n,void 0),a||(e.position+=t),t}function tt(e,t,s){e=J("/dev/"+e);var i=Ae(!!t,!!s);tt.yb??(tt.yb=64);var n=tt.yb++<<8;Pe(n,{open(e){e.seekable=!1},close(){var e;(null==(e=null==s?void 0:s.buffer)?void 0:e.length)&&s(10)},read(e,s,i,n){for(var a=0,r=0;r<n;r++){try{var o=t()}catch(l){throw new ve(29)}if(void 0===o&&0===a)throw new ve(6);if(null==o)break;a++,s[i+r]=o}return a&&(e.node.atime=Date.now()),a},write(e,t,i,n){for(var a=0;a<n;a++)try{s(t[i+a])}catch(r){throw new ve(29)}return n&&(e.node.mtime=e.node.ctime=Date.now()),a}}),ze(e,i,n)}function st(e,t,s){if("/"===t.charAt(0))return t;if(e=-100===e?"/":ke(e).path,0==t.length){if(!s)throw new ve(44);return e}return e+"/"+t}function it(e,t){w[e>>2]=t.dev,w[e+4>>2]=t.mode,E[e+8>>2]=t.nlink,w[e+12>>2]=t.uid,w[e+16>>2]=t.gid,w[e+20>>2]=t.rdev,S[e+24>>3]=BigInt(t.size),w[e+32>>2]=4096,w[e+36>>2]=t.blocks;var s=t.atime.getTime(),i=t.mtime.getTime(),n=t.ctime.getTime();return S[e+40>>3]=BigInt(Math.floor(s/1e3)),E[e+48>>2]=s%1e3*1e6,S[e+56>>3]=BigInt(Math.floor(i/1e3)),E[e+64>>2]=i%1e3*1e6,S[e+72>>3]=BigInt(Math.floor(n/1e3)),E[e+80>>2]=n%1e3*1e6,S[e+88>>3]=BigInt(t.ino),0}var nt,at,rt,ot=void 0,lt=()=>{var e=w[+ot>>2];return ot+=4,e},ct=0,At=[0,31,60,91,121,152,182,213,244,274,305,335],dt=[0,31,59,90,120,151,181,212,243,273,304,334],ht={},ut=e=>{var t;y=e,H||0<ct||(null==(t=n.onExit)||t.call(n,e),M=!0),p(e,new P(e))},pt={},gt=()=>{if(!nt){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:u||"./this.program"};for(e in pt)void 0===pt[e]?delete t[e]:t[e]=pt[e];var s=[];for(e in t)s.push(`${e}=${t[e]}`);nt=s}return nt},mt=e=>{var t=te(e)+1,s=jt(t);return se(e,x,s,t),s},bt=0,ft=(e,t)=>(t=1==t?jt(e.length):wt(e.length),e.subarray||e.slice||(e=new Uint8Array(e)),x.set(e,t),t),vt=[],yt=e=>{at.delete(rt.get(e)),rt.set(e,null),vt.push(e)},Ct=(e,t)=>{if(!at){at=new WeakMap;var s=rt.length;if(at)for(var i=0;i<0+s;i++){var n=rt.get(i);n&&at.set(n,i)}}if(s=at.get(e)||0)return s;if(vt.length)s=vt.pop();else{try{rt.grow(1)}catch(l){if(!(l instanceof RangeError))throw l;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}s=rt.length-1}try{rt.set(s,e)}catch(l){if(!(l instanceof TypeError))throw l;if("function"==typeof WebAssembly.Function){var a=WebAssembly.Function;i={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},n={parameters:[],results:"v"==t[0]?[]:[i[t[0]]]};for(var r=1;r<t.length;++r)n.parameters.push(i[t[r]]);t=new a(n,e)}else{i=[1],n=t.slice(0,1),t=t.slice(1),r={i:127,p:127,j:126,f:125,d:124,e:111},i.push(96);var o=t.length;for(a of(128>o?i.push(o):i.push(o%128|128,o>>7),t))i.push(r[a]);"v"==n?i.push(0):i.push(1,r[n]),t=[0,97,115,109,1,0,0,0,1],128>(a=i.length)?t.push(a):t.push(a%128|128,a>>7),t.push(...i),t.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),t=new WebAssembly.Module(new Uint8Array(t)),t=new WebAssembly.Instance(t,{e:{f:e}}).exports.f}rt.set(s,t)}return at.set(e,s),s};ge=Array(4096),Ne(ce,"/"),_e("/tmp"),_e("/home"),_e("/home/web_user"),function(){_e("/dev"),Pe(259,{read:()=>0,write:(e,t,s,i)=>i,Va:()=>0}),ze("/dev/null",259),ae(1280,oe),ae(1536,le),ze("/dev/tty",1280),ze("/dev/tty1",1536);var e=new Uint8Array(1024),t=0,s=()=>(0===t&&($(e),t=e.byteLength),e[--t]);tt("random",s),tt("urandom",s),_e("/dev/shm"),_e("/dev/shm/tmp")}(),function(){_e("/proc");var e=_e("/proc/self");_e("/proc/self/fd"),Ne({Xa(){var t=Se(e,"fd",16895,73);return t.Ma={Va:ce.Ma.Va},t.La={lookup(e,t){var s=ke(e=+t);return(e={parent:null,Xa:{zb:"fake"},La:{readlink:()=>s.path},id:e+1}).parent=e},readdir:()=>Array.from(ue.entries()).filter(([,e])=>e).map(([e])=>e.toString())},t}},"/proc/self/fd")}(),ce.vb=new ve(44),ce.vb.stack="<generic error, no stack>";var xt,It={a:(e,t,s,i)=>L(`Assertion failed: ${e?W(x,e):""}, at: `+[t?t?W(x,t):"":"unknown filename",s,i?i?W(x,i):"":"unknown function"]),i:function(e,t){try{return Ve(e=e?W(x,e):"",t),0}catch(s){if("ErrnoError"!==s.name)throw s;return-s.Pa}},L:function(e,t,s){try{if(t=st(e,t=t?W(x,t):""),-8&s)return-28;var i=xe(t,{$a:!0}).node;return i?(e="",4&s&&(e+="r"),2&s&&(e+="w"),1&s&&(e+="x"),e&&Me(i,e)?-2:0):-44}catch(n){if("ErrnoError"!==n.name)throw n;return-n.Pa}},j:function(e,t){try{var s=ke(e);return We(s,s.node,t,!1),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},h:function(e){try{var t=ke(e);return Le(t,t.node,{timestamp:Date.now(),Fb:!1}),0}catch(s){if("ErrnoError"!==s.name)throw s;return-s.Pa}},b:function(e,t,s){ot=s;try{var i=ke(e);switch(t){case 0:var n=lt();if(0>n)break;for(;ue[n];)n++;return function(e,t=-1){var s,i;return null==(i=null==(s=(e=Oe(e,t)).Ma)?void 0:s.Rb)||i.call(s,e),e}(i,n).fd;case 1:case 2:case 13:case 14:return 0;case 3:return i.flags;case 4:return n=lt(),i.flags|=n,0;case 12:return n=lt(),I[n+0>>1]=2,0}return-28}catch(a){if("ErrnoError"!==a.name)throw a;return-a.Pa}},g:function(e,t){try{var s=ke(e),i=s.node,n=s.Ma.Ta;return e=n?s:i,n??(n=i.La.Ta),Re(n),it(t,n(e))}catch(a){if("ErrnoError"!==a.name)throw a;return-a.Pa}},H:function(e,t){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var s=ke(e);if(0>t||!(2097155&s.flags))throw new ve(28);return Ye(s,s.node,t),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},G:function(e,t){try{if(0===t)return-28;var s=te("/")+1;return t<s?-68:(se("/",x,e,t),s)}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},K:function(e,t){try{return it(t,Ke(e=e?W(x,e):"",!0))}catch(s){if("ErrnoError"!==s.name)throw s;return-s.Pa}},C:function(e,t,s){try{return _e(t=st(e,t=t?W(x,t):""),s),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},J:function(e,t,s,i){try{t=t?W(x,t):"";var n=256&i;return t=st(e,t,4096&i),it(s,n?Ke(t,!0):Ke(t))}catch(a){if("ErrnoError"!==a.name)throw a;return-a.Pa}},x:function(e,t,s,i){ot=i;try{return Je(t=st(e,t=t?W(x,t):""),s,i?lt():0).fd}catch(n){if("ErrnoError"!==n.name)throw n;return-n.Pa}},v:function(e,t,s,i){try{if(t=st(e,t=t?W(x,t):""),0>=i)return-28;var n=xe(t).node;if(!n)throw new ve(44);if(!n.La.readlink)throw new ve(28);var a=n.La.readlink(n),r=Math.min(i,te(a)),o=C[s+r];return se(a,x,s,i+1),C[s+r]=o,r}catch(l){if("ErrnoError"!==l.name)throw l;return-l.Pa}},u:function(e){try{return He(e=e?W(x,e):""),0}catch(t){if("ErrnoError"!==t.name)throw t;return-t.Pa}},f:function(e,t){try{return it(t,Ke(e=e?W(x,e):""))}catch(s){if("ErrnoError"!==s.name)throw s;return-s.Pa}},r:function(e,t,s){try{return t=st(e,t=t?W(x,t):""),0===s?qe(t):512===s?He(t):L("Invalid flags passed to unlinkat"),0}catch(i){if("ErrnoError"!==i.name)throw i;return-i.Pa}},q:function(e,t,s){try{t=st(e,t=t?W(x,t):"",!0);var i,n,a=Date.now();if(s){var r=E[s>>2]+4294967296*w[s+4>>2],o=w[s+8>>2];i=1073741823==o?a:1073741822==o?null:1e3*r+o/1e6,r=E[(s+=16)>>2]+4294967296*w[s+4>>2],n=1073741823==(o=w[s+8>>2])?a:1073741822==o?null:1e3*r+o/1e6}else n=i=a;if(null!==(n??i)){e=i;var l=xe(t,{$a:!0}).node;Re(l.La.Ua)(l,{atime:e,mtime:n})}return 0}catch(c){if("ErrnoError"!==c.name)throw c;return-c.Pa}},m:()=>L(""),l:()=>{H=!1,ct=0},A:function(e,t){e=-9007199254740992>e||9007199254740992<e?NaN:Number(e),e=new Date(1e3*e),w[t>>2]=e.getSeconds(),w[t+4>>2]=e.getMinutes(),w[t+8>>2]=e.getHours(),w[t+12>>2]=e.getDate(),w[t+16>>2]=e.getMonth(),w[t+20>>2]=e.getFullYear()-1900,w[t+24>>2]=e.getDay();var s=e.getFullYear();w[t+28>>2]=(0!=s%4||0==s%100&&0!=s%400?dt:At)[e.getMonth()]+e.getDate()-1|0,w[t+36>>2]=-60*e.getTimezoneOffset(),s=new Date(e.getFullYear(),6,1).getTimezoneOffset();var i=new Date(e.getFullYear(),0,1).getTimezoneOffset();w[t+32>>2]=0|(s!=i&&e.getTimezoneOffset()==Math.min(i,s))},y:function(e,t,s,i,n,a,r){n=-9007199254740992>n||9007199254740992<n?NaN:Number(n);try{if(isNaN(n))return 61;var o=ke(i);if(2&t&&!(2&s)&&2!=(2097155&o.flags))throw new ve(2);if(1==(2097155&o.flags))throw new ve(2);if(!o.Ma.ib)throw new ve(43);if(!e)throw new ve(28);var l=o.Ma.ib(o,e,n,t,s),c=l.Kb;return w[a>>2]=l.Ab,E[r>>2]=c,0}catch(A){if("ErrnoError"!==A.name)throw A;return-A.Pa}},z:function(e,t,s,i,n,a){a=-9007199254740992>a||9007199254740992<a?NaN:Number(a);try{var r=ke(n);if(2&s){if(s=a,32768!=(61440&r.node.mode))throw new ve(43);if(!(2&i)){var o=x.slice(e,e+t);r.Ma.jb&&r.Ma.jb(r,o,s,t,i)}}}catch(l){if("ErrnoError"!==l.name)throw l;return-l.Pa}},n:(e,t)=>{if(ht[e]&&(clearTimeout(ht[e].id),delete ht[e]),!t)return 0;var s=setTimeout(()=>{delete ht[e],(e=>{if(!M)try{if(e(),!(H||0<ct))try{y=e=y,ut(e)}catch(t){t instanceof P||"unwind"==t||p(1,t)}}catch(t){t instanceof P||"unwind"==t||p(1,t)}})(()=>St(e,performance.now()))},t);return ht[e]={id:s,Xb:t},0},B:(e,t,s,i)=>{var n=(new Date).getFullYear(),a=new Date(n,0,1).getTimezoneOffset();n=new Date(n,6,1).getTimezoneOffset(),E[e>>2]=60*Math.max(a,n),w[t>>2]=Number(a!=n),e=(t=e=>{var t=Math.abs(e);return`UTC${0<=e?"-":"+"}${String(Math.floor(t/60)).padStart(2,"0")}${String(t%60).padStart(2,"0")}`})(a),t=t(n),n<a?(se(e,x,s,17),se(t,x,i,17)):(se(e,x,i,17),se(t,x,s,17))},d:()=>Date.now(),s:()=>2147483648,c:()=>performance.now(),o:e=>{var t=x.length;if(2147483648<(e>>>=0))return!1;for(var s=1;4>=s;s*=2){var i=t*(1+.2/s);i=Math.min(i,e+100663296);e:{i=(Math.min(2147483648,65536*Math.ceil(Math.max(e,i)/65536))-v.buffer.byteLength+65535)/65536|0;try{v.grow(i),T();var n=1;break e}catch(a){}n=void 0}if(n)return!0}return!1},E:(e,t)=>{var s=0;return gt().forEach((i,n)=>{var a=t+s;for(n=E[e+4*n>>2]=a,a=0;a<i.length;++a)C[n++]=i.charCodeAt(a);C[n]=0,s+=i.length+1}),0},F:(e,t)=>{var s=gt();E[e>>2]=s.length;var i=0;return s.forEach(e=>i+=e.length+1),E[t>>2]=i,0},e:function(e){try{return Xe(ke(e)),0}catch(t){if("ErrnoError"!==t.name)throw t;return t.Pa}},p:function(e,t){try{var s=ke(e);return C[t]=s.tty?2:Qe(s.mode)?3:40960==(61440&s.mode)?7:4,I[t+2>>1]=0,S[t+8>>3]=BigInt(0),S[t+16>>3]=BigInt(0),0}catch(i){if("ErrnoError"!==i.name)throw i;return i.Pa}},w:function(e,t,s,i){try{e:{var n=ke(e);e=t;for(var a,r=t=0;r<s;r++){var o=E[e>>2],l=E[e+4>>2];e+=8;var c=$e(n,C,o,l,a);if(0>c){var A=-1;break e}if(t+=c,c<l)break;void 0!==a&&(a+=c)}A=t}return E[i>>2]=A,0}catch(d){if("ErrnoError"!==d.name)throw d;return d.Pa}},D:function(e,t,s,i){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t);try{if(isNaN(t))return 61;var n=ke(e);return Ze(n,t,s),S[i>>3]=BigInt(n.position),n.ob&&0===t&&0===s&&(n.ob=null),0}catch(a){if("ErrnoError"!==a.name)throw a;return a.Pa}},I:function(e){var t;try{var s=ke(e);return(null==(t=s.Ma)?void 0:t.fsync)?s.Ma.fsync(s):0}catch(i){if("ErrnoError"!==i.name)throw i;return i.Pa}},t:function(e,t,s,i){try{e:{var n=ke(e);e=t;for(var a,r=t=0;r<s;r++){var o=E[e>>2],l=E[e+4>>2];e+=8;var c=et(n,C,o,l,a);if(0>c){var A=-1;break e}if(t+=c,c<l)break;void 0!==a&&(a+=c)}A=t}return E[i>>2]=A,0}catch(d){if("ErrnoError"!==d.name)throw d;return d.Pa}},k:ut};!async function(){var e;function t(e){var t;return xt=e.exports,v=xt.M,T(),rt=xt.O,k--,null==(t=n.monitorRunDependencies)||t.call(n,k),0==k&&O&&(e=O,O=null,e()),xt}k++,null==(e=n.monitorRunDependencies)||e.call(n,k);var s={a:It};n.instantiateWasm?new Promise(e=>{n.instantiateWasm(s,(s,i)=>{t(s),e(s.exports)})}):(R??(R=n.locateFile?n.locateFile("sql-wasm.wasm",g):g+"sql-wasm.wasm"),t((await async function(e){var t=R;if(!j&&"function"==typeof WebAssembly.instantiateStreaming&&!D(t)&&!c)try{var s=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(s,e)}catch(i){f(`wasm streaming compile failed: ${i}`),f("falling back to ArrayBuffer instantiation")}return F(t,e)}(s)).instance))}(),n._sqlite3_free=e=>(n._sqlite3_free=xt.P)(e),n._sqlite3_value_text=e=>(n._sqlite3_value_text=xt.Q)(e),n._sqlite3_prepare_v2=(e,t,s,i,a)=>(n._sqlite3_prepare_v2=xt.R)(e,t,s,i,a),n._sqlite3_step=e=>(n._sqlite3_step=xt.S)(e),n._sqlite3_reset=e=>(n._sqlite3_reset=xt.T)(e),n._sqlite3_exec=(e,t,s,i,a)=>(n._sqlite3_exec=xt.U)(e,t,s,i,a),n._sqlite3_finalize=e=>(n._sqlite3_finalize=xt.V)(e),n._sqlite3_column_name=(e,t)=>(n._sqlite3_column_name=xt.W)(e,t),n._sqlite3_column_text=(e,t)=>(n._sqlite3_column_text=xt.X)(e,t),n._sqlite3_column_type=(e,t)=>(n._sqlite3_column_type=xt.Y)(e,t),n._sqlite3_errmsg=e=>(n._sqlite3_errmsg=xt.Z)(e),n._sqlite3_clear_bindings=e=>(n._sqlite3_clear_bindings=xt._)(e),n._sqlite3_value_blob=e=>(n._sqlite3_value_blob=xt.$)(e),n._sqlite3_value_bytes=e=>(n._sqlite3_value_bytes=xt.aa)(e),n._sqlite3_value_double=e=>(n._sqlite3_value_double=xt.ba)(e),n._sqlite3_value_int=e=>(n._sqlite3_value_int=xt.ca)(e),n._sqlite3_value_type=e=>(n._sqlite3_value_type=xt.da)(e),n._sqlite3_result_blob=(e,t,s,i)=>(n._sqlite3_result_blob=xt.ea)(e,t,s,i),n._sqlite3_result_double=(e,t)=>(n._sqlite3_result_double=xt.fa)(e,t),n._sqlite3_result_error=(e,t,s)=>(n._sqlite3_result_error=xt.ga)(e,t,s),n._sqlite3_result_int=(e,t)=>(n._sqlite3_result_int=xt.ha)(e,t),n._sqlite3_result_int64=(e,t)=>(n._sqlite3_result_int64=xt.ia)(e,t),n._sqlite3_result_null=e=>(n._sqlite3_result_null=xt.ja)(e),n._sqlite3_result_text=(e,t,s,i)=>(n._sqlite3_result_text=xt.ka)(e,t,s,i),n._sqlite3_aggregate_context=(e,t)=>(n._sqlite3_aggregate_context=xt.la)(e,t),n._sqlite3_column_count=e=>(n._sqlite3_column_count=xt.ma)(e),n._sqlite3_data_count=e=>(n._sqlite3_data_count=xt.na)(e),n._sqlite3_column_blob=(e,t)=>(n._sqlite3_column_blob=xt.oa)(e,t),n._sqlite3_column_bytes=(e,t)=>(n._sqlite3_column_bytes=xt.pa)(e,t),n._sqlite3_column_double=(e,t)=>(n._sqlite3_column_double=xt.qa)(e,t),n._sqlite3_bind_blob=(e,t,s,i,a)=>(n._sqlite3_bind_blob=xt.ra)(e,t,s,i,a),n._sqlite3_bind_double=(e,t,s)=>(n._sqlite3_bind_double=xt.sa)(e,t,s),n._sqlite3_bind_int=(e,t,s)=>(n._sqlite3_bind_int=xt.ta)(e,t,s),n._sqlite3_bind_text=(e,t,s,i,a)=>(n._sqlite3_bind_text=xt.ua)(e,t,s,i,a),n._sqlite3_bind_parameter_index=(e,t)=>(n._sqlite3_bind_parameter_index=xt.va)(e,t),n._sqlite3_sql=e=>(n._sqlite3_sql=xt.wa)(e),n._sqlite3_normalized_sql=e=>(n._sqlite3_normalized_sql=xt.xa)(e),n._sqlite3_changes=e=>(n._sqlite3_changes=xt.ya)(e),n._sqlite3_close_v2=e=>(n._sqlite3_close_v2=xt.za)(e),n._sqlite3_create_function_v2=(e,t,s,i,a,r,o,l,c)=>(n._sqlite3_create_function_v2=xt.Aa)(e,t,s,i,a,r,o,l,c),n._sqlite3_update_hook=(e,t,s)=>(n._sqlite3_update_hook=xt.Ba)(e,t,s),n._sqlite3_open=(e,t)=>(n._sqlite3_open=xt.Ca)(e,t);var wt=n._malloc=e=>(wt=n._malloc=xt.Da)(e),Et=n._free=e=>(Et=n._free=xt.Ea)(e);n._RegisterExtensionFunctions=e=>(n._RegisterExtensionFunctions=xt.Fa)(e);var Bt=(e,t)=>(Bt=xt.Ga)(e,t),St=(e,t)=>(St=xt.Ha)(e,t),Qt=e=>(Qt=xt.Ia)(e),jt=e=>(jt=xt.Ja)(e),Mt=()=>(Mt=xt.Ka)();if(n.stackSave=()=>Mt(),n.stackRestore=e=>Qt(e),n.stackAlloc=e=>jt(e),n.cwrap=(e,t,s,i)=>{var a=!s||s.every(e=>"number"===e||"boolean"===e);return"string"!==t&&a&&!i?n["_"+e]:(...i)=>((e,t,s,i)=>{var a={string:e=>{var t=0;return null!=e&&0!==e&&(t=mt(e)),t},array:e=>{var t=jt(e.length);return C.set(e,t),t}};e=n["_"+e];var r,o=[],l=0;if(i)for(var c=0;c<i.length;c++){var A=a[s[c]];A?(0===l&&(l=Mt()),o[c]=A(i[c])):o[c]=i[c]}return s=e(...o),r=s,0!==l&&Qt(l),"string"===t?r?W(x,r):"":"boolean"===t?!!r:r})(e,t,s,i)},n.addFunction=Ct,n.removeFunction=yt,n.UTF8ToString=V,n.ALLOC_NORMAL=bt,n.allocate=ft,n.allocateUTF8OnStack=mt,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);0<n.preInit.length;)n.preInit.pop()();return function e(){function t(){var e;if(n.calledRun=!0,!M){var t,s;if(n.noFSInit||me||(me=!0,i??(i=n.stdin),t??(t=n.stdout),s??(s=n.stderr),i?tt("stdin",i):Ue("/dev/tty","/dev/stdin"),t?tt("stdout",null,t):Ue("/dev/tty","/dev/stdout"),s?tt("stderr",null,s):Ue("/dev/tty1","/dev/stderr"),Je("/dev/stdin",0),Je("/dev/stdout",1),Je("/dev/stderr",1)),xt.N(),be=!1,null==(e=n.onRuntimeInitialized)||e.call(n),n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;){var i=n.postRun.shift();G.unshift(i)}N(G)}}if(0<k)O=e;else{if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)z();N(_),0<k?O=e:n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),t()},1)):t()}}(),a}))},(Fi=Oi).exports=Ni,Fi.exports.default=Ni;const Gi=a(Oi.exports),_i="sqlite_db",zi="sqlite";let Ui=null,Hi=null,qi=null;const Ki="Web3DModelEditorDB",Wi="customMeshes",Vi="sqlite_legacy_migrated_v1";function Yi(e){let t="";for(let s=0;s<e.length;s+=32768){const i=e.subarray(s,Math.min(s+32768,e.length));t+=String.fromCharCode.apply(null,Array.from(i))}return btoa(t)}function Ji(e){return e instanceof Uint8Array?Yi(e):Yi(new Uint8Array(e))}function Xi(e){if(!e)return new Uint8Array(0);const t=atob(e),s=t.length,i=new Uint8Array(s);for(let n=0;n<s;n++)i[n]=t.charCodeAt(n);return i}function Zi(){return new Promise((e,t)=>{const s=indexedDB.open("Web3DModelEditorSQLite",1);s.onupgradeneeded=()=>{const e=s.result;e.objectStoreNames.contains(zi)||e.createObjectStore(zi)},s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async function $i(){const e=await async function(e){try{const t=await Zi();return await new Promise((s,i)=>{const n=t.transaction(zi,"readonly").objectStore(zi).get(e);n.onsuccess=()=>s(n.result||null),n.onerror=()=>i(n.error)})}catch{return null}}(_i);if(e)try{const t=await(e.arrayBuffer?e.arrayBuffer():e);return new Uint8Array(t)}catch{}try{const e=localStorage.getItem(_i);return e?Uint8Array.from(atob(e),e=>e.charCodeAt(0)):null}catch{return null}}async function en(){try{const e=Hi.export();await async function(e,t){try{const s=await Zi();return await new Promise((i,n)=>{const a=s.transaction(zi,"readwrite").objectStore(zi).put(t,e);a.onsuccess=()=>i(),a.onerror=()=>n(a.error)})}catch(s){}}(_i,new Blob([e],{type:"application/octet-stream"}));try{const t=Ji(e);localStorage.setItem(_i,t)}catch{}}catch(e){}}async function tn(){return Hi||(qi||(qi=(async()=>{Ui=await Gi({locateFile:e=>e.endsWith("sql-wasm.wasm")?"/assets/sql-wasm-0734155c.wasm":e});const e=await $i();Hi=e?new Ui.Database(e):new Ui.Database,Hi.exec("\nCREATE TABLE IF NOT EXISTS app_settings (\n  key TEXT PRIMARY KEY,\n  value TEXT\n);\nCREATE TABLE IF NOT EXISTS custom_meshes (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  data_b64 TEXT,\n  thumbnail_b64 TEXT,\n  created_at INTEGER\n);\n");try{localStorage.getItem(Vi)||(await async function(){if("undefined"==typeof indexedDB)return;const e=await new Promise(e=>{const t=indexedDB.open(Ki);t.onerror=()=>e(null),t.onsuccess=()=>{const s=t.result;try{if(!s.objectStoreNames||!s.objectStoreNames.contains(Wi))return e([]);const t=s.transaction(Wi,"readonly"),i=t.objectStore(Wi).getAll();i.onsuccess=()=>e(i.result||[]),i.onerror=()=>e(null)}catch(i){e([])}}});if(!e||!Array.isArray(e)||0===e.length)return;for(const t of e)try{await nn({id:t.id,name:t.name,glbData:t.glbData,thumbnail:t.thumbnail})}catch{}}(),localStorage.setItem(Vi,"1"),sn())}catch(t){}return Hi})()),qi)}function sn(){Hi&&en()}async function nn(e){const t=await tn(),{id:s,name:i,data:n,glbData:a,thumbnail:r}=e,o=n||a||null,l=o?Ji(o instanceof Uint8Array?o:new Uint8Array(o)):null,c="string"==typeof r?r:null,A=Date.now(),d=t.prepare("INSERT INTO custom_meshes(id, name, data_b64, thumbnail_b64, created_at) VALUES(?, ?, ?, ?, ?)\nON CONFLICT(id) DO UPDATE SET name=excluded.name, data_b64=excluded.data_b64, thumbnail_b64=excluded.thumbnail_b64");d.run([s,i??"",l,c,A]),d.free(),sn()}const an="web3dEditor.settings.v1",rn=(e,t)=>{return{...e,...(s=t,"[object Object]"===Object.prototype.toString.call(s)?t:{})};var s};const on={isWireframe:!1,isGridSnap:!1,isGridVisible:!0,gizmoSpace:"world",gizmoSize:.5,snapMove:1,snapRotateDeg:5,snapScale:.01,cameraPanSpeed:10,cameraOrbitSpeed:10,cameraZoomSpeed:.5,isPostProcessingEnabled:!1},ln={showLibrary:!1,showAssets:!0,isPostProcessingPanelOpen:!1,showHDRI:!1,isViewGizmoSettingsOpen:!1,dragUseSelectionForDnD:!1},cn={},An={},dn={hdriSettings:{currentHDRI:{name:"기본 배경",type:"none"},hdriIntensity:1,hdriRotation:0,sunLightEnabled:!0,sunIntensity:1,timeOfDay:12,sunAzimuth:0,sunElevation:45,sunColor:"#ffffff"},postProcessing:{enabled:!1,preset:"default"},toneMapping:{enabled:!0,mapping:"ACESFilmic",exposure:1},safeMode:{enabled:!1,pixelRatio:1},rendererAA:"msaa",renderMode:"continuous"},hn={__version:1,viewGizmo:{...on},ui:{...ln},editor:{...cn},game:{...An},environment:{...dn}};function un(e){const t=rn(hn,e);return t.viewGizmo=rn(on,t.viewGizmo),t.ui=rn(ln,t.ui),t.editor=rn(cn,t.editor),t.game=rn(An,t.game),t.environment=rn(dn,t.environment),t}async function pn(){try{const e=await async function(){const e=(await tn()).prepare("SELECT value FROM app_settings WHERE key = ?");let t=null;if(e.step())try{t=JSON.parse(e.getAsObject().value)}catch{t=null}return e.free(),t}();if(e&&"object"==typeof e)return un(e)}catch{}return{...hn}}async function gn(e){const t=un(e||{});try{await async function(e,t){const s=await tn(),i=JSON.stringify(t??null),n=s.prepare("INSERT INTO app_settings(key, value) VALUES(?, ?)\nON CONFLICT(key) DO UPDATE SET value=excluded.value");n.run([e,i]),n.free(),sn()}(an,t)}catch{}return!0}async function mn(e){const t=await pn();return null==t?void 0:t[e]}async function bn(e,t){const s=await pn();return gn({...s,[e]:rn((null==s?void 0:s[e])||{},t||{})})}function fn(e,t,s,i=150){if(!e||"function"!=typeof e.getState||"function"!=typeof e.subscribe)return()=>{};if("function"!=typeof s)return()=>{};let n=s(e.getState());const a=function(e,t=200){let s=null;return(...i)=>{clearTimeout(s),s=setTimeout(()=>e(...i),t)}}(e=>{try{bn(t,e)}catch{}},i);return e.subscribe(e=>{try{const t=s(e);((e,t)=>{if(e===t)return!0;if(!e||!t)return!1;const s=Object.keys(e),i=Object.keys(t);if(s.length!==i.length)return!1;for(const n of s)if(e[n]!==t[n])return!1;return!0})(t,n)||(n=t,a(t))}catch{}})}function vn(e){return fn(e,"viewGizmo",e=>({isWireframe:!!e.isWireframe,isGridSnap:!!e.isGridSnap,isGridVisible:!!e.isGridVisible,gizmoSpace:e.gizmoSpace||"world",gizmoSize:Number.isFinite(e.gizmoSize)?e.gizmoSize:1,snapMove:Number.isFinite(e.snapMove)?e.snapMove:1,snapRotateDeg:Number.isFinite(e.snapRotateDeg)?e.snapRotateDeg:15,snapScale:Number.isFinite(e.snapScale)?e.snapScale:.1,isPostProcessingEnabled:!!e.isPostProcessingEnabled,cameraPanSpeed:Number.isFinite(e.cameraPanSpeed)?e.cameraPanSpeed:50,cameraOrbitSpeed:Number.isFinite(e.cameraOrbitSpeed)?e.cameraOrbitSpeed:100,cameraZoomSpeed:Number.isFinite(e.cameraZoomSpeed)?e.cameraZoomSpeed:.3}),150)}async function yn(){const e=await mn("viewGizmo");return rn(on,e||{})}async function Cn(){const e=await mn("environment");return rn(dn,e||{})}async function xn(e){return bn("environment",e)}function In(e){return fn(e,"environment",e=>{var t,s;return{hdriSettings:{...e.hdriSettings||{}},postProcessing:{enabled:!!e.isPostProcessingEnabled,preset:e.postProcessingPreset||"default"},safeMode:{enabled:!!(null==(t=e.safeMode)?void 0:t.enabled),pixelRatio:Number((null==(s=e.safeMode)?void 0:s.pixelRatio)??1)}}},200)}const wn=Object.freeze(Object.defineProperty({__proto__:null,defaultAppSettings:hn,defaultEditorSettings:cn,defaultEnvironmentSettings:dn,defaultGameSettings:An,defaultUISettings:ln,defaultViewGizmoConfig:on,getAppSettingsAsync:pn,loadEnvironmentSettingsAsync:Cn,loadSettingsSectionAsync:mn,loadViewGizmoConfigAsync:yn,saveAppSettingsAsync:gn,saveEnvironmentSettingsAsync:xn,saveSettingsSectionAsync:bn,startEnvironmentAutoPersist:In,startSettingsAutoPersist:fn,startViewGizmoConfigAutoPersist:vn},Symbol.toStringTag,{value:"Module"})),En=async()=>{try{return await async function(){const e=[],t=(await tn()).prepare("SELECT id, name, data_b64, thumbnail_b64, created_at FROM custom_meshes ORDER BY created_at ASC");for(;t.step();){const s=t.getAsObject();e.push({id:s.id,name:s.name,glbData:s.data_b64?Xi(s.data_b64).buffer:null,thumbnail:s.thumbnail_b64||null,createdAt:s.created_at})}return t.free(),e}()}catch(e){return[]}},Bn=async e=>{await nn({id:e.id,name:e.name,data:e.glbData,thumbnail:e.thumbnail})},Sn=async e=>{await async function(e){const t=(await tn()).prepare("DELETE FROM custom_meshes WHERE id = ?");t.run([e]),t.free(),sn()}(e)},Qn={...(null==dn?void 0:dn.hdriSettings)||{}},jn=(e,t={x:0,y:0,z:0})=>{if(!e&&0!==e)return{...t};if(Array.isArray(e)){const[s=t.x,i=t.y,n=t.z]=e;return{x:s,y:i,z:n}}if("object"==typeof e){return{x:Number.isFinite(e.x)?e.x:t.x,y:Number.isFinite(e.y)?e.y:t.y,z:Number.isFinite(e.z)?e.z:t.z}}return{...t}},Mn=e=>{if(!e||"object"!=typeof e)return e;const t={...e};return t.position=jn(e.position,{x:0,y:0,z:0}),t.rotation=jn(e.rotation,{x:0,y:0,z:0}),t.scale=jn(e.scale,{x:1,y:1,z:1}),t},Dn=Ht((e,t)=>{var s,i;const n={...on},a={...ln};return(async()=>{try{const t=await Promise.allSettled([yn(),mn("ui"),Cn()]);try{if("fulfilled"===t[0].status&&t[0].value){const s=t[0].value;e(e=>({isWireframe:!!s.isWireframe,isGridSnap:!!s.isGridSnap,isGridVisible:!!s.isGridVisible,gizmoSpace:s.gizmoSpace||"world",gizmoSize:Number.isFinite(s.gizmoSize)?s.gizmoSize:e.gizmoSize,snapMove:Number.isFinite(s.snapMove)?s.snapMove:e.snapMove,snapRotateDeg:Number.isFinite(s.snapRotateDeg)?s.snapRotateDeg:e.snapRotateDeg,snapScale:Number.isFinite(s.snapScale)?s.snapScale:e.snapScale,cameraPanSpeed:Number.isFinite(s.cameraPanSpeed)?s.cameraPanSpeed:e.cameraPanSpeed,cameraOrbitSpeed:Number.isFinite(s.cameraOrbitSpeed)?s.cameraOrbitSpeed:e.cameraOrbitSpeed,cameraZoomSpeed:Number.isFinite(s.cameraZoomSpeed)?s.cameraZoomSpeed:e.cameraZoomSpeed,isPostProcessingEnabled:!!s.isPostProcessingEnabled}))}}finally{try{e({viewReady:!0})}catch{}}try{if("fulfilled"===t[1].status&&t[1].value){const s=t[1].value;e({showLibrary:!!s.showLibrary,showAssets:!!s.showAssets,isPostProcessingPanelOpen:!!s.isPostProcessingPanelOpen,showHDRI:!!s.showHDRI,isViewGizmoSettingsOpen:!!s.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!s.dragUseSelectionForDnD})}}finally{try{e({uiReady:!0})}catch{}}try{if("fulfilled"===t[2].status&&t[2].value){const s=t[2].value;e(e=>{var t,i;return{isPostProcessingEnabled:!!((null==(t=s.postProcessing)?void 0:t.enabled)??e.isPostProcessingEnabled),postProcessingPreset:(null==(i=s.postProcessing)?void 0:i.preset)||e.postProcessingPreset,safeMode:{...e.safeMode,...s.safeMode||{}},rendererAA:s.rendererAA||e.rendererAA,renderMode:s.renderMode||e.renderMode,hdriSettings:s.hdriSettings?{...e.hdriSettings,...s.hdriSettings}:e.hdriSettings}})}}finally{try{e({envReady:!0})}catch{}}}catch{try{e({viewReady:!0,uiReady:!0,envReady:!0})}catch{}}})(),{scene:null,camera:null,renderer:null,_historyPast:[],_historyFuture:[],_batchActive:!1,_batchBuffer:[],canUndo:!1,canRedo:!1,selectedObject:null,selectedIds:[],transformMode:"translate",isWireframe:!!n.isWireframe,isGridSnap:!!n.isGridSnap,isGridVisible:!!n.isGridVisible,gridSize:1,gizmoSpace:n.gizmoSpace||"world",gizmoSize:Number.isFinite(n.gizmoSize)?n.gizmoSize:.5,snapMove:Number.isFinite(n.snapMove)?n.snapMove:1,snapRotateDeg:Number.isFinite(n.snapRotateDeg)?n.snapRotateDeg:5,snapScale:Number.isFinite(n.snapScale)?n.snapScale:.01,cameraPanSpeed:Number.isFinite(n.cameraPanSpeed)?n.cameraPanSpeed:10,cameraOrbitSpeed:Number.isFinite(n.cameraOrbitSpeed)?n.cameraOrbitSpeed:10,cameraZoomSpeed:Number.isFinite(n.cameraZoomSpeed)?n.cameraZoomSpeed:.5,hdriSettings:{currentHDRI:{name:"기본 배경",type:"none"},hdriIntensity:1,hdriRotation:0,sunLightEnabled:!0,sunIntensity:1,timeOfDay:12,sunAzimuth:0,sunElevation:45,sunColor:"#ffffff",...Qn},sunLightRef:null,dropIndicator:{easing:"easeInOutQuad",inMs:200,outMs:220,maxOpacity:.6},postProcessingManager:null,viewReady:!1,uiReady:!1,envReady:!1,isPostProcessingEnabled:!!(null==(s=null==dn?void 0:dn.postProcessing)?void 0:s.enabled),postProcessingPreset:(null==(i=null==dn?void 0:dn.postProcessing)?void 0:i.preset)||"default",safeMode:{enabled:!1,pixelRatio:1,notes:"Disables FXAA/SSAO and forces pixelRatio to 1.0 to reduce VRAM."},vramEstimateMB:0,stats:{fps:0,objects:0,vertices:0,triangles:0},rendererAA:(null==dn?void 0:dn.rendererAA)||"msaa",renderMode:(null==dn?void 0:dn.renderMode)||"continuous",savedObjects:new Map,customMeshes:[],objects:[],walls:[],clipboard:null,showLibrary:!!a.showLibrary,showAssets:!!a.showAssets,isPostProcessingPanelOpen:!!a.isPostProcessingPanelOpen,showHDRI:!!a.showHDRI,isViewGizmoSettingsOpen:!!a.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!a.dragUseSelectionForDnD,setShowLibrary:t=>e({showLibrary:!!t}),setShowAssets:t=>e({showAssets:!!t}),setIsPostProcessingPanelOpen:t=>e({isPostProcessingPanelOpen:!!t}),setShowHDRI:t=>e({showHDRI:!!t}),setIsViewGizmoSettingsOpen:t=>e({isViewGizmoSettingsOpen:!!t}),setDragUseSelectionForDnD:t=>e({dragUseSelectionForDnD:!!t}),setSelectedObject:t=>e({selectedObject:t}),setSelectedIds:t=>e({selectedIds:Array.isArray(t)?Array.from(new Set(t)):[]}),setTransformMode:t=>e({transformMode:t}),toggleWireframe:()=>e(e=>({isWireframe:!e.isWireframe})),toggleGridSnap:()=>e(e=>({isGridSnap:!e.isGridSnap})),toggleGridVisible:()=>e(e=>({isGridVisible:!e.isGridVisible})),setGridSize:t=>e({gridSize:t}),toggleGizmoSpace:()=>e(e=>({gizmoSpace:"world"===e.gizmoSpace?"local":"world"})),setGizmoSize:t=>e({gizmoSize:Math.max(.1,Math.min(5,Number(t)||1))}),setSnapMove:t=>e({snapMove:Math.max(.001,Math.min(1e3,Number(t)||1))}),setSnapRotateDeg:t=>e({snapRotateDeg:Math.max(.1,Math.min(360,Number(t)||15))}),setSnapScale:t=>e({snapScale:Math.max(.001,Math.min(100,Number(t)||.1))}),setCameraPanSpeed:t=>e({cameraPanSpeed:Math.max(1,Math.min(500,Number(t)||50))}),setCameraOrbitSpeed:t=>e({cameraOrbitSpeed:Math.max(1,Math.min(1e3,Number(t)||100))}),setCameraZoomSpeed:t=>e({cameraZoomSpeed:Math.max(.01,Math.min(5,Number(t)||.3))}),rehydrateViewGizmoConfig:async()=>{try{const t=await yn();e({isWireframe:!!t.isWireframe,isGridSnap:!!t.isGridSnap,isGridVisible:!!t.isGridVisible,gizmoSpace:t.gizmoSpace||"world",gizmoSize:Number.isFinite(t.gizmoSize)?t.gizmoSize:.5,snapMove:Number.isFinite(t.snapMove)?t.snapMove:1,snapRotateDeg:Number.isFinite(t.snapRotateDeg)?t.snapRotateDeg:5,snapScale:Number.isFinite(t.snapScale)?t.snapScale:.01,isPostProcessingEnabled:!!t.isPostProcessingEnabled,cameraPanSpeed:Number.isFinite(t.cameraPanSpeed)?t.cameraPanSpeed:10,cameraOrbitSpeed:Number.isFinite(t.cameraOrbitSpeed)?t.cameraOrbitSpeed:10,cameraZoomSpeed:Number.isFinite(t.cameraZoomSpeed)?t.cameraZoomSpeed:.5})}catch{}},useBlenderControls:!0,setUseBlenderControls:t=>e({useBlenderControls:!!t}),updateHDRISettings:t=>e(e=>({hdriSettings:{...e.hdriSettings,...t}})),setSunLightRef:t=>e({sunLightRef:t}),updateDropIndicator:t=>e(e=>({dropIndicator:{...e.dropIndicator,...t}})),setPostProcessingManager:t=>e({postProcessingManager:t}),setRendererAA:s=>{var i;const n=["msaa","fxaa","none"].includes(s)?s:"msaa";e({rendererAA:n});try{xn({rendererAA:n})}catch{}try{const e=t().postProcessingManager;e&&e.setEffectEnabled("fxaa","fxaa"===n&&!(null==(i=t().safeMode)?void 0:i.enabled))}catch{}},setRenderMode:t=>{const s=["continuous","on-demand"].includes(t)?t:"continuous";e({renderMode:s});try{xn({renderMode:s})}catch{}},togglePostProcessingEnabled:()=>e(e=>({isPostProcessingEnabled:!e.isPostProcessingEnabled})),setPostProcessingPreset:t=>e({postProcessingPreset:t||"default"}),setStats:t=>e(e=>({stats:{...e.stats,...t}})),toggleSafeMode:s=>{const i=void 0!==s?!!s:!t().safeMode.enabled,n={...t().safeMode,enabled:i};e({safeMode:n});try{const e=t().postProcessingManager;e&&(e.setEffectEnabled("fxaa",!i),e.setEffectEnabled("ssao",!i),e.handleResize(window.innerWidth,window.innerHeight))}catch{}try{const e=t().renderer;if(e){const s=i?t().safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);e.setPixelRatio(s)}}catch{}try{t().estimateVRAMUsage()}catch{}try{xn({safeMode:{enabled:t().safeMode.enabled,pixelRatio:t().safeMode.pixelRatio}})}catch{}},setSafeModePixelRatio:s=>{const i=Math.max(.5,Math.min(2,Number(s)||1)),n={...t().safeMode,pixelRatio:i};e({safeMode:n});try{const e=t().renderer;e&&t().safeMode.enabled&&e.setPixelRatio(i)}catch{}try{const e=t().postProcessingManager;e&&e.handleResize(window.innerWidth,window.innerHeight)}catch{}try{t().estimateVRAMUsage()}catch{}try{xn({safeMode:{enabled:t().safeMode.enabled,pixelRatio:i}})}catch{}},estimateVRAMUsage:(s={})=>{var i,n,a,r,o;const l=s.width||window.innerWidth,c=s.height||window.innerHeight;let A=1;try{A=(null==(n=null==(i=t().renderer)?void 0:i.getPixelRatio)?void 0:n.call(i))||window.devicePixelRatio||1}catch{}const d=Math.max(1,Math.floor(l*A)),h=Math.max(1,Math.floor(c*A));let u=d*h*8;try{const e=t().postProcessingManager,s=t().isPostProcessingEnabled;if(e&&s){u+=d*h*8;const t=(null==(a=e.getSettings)?void 0:a.call(e))||{};(null==(r=t.ssao)?void 0:r.enabled)&&(u+=d*h*2*4),(null==(o=t.fxaa)?void 0:o.enabled)&&(u+=d*h*4)}}catch{}const p=Math.round(u/1048576);return e({vramEstimateMB:p}),p},initializeHDRISettings:()=>!1,saveHDRISettings:async()=>{const{hdriSettings:e}=t();try{await xn({hdriSettings:{...e||{}}})}catch{}},addAsset:(t,s)=>e(e=>{const i=new Map(e.savedObjects);return i.set(t,s),{savedObjects:i}}),addCustomMesh:async t=>{try{await Bn(t),e(e=>({customMeshes:[...e.customMeshes,t]}))}catch(s){try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"저장에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}catch{}}},deleteCustomMesh:async t=>{try{await Sn(t),e(e=>({customMeshes:e.customMeshes.filter(e=>e.id!==t)}))}catch(s){try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}catch{}}},loadCustomMeshes:t=>e(()=>({customMeshes:(Array.isArray(t)?t:[]).map(e=>({...e,type:"custom"}))})),updateObjectTransform:(s,i)=>e(e=>{const n=Mn(i),a=e.objects.find(e=>e.id===s),r=a?{...a,...n}:null,o=e.objects.map(e=>e.id===s?{...e,...n}:e);if(a){const e={type:"transform",id:s,before:Rn(a),after:Rn(r)},{_pushHistory:i}=t();i(e)}return{objects:o}}),addObject:s=>e(e=>{const i=Mn(s),n=Object.prototype.hasOwnProperty.call(i,"parentId")?i.parentId??null:null;let a=i.order;if(!Number.isFinite(a)){a=e.objects.filter(e=>(e.parentId??null)===n).reduce((e,t)=>Number.isFinite(t.order)?Math.max(e,t.order):e,-1)+1}const r={...i,parentId:n,order:a},o=[...e.objects,r],l={type:"add",object:Tn(r)},{_pushHistory:c}=t();return c(l),{objects:o}}),removeObject:s=>e(e=>{if(s.isSystemObject)return e;const i=e.objects.filter(e=>e!==s),n={type:"remove",object:Tn(s)},{_pushHistory:a}=t();return a(n),{objects:i,selectedObject:e.selectedObject===s?null:e.selectedObject}}),removeObjectById:s=>e(e=>{const i=e.objects.find(e=>e.id===s);if(!i)return{};if(i.isSystemObject)return{};const{_pushHistory:n}=t(),a=e.objects.filter(e=>e.parentId===s);let r=e.objects;for(const t of a){const e=t.parentId??null,s=i.parentId??null;e!==s&&(n({type:"reparent",id:t.id,before:{parentId:e},after:{parentId:s}}),r=r.map(e=>e.id===t.id?{...e,parentId:s}:e))}n({type:"remove",object:Tn(i)});return{objects:r.filter(e=>e.id!==s),selectedObject:e.selectedObject&&("object"==typeof e.selectedObject?e.selectedObject.id:e.selectedObject)===s?null:e.selectedObject}}),setParent:(s,i)=>e(e=>{const n=e.objects.find(e=>e.id===s);if(!n)return{};const a=n.parentId??null,r=i??null;if(a===r)return{};const o={type:"reparent",id:s,before:{parentId:a},after:{parentId:r}},{_pushHistory:l}=t();l(o);const c=e.objects.filter(e=>(e.parentId??null)===r&&e.id!==s).reduce((e,t)=>Number.isFinite(t.order)?Math.max(e,t.order):e,-1)+1;return{objects:e.objects.map(e=>e.id===s?{...e,parentId:r,order:c}:e)}}),reorderSiblings:(t,s)=>e(e=>{if(!Array.isArray(s))return{};const i=new Map(s.map((e,t)=>[e,t]));return{objects:e.objects.map(e=>(e.parentId??null)!==(t??null)?e:i.has(e.id)?{...e,order:i.get(e.id)}:e)}}),addWall:t=>e(e=>({walls:[...e.walls,t]})),removeWall:t=>e(e=>({walls:e.walls.filter(e=>e.id!==t)})),updateObject:(s,i)=>e(e=>{const n=e.objects.find(e=>e.id===s),a=Mn(i),r=e.objects.map(e=>e.id===s?{...e,...a}:e);if(n){const e={type:"update",id:s,before:kn(n,a),after:a},{_pushHistory:i}=t();i(e)}return{objects:r}}),copyObject:s=>{var i,n,a,r,o;if(!s)return;if(s.isObject3D){t();const l=null==(i=s.userData)?void 0:i.id;if(l){const{updateObjectTransform:e}=t();e(l,{position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}})}const c=t().objects.find(e=>e.id===l),A={name:`${s.name}_copy`,type:(null==c?void 0:c.type)||(null==(n=s.userData)?void 0:n.type)||"basic",geometry:(null==c?void 0:c.geometry)||(null==(a=s.userData)?void 0:a.geometry)||"BoxGeometry",params:(null==c?void 0:c.params)||(null==(r=s.userData)?void 0:r.params)||[1,1,1],uuid:s.uuid,..."glb"===(null==c?void 0:c.type)&&{url:c.url,customMeshId:c.customMeshId,file:void 0},position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z},visible:s.visible,material:(null==c?void 0:c.material)||(null==(o=s.userData)?void 0:o.material)||{type:"MeshStandardMaterial",color:16711680},originalObject:s};return void e({clipboard:A})}if(s.isSystemObject)return;const l={...s,id:void 0,name:`${s.name}_copy`};e({clipboard:l})},pasteObject:()=>{var s,i,n,a,r,o,l,c,A;const d=t();if(!d.clipboard)return null;const h={...d.clipboard,id:Date.now(),position:{x:(null==(s=d.clipboard.position)?void 0:s.x)||0,y:(null==(i=d.clipboard.position)?void 0:i.y)||0,z:(null==(n=d.clipboard.position)?void 0:n.z)||0},rotation:{x:(null==(a=d.clipboard.rotation)?void 0:a.x)||0,y:(null==(r=d.clipboard.rotation)?void 0:r.y)||0,z:(null==(o=d.clipboard.rotation)?void 0:o.z)||0},scale:{x:(null==(l=d.clipboard.scale)?void 0:l.x)||1,y:(null==(c=d.clipboard.scale)?void 0:c.y)||1,z:(null==(A=d.clipboard.scale)?void 0:A.z)||1}},u=[...d.objects,h];return e({objects:u,selectedObject:h.id}),h},hasClipboardData:()=>null!==t().clipboard,clearClipboard:()=>e({clipboard:null}),deleteSelectedObject:()=>{const s=t();if(!s.selectedObject)return;const i="object"==typeof s.selectedObject?s.selectedObject.id:s.selectedObject;if(!i)return;const n=s.objects.find(e=>e.id===i);if(!n)return;if(n.isSystemObject)return;const a=s.objects.filter(e=>e.id!==i),r={type:"remove",object:Tn(n)},{_pushHistory:o}=t();o(r),e({objects:a,selectedObject:null})},updateWall:(t,s)=>e(e=>({walls:e.walls.map(e=>e.id===t?{...e,...s}:e)})),toggleObjectVisibility:s=>e(e=>{const i=!1===s.visible,n=e.objects.map(e=>e.id===s.id?{...e,visible:i}:e),a={type:"update",id:s.id,before:{visible:s.visible},after:{visible:i}},{_pushHistory:r}=t();r(a);return{objects:n,walls:e.walls.map(e=>e.id===s.id?{...e,visible:i}:e)}}),toggleObjectFreeze:s=>e(e=>{const i=!0!==s.frozen,n=e.objects.map(e=>e.id===s.id?{...e,frozen:i}:e),a={type:"update",id:s.id,before:{frozen:s.frozen},after:{frozen:i}},{_pushHistory:r}=t();r(a);return{objects:n,walls:e.walls.map(e=>e.id===s.id?{...e,frozen:i}:e)}}),renameObject:(s,i)=>e(e=>{const n=e.objects.find(e=>e.id===s),a=e.objects.map(e=>e.id===s?{...e,name:i}:e);if(n){const e={type:"update",id:s,before:{name:n.name},after:{name:i}},{_pushHistory:a}=t();a(e)}return{objects:a,walls:e.walls.map(e=>e.id===s?{...e,name:i}:e)}}),syncSceneToState:()=>{const s=t(),i=s.scene;if(!i)return!1;const n=new Map;try{i.traverse(e=>{var t;const s=null==(t=null==e?void 0:e.userData)?void 0:t.id;s&&n.set(s,e)})}catch{}const a=s.objects.map(e=>{const t=Mn(e),s=n.get(e.id);if(!s||!s.isObject3D)return t;const i={...t,position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}};try{const t=e.type,n="light"===t?e.lightType:"directional_light"===t?"directional":"point_light"===t?"point":"spot_light"===t?"spot":null;s.isLight&&n&&("number"==typeof s.intensity&&(i.intensity=s.intensity),s.color&&"function"==typeof s.color.getHex&&(i.color=s.color.getHex()),i.castShadow=!!s.castShadow,"point"!==n&&"spot"!==n||("number"==typeof s.distance&&(i.distance=s.distance),"number"==typeof s.decay&&(i.decay=s.decay)),"spot"===n&&("number"==typeof s.angle&&(i.angle=s.angle),"number"==typeof s.penumbra&&(i.penumbra=s.penumbra)))}catch{}return i});return e({objects:a}),!0},saveMap:(e,s)=>{var i;const n=t();try{null==(i=n.syncSceneToState)||i.call(n)}catch{}const a=n.objects.map(e=>{if("glb"===(null==e?void 0:e.type)){const{glbData:t,file:s,...i}=e||{};return{...i}}return e});let r=s;try{if(!r){const e=n.camera;r=e?{camera:{type:e.type,position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},zoom:"number"==typeof e.zoom?e.zoom:void 0},viewport:{isWireframe:!!n.isWireframe,isGridSnap:!!n.isGridSnap,isGridVisible:!!n.isGridVisible,gizmoSpace:n.gizmoSpace,gizmoSize:n.gizmoSize,snapMove:n.snapMove,snapRotateDeg:n.snapRotateDeg,snapScale:n.snapScale,rendererAA:n.rendererAA,renderMode:n.renderMode,isPostProcessingEnabled:!!n.isPostProcessingEnabled,postProcessingPreset:n.postProcessingPreset,safeMode:{...n.safeMode},hdriSettings:{...n.hdriSettings}}}:void 0}}catch{}const o={walls:n.walls,objects:a,viewState:r||void 0};try{localStorage.setItem(`map_${e}`,JSON.stringify(o))}catch{}},getMapData:e=>{try{const t=localStorage.getItem(`map_${e}`);return t?JSON.parse(t):null}catch{return null}},loadMap:s=>{const i=localStorage.getItem(`map_${s}`);if(i){const s=JSON.parse(i),n=(s.objects||[]).map(e=>{var t,s,i,n,a;const r=Mn(e);if("glb"===(null==r?void 0:r.type)&&(!r.glbData||"object"!=typeof r.glbData||Array.isArray(r.glbData)||r.glbData instanceof ArrayBuffer||r.glbData instanceof Uint8Array||delete r.glbData),"mesh"===(null==r?void 0:r.type)&&!r.geometry&&!r.params&&("basic"===(null==(t=r.userData)?void 0:t.type)||(null==(s=r.userData)?void 0:s.geometry))){const e=(null==(i=r.userData)?void 0:i.originalName)||r.name||"",t=String(e).toLowerCase();let s=null==(n=r.userData)?void 0:n.geometry,o=null==(a=r.userData)?void 0:a.params;s||(t.includes("정육면체")||t.includes("box")?(s="BoxGeometry",o=[1,1,1]):t.includes("구체")||t.includes("sphere")?(s="SphereGeometry",o=[.5,32,16]):t.includes("원기둥")||t.includes("cylinder")?(s="CylinderGeometry",o=[.5,.5,1,32]):t.includes("원뿔")||t.includes("cone")?(s="ConeGeometry",o=[.5,1,32]):t.includes("평면")||t.includes("plane")?(s="PlaneGeometry",o=[1,1]):(t.includes("도넛")||t.includes("torus"))&&(s="TorusGeometry",o=[.5,.2,16,100])),s&&(r.type="basic",r.geometry=s,r.params=o||[])}const o=Object.prototype.hasOwnProperty.call(r,"parentId")?r.parentId??null:null;let l=r.order;return Number.isFinite(l)||(l=0),{...r,parentId:o,order:l}}),a=(s.walls||[]).map(Mn);e(()=>({walls:a,objects:n}));try{const i=s.viewState;if(i){const s={};if(i.viewport){const e=i.viewport;s.isWireframe=!!e.isWireframe,s.isGridSnap=!!e.isGridSnap,s.isGridVisible=!!e.isGridVisible,s.gizmoSpace=e.gizmoSpace||t().gizmoSpace,Number.isFinite(e.gizmoSize)&&(s.gizmoSize=e.gizmoSize),Number.isFinite(e.snapMove)&&(s.snapMove=e.snapMove),Number.isFinite(e.snapRotateDeg)&&(s.snapRotateDeg=e.snapRotateDeg),Number.isFinite(e.snapScale)&&(s.snapScale=e.snapScale),e.rendererAA&&(s.rendererAA=e.rendererAA),e.renderMode&&(s.renderMode=e.renderMode),s.isPostProcessingEnabled=!!e.isPostProcessingEnabled,e.postProcessingPreset&&(s.postProcessingPreset=e.postProcessingPreset),e.safeMode&&(s.safeMode={...t().safeMode,...e.safeMode}),e.hdriSettings&&(s.hdriSettings={...t().hdriSettings,...e.hdriSettings})}Object.keys(s).length>0&&e(s)}}catch{}return!0}return!1},clearMap:()=>{const s=t();e({objects:(s.objects||[]).filter(e=>e.isSystemObject),walls:[],selectedObject:null,selectedIds:[]});try{const e=t().scene;if(e){const s=new Set((t().objects||[]).map(e=>e.id)),i=[];e.traverse(e=>{var t,n,a;if(null==(t=null==e?void 0:e.userData)?void 0:t.isSystemObject)return;if(null==(n=null==e?void 0:e.userData)?void 0:n.isSelectionOutline)return;const r=null==(a=null==e?void 0:e.userData)?void 0:a.id;r&&s.has(r)||i.push(e)}),i.forEach(t=>{try{t.parent?t.parent.remove(t):e.remove(t)}catch{}})}}catch{}},pruneOrphanSceneObjects:()=>{try{const e=t().scene;if(!e)return;const s=new Set((t().objects||[]).map(e=>e.id)),i=[];e.traverse(e=>{var t,n,a;if(null==(t=null==e?void 0:e.userData)?void 0:t.isSystemObject)return;if(null==(n=null==e?void 0:e.userData)?void 0:n.isSelectionOutline)return;const r=null==(a=null==e?void 0:e.userData)?void 0:a.id;if(!r||!s.has(r)){const t=(e.name||"").toLowerCase();if(t.includes("transformcontrols")||t.includes("gizmo")||t.includes("helper"))return;i.push(e)}}),i.forEach(t=>{try{t.parent?t.parent.remove(t):e.remove(t)}catch{}})}catch{}},setScene:(t,s,i)=>e({scene:t,camera:s,renderer:i}),_pushHistory:s=>{const{_batchActive:i,_historyPast:n}=t();if(i)return void e(e=>({_batchBuffer:[...e._batchBuffer,s]}));const a=[...n,s];e({_historyPast:a,_historyFuture:[],canUndo:a.length>0,canRedo:!1})},beginBatch:()=>e({_batchActive:!0,_batchBuffer:[]}),endBatch:()=>e(e=>{if(!e._batchActive)return{};const t=e._batchBuffer;if(0===t.length)return{_batchActive:!1,_batchBuffer:[]};const s={type:"batch",entries:t},i=[...e._historyPast,s];return{_batchActive:!1,_batchBuffer:[],_historyPast:i,_historyFuture:[],canUndo:i.length>0,canRedo:!1}}),undo:()=>{const s=t(),i=[...s._historyPast];if(0===i.length)return!1;try{s.setSelectedObject&&s.setSelectedObject(null),s.setSelectedIds&&s.setSelectedIds([])}catch{}const n=i.pop();On(n,e,t);const a=[...s._historyFuture,n];return e({_historyPast:i,_historyFuture:a,canUndo:i.length>0,canRedo:a.length>0}),!0},redo:()=>{const s=t(),i=[...s._historyFuture];if(0===i.length)return!1;try{s.setSelectedObject&&s.setSelectedObject(null),s.setSelectedIds&&s.setSelectedIds([])}catch{}const n=i.pop();Ln(n,e,t);const a=[...s._historyPast,n];return e({_historyFuture:i,_historyPast:a,canUndo:a.length>0,canRedo:i.length>0}),!0}}});try{vn(Dn)}catch{}try{In(Dn)}catch{}try{fn(Dn,"ui",e=>({showLibrary:!!e.showLibrary,showAssets:!!e.showAssets,isPostProcessingPanelOpen:!!e.isPostProcessingPanelOpen,showHDRI:!!e.showHDRI,isViewGizmoSettingsOpen:!!e.isViewGizmoSettingsOpen,dragUseSelectionForDnD:!!e.dragUseSelectionForDnD}),120)}catch{}function Tn(e){if(!e||"object"!=typeof e)return e;const t={...e};return"glbData"in t&&delete t.glbData,"file"in t&&delete t.file,t}function Rn(e){return{position:jn(e.position,{x:0,y:0,z:0}),rotation:jn(e.rotation,{x:0,y:0,z:0}),scale:jn(e.scale,{x:1,y:1,z:1})}}function kn(e,t){const s={},i=["name","visible","frozen","parentId","position","rotation","scale"];for(const n of i)n in t&&(s[n]="position"===n||"rotation"===n||"scale"===n?jn(e[n],"scale"===n?{x:1,y:1,z:1}:{x:0,y:0,z:0}):e[n]);return s}function On(e,t,s){var i;if(e)switch(e.type){case"part-transform":{const t=s().scene;if(!t)break;const i=Array.isArray(e.parts)&&e.parts.length>0?e.parts:e.part&&e.before&&e.after?[{uuid:e.part.uuid,before:e.before}]:[];for(const s of i){const i=s.uuid,n=s.before||e.before;if(!i||!n)continue;let a=null;if(t.traverse(e=>{a||e.uuid!==i||(a=e)}),a&&a.isObject3D)try{a.position.set(n.position.x,n.position.y,n.position.z),a.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),a.scale.set(n.scale.x,n.scale.y,n.scale.z),a.updateMatrix(),a.updateMatrixWorld(!0)}catch{}}break}case"batch":for(let i=e.entries.length-1;i>=0;i--)On(e.entries[i],t,s);break;case"reparent":{const i=s(),n=e.id,a=e.before;if(!n||!a)break;t({objects:i.objects.map(e=>e.id===n?{...e,parentId:a.parentId??null}:e)});break}case"add":{const n=null==(i=e.object)?void 0:i.id;if(!n)break;t({objects:s().objects.filter(e=>e.id!==n)});break}case"remove":{const i=s(),n=e.object;if(!n)break;t({objects:[...i.objects,Mn(n)]});break}case"update":case"transform":{const i=s(),n=e.id,a=e.before;if(!n||!a)break;t({objects:i.objects.map(e=>e.id===n?{...e,...Mn(a)}:e)});break}}}function Ln(e,t,s){var i;if(e)switch(e.type){case"part-transform":{const t=s().scene;if(!t)break;const i=Array.isArray(e.parts)&&e.parts.length>0?e.parts:e.part&&e.before&&e.after?[{uuid:e.part.uuid,after:e.after}]:[];for(const s of i){const i=s.uuid,n=s.after||e.after;if(!i||!n)continue;let a=null;if(t.traverse(e=>{a||e.uuid!==i||(a=e)}),a&&a.isObject3D)try{a.position.set(n.position.x,n.position.y,n.position.z),a.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),a.scale.set(n.scale.x,n.scale.y,n.scale.z),a.updateMatrix(),a.updateMatrixWorld(!0)}catch{}}break}case"batch":for(let i=0;i<e.entries.length;i++)Ln(e.entries[i],t,s);break;case"reparent":{const i=s(),n=e.id,a=e.after;if(!n||!a)break;t({objects:i.objects.map(e=>e.id===n?{...e,parentId:a.parentId??null}:e)});break}case"add":{const i=s(),n=e.object;if(!n)break;t({objects:[...i.objects,Mn(n)]});break}case"remove":{const n=null==(i=e.object)?void 0:i.id;if(!n)break;t({objects:s().objects.filter(e=>e.id!==n)});break}case"update":case"transform":{const i=s(),n=e.id,a=e.after;if(!n||!a)break;t({objects:i.objects.map(e=>e.id===n?{...e,...Mn(a)}:e)});break}}}const Fn=new qe,Pn=new S,Nn=new S,Gn=new ae,_n={X:new S(1,0,0),Y:new S(0,1,0),Z:new S(0,0,1)},zn={type:"change"},Un={type:"mouseDown",mode:null},Hn={type:"mouseUp",mode:null},qn={type:"objectChange"};class Kn extends Ke{constructor(e,t=null){super(void 0,t);const s=new ua(this);this._root=s;const i=new pa;this._gizmo=i,s.add(i);const n=new ga;this._plane=n,s.add(n);const a=this;function r(e,t){let s=t;Object.defineProperty(a,e,{get:function(){return void 0!==s?s:t},set:function(t){s!==t&&(s=t,n[e]=t,i[e]=t,a.dispatchEvent({type:e+"-changed",value:t}),a.dispatchEvent(zn))}}),a[e]=t,n[e]=t,i[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0),r("minX",-1/0),r("maxX",1/0),r("minY",-1/0),r("maxY",1/0),r("minZ",-1/0),r("maxZ",1/0);const o=new S,l=new S,c=new ae,A=new ae,d=new S,h=new ae,u=new S,p=new S,g=new S,m=new S;r("worldPosition",o),r("worldPositionStart",l),r("worldQuaternion",c),r("worldQuaternionStart",A),r("cameraPosition",d),r("cameraQuaternion",h),r("pointStart",u),r("pointEnd",p),r("rotationAxis",g),r("rotationAngle",0),r("eye",m),this._offset=new S,this._startNorm=new S,this._endNorm=new S,this._cameraScale=new S,this._parentPosition=new S,this._parentQuaternion=new ae,this._parentQuaternionInv=new ae,this._parentScale=new S,this._worldScaleStart=new S,this._worldQuaternionInv=new ae,this._worldScale=new S,this._positionStart=new S,this._quaternionStart=new ae,this._scaleStart=new S,this._getPointer=Wn.bind(this),this._onPointerDown=Yn.bind(this),this._onPointerHover=Vn.bind(this),this._onPointerMove=Jn.bind(this),this._onPointerUp=Xn.bind(this),null!==t&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;null!==e&&Fn.setFromCamera(e,this.camera);const t=Zn(this._gizmo.picker[this.mode],Fn);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&(null==e||0===e.button)&&null!==this.axis){null!==e&&Fn.setFromCamera(e,this.camera);const t=Zn(this._plane,Fn,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Un.mode=this.mode,this.dispatchEvent(Un)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if("scale"===s?n="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(n="world"),void 0===i||null===t||!1===this.dragging||null!==e&&-1!==e.button)return;null!==e&&Fn.setFromCamera(e,this.camera);const a=Zn(this._plane,Fn,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===s)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===n&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(Gn.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===n&&(i.parent&&i.position.add(Pn.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Pn.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if("scale"===s){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),Nn.set(e,e,e)}else Pn.copy(this.pointStart),Nn.copy(this.pointEnd),Pn.applyQuaternion(this._worldQuaternionInv),Nn.applyQuaternion(this._worldQuaternionInv),Nn.divide(Pn),-1===t.search("X")&&(Nn.x=1),-1===t.search("Y")&&(Nn.y=1),-1===t.search("Z")&&(Nn.z=1);i.scale.copy(this._scaleStart).multiply(Nn),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===s){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(Pn.setFromMatrixPosition(this.camera.matrixWorld));let s=!1;"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Pn.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(_n[t]),Pn.copy(_n[t]),"local"===n&&Pn.applyQuaternion(this.worldQuaternion),Pn.cross(this.eye),0===Pn.length()?s=!0:this.rotationAngle=this._offset.dot(Pn.normalize())*e),("E"===t||s)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Gn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Gn.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(zn),this.dispatchEvent(qn)}}pointerUp(e){null!==e&&0!==e.button||(this.dragging&&null!==this.axis&&(Hn.mode=this.mode,this.dispatchEvent(Hn)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(zn),this.dispatchEvent(qn),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Fn}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Wn(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function Vn(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function Yn(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function Jn(e){this.enabled&&this.pointerMove(this._getPointer(e))}function Xn(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function Zn(e,t,s){const i=t.intersectObject(e,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||s)return i[n];return!1}const $n=new $e,ea=new S(0,1,0),ta=new S(0,0,0),sa=new B,ia=new ae,na=new ae,aa=new S,ra=new B,oa=new S(1,0,0),la=new S(0,1,0),ca=new S(0,0,1),Aa=new S,da=new S,ha=new S;class ua extends M{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;void 0!==t.object&&(t.object.updateMatrixWorld(),null===t.object.parent||t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}}class pa extends M{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new x({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new G({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const r=e.clone();r.color.setHex(255);const o=e.clone();o.color.setHex(16711680),o.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const A=e.clone();A.color.setHex(255),A.opacity=.5;const d=e.clone();d.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25;e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const p=new We(0,.04,.1,12);p.translate(0,.05,0);const g=new He(.08,.08,.08);g.translate(0,.04,0);const m=new c;m.setAttribute("position",new Ve([0,0,0,1,0,0],3));const b=new We(.0075,.0075,.5,3);function f(e,t){const s=new Xe(e,.0075,3,64,t*Math.PI*2);return s.rotateY(Math.PI/2),s.rotateX(Math.PI/2),s}b.translate(0,.25,0);const v={X:[[new q(p,n),[.5,0,0],[0,0,-Math.PI/2]],[new q(p,n),[-.5,0,0],[0,0,Math.PI/2]],[new q(b,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new q(p,a),[0,.5,0]],[new q(p,a),[0,-.5,0],[Math.PI,0,0]],[new q(b,a)]],Z:[[new q(p,r),[0,0,.5],[Math.PI/2,0,0]],[new q(p,r),[0,0,-.5],[-Math.PI/2,0,0]],[new q(b,r),null,[Math.PI/2,0,0]]],XYZ:[[new q(new Ye(.1,0),d.clone()),[0,0,0]]],XY:[[new q(new He(.15,.15,.01),A.clone()),[.15,.15,0]]],YZ:[[new q(new He(.15,.15,.01),o.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},y={X:[[new q(new We(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new q(new We(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new q(new We(.2,0,.6,4),s),[0,.3,0]],[new q(new We(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new q(new We(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new q(new We(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new q(new Ye(.2,0),s)]],XY:[[new q(new He(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new q(new He(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},C={START:[[new q(new Ye(.01,2),i),null,null,null,"helper"]],END:[[new q(new Ye(.01,2),i),null,null,null,"helper"]],DELTA:[[new W(function(){const e=new c;return e.setAttribute("position",new Ve([0,0,0,1,1,1],3)),e}(),i),null,null,null,"helper"]],X:[[new W(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new W(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new W(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={XYZE:[[new q(f(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new q(f(.5,.5),n)]],Y:[[new q(f(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new q(f(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new q(f(.75,1),h),null,[0,Math.PI/2,0]]]},w={AXIS:[[new W(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new q(new Je(.25,10,8),s)]],X:[[new q(new Xe(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new q(new Xe(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new q(new Xe(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new q(new Xe(.75,.1,2,24),s)]]},B={X:[[new q(g,n),[.5,0,0],[0,0,-Math.PI/2]],[new q(b,n),[0,0,0],[0,0,-Math.PI/2]],[new q(g,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new q(g,a),[0,.5,0]],[new q(b,a)],[new q(g,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new q(g,r),[0,0,.5],[Math.PI/2,0,0]],[new q(b,r),[0,0,0],[Math.PI/2,0,0]],[new q(g,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new q(new He(.15,.15,.01),A),[.15,.15,0]]],YZ:[[new q(new He(.15,.15,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new q(new He(.1,.1,.1),d.clone())]]},S={X:[[new q(new We(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new q(new We(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new q(new We(.2,0,.6,4),s),[0,.3,0]],[new q(new We(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new q(new We(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new q(new We(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new q(new He(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new q(new He(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new q(new He(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new q(new He(.2,.2,.2),s),[0,0,0]]]},Q={X:[[new W(m,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new W(m,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new W(m,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function j(e){const t=new M;for(const s in e)for(let i=e[s].length;i--;){const n=e[s][i][0].clone(),a=e[s][i][1],r=e[s][i][2],o=e[s][i][3],l=e[s][i][4];n.name=s,n.tag=l,a&&n.position.set(a[0],a[1],a[2]),r&&n.rotation.set(r[0],r[1],r[2]),o&&n.scale.set(o[0],o[1],o[2]),n.updateMatrix();const c=n.geometry.clone();c.applyMatrix4(n.matrix),n.geometry=c,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=j(v)),this.add(this.gizmo.rotate=j(I)),this.add(this.gizmo.scale=j(B)),this.add(this.picker.translate=j(y)),this.add(this.picker.rotate=j(E)),this.add(this.picker.scale=j(S)),this.add(this.helper.translate=j(C)),this.add(this.helper.rotate=j(w)),this.add(this.helper.scale=j(Q)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:na;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const e=s[i];let n;if(e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(n*this.size/4),"helper"!==e.tag){if(e.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const s=.99,i=.2;"X"===e.name&&Math.abs(ea.copy(oa).applyQuaternion(t).dot(this.eye))>s&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Y"===e.name&&Math.abs(ea.copy(la).applyQuaternion(t).dot(this.eye))>s&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"Z"===e.name&&Math.abs(ea.copy(ca).applyQuaternion(t).dot(this.eye))>s&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XY"===e.name&&Math.abs(ea.copy(ca).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"YZ"===e.name&&Math.abs(ea.copy(oa).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),"XZ"===e.name&&Math.abs(ea.copy(la).applyQuaternion(t).dot(this.eye))<i&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)}else"rotate"===this.mode&&(ia.copy(t),ea.copy(this.eye).applyQuaternion(Gn.copy(t).invert()),-1!==e.name.search("E")&&e.quaternion.setFromRotationMatrix(sa.lookAt(this.eye,ta,la)),"X"===e.name&&(Gn.setFromAxisAngle(oa,Math.atan2(-ea.y,ea.z)),Gn.multiplyQuaternions(ia,Gn),e.quaternion.copy(Gn)),"Y"===e.name&&(Gn.setFromAxisAngle(la,Math.atan2(ea.x,ea.z)),Gn.multiplyQuaternions(ia,Gn),e.quaternion.copy(Gn)),"Z"===e.name&&(Gn.setFromAxisAngle(ca,Math.atan2(ea.y,ea.x)),Gn.multiplyQuaternions(ia,Gn),e.quaternion.copy(Gn)));e.visible=e.visible&&(-1===e.name.indexOf("X")||this.showX),e.visible=e.visible&&(-1===e.name.indexOf("Y")||this.showY),e.visible=e.visible&&(-1===e.name.indexOf("Z")||this.showZ),e.visible=e.visible&&(-1===e.name.indexOf("E")||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(t){return e.name===t}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}else e.visible=!1,"AXIS"===e.name?(e.visible=!!this.axis,"X"===this.axis&&(Gn.setFromEuler($n.set(0,0,0)),e.quaternion.copy(t).multiply(Gn),Math.abs(ea.copy(oa).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Y"===this.axis&&(Gn.setFromEuler($n.set(0,0,Math.PI/2)),e.quaternion.copy(t).multiply(Gn),Math.abs(ea.copy(la).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"Z"===this.axis&&(Gn.setFromEuler($n.set(0,Math.PI/2,0)),e.quaternion.copy(t).multiply(Gn),Math.abs(ea.copy(ca).applyQuaternion(t).dot(this.eye))>.9&&(e.visible=!1)),"XYZE"===this.axis&&(Gn.setFromEuler($n.set(0,Math.PI/2,0)),ea.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(sa.lookAt(ta,ea,la)),e.quaternion.multiply(Gn),e.visible=this.dragging),"E"===this.axis&&(e.visible=!1)):"START"===e.name?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):"END"===e.name?(e.position.copy(this.worldPosition),e.visible=this.dragging):"DELTA"===e.name?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),Pn.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Pn.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(Pn),e.visible=this.dragging):(e.quaternion.copy(t),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=-1!==this.axis.search(e.name)))}super.updateMatrixWorld(e)}}class ga extends q{constructor(){super(new Ze(1e5,1e5,2,2),new x({visible:!1,wireframe:!0,side:z,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),Aa.copy(oa).applyQuaternion("local"===t?this.worldQuaternion:na),da.copy(la).applyQuaternion("local"===t?this.worldQuaternion:na),ha.copy(ca).applyQuaternion("local"===t?this.worldQuaternion:na),ea.copy(da),this.mode){case"translate":case"scale":switch(this.axis){case"X":ea.copy(this.eye).cross(Aa),aa.copy(Aa).cross(ea);break;case"Y":ea.copy(this.eye).cross(da),aa.copy(da).cross(ea);break;case"Z":ea.copy(this.eye).cross(ha),aa.copy(ha).cross(ea);break;case"XY":aa.copy(ha);break;case"YZ":aa.copy(Aa);break;case"XZ":ea.copy(ha),aa.copy(da);break;case"XYZ":case"E":aa.set(0,0,0)}break;default:aa.set(0,0,0)}0===aa.length()?this.quaternion.copy(this.cameraQuaternion):(ra.lookAt(Pn.set(0,0,0),aa,ea),this.quaternion.setFromRotationMatrix(ra)),super.updateMatrixWorld(e)}}class ma{constructor(e,t,s=null){this.camera=e,this.renderer=t,this.onCameraChange=s,this.initialPosition=e.position.clone(),this.initialTarget=new S(0,0,0),this.cameraTarget=new S(0,0,0),this.spherical=new et,this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget)),this._tempVector1=new S,this._tempVector2=new S,this._tempVector3=new S,this._panSpeed=50,this._orbitSpeed=100,this._zoomSpeed=.3}resetCamera(){this.camera.position.copy(this.initialPosition),this.cameraTarget.copy(this.initialTarget),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}toggleProjection(){const e=this.camera,t=e.position.clone(),s=this.cameraTarget.clone();if(e.isPerspectiveCamera){const e=t.distanceTo(s),i=window.innerWidth/window.innerHeight,n=.5*e,a=new $(n*i/-2,n*i/2,n/2,n/-2,.1,1e3);a.position.copy(t),a.lookAt(s),a.updateMatrixWorld(),this.camera=a}else{const e=new X(75,window.innerWidth/window.innerHeight,.1,1e3);e.position.copy(t),e.lookAt(s),e.updateMatrixWorld(),this.camera=e}return this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget)),this.onCameraChange&&this.onCameraChange(this.camera),this.camera}setView(e){const t=this.camera.position.distanceTo(this.cameraTarget),s=this.cameraTarget.clone();let i=new S;switch(e){case"front":i.set(s.x,s.y,s.z+t);break;case"side":i.set(s.x+t,s.y,s.z);break;case"top":i.set(s.x,s.y+t,s.z);break;case"bottom":i.set(s.x,s.y-t,s.z);break;default:return}this.camera.position.copy(i),this.camera.lookAt(s),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}pan(e,t){const s=this._panSpeed,i=new S,n=new S;i.setFromMatrixColumn(this.camera.matrix,0),n.setFromMatrixColumn(this.camera.matrix,1);const a=s*(this.camera.position.distanceTo(this.cameraTarget)/50),r=new S;r.add(i.clone().multiplyScalar(-e*a)),r.add(n.clone().multiplyScalar(-t*a)),this.camera.position.add(r),this.cameraTarget.add(r),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}updateRotationCenterAfterPan(e,t=[]){const s=new qe,i=new E(0,0);s.setFromCamera(i,this.camera);const n=s.intersectObjects(t,!0);if(n.length>0){const e=n[0].point;this.cameraTarget.copy(e)}else{const e=new S;e.setFromMatrixColumn(this.camera.matrix,2).negate();const t=this.camera.position.clone().add(e.multiplyScalar(50));this.cameraTarget.copy(t)}this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}orbit(e,t){const s=this._orbitSpeed;this.spherical.theta-=e*s*.01,this.spherical.phi+=t*s*.01,this.spherical.phi=Math.max(.1,Math.min(Math.PI-.1,this.spherical.phi));const i=new S;i.setFromSpherical(this.spherical),i.add(this.cameraTarget),this.camera.position.copy(i),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld()}zoom(e){const t=Math.max(.01,this._zoomSpeed),s=e>0?1+t:1/(1+t);if(this.camera.isPerspectiveCamera){this.spherical.radius*=s,this.spherical.radius=Math.max(1,Math.min(1e3,this.spherical.radius));const e=new S;e.setFromSpherical(this.spherical),e.add(this.cameraTarget),this.camera.position.copy(e),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld()}else if(this.camera.isOrthographicCamera){const e=(this.camera.right-this.camera.left)*s,t=(this.camera.top-this.camera.bottom)*s,i=2e3,n=.1,a=Math.max(n,Math.min(i,e)),r=Math.max(n,Math.min(i,t));this.camera.left=-a/2,this.camera.right=a/2,this.camera.top=r/2,this.camera.bottom=-r/2,this.camera.updateProjectionMatrix()}}setSpeeds({pan:e,orbit:t,zoom:s}={}){Number.isFinite(e)&&(this._panSpeed=e),Number.isFinite(t)&&(this._orbitSpeed=t),Number.isFinite(s)&&(this._zoomSpeed=s)}focusOnObject(e){if(!e)return;const t=(new fe).setFromObject(e),s=t.getCenter(new S),i=t.getSize(new S),n=Math.max(i.x,i.y,i.z);let a;if(this.camera.isPerspectiveCamera){const e=this.camera.fov*(Math.PI/180);a=1.5*Math.abs(n/Math.sin(e/2))}else a=2*n;this.cameraTarget.copy(s);const r=new S;r.subVectors(this.camera.position,this.cameraTarget).normalize(),this.camera.position.copy(s).add(r.multiplyScalar(a)),this.camera.lookAt(this.cameraTarget),this.camera.updateMatrixWorld(),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}handleResize(){if(this.camera.isPerspectiveCamera)this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();else if(this.camera.isOrthographicCamera){const e=window.innerWidth/window.innerHeight,t=(this.camera.top-this.camera.bottom)*e;this.camera.left=-t/2,this.camera.right=t/2,this.camera.updateProjectionMatrix()}}setTarget(e){this.cameraTarget.copy(e),this.spherical.setFromVector3(this.camera.position.clone().sub(this.cameraTarget))}getCamera(){return this.camera}getTarget(){return this.cameraTarget.clone()}}class ba{constructor(e,t,s,i){this.scene=e,this.camera=t,this.renderer=s,this.editorStore=i,this.gizmoScene=null,this.selectedObjects=[],this.lastSelectedObject=null,this.selectableObjects=[],this.raycaster=new qe,this.selectionBox=null,this.createSelectionBox(),this.transformControls=null,this.gizmoMode="translate",this.isDragging=!1,this.snapEnabled=!1,this.gridSize=1,this.tempGroup=null,this.tempGroupCenter=new S,this.initialTransformStates=new Map,this.initializeTransformControls(),this._pendingTransformUpdates=new Map,this._rafScheduled=!1,this.postProcessingManager=null}_requestRender(){try{"undefined"!=typeof window&&"function"==typeof window.__requestRender&&window.__requestRender()}catch{}}_shouldUseFallbackOutline(){return!0}forceHideGizmoLines(){var e,t,s;try{const i=null==(t=null==(e=this.transformControls)?void 0:e.getHelper)?void 0:t.call(e);if(!i||!i.isObject3D)return;const n=this.gizmoScene||this.scene;i.parent!==n&&(i.parent&&i.parent.remove(i),n.add(i));const a=[];null==(s=i.traverse)||s.call(i,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,s=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||s)&&a.push(e)}),a.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})}catch{}}setGizmoScene(e){var t,s,i,n;this.gizmoScene=e;try{const a=null==(s=null==(t=this.transformControls)?void 0:t.getHelper)?void 0:s.call(t);if(a&&a.isObject3D&&e){try{const e=null==(n=null==(i=a.children)?void 0:i.find)?void 0:n.call(i,e=>"helper"===e.name);e&&(e.visible=!1);const t=e=>{var t;const s=[];null==(t=e.traverse)||t.call(e,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,i=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||i)&&s.push(e)}),s.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})};t(a),a.onBeforeRender=()=>{try{e&&(e.visible=!1),t(a)}catch{}}}catch{}a.parent&&a.parent.remove(a),e.add(a)}}catch{}}setPostProcessingManager(e){this.postProcessingManager=e}_syncOutlineWithSelection(){if(!this.postProcessingManager)return;const e=this.selectedObjects&&this.selectedObjects.length>0?[...this.selectedObjects]:[];try{this.postProcessingManager.setOutlineSelectedObjects(e);const t=this.lastSelectedObject&&e.includes(this.lastSelectedObject)?[this.lastSelectedObject]:e.length?[e[e.length-1]]:[];this.postProcessingManager.setOutlineActiveObjects(t)}catch{}}isInSceneGraph(e){if(!e)return!1;let t=e;for(;t;){if(t===this.scene||t===this.gizmoScene)return!0;t=t.parent}return!1}validateTransformAttachment(){if(!this.transformControls||!this.transformControls.object)return;if(this.isDragging)return;const e=this.transformControls.object;if(!this.isInSceneGraph(e)){try{this.transformControls.detach()}catch{}this.editorStore.getState().setSelectedObject(null)}}createTempGroup(){if(this.selectedObjects.length<=1)return this.clearTempGroup(),null;this.clearTempGroup(),this.tempGroup=new J,this.tempGroup.name="TempSelectionGroup",this.tempGroup.userData.isTempGroup=!0,this.calculateGroupCenter(),this.tempGroup.position.copy(this.tempGroupCenter);const e=this.gizmoScene||this.scene;try{e.add(this.tempGroup)}catch{}return this.tempGroup}calculateGroupCenter(){if(0===this.selectedObjects.length)return void this.tempGroupCenter.set(0,0,0);const e=new fe;this.selectedObjects.forEach(t=>{if(t){const s=(new fe).setFromObject(t);e.union(s)}}),e.getCenter(this.tempGroupCenter)}clearTempGroup(){if(this.tempGroup){try{this.tempGroup.parent&&this.tempGroup.parent.remove(this.tempGroup)}catch{}this.tempGroup=null}}saveInitialTransformStates(){this.initialTransformStates.clear();for(const e of this.selectedObjects)e&&e.position&&e.rotation&&e.scale&&this.initialTransformStates.set(e,{position:e.position.clone(),rotation:e.rotation.clone(),scale:e.scale.clone()});this.tempGroup&&this.selectedObjects.length>1&&this.initialTransformStates.set(this.tempGroup,{position:this.tempGroup.position.clone(),rotation:this.tempGroup.rotation.clone(),scale:this.tempGroup.scale.clone()})}applyTransformToSelectedObjects(){if(!this.tempGroup||!this.transformControls.object||this.selectedObjects.length<=1)return;const e={position:this.tempGroup.position.clone(),rotation:this.tempGroup.rotation.clone(),scale:this.tempGroup.scale.clone()},t=this.initialTransformStates.get(this.tempGroup);if(t)for(const s of this.selectedObjects)if(s){const i=this.initialTransformStates.get(s);i&&this.applyRelativeTransformFromGroup(s,e,t,i)}}applyRelativeTransformFromGroup(e,t,s,i){switch(this.transformControls.getMode()){case"translate":const n=(new S).subVectors(t.position,s.position);e.position.copy(i.position).add(n);break;case"rotate":const a=(new ae).setFromEuler(new $e(s.rotation.x,s.rotation.y,s.rotation.z)),r=(new ae).setFromEuler(new $e(t.rotation.x,t.rotation.y,t.rotation.z)),o=(new ae).multiplyQuaternions(r,a.invert()),l=(new S).subVectors(i.position,s.position);l.applyQuaternion(o),e.position.copy(t.position).add(l);const c=(new ae).setFromEuler(new $e(i.rotation.x,i.rotation.y,i.rotation.z));e.quaternion.multiplyQuaternions(o,c);break;case"scale":const A=new S(t.scale.x/s.scale.x,t.scale.y/s.scale.y,t.scale.z/s.scale.z),d=(new S).subVectors(i.position,s.position);d.multiply(A),e.position.copy(t.position).add(d),e.scale.copy(i.scale).multiply(A)}}applyRelativeTransform(e,t,s,i){switch(this.transformControls.getMode()){case"translate":const n=(new S).subVectors(t.position,s.position);e.position.copy(i.position).add(n);break;case"rotate":const a=new $e(t.rotation.x-s.rotation.x,t.rotation.y-s.rotation.y,t.rotation.z-s.rotation.z);e.rotation.copy(i.rotation),e.rotation.x+=a.x,e.rotation.y+=a.y,e.rotation.z+=a.z;break;case"scale":const r=new S(t.scale.x/s.scale.x,t.scale.y/s.scale.y,t.scale.z/s.scale.z);e.scale.copy(i.scale).multiply(r)}}initializeTransformControls(){var e,t;try{this.transformControls=new Kn(this.camera,this.renderer.domElement);try{const e=this.editorStore.getState();Number.isFinite(null==e?void 0:e.gizmoSize)&&this.transformControls.setSize(e.gizmoSize);const t=!!(null==e?void 0:e.isGridSnap),s=Number.isFinite(null==e?void 0:e.gridSize)?e.gridSize:1,i=Number.isFinite(null==e?void 0:e.snapMove)?e.snapMove:s,n=Number.isFinite(null==e?void 0:e.snapRotateDeg)?Z.degToRad(e.snapRotateDeg):Z.degToRad(15),a=Number.isFinite(null==e?void 0:e.snapScale)?e.snapScale:.1;t?(this.transformControls.setTranslationSnap(i||s||1),this.transformControls.setRotationSnap(n),this.transformControls.setScaleSnap(a)):(this.transformControls.setTranslationSnap(null),this.transformControls.setRotationSnap(null),this.transformControls.setScaleSnap(null))}catch{}this.transformControls.addEventListener("dragging-changed",e=>{var t,s,i,n,a,r;if(this.isDragging=e.value,e.value){this.saveInitialTransformStates();try{const e=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);(null==e?void 0:e.beginBatch)&&e.beginBatch()}catch{}}else{try{null==(i=this.flushPendingTransformUpdates)||i.call(this)}catch{}this.initialTransformStates.clear();try{const e=null==(a=null==(n=this.editorStore)?void 0:n.getState)?void 0:a.call(n),t=null==e?void 0:e.updateObjectTransform;if(t){const e=this.selectedObjects&&this.selectedObjects.length>0?this.selectedObjects:this.lastSelectedObject?[this.lastSelectedObject]:[];for(const s of e){const e=null==(r=null==s?void 0:s.userData)?void 0:r.id;e&&t(e,{position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}})}}(null==e?void 0:e.endBatch)&&e.endBatch()}catch{}}}),this.transformControls.addEventListener("change",()=>{var e,t;this.applyTransformToSelectedObjects();try{const s=this.selectedObjects&&this.selectedObjects.length>0?this.selectedObjects:this.lastSelectedObject?[this.lastSelectedObject]:[];try{"rotate"===(null==(t=(e=this.transformControls).getMode)?void 0:t.call(e))&&s.forEach(e=>{var t;if(e&&e.isLight&&(e.isSpotLight||e.isDirectionalLight)&&e.target)try{const s=new S,i=new S;e.getWorldPosition(s),e.getWorldDirection(i);let n=0;try{n=e.target.getWorldPosition(new S).distanceTo(s)}catch{}(!Number.isFinite(n)||n<.001)&&(n=10);const a=s.clone().add(i.multiplyScalar(n));e.target.position.copy(a),e.target.updateMatrixWorld(!0),(null==(t=e.userData)?void 0:t.lightHelper)&&"function"==typeof e.userData.lightHelper.update&&e.userData.lightHelper.update()}catch{}})}catch{}s.forEach(e=>this.scheduleTransformUpdate(e))}catch{}}),this.transformControls.setSize(1);const s=this.transformControls.getHelper();if(s instanceof M){try{const i=null==(t=null==(e=s.children)?void 0:e.find)?void 0:t.call(e,e=>"helper"===e.name);i&&(i.visible=!1);const n=e=>{var t;const s=[];null==(t=e.traverse)||t.call(e,e=>{if(!e)return;const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,i=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||i)&&s.push(e)}),s.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})};n(s),s.onBeforeRender=()=>{try{i&&(i.visible=!1),n(s)}catch{}}}catch{}s.renderOrder=999;(this.gizmoScene||this.scene).add(s);try{const e=()=>{var e,t,i;try{const n=null==(t=null==(e=s.children)?void 0:e.find)?void 0:t.call(e,e=>"helper"===e.name);n&&(n.visible=!1);const a=[];null==(i=s.traverse)||i.call(s,e=>{const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,s=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||s)&&a.push(e)}),a.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})}catch{}};this.transformControls.addEventListener("change",e),this.transformControls.addEventListener("dragging-changed",e),this.transformControls.addEventListener("mouseDown",e),this.transformControls.addEventListener("mouseUp",e),this.transformControls.addEventListener("objectChange",e)}catch{}}}catch(s){this.transformControls=null}}scheduleTransformUpdate(e){var t,s,i,n,a,r,o,l,c;if(!e)return;const A=null==(t=e.userData)?void 0:t.id;if(A){try{if(e.isLight&&(null==(s=e.userData)?void 0:s.lightHelper)){const t=e.userData.lightHelper;try{e.updateMatrixWorld(!0)}catch{}try{null==(n=null==(i=e.target)?void 0:i.updateMatrixWorld)||n.call(i,!0)}catch{}"function"==typeof t.update&&t.update()}else if(null==(a=e.userData)?void 0:a.isLightTarget){let t=null;try{const s=null==(r=e.userData)?void 0:r.ownerId;s?this.scene.traverse(e=>{var i;!t&&(null==e?void 0:e.isLight)&&(null==(i=e.userData)?void 0:i.id)===s&&(t=e)}):this.scene.traverse(s=>{!t&&(null==s?void 0:s.isLight)&&s.target===e&&(t=s)})}catch{}if((null==(o=null==t?void 0:t.userData)?void 0:o.lightHelper)&&"function"==typeof t.userData.lightHelper.update){try{t.updateMatrixWorld(!0)}catch{}try{null==(c=null==(l=t.target)?void 0:l.updateMatrixWorld)||c.call(l,!0)}catch{}t.userData.lightHelper.update()}}}catch{}this._pendingTransformUpdates.set(A,{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}),this._rafScheduled||(this._rafScheduled=!0,requestAnimationFrame(()=>this.flushPendingTransformUpdates()))}}flushPendingTransformUpdates(){var e,t,s,i;if(this._rafScheduled=!1,this._pendingTransformUpdates&&0!==this._pendingTransformUpdates.size){try{const s=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:t.call(e),i=null==s?void 0:s.updateObjectTransform;if(i)for(const[e,t]of this._pendingTransformUpdates.entries())i(e,t)}catch{}try{null==(i=null==(s=this.selectedObjects)?void 0:s.forEach)||i.call(s,e=>{var t;(null==e?void 0:e.isLight)&&(null==(t=e.userData)?void 0:t.lightHelper)&&"function"==typeof e.userData.lightHelper.update&&e.userData.lightHelper.update()})}catch{}this._pendingTransformUpdates.clear()}}createSelectionBox(){this.selectionBox=document.createElement("div"),this.selectionBox.style.position="absolute",this.selectionBox.style.border="2px dashed #007acc",this.selectionBox.style.backgroundColor="rgba(0, 122, 204, 0.1)",this.selectionBox.style.pointerEvents="none",this.selectionBox.style.display="none",this.selectionBox.style.zIndex="1000",document.body.appendChild(this.selectionBox)}isObjectValidForSelection(e){var t,s;if(!e||!e.visible||!e.isObject3D)return!1;const i=this.editorStore.getState(),n=(null==(t=e.userData)?void 0:t.id)??(null==(s=e.userData)?void 0:s.ownerId),a=i.objects.find(e=>e.id===n)||i.walls.find(e=>e.id===n);return!a||!a.frozen}_promoteToCanonical(e){if(!e||!e.userData)return e;const t=!!e.userData.id,s=e.userData.ownerId;if(!t&&null!=s){let t=e;for(;t;){if(t.userData&&t.userData.id===s)return t;t=t.parent}}return e}selectSingleObject(e){var t,s;if((e=this._promoteToCanonical(e))&&this.isObjectValidForSelection(e)){this.cleanupSelectedObjects(),this.deselectAllObjects(),this.selectedObjects=[e],this.lastSelectedObject=e,this.editorStore.getState().setSelectedObject(e);try{const i=this.editorStore.getState(),n=(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(s=null==e?void 0:e.userData)?void 0:s.ownerId);(null==i?void 0:i.setSelectedIds)&&i.setSelectedIds(null!=n?[n]:[])}catch{}if(this.clearTempGroup(),this.transformControls&&e.parent){let t=!1,s=e;for(;s.parent;)if(s=s.parent,s===this.scene){t=!0;break}t&&(this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}this._syncOutlineWithSelection();try{this.addSelectionOutline(e),this.updateSelectionOutline(e)}catch{}this._requestRender()}}selectMultipleObjects(e,t=!1){if(e&&Array.isArray(e)){t||this.deselectAllObjects();for(let t of e)if(t=this._promoteToCanonical(t),t&&!this.selectedObjects.includes(t)){this.selectedObjects.push(t),this.lastSelectedObject=t;try{this.addSelectionOutline(t),this.updateSelectionOutline(t)}catch{}}if(this.selectedObjects.length>1){const e=this.createTempGroup();if(e&&this.transformControls){e.parent===(this.gizmoScene||this.scene)&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}}else if(1===this.selectedObjects.length){this.clearTempGroup();const e=this.selectedObjects[0];e&&this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}try{const e=this.editorStore.getState(),t=this.selectedObjects.map(e=>{var t,s;return(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(s=null==e?void 0:e.userData)?void 0:s.ownerId)}).filter(e=>null!=e);(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds(t)}catch{}this._syncOutlineWithSelection(),this._requestRender()}}toggleObjectSelection(e){if(!e)return;e=this._promoteToCanonical(e);const t=this.selectedObjects.indexOf(e);if(t>-1)if(this.selectedObjects.splice(t,1),this.removeSelectionOutline(e),this.lastSelectedObject===e&&(this.lastSelectedObject=this.selectedObjects.length>0?this.selectedObjects[this.selectedObjects.length-1]:null),this.selectedObjects.length>1){const e=this.createTempGroup();e&&this.transformControls&&e.parent===this.scene&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else if(1===this.selectedObjects.length){this.clearTempGroup();const e=this.selectedObjects[0];e&&this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}else this.clearTempGroup(),this.editorStore.getState().setSelectedObject(null),this.lastSelectedObject=null,this.transformControls&&this.transformControls.detach();else{this.selectedObjects.push(e),this.lastSelectedObject=e;try{this.addSelectionOutline(e),this.updateSelectionOutline(e)}catch{}if(this.selectedObjects.length>1){const e=this.createTempGroup();if(e&&this.transformControls){e.parent===(this.gizmoScene||this.scene)&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}}else this.clearTempGroup(),this.transformControls&&(this.editorStore.getState().setSelectedObject(e),this.transformControls.attach(e),this.setGizmoMode(this.gizmoMode))}try{const e=this.editorStore.getState(),t=this.selectedObjects.map(e=>{var t,s;return(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(s=null==e?void 0:e.userData)?void 0:s.ownerId)}).filter(e=>null!=e);(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds(t)}catch{}this._syncOutlineWithSelection(),this._requestRender()}deselectAllObjects(){if(this.transformControls)try{this.transformControls.detach()}catch(e){}this.clearTempGroup(),this.cleanupSelectedObjects();for(const t of this.selectedObjects)if(t)try{this.removeSelectionOutline(t)}catch(e){}this.selectedObjects=[],this.lastSelectedObject=null,this.editorStore.getState().setSelectedObject(null);try{const e=this.editorStore.getState();(null==e?void 0:e.setSelectedIds)&&e.setSelectedIds([])}catch{}this._syncOutlineWithSelection(),this._requestRender()}cleanupSelectedObjects(){this.isDragging||(this.selectedObjects.length,this.selectedObjects=this.selectedObjects.filter(e=>this.isObjectValidForSelection(e)&&this.isInSceneGraph(e)),!this.lastSelectedObject||this.isObjectValidForSelection(this.lastSelectedObject)&&this.isInSceneGraph(this.lastSelectedObject)||(this.lastSelectedObject=this.selectedObjects.length>0?this.selectedObjects[this.selectedObjects.length-1]:null),this.validateTransformAttachment())}handleObjectSelection(e,t=!1){if(this.isDragging)return;this.raycaster.setFromCamera(e,this.camera);let s=[];try{s=this.raycaster.intersectObjects(this.selectableObjects,!0)}catch{s=[]}if((!s||0===s.length)&&this.scene)try{const e=this.raycaster.intersectObjects(this.scene.children,!0),t=e=>{let t=e;for(;t;){if(this.selectableObjects.includes(t))return t;t=t.parent}return null};for(const i of e){const e=t(i.object);if(e){s=[{object:e}];break}}}catch{}if(s&&s.length>0){let e=s[0].object;for(;e&&e.parent&&!this.selectableObjects.includes(e);)e=e.parent;if(!e||!this.selectableObjects.includes(e)||!this.isObjectValidForSelection(e))return void(t||this.isDragging||this.deselectAllObjects());t?this.toggleObjectSelection(e):this.selectSingleObject(e)}else t||this.isDragging||this.deselectAllObjects()}getObjectsInArea(e,t){const s=[],i=Math.min(e.x,t.x),n=Math.max(e.x,t.x),a=Math.min(e.y,t.y),r=Math.max(e.y,t.y);for(const o of this.selectableObjects){if(!this.isObjectValidForSelection(o))continue;const e=new S;o.getWorldPosition(e),e.project(this.camera),e.x>=i&&e.x<=n&&e.y>=a&&e.y<=r&&s.push(o)}return s}addSelectionOutline(e){var t;e&&((null==(t=e.userData)?void 0:t.isSelectionOutline)||this._shouldUseFallbackOutline()&&(e.isGroup||e.children&&e.children.length>0?this.addSelectionOutlineToGroup(e):this.addSelectionOutlineToSingleMesh(e)))}addSelectionOutlineToGroup(e){e&&e.traverse&&e.traverse(t=>{var s;t&&t.isMesh&&t!==e&&!(null==(s=t.userData)?void 0:s.isSelectionOutline)&&this.addSelectionOutlineToSingleMesh(t)})}addSelectionOutlineToSingleMesh(e){var t,s,i;try{if(!e||!e.isMesh)return;if(null==(t=e.userData)?void 0:t.isSelectionOutline)return;if(!this._shouldUseFallbackOutline())return;if(e.userData||(e.userData={}),e.userData.outlineObject){try{const t=e.userData.outlineObject;t&&t.parent!==e&&(t.parent&&t.parent.remove(t),e.add(t))}catch{}return}const n=(null==(i=null==(s=e.geometry)?void 0:s.clone)?void 0:i.call(s))||null;if(!n)return;try{n.attributes&&n.attributes.normal||n.computeVertexNormals()}catch{}const a=this.lastSelectedObject===e||1===this.selectedObjects.length&&this.selectedObjects[0]===e,r=new x({color:a?16765952:16742912,side:tt,transparent:!1,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});try{n.computeBoundingSphere()}catch{}const o=n.boundingSphere?n.boundingSphere.radius:1,l=Math.max(.002,.005*o);r.onBeforeCompile=e=>{e.uniforms.uOutlineThickness={value:l},e.vertexShader=e.vertexShader.replace("#include <common>","#include <common>\nuniform float uOutlineThickness;").replace("#include <begin_vertex>","#include <begin_vertex>\n  vec3 worldNormal = normalize(mat3(modelMatrix) * normal);\n  transformed += worldNormal * uOutlineThickness;"),r.userData.shader=e};const c=new q(n,r);c.name="SelectionOutline",c.userData=c.userData||{},c.userData.isSelectionOutline=!0,c.userData.isSystemObject=!0;try{c.layers.mask=e.layers.mask}catch{}try{c.renderOrder=(e.renderOrder||0)+.001}catch{}e.add(c),e.userData.outlineObject=c}catch{}}removeSelectionOutline(e){e&&(e.isGroup||e.children&&e.children.length>0?this.removeSelectionOutlineFromGroup(e):this.removeSelectionOutlineFromMesh(e))}removeSelectionOutlineFromGroup(e){if(e&&e.traverse){try{e.traverse(t=>{var s;t&&t.isMesh&&t!==e&&!(null==(s=t.userData)?void 0:s.isSelectionOutline)&&this.removeSelectionOutlineFromMesh(t)})}catch(t){}e.userData&&delete e.userData.outlineChildren}}removeSelectionOutlineFromMesh(e){if(e&&e.userData&&!e.userData.isSelectionOutline){if(e.userData.outlineObject){if(e.userData.outlineObject.parent&&e.userData.outlineObject.parent.remove(e.userData.outlineObject),e.userData.outlineObject.geometry){if(this.isDragging)return;e.userData.outlineObject.geometry.dispose()}e.userData.outlineObject.material&&e.userData.outlineObject.material.dispose(),delete e.userData.outlineObject}e.material&&void 0!==e.userData.originalEmissive&&(e.material.emissive.copy(e.userData.originalEmissive),e.material.emissiveIntensity=e.userData.originalEmissiveIntensity,delete e.userData.originalEmissive,delete e.userData.originalEmissiveIntensity)}}updateSelectionOutline(e){var t;(null==(t=e.userData)?void 0:t.isSelectionOutline)||this._shouldUseFallbackOutline()&&(e.isGroup||e.children&&e.children.length>0?this.updateSelectionOutlineForGroup(e):this.updateSelectionOutlineForMesh(e))}updateSelectionOutlineForGroup(e){e&&e.traverse&&e.traverse(t=>{var s;t&&t.isMesh&&t!==e&&!(null==(s=t.userData)?void 0:s.isSelectionOutline)&&this.updateSelectionOutlineForMesh(t)})}updateSelectionOutlineForMesh(e){var t,s;if(!e||!e.isMesh)return;if(null==(t=e.userData)?void 0:t.isSelectionOutline)return;if(!this._shouldUseFallbackOutline())return;const i=null==(s=e.userData)?void 0:s.outlineObject;if(i)try{const t=this.lastSelectedObject===e||1===this.selectedObjects.length&&this.selectedObjects[0]===e?16765952:16742912;i.material&&i.material.color&&i.material.color.setHex(t)}catch{}}updateAllSelectionOutlines(){this.isDragging||this.cleanupSelectedObjects(),this._syncOutlineWithSelection();if(this._shouldUseFallbackOutline()){for(const e of this.selectedObjects)if(e){try{this.addSelectionOutline(e)}catch{}try{this.updateSelectionOutline(e)}catch{}}}else for(const e of this.selectedObjects)if(e)try{this.removeSelectionOutline(e)}catch{}}setGizmoMode(e){if(!this.transformControls)return;this.gizmoMode=e,this.transformControls.setMode(e);const t=this.editorStore.getState();t.setTransformMode&&t.setTransformMode(e);const s=this.editorStore.getState().selectedObject;s&&!this.transformControls.object&&this.transformControls.attach(s)}setGridSnap(e,t=1){if(this.transformControls)if(e){const e=this.editorStore.getState(),s=Number.isFinite(null==e?void 0:e.snapMove)?e.snapMove:t,i=Number.isFinite(null==e?void 0:e.snapRotateDeg)?Z.degToRad(e.snapRotateDeg):Z.degToRad(15),n=Number.isFinite(null==e?void 0:e.snapScale)?e.snapScale:.1;this.transformControls.setTranslationSnap(s||t),this.transformControls.setRotationSnap(i),this.transformControls.setScaleSnap(n)}else this.transformControls.setTranslationSnap(null),this.transformControls.setRotationSnap(null),this.transformControls.setScaleSnap(null)}updateGizmoSize(){var e;try{const t=null==(e=this.editorStore.getState())?void 0:e.gizmoSize;this.transformControls&&Number.isFinite(t)&&this.transformControls.setSize(t)}catch{}}updateGridSnap(){const e=this.editorStore.getState();this.setGridSnap(e.isGridSnap,e.gridSize)}updateGizmoSpace(){const e=this.editorStore.getState();this.transformControls&&this.transformControls.setSpace(e.gizmoSpace)}isChildOf(e,t){let s=e.parent;for(;s;){if(s===t)return!0;s=s.parent}return!1}updateCamera(e){this.camera=e,this.transformControls&&(this.transformControls.camera=e)}addSelectableObject(e){this.selectableObjects.includes(e)||this.selectableObjects.push(e)}removeSelectableObject(e){const t=this.selectableObjects.indexOf(e);t>-1&&this.selectableObjects.splice(t,1)}updateSelectableObjects(e){this.selectableObjects=[...e]}showSelectionBox(e,t,s,i){this.selectionBox.style.display="block",this.selectionBox.style.left=e+"px",this.selectionBox.style.top=t+"px",this.selectionBox.style.width=s+"px",this.selectionBox.style.height=i+"px"}hideSelectionBox(){this.selectionBox.style.display="none"}getSelectedObjects(){return[...this.selectedObjects]}getSelectableObjects(){return[...this.selectableObjects]}getTransformControls(){return this.transformControls}isDraggingGizmo(){return this.isDragging}dispose(){var e,t;if(this.clearTempGroup(),this.transformControls){try{const s=null==(t=(e=this.transformControls).getHelper)?void 0:t.call(e);s&&s.parent&&s.parent.remove(s)}catch{}this.transformControls.dispose()}this.selectionBox&&this.selectionBox.parentNode&&this.selectionBox.parentNode.removeChild(this.selectionBox)}}class fa{constructor(e,t,s){this.objectSelector=e,this.editorStore=t,this.keyboardController=s,this.state={mode:"translate",space:"world",snapEnabled:!1,gridSize:1},this.registerKeyboardActions(),this.applyInitialSettings()}registerKeyboardActions(){this.keyboardController&&(this.keyboardController.registerTransformActions({setMode:e=>this.setTransformMode(e),toggleSpace:()=>this.toggleSpace(),toggleSnap:()=>this.toggleGridSnap()}),this.keyboardController.registerRotationActions({rotateX:e=>this.rotateSelectedX(e),rotateY:e=>this.rotateSelectedY(e),rotateZ:e=>this.rotateSelectedZ(e),resetRotation:()=>this.resetSelectedRotation()}),this.keyboardController.registerSelectionActions({deselectAll:()=>this.deselectAll(),selectAll:()=>this.selectAll()}),this.keyboardController.registerObjectActions({deleteSelected:()=>this.deleteSelected(),duplicateSelected:()=>this.duplicateSelected(),groupSelected:()=>this.groupSelected(),ungroupSelected:()=>this.ungroupSelected()}),this.keyboardController.registerSystemActions({undo:()=>this.undo(),redo:()=>this.redo()}))}setTransformMode(e){var t;return!(!this.isValidMode(e)||!this.objectSelector)&&(this.state.mode,this.state.mode=e,this.objectSelector.setGizmoMode(e),"rotate"===e&&this.setupQuaternionRotation(),(null==(t=this.editorStore)?void 0:t.getState().setTransformMode)&&this.editorStore.getState().setTransformMode(e),!0)}toggleSpace(){var e;return!!(null==(e=this.objectSelector)?void 0:e.transformControls)&&(this.state.space,this.state.space="world"===this.state.space?"local":"world",this.objectSelector.transformControls.setSpace(this.state.space),!0)}toggleGridSnap(){return!!this.objectSelector&&(this.state.snapEnabled=!this.state.snapEnabled,this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),!0)}setGridSize(e){return!(!this.objectSelector||!this.isValidGridSize(e))&&(this.state.gridSize,this.state.gridSize=e,this.state.snapEnabled&&this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),!0)}deselectAll(){var e;return!!this.objectSelector&&(null==(e=this.objectSelector.selectedObjects)||e.length,this.objectSelector.deselectAllObjects(),!0)}selectAll(){if(!this.objectSelector)return!1;const e=this.objectSelector.getSelectableObjects();return!!(e&&e.length>0)&&(this.objectSelector.selectMultipleObjects(e),!0)}deleteSelected(){var e,t,s,i,n,a,r,o,l,c;if(!this.objectSelector||!this.hasSelectedObjects())return!1;const A=[...this.objectSelector.selectedObjects];try{null==(i=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:(s=t.call(e)).beginBatch)||i.call(s)}catch{}A.map(e=>{var t,s;return(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(s=null==e?void 0:e.userData)?void 0:s.ownerId)}).filter(Boolean);const d=null==(a=null==(n=this.editorStore)?void 0:n.getState)?void 0:a.call(n);this.deselectAll(),A.forEach(e=>{var t,s;this.removeObjectFromScene(e);const i=(null==(t=null==e?void 0:e.userData)?void 0:t.id)??(null==(s=null==e?void 0:e.userData)?void 0:s.ownerId);i&&(null==d?void 0:d.removeObjectById)&&d.removeObjectById(i)});try{null==(c=null==(o=null==(r=this.editorStore)?void 0:r.getState)?void 0:(l=o.call(r)).endBatch)||c.call(l)}catch{}return!0}duplicateSelected(){var e,t,s,i,n,a,r,o,l,c;if(!this.objectSelector||!this.hasSelectedObjects())return!1;const A=[...this.objectSelector.selectedObjects],d=[];try{null==(i=null==(t=null==(e=this.editorStore)?void 0:e.getState)?void 0:(s=t.call(e)).beginBatch)||i.call(s)}catch{}const h=null==(a=null==(n=this.editorStore)?void 0:n.getState)?void 0:a.call(n);A.forEach(e=>{var t,s,i,n,a;const r=this.cloneObject(e);if(r){d.push(r);const o=null==(t=r.userData)?void 0:t.id;o&&(null==h?void 0:h.addObject)&&h.addObject({id:o,name:r.name||`Object_${o}`,type:(null==(s=null==e?void 0:e.userData)?void 0:s.type)||"basic",parentId:(null==(i=null==e?void 0:e.userData)?void 0:i.id)?(null==(a=null==(n=e.parent)?void 0:n.userData)?void 0:a.id)??null:null,position:{x:r.position.x,y:r.position.y,z:r.position.z},rotation:{x:r.rotation.x,y:r.rotation.y,z:r.rotation.z},scale:{x:r.scale.x,y:r.scale.y,z:r.scale.z},visible:!1!==r.visible})}}),d.length>0&&this.selectObjects(d);try{null==(c=null==(o=null==(r=this.editorStore)?void 0:r.getState)?void 0:(l=o.call(r)).endBatch)||c.call(l)}catch{}return d}groupSelected(){var e,t,s,i,n,a,r,o,l,c,A,d,h;if(!this.objectSelector||(null==(e=this.objectSelector.selectedObjects)?void 0:e.length)<2)return!1;const u=[...this.objectSelector.selectedObjects];try{null==(n=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:(i=s.call(t)).beginBatch)||n.call(i)}catch{}const p=this.createGroup(u);if(p){this.selectObjects([p]);try{null==(l=null==(r=null==(a=this.editorStore)?void 0:a.getState)?void 0:(o=r.call(a)).endBatch)||l.call(o)}catch{}return p}try{null==(h=null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:(d=A.call(c)).endBatch)||h.call(d)}catch{}return!1}ungroupSelected(){var e,t,s,i,n,a,r,o,l,c,A,d,h;if(!this.objectSelector||1!==(null==(e=this.objectSelector.selectedObjects)?void 0:e.length))return!1;const u=this.objectSelector.selectedObjects[0];if(!this.isGroup(u))return!1;try{null==(n=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:(i=s.call(t)).beginBatch)||n.call(i)}catch{}const p=this.ungroupObject(u);if(p.length>0){this.selectObjects(p);try{null==(l=null==(r=null==(a=this.editorStore)?void 0:a.getState)?void 0:(o=r.call(a)).endBatch)||l.call(o)}catch{}return p}try{null==(h=null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:(d=A.call(c)).endBatch)||h.call(d)}catch{}return!1}applyInitialSettings(){this.objectSelector&&(this.objectSelector.setGizmoMode(this.state.mode),this.objectSelector.setGridSnap(this.state.snapEnabled,this.state.gridSize),this.objectSelector.isMagnetEnabled=this.state.magnetEnabled,this.objectSelector.showMagnetRays=this.state.magnetRaysVisible,this.objectSelector.transformControls&&(this.objectSelector.transformControls.setSpace(this.state.space),this.setupQuaternionRotation()))}setupQuaternionRotation(){var e;if(!(null==(e=this.objectSelector)?void 0:e.transformControls))return;const t=this.objectSelector.transformControls;"rotate"===this.state.mode&&(t.rotationSnap=Math.PI/12,this.setupRotationEventListeners())}setupRotationEventListeners(){var e;if(!(null==(e=this.objectSelector)?void 0:e.transformControls))return;const t=this.objectSelector.transformControls;t.addEventListener("objectChange",()=>{"rotate"===t.getMode()&&this.hasSelectedObjects()&&this.onQuaternionRotationChange()})}onQuaternionRotationChange(){const e=this.objectSelector.selectedObjects;e.forEach((e,t)=>{e.quaternion.normalize(),e.updateMatrix(),e.updateMatrixWorld()}),e.length>0&&this.getSelectedObjectRotation(e[0])}updateObjectSelector(e){this.objectSelector=e,this.applyInitialSettings()}getState(){var e,t;return{...this.state,selectedObjectsCount:(null==(t=null==(e=this.objectSelector)?void 0:e.selectedObjects)?void 0:t.length)||0,hasSelection:this.hasSelectedObjects()}}applySettings(e){e.mode&&e.mode!==this.state.mode&&this.setTransformMode(e.mode),e.space&&e.space!==this.state.space&&this.toggleSpace(),void 0!==e.snapEnabled&&e.snapEnabled!==this.state.snapEnabled&&this.toggleGridSnap(),e.gridSize&&e.gridSize!==this.state.gridSize&&this.setGridSize(e.gridSize)}rotateSelectedObjects(e){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(t=>{this.applyQuaternionRotation(t,e)}),!0}applyQuaternionRotation(e,t){e&&(e.quaternion.multiplyQuaternions(t,e.quaternion),e.updateMatrix())}rotateSelectedX(e){const t=Z.degToRad(e),s=(new ae).setFromAxisAngle(new S(1,0,0),t);return this.rotateSelectedObjects(s)}rotateSelectedY(e){const t=Z.degToRad(e),s=(new ae).setFromAxisAngle(new S(0,1,0),t);return this.rotateSelectedObjects(s)}rotateSelectedZ(e){const t=Z.degToRad(e),s=(new ae).setFromAxisAngle(new S(0,0,1),t);return this.rotateSelectedObjects(s)}rotateSelectedAroundAxis(e,t){if(!e||0===e.length())return!1;const s=e.clone().normalize(),i=Z.degToRad(t),n=(new ae).setFromAxisAngle(s,i);return this.rotateSelectedObjects(n)}rotateSelectedByEuler(e,t,s,i="XYZ"){const n=new $e(Z.degToRad(e),Z.degToRad(t),Z.degToRad(s),i),a=(new ae).setFromEuler(n);return this.rotateSelectedObjects(a)}rotateSelectedToLookAt(e){if(!this.hasSelectedObjects()||!e)return!1;return this.objectSelector.selectedObjects.forEach(t=>{(new S).subVectors(e,t.position).normalize();const s=new B;s.lookAt(t.position,e,new S(0,1,0));const i=(new ae).setFromRotationMatrix(s);t.quaternion.copy(i),t.updateMatrix()}),!0}resetSelectedRotation(){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(e=>{e.quaternion.set(0,0,0,1),e.updateMatrix()}),!0}getSelectedObjectRotation(e=null){const t=e||this.objectSelector.selectedObjects[0];if(!t)return null;const s=(new $e).setFromQuaternion(t.quaternion,"XYZ");return{x:Z.radToDeg(s.x),y:Z.radToDeg(s.y),z:Z.radToDeg(s.z),quaternion:t.quaternion.clone()}}rotateSelectedInWorldSpace(e){if(!this.hasSelectedObjects())return!1;return this.objectSelector.selectedObjects.forEach(t=>{const s=new ae;if(t.getWorldQuaternion(s),s.premultiply(e),t.parent){const e=new ae;t.parent.getWorldQuaternion(e),e.invert(),t.quaternion.multiplyQuaternions(e,s)}else t.quaternion.copy(s);t.updateMatrix()}),!0}rotateSelectedAroundPoint(e,t){if(!this.hasSelectedObjects()||!e)return!1;return this.objectSelector.selectedObjects.forEach(s=>{const i=s.position.clone().sub(e);i.applyQuaternion(t),s.position.copy(e).add(i),s.quaternion.multiplyQuaternions(t,s.quaternion),s.updateMatrix()}),!0}isValidMode(e){return["translate","rotate","scale"].includes(e)}isValidGridSize(e){return"number"==typeof e&&e>0&&e<=100}hasSelectedObjects(){var e,t;return(null==(t=null==(e=this.objectSelector)?void 0:e.selectedObjects)?void 0:t.length)>0}isGroup(e){var t;return!0===(null==(t=null==e?void 0:e.userData)?void 0:t.isGroup)||"Group"===(null==e?void 0:e.type)}removeObjectFromScene(e){e&&e.parent&&(e.parent.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))}cloneObject(e){if(!e)return null;const t=e.clone();return t.position.x+=1,t.position.z+=1,t.userData={...e.userData,id:`${e.userData.id}_copy_${Date.now()}`},e.parent.add(t),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(t),t}createGroup(e){var t,s,i;if(!e||e.length<2)return null;const n=new J;n.name=`Group_${Date.now()}`,n.userData={id:`group_${Date.now()}`,type:"group",isGroup:!0};e[0].parent.add(n),e.forEach(e=>{if(e&&e.parent){const t=e.matrixWorld.clone();n.add(e),e.matrix.copy(t),e.matrix.premultiply(n.matrixWorld.clone().invert()),e.matrix.decompose(e.position,e.quaternion,e.scale)}}),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(n);try{const a=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);if((null==a?void 0:a.addObject)&&a.addObject({id:n.userData.id,name:n.name,type:"group",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z},visible:!0}),null==a?void 0:a.setParent)for(const t of e){const e=null==(i=null==t?void 0:t.userData)?void 0:i.id;e&&a.setParent(e,n.userData.id)}}catch{}return n}ungroupObject(e){var t,s,i,n,a,r,o;if(!this.isGroup(e))return[];const l=[...e.children],c=e.parent;l.forEach(e=>{if(e){const t=e.matrixWorld.clone();c.add(e),e.matrix.copy(t),e.matrix.premultiply(c.matrixWorld.clone().invert()),e.matrix.decompose(e.position,e.quaternion,e.scale),this.objectSelector.addSelectableObject&&this.objectSelector.addSelectableObject(e)}});try{const e=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);if(null==e?void 0:e.setParent){const t=(null==(i=null==c?void 0:c.userData)?void 0:i.id)??null;for(const s of l){const i=null==(n=null==s?void 0:s.userData)?void 0:n.id;i&&(e.setParent(i,t),e.updateObjectTransform&&e.updateObjectTransform(i,{position:{x:s.position.x,y:s.position.y,z:s.position.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:s.scale.x,y:s.scale.y,z:s.scale.z}}))}}}catch{}this.objectSelector.removeSelectableObject&&this.objectSelector.removeSelectableObject(e),c.remove(e);try{const t=null==(r=null==(a=this.editorStore)?void 0:a.getState)?void 0:r.call(a),s=null==(o=null==e?void 0:e.userData)?void 0:o.id;s&&(null==t?void 0:t.removeObjectById)&&t.removeObjectById(s)}catch{}return l}selectObjects(e){this.objectSelector&&e&&0!==e.length&&(this.objectSelector.deselectAllObjects(),1===e.length?this.objectSelector.selectSingleObject(e[0]):this.objectSelector.selectMultipleObjects(e))}logStateChange(e,t,s){}undo(){var e;try{const t=null==(e=this.editorStore)?void 0:e.getState();(null==t?void 0:t.undo)&&t.undo()}catch(t){}}redo(){var e;try{const t=null==(e=this.editorStore)?void 0:e.getState();(null==t?void 0:t.redo)&&t.redo()}catch(t){}}dispose(){this.objectSelector=null,this.editorStore=null,this.keyboardController=null}}class va{constructor(){this.isEnabled=!0,this.pressedKeys=new Set,this.mouseState={isDown:!1,button:-1,position:{x:0,y:0},previousPosition:{x:0,y:0},dragStart:{x:0,y:0}},this.handlers={keyboard:new Map,mouse:new Map,wheel:null,contextMenu:null,resize:null},this.modifierKeys={ctrl:!1,shift:!1,alt:!1,meta:!1},this.boundHandlers={keyDown:this.handleKeyDown.bind(this),keyUp:this.handleKeyUp.bind(this),mouseDown:this.handleMouseDown.bind(this),mouseMove:this.handleMouseMove.bind(this),mouseUp:this.handleMouseUp.bind(this),wheel:this.handleWheel.bind(this),contextMenu:this.handleContextMenu.bind(this),resize:this.handleResize.bind(this)},this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",this.boundHandlers.keyDown),document.addEventListener("keyup",this.boundHandlers.keyUp),window.addEventListener("resize",this.boundHandlers.resize)}setupMouseEvents(e){this.canvas=e,e.addEventListener("mousedown",this.boundHandlers.mouseDown),document.addEventListener("mousemove",this.boundHandlers.mouseMove),document.addEventListener("mouseup",this.boundHandlers.mouseUp),e.addEventListener("wheel",this.boundHandlers.wheel),e.addEventListener("contextmenu",this.boundHandlers.contextMenu)}handleKeyDown(e){if(!this.isEnabled||this.isInputFieldActive(e.target))return;this.updateModifierKeys(e),this.pressedKeys.add(e.code);const t={code:e.code,key:e.key,ctrl:this.modifierKeys.ctrl,shift:this.modifierKeys.shift,alt:this.modifierKeys.alt,meta:this.modifierKeys.meta,originalEvent:e};this.modifierKeys.ctrl||this.modifierKeys.meta?this.executeHandler("keyboard","ctrl",t):this.executeHandler("keyboard",e.code,t)}handleKeyUp(e){if(!this.isEnabled)return;this.updateModifierKeys(e),this.pressedKeys.delete(e.code);const t={code:e.code,key:e.key,ctrl:this.modifierKeys.ctrl,shift:this.modifierKeys.shift,alt:this.modifierKeys.alt,meta:this.modifierKeys.meta,originalEvent:e};this.executeHandler("keyboard","keyup",t)}handleMouseDown(e){if(!this.isEnabled)return;this.mouseState.isDown=!0,this.mouseState.button=e.button,this.updateMousePosition(e),this.mouseState.previousPosition={...this.mouseState.position},this.mouseState.dragStart={...this.mouseState.position};const t={button:e.button,position:{...this.mouseState.position},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e};this.executeHandler("mouse","mousedown",t)}handleMouseMove(e){if(!this.isEnabled)return;this.mouseState.previousPosition={...this.mouseState.position},this.updateMousePosition(e);const t={position:{...this.mouseState.position},previousPosition:{...this.mouseState.previousPosition},dragStart:{...this.mouseState.dragStart},isDown:this.mouseState.isDown,button:this.mouseState.button,delta:{x:this.mouseState.position.x-this.mouseState.previousPosition.x,y:this.mouseState.position.y-this.mouseState.previousPosition.y},originalEvent:e};this.executeHandler("mouse","mousemove",t)}handleMouseUp(e){if(!this.isEnabled)return;const t={button:e.button,position:{...this.mouseState.position},dragStart:{...this.mouseState.dragStart},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,meta:e.metaKey,originalEvent:e};this.executeHandler("mouse","mouseup",t),this.mouseState.isDown=!1,this.mouseState.button=-1}handleWheel(e){if(!this.isEnabled)return;e.preventDefault();const t={delta:e.deltaY,position:{...this.mouseState.position},ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,originalEvent:e};this.handlers.wheel&&this.handlers.wheel(t)}handleContextMenu(e){e.preventDefault(),this.handlers.contextMenu&&this.handlers.contextMenu(e)}handleResize(e){this.handlers.resize&&this.handlers.resize(e)}updateMousePosition(e){if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.mouseState.position={x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,screenX:e.clientX,screenY:e.clientY}}updateModifierKeys(e){this.modifierKeys.ctrl=e.ctrlKey,this.modifierKeys.shift=e.shiftKey,this.modifierKeys.alt=e.altKey,this.modifierKeys.meta=e.metaKey}executeHandler(e,t,s){var i;if("keyboard"===e){const e=this.handlers.keyboard.get("default");if(e)try{e(s)}catch(n){}}else{const a=null==(i=this.handlers[e])?void 0:i.get(t);if(a)try{a(s)}catch(n){}}}isInputFieldActive(e){return["INPUT","TEXTAREA","SELECT"].includes(e.tagName)||"true"===e.contentEditable}registerKeyHandler(e,t){this.handlers.keyboard.has(e)||this.handlers.keyboard.set(e,t)}registerMouseHandler(e,t){this.handlers.mouse.has(e)||this.handlers.mouse.set(e,t)}registerWheelHandler(e){this.handlers.wheel=e}registerContextMenuHandler(e){this.handlers.contextMenu=e}registerResizeHandler(e){this.handlers.resize=e}unregisterHandler(e,t){var s;"wheel"===e?this.handlers.wheel=null:"contextMenu"===e?this.handlers.contextMenu=null:null==(s=this.handlers[e])||s.delete(t)}clearAllHandlers(){this.handlers.keyboard.clear(),this.handlers.mouse.clear(),this.handlers.wheel=null,this.handlers.contextMenu=null}setEnabled(e){this.isEnabled=e}isKeyPressed(e){return this.pressedKeys.has(e)}getModifierKeys(){return{...this.modifierKeys}}getMouseState(){return{...this.mouseState}}getInputState(){return{enabled:this.isEnabled,pressedKeys:Array.from(this.pressedKeys),modifierKeys:this.getModifierKeys(),mouseState:this.getMouseState()}}dispose(){document.removeEventListener("keydown",this.boundHandlers.keyDown),document.removeEventListener("keyup",this.boundHandlers.keyUp),this.canvas&&(this.canvas.removeEventListener("mousedown",this.boundHandlers.mouseDown),this.canvas.removeEventListener("wheel",this.boundHandlers.wheel),this.canvas.removeEventListener("contextmenu",this.boundHandlers.contextMenu)),document.removeEventListener("mousemove",this.boundHandlers.mouseMove),document.removeEventListener("mouseup",this.boundHandlers.mouseUp),window.removeEventListener("resize",this.boundHandlers.resize),this.clearAllHandlers(),this.canvas=null,this.boundHandlers=null,this.pressedKeys.clear()}}class ya{constructor(e){this.inputManager=e,this.comboLocks=new Set,this.actions={transform:new Map,rotation:new Map,selection:new Map,viewport:new Map,object:new Map,system:new Map},this.setupDefaultKeyMappings(),this.registerInputHandlers()}setupDefaultKeyMappings(){this.actions.transform.set("KeyW",{name:"Move Mode",description:"이동 모드",action:null,category:"transform"}),this.actions.transform.set("KeyE",{name:"Rotate Mode",description:"회전 모드",action:null,category:"transform"}),this.actions.transform.set("KeyR",{name:"Scale Mode",description:"크기 모드",action:null,category:"transform"}),this.actions.transform.set("KeyQ",{name:"Toggle Space",description:"좌표계 전환",action:null,category:"transform"}),this.actions.transform.set("KeyX",{name:"Toggle Snap",description:"그리드 스냅 토글",action:null,category:"transform"}),this.actions.rotation.set("KeyJ",{name:"Rotate X+",description:"X축 양의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyL",{name:"Rotate X-",description:"X축 음의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyI",{name:"Rotate Y+",description:"Y축 양의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyK",{name:"Rotate Y-",description:"Y축 음의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyU",{name:"Rotate Z+",description:"Z축 양의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyO",{name:"Rotate Z-",description:"Z축 음의 방향 15도 회전",action:null,category:"rotation"}),this.actions.rotation.set("KeyP",{name:"Reset Rotation",description:"회전 초기화",action:null,category:"rotation"}),this.actions.selection.set("Escape",{name:"Deselect All",description:"모든 선택 해제",action:null,category:"selection"}),this.actions.selection.set("KeyA",{name:"Select All",description:"전체 선택",action:null,category:"selection",requiresCtrl:!0}),this.actions.object.set("Delete",{name:"Delete Objects",description:"선택된 오브젝트 삭제",action:null,category:"object"}),this.actions.object.set("Backspace",{name:"Delete Objects",description:"선택된 오브젝트 삭제",action:null,category:"object"}),this.actions.object.set("KeyD",{name:"Duplicate Objects",description:"오브젝트 복제",action:null,category:"object",requiresCtrl:!0}),this.actions.object.set("KeyG",{name:"Group Objects",description:"오브젝트 그룹화",action:null,category:"object",requiresCtrl:!0}),this.actions.viewport.set("KeyF",{name:"Focus on Object",description:"선택된 오브젝트로 포커스",action:null,category:"viewport"}),this.actions.viewport.set("Numpad5",{name:"Toggle Projection",description:"투영 모드 전환",action:null,category:"viewport"}),this.actions.viewport.set("Numpad1",{name:"Front View",description:"정면 뷰",action:null,category:"viewport"}),this.actions.viewport.set("Numpad3",{name:"Side View",description:"측면 뷰",action:null,category:"viewport"}),this.actions.viewport.set("Numpad7",{name:"Top View",description:"상단 뷰",action:null,category:"viewport"}),this.actions.viewport.set("Numpad0",{name:"Reset Camera",description:"카메라 리셋",action:null,category:"viewport"}),this.actions.system.set("KeyZ",{name:"Undo",description:"실행 취소",action:null,category:"system",requiresCtrl:!0}),this.actions.system.set("KeyY",{name:"Redo",description:"다시 실행",action:null,category:"system",requiresCtrl:!0}),this.actions.system.set("KeyS",{name:"Save",description:"저장",action:null,category:"system",requiresCtrl:!0})}registerInputHandlers(){this.inputManager.registerKeyHandler("default",this.handleKeyInput.bind(this))}handleKeyInput(e){const{code:t,ctrl:s,shift:i,originalEvent:n}=e;"keyup"!==(null==n?void 0:n.type)?s?this.handleCtrlKeyPress(e):this.handleKeyPress(e):this.releaseComboLocksForKey(t)}handleKeyPress(e){const{code:t,ctrl:s,shift:i,originalEvent:n}=e;if(s)return;const a=this.findAction(t);a&&a.action&&!a.requiresCtrl&&(n.preventDefault(),this.executeAction(a,e))}handleCtrlKeyPress(e){const{code:t,shift:s,originalEvent:i}=e,n="KeyZ"===t||"KeyY"===t;if(n&&(null==i?void 0:i.repeat))return;const a=this.buildComboSignature(t,{ctrl:!0,shift:s});if(n&&this.comboLocks.has(a))return;const r=this.findAction(t);if(r&&r.action&&r.requiresCtrl)if(i.preventDefault(),s&&"KeyG"===t)this.executeSpecialAction("ungroupObjects",e);else if(s&&"KeyZ"===t){if(null==i?void 0:i.repeat)return;n&&this.comboLocks.add(a),this.executeSpecialAction("redo",e)}else n&&this.comboLocks.add(a),this.executeAction(r,e)}buildComboSignature(e,{ctrl:t=!1,shift:s=!1}={}){const i=[];return t&&i.push("Ctrl"),s&&i.push("Shift"),i.push(e),i.join("+")}releaseComboLocksForKey(e){const t=[];for(const s of this.comboLocks)s.endsWith(`+${e}`)&&t.push(s);for(const s of t)this.comboLocks.delete(s)}findAction(e){for(const[t,s]of Object.entries(this.actions))if(s.has(e))return s.get(e);return null}executeAction(e,t){if("function"==typeof e.action)try{e.action(t)}catch(s){}}executeSpecialAction(e,t){var s,i;const n={ungroupObjects:null==(s=this.actions.object.get("KeyG"))?void 0:s.ungroupAction,redo:null==(i=this.actions.system.get("KeyZ"))?void 0:i.redoAction}[e];if("function"==typeof n)try{n(t)}catch(a){}}registerTransformActions(e){e.setMode&&(this.actions.transform.get("KeyW").action=()=>e.setMode("translate"),this.actions.transform.get("KeyE").action=()=>e.setMode("rotate"),this.actions.transform.get("KeyR").action=()=>e.setMode("scale")),e.toggleSpace&&(this.actions.transform.get("KeyQ").action=e.toggleSpace),e.toggleSnap&&(this.actions.transform.get("KeyX").action=e.toggleSnap)}registerRotationActions(e){e.rotateX&&(this.actions.rotation.get("KeyJ").action=()=>e.rotateX(15),this.actions.rotation.get("KeyL").action=()=>e.rotateX(-15)),e.rotateY&&(this.actions.rotation.get("KeyI").action=()=>e.rotateY(15),this.actions.rotation.get("KeyK").action=()=>e.rotateY(-15)),e.rotateZ&&(this.actions.rotation.get("KeyU").action=()=>e.rotateZ(15),this.actions.rotation.get("KeyO").action=()=>e.rotateZ(-15)),e.resetRotation&&(this.actions.rotation.get("KeyP").action=e.resetRotation)}registerSelectionActions(e){e.deselectAll&&(this.actions.selection.get("Escape").action=e.deselectAll),e.selectAll&&(this.actions.selection.get("KeyA").action=e.selectAll)}registerObjectActions(e){e.deleteSelected&&(this.actions.object.get("Delete").action=e.deleteSelected,this.actions.object.get("Backspace").action=e.deleteSelected),e.duplicateSelected&&(this.actions.object.get("KeyD").action=e.duplicateSelected),e.groupSelected&&(this.actions.object.get("KeyG").action=e.groupSelected),e.ungroupSelected&&(this.actions.object.get("KeyG").ungroupAction=e.ungroupSelected)}registerViewportActions(e){e.focusOnSelected&&(this.actions.viewport.get("KeyF").action=e.focusOnSelected),e.toggleProjection&&(this.actions.viewport.get("Numpad5").action=e.toggleProjection),e.setView&&(this.actions.viewport.get("Numpad1").action=()=>e.setView("front"),this.actions.viewport.get("Numpad3").action=()=>e.setView("side"),this.actions.viewport.get("Numpad7").action=()=>e.setView("top")),e.resetCamera&&(this.actions.viewport.get("Numpad0").action=e.resetCamera)}registerSystemActions(e){e.undo&&(this.actions.system.get("KeyZ").action=e.undo),e.redo&&(this.actions.system.get("KeyZ").redoAction=e.redo,this.actions.system.has("KeyY")&&(this.actions.system.get("KeyY").action=e.redo)),e.save&&(this.actions.system.get("KeyS").action=e.save)}registerCustomKey(e,t,s,i,n="custom",a=!1){this.actions[n]||(this.actions[n]=new Map),this.actions[n].set(e,{name:t,description:s,action:i,category:n,requiresCtrl:a})}unregisterKey(e,t=null){if(t&&this.actions[t])this.actions[t].delete(e);else for(const s of Object.values(this.actions))if(s.has(e)){s.delete(e);break}}getKeyMappings(){const e={};for(const[t,s]of Object.entries(this.actions)){e[t]={};for(const[i,n]of s.entries())e[t][i]={name:n.name,description:n.description,requiresCtrl:n.requiresCtrl||!1}}return e}checkKeyConflicts(){const e=new Map,t=[];for(const[s,i]of Object.entries(this.actions))for(const[n,a]of i.entries()){const i=`${n}${a.requiresCtrl?"+Ctrl":""}`;e.has(i)?t.push({key:i,conflicting:[e.get(i),`${s}:${a.name}`]}):e.set(i,`${s}:${a.name}`)}return t.length,t}generateHelpText(){let e="Keyboard Shortcuts:\n\n";for(const[t,s]of Object.entries(this.actions))if(0!==s.size){e+=`${t.toUpperCase()}:\n`;for(const[t,i]of s.entries()){e+=`  ${this.formatKeyName(t,i.requiresCtrl).padEnd(20)} - ${i.description}\n`}e+="\n"}return e}formatKeyName(e,t=!1){const s={KeyW:"W",KeyE:"E",KeyR:"R",KeyQ:"Q",KeyX:"X",KeyV:"V",KeyC:"C",KeyA:"A",KeyD:"D",KeyG:"G",KeyF:"F",KeyZ:"Z",KeyS:"S",Escape:"ESC",Delete:"DEL",Backspace:"BACKSPACE",Numpad1:"NUM1",Numpad3:"NUM3",Numpad5:"NUM5",Numpad7:"NUM7",Numpad0:"NUM0"}[e]||e;return t?`Ctrl+${s}`:s}setEnabled(e){this.inputManager.setEnabled(e)}dispose(){for(const e of Object.values(this.actions))e.clear()}}class Ca{constructor(e){this.inputManager=e,this.transformControls=null,this.objectSelector=null,this.state={isDragging:!1,dragButton:-1,dragThreshold:5,isSelecting:!1,isPanning:!1,isOrbiting:!1,isGizmoInteracting:!1},this.handlers={leftClick:null,rightClick:null,middleClick:null,leftDrag:null,rightDrag:null,middleDrag:null,dragSelect:null,wheel:null,hover:null},this.selectionBox={element:null,startX:0,startY:0,isVisible:!1},this.registerInputHandlers()}registerInputHandlers(){this.inputManager.registerMouseHandler("mousedown",this.handleMouseDown.bind(this)),this.inputManager.registerMouseHandler("mousemove",this.handleMouseMove.bind(this)),this.inputManager.registerMouseHandler("mouseup",this.handleMouseUp.bind(this)),this.inputManager.registerWheelHandler(this.handleWheel.bind(this))}setTransformControls(e){this.transformControls=e,this.setupGizmoEventListeners()}setObjectSelector(e){this.objectSelector=e,e&&e.transformControls&&this.setTransformControls(e.transformControls)}setupGizmoEventListeners(){this.transformControls&&this.transformControls.addEventListener("dragging-changed",e=>{this.state.isGizmoInteracting=e.value})}isGizmoInteracting(){return this.state.isGizmoInteracting||this.transformControls&&this.transformControls.dragging}handleMouseDown(e){const{button:t,position:s,ctrl:i,shift:n,alt:a,originalEvent:r}=e;if(!this.isGizmoInteracting())switch(this.state.dragButton=t,t){case 0:this.handleLeftMouseDown(e);break;case 1:this.handleMiddleMouseDown(e);break;case 2:this.handleRightMouseDown(e)}}handleLeftMouseDown(e){const{position:t,ctrl:s,shift:i}=e;if(this.isGizmoInteracting&&this.isGizmoInteracting())return;const n=s||i;this.state.isSelecting=!0,this.selectionBox.startX=t.screenX,this.selectionBox.startY=t.screenY,this.handlers.leftClick&&this.handlers.leftClick({position:t,isMultiSelect:n,originalEvent:e.originalEvent})}handleMiddleMouseDown(e){const{alt:t,originalEvent:s}=e;s.preventDefault(),t?this.state.isOrbiting=!0:this.state.isPanning=!0,this.handlers.middleClick&&this.handlers.middleClick({isOrbiting:this.state.isOrbiting,isPanning:this.state.isPanning,originalEvent:s})}handleRightMouseDown(e){this.handlers.rightClick&&this.handlers.rightClick(e)}handleMouseMove(e){const{position:t,isDown:s,button:i,delta:n}=e;if((!this.isGizmoInteracting()||!s)&&(!s&&this.handlers.hover&&this.handlers.hover({position:t}),s)){if(!this.state.isDragging){this.calculateDragDistance(e)>this.state.dragThreshold&&(this.state.isDragging=!0,this.onDragStart(e))}this.state.isDragging&&this.handleDragMove(e),this.state.isSelecting&&0===i&&this.updateSelectionBox(e)}}onDragStart(e){}handleDragMove(e){const{button:t,delta:s}=e;switch(t){case 0:this.handlers.leftDrag&&this.handlers.leftDrag({delta:s,mouseInfo:e});break;case 1:this.state.isPanning&&this.handlers.middleDrag?this.handlers.middleDrag({type:"pan",delta:s,mouseInfo:e}):this.state.isOrbiting&&this.handlers.middleDrag&&this.handlers.middleDrag({type:"orbit",delta:s,mouseInfo:e});break;case 2:this.handlers.rightDrag&&this.handlers.rightDrag({delta:s,mouseInfo:e})}}handleMouseUp(e){const{button:t,position:s}=e;this.isGizmoInteracting()||(this.state.isSelecting&&0===t&&this.finishDragSelection(e),this.state.isDragging?this.handleDragEnd(e):this.handleClick(e)),this.resetMouseState()}handleClick(e){}handleDragEnd(e){this.state.isPanning&&this.handlers.dragEnd&&this.handlers.dragEnd({type:"pan",mouseInfo:e})}handleWheel(e){this.handlers.wheel&&this.handlers.wheel(e)}calculateDragDistance(e){const{position:t,dragStart:s}=e,i=t.screenX-s.screenX,n=t.screenY-s.screenY;return Math.sqrt(i*i+n*n)}updateSelectionBox(e){var t;const{position:s}=e,i=s.screenX,n=s.screenY,a=null==(t=this.inputManager)?void 0:t.canvas,r=a?a.getBoundingClientRect():null,o=(e,t,s)=>Math.min(Math.max(e,t),s),l=this.selectionBox.startX,c=this.selectionBox.startY,A=r?o(l,r.left,r.right):l,d=r?o(c,r.top,r.bottom):c,h=r?o(i,r.left,r.right):i,u=r?o(n,r.top,r.bottom):n,p=Math.min(A,h),g=Math.min(d,u),m=Math.abs(h-A),b=Math.abs(u-d);(m>this.state.dragThreshold||b>this.state.dragThreshold)&&(m>0&&b>0?this.showSelectionBox(p,g,m,b):this.hideSelectionBox(),this.handlers.dragSelect&&this.handlers.dragSelect({startX:A,startY:d,currentX:h,currentY:u,left:p,top:g,width:m,height:b}))}finishDragSelection(e){var t;const{position:s,ctrl:i,shift:n}=e,a=this.calculateDragDistance(e),r=i||n;if(this.hideSelectionBox(),a<this.state.dragThreshold)return;const o=null==(t=this.inputManager)?void 0:t.canvas,l=o?o.getBoundingClientRect():null,c=(e,t,s)=>Math.min(Math.max(e,t),s),A=l?c(this.selectionBox.startX,l.left,l.right):this.selectionBox.startX,d=l?c(this.selectionBox.startY,l.top,l.bottom):this.selectionBox.startY,h=l?c(s.screenX,l.left,l.right):s.screenX,u=l?c(s.screenY,l.top,l.bottom):s.screenY;l&&Math.abs(h-A)<=this.state.dragThreshold&&Math.abs(u-d)<=this.state.dragThreshold||this.handlers.dragSelectEnd&&this.handlers.dragSelectEnd({startX:A,startY:d,endX:h,endY:u,isMultiSelect:r})}showSelectionBox(e,t,s,i){this.selectionBox.element||this.createSelectionBoxElement();const n=this.selectionBox.element;n.style.left=`${e}px`,n.style.top=`${t}px`,n.style.width=`${s}px`,n.style.height=`${i}px`,n.style.display="block",this.selectionBox.isVisible=!0}hideSelectionBox(){this.selectionBox.element&&(this.selectionBox.element.style.display="none"),this.selectionBox.isVisible=!1}createSelectionBoxElement(){const e=document.createElement("div");e.style.position="fixed",e.style.border="1px dashed #007acc",e.style.backgroundColor="rgba(0, 122, 204, 0.1)",e.style.pointerEvents="none",e.style.zIndex="10000",e.style.display="none",document.body.appendChild(e),this.selectionBox.element=e}resetMouseState(){this.state.isDragging=!1,this.state.dragButton=-1,this.state.isSelecting=!1,this.state.isPanning=!1,this.state.isOrbiting=!1}onLeftClick(e){this.handlers.leftClick=e}onRightClick(e){this.handlers.rightClick=e}onMiddleClick(e){this.handlers.middleClick=e}onLeftDrag(e){this.handlers.leftDrag=e}onMiddleDrag(e){this.handlers.middleDrag=e}onRightDrag(e){this.handlers.rightDrag=e}onDragSelect(e){this.handlers.dragSelect=e}onDragSelectEnd(e){this.handlers.dragSelectEnd=e}onWheel(e){this.handlers.wheel=e}onHover(e){this.handlers.hover=e}onDragEnd(e){this.handlers.dragEnd=e}setDragThreshold(e){this.state.dragThreshold=Math.max(1,e)}getMouseState(){return{...this.state}}getSelectionBoxState(){return{...this.selectionBox}}removeHandler(e){this.handlers.hasOwnProperty(e)&&(this.handlers[e]=null)}removeAllHandlers(){for(const e in this.handlers)this.handlers[e]=null}dispose(){this.selectionBox.element&&(document.body.removeChild(this.selectionBox.element),this.selectionBox.element=null),this.removeAllHandlers(),this.resetMouseState(),this.transformControls=null,this.objectSelector=null}}class xa{constructor(e,t,s,i,n=null){var a,r,o,l,c;this.scene=e,this.renderer=s,this.editorStore=i,this.gizmoScene=null,this.inputManager=new va,this.keyboardController=new ya(this.inputManager),this.mouseController=new Ca(this.inputManager),this.cameraController=new ma(t,s,n);try{const e=this.editorStore.getState();null==(r=(a=this.cameraController).setSpeeds)||r.call(a,{pan:e.cameraPanSpeed,orbit:e.cameraOrbitSpeed,zoom:e.cameraZoomSpeed}),this._unsubCamSpeeds=this.editorStore.subscribe((e,t)=>{var s,i;e.cameraPanSpeed===t.cameraPanSpeed&&e.cameraOrbitSpeed===t.cameraOrbitSpeed&&e.cameraZoomSpeed===t.cameraZoomSpeed||null==(i=(s=this.cameraController).setSpeeds)||i.call(s,{pan:e.cameraPanSpeed,orbit:e.cameraOrbitSpeed,zoom:e.cameraZoomSpeed})})}catch{}this.objectSelector=new ba(e,t,s,i),null==(l=(o=this.objectSelector).setGizmoScene)||l.call(o,null),this._gizmoPointerDown=!1,this._gizmoPointerDownAt=0;try{const e=null==(c=this.objectSelector)?void 0:c.transformControls;e&&(e.addEventListener("mouseDown",()=>{this._gizmoPointerDown=!0,this._gizmoPointerDownAt="undefined"!=typeof performance?performance.now():Date.now()}),e.addEventListener("mouseUp",()=>{this._gizmoPointerDown=!1,this._gizmoPointerDownAt=0}),e.addEventListener("dragging-changed",e=>{(null==e?void 0:e.value)&&(this._gizmoPointerDown=!0)}))}catch{}this.mouseController.setObjectSelector(this.objectSelector),this.transformManager=new fa(this.objectSelector,i,this.keyboardController),this._wrapSceneAddForWireframe(e),this.initializeGrid(),this.inputManager.setupMouseEvents(s.domElement),this.inputManager.registerResizeHandler(this.onWindowResize.bind(this)),this.setupMouseHandlers(),this.setupViewportActions(),this.isMouseDown=!1,this.isPanning=!1,this.isOrbiting=!1,this.isDragSelecting=!1,this.mousePosition=new E,this.previousMousePosition=new E,this.dragStartPosition=new E,this.partInspector={enabled:!1,selectedPart:null,selectedParts:new Set,solo:!1,clipping:!1,savedVisibility:new Map,clippingPlanes:[],group:null,groupPivot:"center",groupEnabled:!1},this._partRaycaster=new qe,this._partTransformControls=null,this._initPartTransformControls(t,s)}_wrapSceneAddForWireframe(e){try{if(!e||!e.add||e.__addWrapped)return;const t=e.add.bind(e),s=this.editorStore;e.add=(...e)=>{var i;const n=t(...e);try{const t=!!s.getState().isWireframe;for(const s of e)null==(i=null==s?void 0:s.traverse)||i.call(s,e=>{e&&e.isMesh&&e.material&&(Array.isArray(e.material)?e.material.forEach(e=>{e&&(e.wireframe=t)}):e.material.wireframe=t)})}catch{}return n},e.__addWrapped=!0}catch{}}setupMouseHandlers(){this.mouseController.onLeftClick(e=>{var t;const{position:s,isMultiSelect:i}=e;this.updateMousePosition(s);const n="undefined"!=typeof performance?performance.now():Date.now(),a=this._gizmoPointerDown||this._gizmoPointerDownAt&&n-this._gizmoPointerDownAt<300;if(!this.objectSelector.isDraggingGizmo()&&!a){if(this.partInspector.enabled){const e=this.raycastMeshAtNDC(this.mousePosition);return void(i?(null==(t=null==e?void 0:e.object)?void 0:t.isMesh)&&(this.partInspector.selectedParts.has(e.object)?this.partInspector.selectedParts.delete(e.object):(this.partInspector.selectedParts.add(e.object),this.partInspector.selectedPart=e.object),this._updatePartOutline()):this.selectPart((null==e?void 0:e.object)||null,(null==e?void 0:e.point)||null))}this.objectSelector.handleObjectSelection(this.mousePosition,i)}}),this.mouseController.onMiddleClick(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}const{isOrbiting:i,isPanning:n}=e;this.isOrbiting=i,this.isPanning=n}),this.mouseController.onMiddleDrag(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}const{type:i,delta:n}=e;"pan"===i?this.cameraController.pan(n.x,n.y):"orbit"===i&&this.cameraController.orbit(n.x,n.y)}),this.mouseController.onDragSelect(e=>{const{left:t,top:s,width:i,height:n}=e;this.objectSelector.showSelectionBox(t,s,i,n)}),this.mouseController.onDragSelectEnd(e=>{const{startX:t,startY:s,endX:i,endY:n,isMultiSelect:a}=e;this.partInspector.enabled?this.selectPartsInRect(t,s,i,n,a):this.finishDragSelection(t,s,i,n,a)}),this.mouseController.onWheel(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}if(this.objectSelector.isDraggingGizmo())return;const i=e.delta>0?1:-1;this.cameraController.zoom(.3*i)}),this.mouseController.onDragEnd(e=>{var t,s;try{if(null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t).useBlenderControls)return}catch{}"pan"===e.type&&this.cameraController.updateRotationCenterAfterPan(this.scene,this.objectSelector.getSelectableObjects()),this.isMouseDown=!1,this.isPanning=!1,this.isOrbiting=!1,this.isDragSelecting=!1,this.objectSelector.hideSelectionBox()})}_initPartTransformControls(e,t){var s,i;try{this._partTransformControls=new Kn(e,t.domElement),this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,this._partTransformControls.setSize(.9);try{const e=null==(i=(s=this._partTransformControls).getHelper)?void 0:i.call(s);if(e&&e.isObject3D){const t=()=>{var t,s,i;try{const n=null==(s=null==(t=e.children)?void 0:t.find)?void 0:s.call(t,e=>"helper"===e.name);n&&(n.visible=!1);const a=[];null==(i=e.traverse)||i.call(e,e=>{const t="Line"===e.type||"Line2"===e.type||"LineSegments"===e.type||"LineSegments2"===e.type||e.isLine,s=e.material&&(e.material.isLineBasicMaterial||e.material.isLineDashedMaterial);(t||s)&&a.push(e)}),a.forEach(e=>{var t;try{e.parent&&e.parent.remove(e),(null==(t=e.geometry)?void 0:t.dispose)&&e.geometry.dispose();const s=e.material;Array.isArray(s)?s.forEach(e=>(null==e?void 0:e.dispose)&&e.dispose()):(null==s?void 0:s.dispose)&&s.dispose()}catch{}})}catch{}};t(),e.onBeforeRender=()=>{try{t()}catch{}},e.renderOrder=999;(this.gizmoScene||this.scene).add(e),this._partTransformControls.addEventListener("change",t),this._partTransformControls.addEventListener("dragging-changed",t),this._partTransformControls.addEventListener("mouseDown",t),this._partTransformControls.addEventListener("mouseUp",t),this._partTransformControls.addEventListener("objectChange",t)}}catch{}this._partGizmoInitial=null,this._partTransformControls.addEventListener("dragging-changed",e=>{var t,s;const i=e.value,n=this.getActivePartSet();if(0!==n.length)if(i)this._partGizmoInitial=n.map(e=>{var t,s;return{uuid:e.uuid,position:e.position.clone(),rotation:e.rotation.clone(),scale:e.scale.clone(),parentId:(null==(s=null==(t=e.parent)?void 0:t.userData)?void 0:s.id)??null}});else{if(!this._partGizmoInitial)return;const e=n.map(e=>{var t,s;return{uuid:e.uuid,parentId:(null==(s=null==(t=e.parent)?void 0:t.userData)?void 0:s.id)??null,after:{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}}}),i=new Map(this._partGizmoInitial.map(e=>[e.uuid,e])),a=[];for(const t of e){const e=i.get(t.uuid);if(!e)continue;const s={position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}},n=t.after;(s.position.x!==n.position.x||s.position.y!==n.position.y||s.position.z!==n.position.z||s.rotation.x!==n.rotation.x||s.rotation.y!==n.rotation.y||s.rotation.z!==n.rotation.z||s.scale.x!==n.scale.x||s.scale.y!==n.scale.y||s.scale.z!==n.scale.z)&&a.push({uuid:t.uuid,parentId:t.parentId,before:s,after:n})}if(a.length>0)try{const e=null==(s=null==(t=this.editorStore)?void 0:t.getState)?void 0:s.call(t);(null==e?void 0:e._pushHistory)&&e._pushHistory({type:"part-transform",parts:a})}catch{}this._partGizmoInitial=null}})}catch(n){this._partTransformControls=null}}isPartGizmoEnabled(){var e;return!!(null==(e=this.partInspector)?void 0:e.gizmo)}setPartGizmoEnabled(e){var t,s,i,n,a,r,o,l,c,A;const d=this.partInspector.selectedPart;if(!this._partTransformControls)return!1;if(!e){this.partInspector.gizmo=!1;try{this._partTransformControls.detach()}catch{}return this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,!0}if(!d&&!this.partInspector.groupEnabled)return!1;try{null==(i=null==(s=null==(t=this.objectSelector)?void 0:t.transformControls)?void 0:s.detach)||i.call(s)}catch{}this.partInspector.groupEnabled?(this._ensurePartGroup(),this.partInspector.group&&this._partTransformControls.attach(this.partInspector.group)):this._partTransformControls.attach(d);try{const e=(null==(a=null==(n=this.transformManager)?void 0:n.getState)?void 0:a.call(n).mode)||(null==(l=null==(o=null==(r=this.objectSelector)?void 0:r.transformControls)?void 0:o.getMode)?void 0:l.call(o))||"translate",t=(null==(A=null==(c=this.editorStore)?void 0:c.getState)?void 0:A.call(c).gizmoSpace)||"world";this._partTransformControls.setMode(e),this._partTransformControls.setSpace(t)}catch{}return this._partTransformControls.visible=!0,this._partTransformControls.enabled=!0,this.partInspector.gizmo=!0,!0}setPartGizmoMode(e){return!!this._partTransformControls&&(!!["translate","rotate","scale"].includes(e)&&(this._partTransformControls.setMode(e),!0))}detachPartGizmo(){if(this._partTransformControls){try{this._partTransformControls.detach()}catch{}this._partTransformControls.visible=!1,this._partTransformControls.enabled=!1,this.partInspector.gizmo=!1}}setPostProcessingManager(e){var t,s;this.postProcessingManager=e;try{null==(s=null==(t=this.objectSelector)?void 0:t.setPostProcessingManager)||s.call(t,e)}catch{}}_updatePartOutline(){}setupViewportActions(){this.keyboardController.registerViewportActions({focusOnSelected:()=>{var e,t,s,i;const n=(null==(t=(e=this.objectSelector).getSelectedObjects)?void 0:t.call(e))||[],a=e=>this.resolveToThreeObject(e),r=n.map(e=>(null==e?void 0:e.isObject3D)?e:a((null==e?void 0:e.id)||e)).filter(Boolean);if(0===r.length){const e=this.editorStore.getState().selectedObject,t=this.resolveToThreeObject(e);t&&r.push(t)}if(0!==r.length){try{if((null==(i=null==(s=this.editorStore)?void 0:s.getState)?void 0:i.call(s).useBlenderControls)&&"undefined"!=typeof window&&window.__blenderControls)return void(1===r.length?window.__blenderControls.focusOnObject(r[0]):window.__blenderControls.focusOnObjects(r))}catch{}if(1===r.length)this.cameraController.focusOnObject(r[0]);else{const e=new fe;r.forEach(t=>{try{e.expandByObject(t)}catch{}});const t=e.getCenter(new S),s=e.getSize(new S),i=Math.max(s.x,s.y,s.z)||1;let n;const a=this.cameraController.getCamera();if(a.isPerspectiveCamera){const e=a.fov*(Math.PI/180);n=1.5*Math.abs(i/Math.sin(e/2))}else n=2*i;const o=(new S).subVectors(a.position,t).normalize();this.cameraController.setTarget(t),a.position.copy(t).add(o.multiplyScalar(n)),a.lookAt(t),a.updateMatrixWorld()}}},toggleProjection:()=>{const e=this.cameraController.toggleProjection();return this.objectSelector.updateCamera(e),e},setView:e=>{this.cameraController.setView(e)},resetCamera:()=>{this.cameraController.resetCamera()}})}updateMousePosition(e){void 0!==e.x&&void 0!==e.y&&(this.mousePosition.x=e.x,this.mousePosition.y=e.y)}finishDragSelection(e,t,s,i,n){const a=this.renderer.domElement.getBoundingClientRect(),r={x:(e-a.left)/a.width*2-1,y:-(t-a.top)/a.height*2+1},o={x:(s-a.left)/a.width*2-1,y:-(i-a.top)/a.height*2+1},l=this.objectSelector.getObjectsInArea(r,o);if(l.length>0)this.objectSelector.selectMultipleObjects(l,n);else if(!n){const n=Math.abs(s-e),a=Math.abs(i-t);Math.hypot(n,a)>=12&&this.objectSelector.deselectAllObjects()}this.objectSelector.hideSelectionBox()}get camera(){return this.cameraController.getCamera()}set camera(e){this.cameraController.camera=e,this.objectSelector.updateCamera(e)}onWindowResize(){this.cameraController.handleResize(),this.renderer.setSize(window.innerWidth,window.innerHeight)}addSelectableObject(e){this.objectSelector.addSelectableObject(e)}removeSelectableObject(e){this.objectSelector.removeSelectableObject(e)}updateSelectableObjects(e){this.objectSelector.updateSelectableObjects(e)}getSelectedObjects(){return this.objectSelector.getSelectedObjects()}getSelectableObjects(){return this.objectSelector.getSelectableObjects()}selectObject(e){this.objectSelector.selectSingleObject(e)}findObjectById(e){if(null==e)return null;let t=null,s=null;if(this.scene.traverse(s=>{t||s&&s.userData&&s.userData.id===e&&(t=s)}),t)return t;if(this.scene.traverse(t=>{s||t&&t.userData&&t.userData.ownerId===e&&(s=t)}),!s)return null;let i=s;for(;i;){if(i.userData&&i.userData.id===e)return i;i=i.parent}return s}deselectAllObjects(){this.objectSelector.deselectAllObjects()}setGizmoMode(e){this.objectSelector.setGizmoMode(e)}getTransformState(){return this.transformManager.getState()}setTransformMode(e){return this.transformManager.setTransformMode(e)}toggleTransformSpace(){return this.transformManager.toggleSpace()}toggleGridSnap(){return this.transformManager.toggleGridSnap()}setGridSize(e){return this.transformManager.setGridSize(e)}duplicateSelectedObjects(){return this.transformManager.duplicateSelected()}deleteSelectedObjects(){return this.transformManager.deleteSelected()}groupSelectedObjects(){return this.transformManager.groupSelected()}ungroupSelectedObjects(){return this.transformManager.ungroupSelected()}focusOnObject(e){const t=this.resolveToThreeObject(e);t&&this.cameraController.focusOnObject(t)}updateSelectedOutlines(){this.objectSelector.updateAllSelectionOutlines()}setCameraView(e){this.cameraController.setView(e)}toggleCameraProjection(){const e=this.cameraController.toggleProjection();return this.objectSelector.updateCamera(e),e}getCameraTarget(){return this.cameraController.getTarget()}setCameraTarget(e){this.cameraController.setTarget(e)}resetCamera(){this.cameraController.resetCamera()}get transformControls(){return this.objectSelector.getTransformControls()}get selectedObjects(){return this.objectSelector.getSelectedObjects()}get isDragging(){return this.objectSelector.isDraggingGizmo()}dispose(){this.inputManager.dispose(),this.keyboardController.dispose(),this.mouseController.dispose(),this.objectSelector.dispose(),this.transformManager.dispose(),this.gridHelper&&(this.scene.remove(this.gridHelper),this.gridHelper.dispose(),this.gridHelper=null)}resolveToThreeObject(e){var t;if(!e)return null;if(e.isObject3D)return e;const s="object"==typeof e?e.id??(null==(t=e.userData)?void 0:t.id)??e:e;return this.findObjectById(s)}updateGridSnap(){this.objectSelector.updateGridSnap()}updateWireframe(){const e=this.editorStore.getState();e.scene&&e.scene.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material.forEach(t=>{t.wireframe=e.isWireframe}):t.material.wireframe=e.isWireframe)})}updateGizmoSpace(){this.objectSelector.updateGizmoSpace()}applyInitialViewState(){var e,t,s,i,n,a;try{null==(e=this.updateWireframe)||e.call(this)}catch{}try{null==(t=this.updateGridSnap)||t.call(this)}catch{}try{null==(s=this.updateGizmoSpace)||s.call(this)}catch{}try{null==(n=null==(i=this.objectSelector)?void 0:i.updateGizmoSize)||n.call(i)}catch{}try{null==(a=this.toggleGrid)||a.call(this)}catch{}}initializeGrid(){this.gridHelper=new st(20,20,8947848,4473924),this.gridHelper.name="EditorGrid",this.gridHelper.position.y=0,this.gridHelper.userData=this.gridHelper.userData||{},this.gridHelper.userData.isSystemObject=!0,this.gridHelper.material.opacity=.8,this.gridHelper.material.transparent=!0,this.gridHelper.material.depthWrite=!1;const e=this.editorStore.getState().isGridVisible;this.gridHelper.visible=e,this.scene.add(this.gridHelper)}toggleGrid(){if(!this.gridHelper)return!1;const e=this.editorStore.getState().isGridVisible;return this.gridHelper.visible=e,this.gridHelper.updateMatrixWorld(!0),e}isGridShown(){return this.editorStore.getState().isGridVisible}setGridSize(e,t=20){if(!this.gridHelper)return;this.scene.remove(this.gridHelper),this.gridHelper.dispose();const s=this.editorStore.getState().isGridVisible;this.gridHelper=new st(e,t,8947848,4473924),this.gridHelper.name="EditorGrid",this.gridHelper.position.y=0,this.gridHelper.visible=s,this.gridHelper.userData=this.gridHelper.userData||{},this.gridHelper.userData.isSystemObject=!0,this.gridHelper.material.opacity=.8,this.gridHelper.material.transparent=!0,this.gridHelper.material.depthWrite=!1,this.scene.add(this.gridHelper)}enablePartInspect(e){e!==this.partInspector.enabled&&(this.partInspector.enabled=!!e,e||(this.clearPartSelection(),this.setPartSolo(!1),this.setPartClipping(!1),this.detachPartGizmo()))}getSelectedPart(){return this.partInspector.selectedPart}getSelectedPartInfo(){var e,t,s,i,n,a,r,o,l;const c=this.partInspector.selectedPart;if(!c||!c.isMesh||!c.geometry)return null;const A=c.geometry,d=Array.isArray(c.material)?c.material[0]:c.material;A.boundingBox||A.computeBoundingBox(),A.boundingSphere||A.computeBoundingSphere();const h=null==(e=A.attributes)?void 0:e.position,u=A.index,p=null==(t=A.attributes)?void 0:t.uv,g=null==(s=A.attributes)?void 0:s.uv2,m=(new fe).setFromObject(c),b=m.getSize(new S),f=m.getCenter(new S),v=u?Math.floor(u.count/3):h?Math.floor(h.count/3):0,y=h?h.count:0;return{name:c.name||"(unnamed mesh)",uuid:c.uuid,drawMode:c.drawMode,geometry:{type:A.type,hasIndex:!!u,attributes:Object.keys(A.attributes||{}),vertices:y,triangles:v,bbox:{min:(null==(a=null==(n=null==(i=A.boundingBox)?void 0:i.min)?void 0:n.toArray)?void 0:a.call(n))||null,max:(null==(l=null==(o=null==(r=A.boundingBox)?void 0:r.max)?void 0:o.toArray)?void 0:l.call(o))||null},world:{size:b.toArray(),center:f.toArray()},uv:p?{count:p.count,itemSize:p.itemSize}:null,uv2:g?{count:g.count,itemSize:g.itemSize}:null},material:d?{type:d.type,name:d.name,color:d.color?`#${d.color.getHexString()}`:null,opacity:d.opacity??1,transparent:!!d.transparent,metalness:d.metalness??null,roughness:d.roughness??null,maps:{map:!!d.map,normalMap:!!d.normalMap,aoMap:!!d.aoMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,emissiveMap:!!d.emissiveMap,alphaMap:!!d.alphaMap}}:null}}raycastMeshAtNDC(e){const t=this.cameraController.getCamera();this._partRaycaster.setFromCamera(e,t);const s=[];this.scene.traverse(e=>{e.isMesh&&e.visible&&s.push(e)});const i=this._partRaycaster.intersectObjects(s,!0);if(!i||0===i.length)return null;return i.find(e=>{var t,s;return(null==(t=e.object)?void 0:t.isMesh)&&!(null==(s=e.object.userData)?void 0:s.isRayHelper)})||i[0]}selectPartsInRect(e,t,s,i,n){const a=this.renderer.domElement.getBoundingClientRect(),r=Math.min(e,s),o=Math.min(t,i),l=Math.max(e,s),c=Math.max(t,i),A=this.cameraController.getCamera(),d=new qe,h=[];this.scene.traverse(e=>{e.isMesh&&e.visible&&h.push(e)});const u=new Set;for(let p=0;p<6;p++)for(let e=0;e<6;e++){const t=o+(e+.5)/6*(c-o),s=new E((r+(p+.5)/6*(l-r)-a.left)/a.width*2-1,-(t-a.top)/a.height*2+1);d.setFromCamera(s,A);const i=d.intersectObjects(h,!0);if(i&&i.length){const e=i[0].object;(null==e?void 0:e.isMesh)&&u.add(e)}}n||this.partInspector.selectedParts.clear(),u.forEach(e=>this.partInspector.selectedParts.add(e)),this.partInspector.selectedPart=this.partInspector.selectedParts.values().next().value||null,this._updatePartOutline()}selectPart(e,t=null){if(this._restorePartHighlight(),this.partInspector.selectedPart=e&&e.isMesh?e:null,this.partInspector.selectedPart&&this.partInspector.selectedParts.add(this.partInspector.selectedPart),this.partInspector.selectedPart){const e=this.partInspector.selectedPart.material,t=Array.isArray(e)?e[0]:e;t&&"emissive"in t&&(t.userData||(t.userData={}),t.userData._origEmissive=t.emissive.clone(),t.userData._origEmissiveIntensity=t.emissiveIntensity??1,t.emissive=new b(65535),t.emissiveIntensity=.6,t.needsUpdate=!0),this.partInspector.clipping&&this.setPartClipping(!0),this.partInspector.solo&&this.setPartSolo(!0),this.partInspector.gizmo&&this.setPartGizmoEnabled(!0)}else this.setPartSolo(!1),this.setPartClipping(!1),this.detachPartGizmo(),this.partInspector.selectedParts.clear();this._updatePartOutline()}clearPartSelection(){this._restorePartHighlight(),this.partInspector.selectedPart=null,this.partInspector.selectedParts.clear()}_restorePartHighlight(){const e=this.partInspector.selectedPart;if(!e)return;const t=Array.isArray(e.material)?e.material[0]:e.material;t&&t.userData&&t.userData._origEmissive&&(t.emissive.copy(t.userData._origEmissive),t.emissiveIntensity=t.userData._origEmissiveIntensity??1,delete t.userData._origEmissive,delete t.userData._origEmissiveIntensity,t.needsUpdate=!0)}getActivePartSet(){return this.partInspector.groupEnabled&&this.partInspector.selectedParts.size>0?Array.from(this.partInspector.selectedParts):this.partInspector.selectedPart?[this.partInspector.selectedPart]:[]}selectAllChildParts(){const e=this.partInspector.selectedPart;if(!e)return 0;const t=this.partInspector.selectedParts,s=[];return(e.parent||e).traverse(e=>{e.isMesh&&(t.add(e),s.push(e))}),this._updatePartOutline(),s.length}clearAllPartSelections(){this.partInspector.selectedParts.clear(),this._updatePartOutline()}isPartGroupGizmoEnabled(){return!!this.partInspector.groupEnabled}setPartGroupGizmoEnabled(e){this.partInspector.groupEnabled=!!e,e?(this._ensurePartGroup(),this.setPartGizmoEnabled(!0)):(this._detachPartGroup(),this.partInspector.selectedPart&&this.setPartGizmoEnabled(!0)),this._updatePartOutline()}getPartGroupPivot(){return this.partInspector.groupPivot}setPartGroupPivot(e){["center","first","last"].includes(e)&&(this.partInspector.groupPivot=e,this.partInspector.groupEnabled&&this._ensurePartGroup(!0))}_ensurePartGroup(e=!1){const t=this.getActivePartSet();if(0===t.length)return;this.partInspector.group||(this.partInspector.group=new J,this.partInspector.group.name="PartGroupPivot",this.partInspector.group.userData.isSystemObject=!0,this.scene.add(this.partInspector.group));const s=this.partInspector.group;let i=new S;if("first"===this.partInspector.groupPivot)i.copy(t[0].getWorldPosition(new S));else if("last"===this.partInspector.groupPivot)i.copy(t[t.length-1].getWorldPosition(new S));else{const e=new fe;for(const s of t)e.expandByObject(s);e.getCenter(i)}s.position.copy(i)}_detachPartGroup(){var e,t;if(this.partInspector.group){try{null==(t=null==(e=this._partTransformControls)?void 0:e.detach)||t.call(e)}catch{}try{this.scene.remove(this.partInspector.group)}catch{}this.partInspector.group=null}}setPartSolo(e){const t=this.partInspector;if(!e)return t.savedVisibility.forEach((e,t)=>{t.visible=e}),t.savedVisibility.clear(),void(t.solo=!1);const s=t.selectedPart;s&&(t.savedVisibility.clear(),this.scene.traverse(e=>{var i;e.isObject3D&&((null==(i=e.userData)?void 0:i.isSystemObject)||e===this.gridHelper||(t.savedVisibility.set(e,e.visible),e.visible=e===s||e.isBone||this._isAncestorOf(e,s)||this._isAncestorOf(s,e)))}),t.solo=!0)}_isAncestorOf(e,t){let s=null==t?void 0:t.parent;for(;s;){if(s===e)return!0;s=s.parent}return!1}setPartClipping(e,t=.01){const s=this.renderer,i=this.partInspector;if(!e)return s.clippingPlanes=[],s.localClippingEnabled=!1,i.clippingPlanes=[],void(i.clipping=!1);const n=i.selectedPart;if(!n)return;const a=(new fe).setFromObject(n);a.expandByScalar(t);const r=a.min,o=a.max,l=[new it(new S(1,0,0),-o.x),new it(new S(-1,0,0),r.x),new it(new S(0,1,0),-o.y),new it(new S(0,-1,0),r.y),new it(new S(0,0,1),-o.z),new it(new S(0,0,-1),r.z)];s.clippingPlanes=l,s.localClippingEnabled=!0,i.clippingPlanes=l,i.clipping=!0}}class Ia{constructor(e,t){if(!e||!t)throw new Error("BlenderControls requires camera and domElement");this.camera=e,this.domElement=t,this.enabled=!0,this.target=new S(0,0,0),this.rotateSpeed=1,this.panSpeed=1,this.zoomSpeed=1,this.minDistance=.1,this.maxDistance=1/0,this.minPolarAngle=1e-4,this.maxPolarAngle=Math.PI-1e-4,this.enableDamping=!0,this.dampingFactor=.15,this._spherical=new et,this._sphericalDelta=new et(0,0,0),this._panOffset=new S,this._zoomScale=1,this._state="none",this._isAltDown=!1,this._isShiftDown=!1,this._isCtrlDown=!1,this._pointer=new E,this._pointerPrev=new E,this._lastPointerForPick=new E,this._raycaster=new qe,this._scene=null,this._onContextMenu=this._onContextMenu.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onPointerMovePassive=e=>{this._lastPointerForPick.set(e.clientX,e.clientY)},this._onMouseUp=this._onMouseUp.bind(this),this._onWheel=this._onWheel.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._updateSphericalFromCamera(),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("mousedown",this._onMouseDown),this.domElement.addEventListener("wheel",this._onWheel,{passive:!1}),this.domElement.addEventListener("mousemove",this._onPointerMovePassive),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp)}setSpeeds({rotate:e,pan:t,zoom:s}={}){Number.isFinite(e)&&(this.rotateSpeed=e),Number.isFinite(t)&&(this.panSpeed=t),Number.isFinite(s)&&(this.zoomSpeed=s)}setCamera(e){e&&(this.camera=e,this._updateSphericalFromCamera())}setScene(e){this._scene=e}focusOnObject(e){if(!e)return!1;const t=(new fe).setFromObject(e),s=t.getCenter(new S),i=t.getSize(new S),n=Math.max(i.x,i.y,i.z)||1;let a;if(this.camera.isPerspectiveCamera){const e=(this.camera.fov||75)*Math.PI/180;a=1.2*Math.abs(n/Math.sin(e/2))}else a=2*n;const r=(new S).subVectors(this.camera.position,this.target).normalize();this.target.copy(s),this.camera.position.copy(s).add(r.multiplyScalar(a)),this._updateSphericalFromCamera();{const e=(new B).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}return!0}focusOnObjects(e){const t=Array.isArray(e)?e.filter(Boolean):[e];if(!t||0===t.length)return!1;const s=new fe;for(const l of t)try{s.expandByObject(l)}catch{}if(!isFinite(s.min.x)||!isFinite(s.max.x))return!1;const i=s.getCenter(new S),n=s.getSize(new S),a=Math.max(n.x,n.y,n.z)||1;let r;if(this.camera.isPerspectiveCamera){const e=(this.camera.fov||75)*Math.PI/180;r=1.2*Math.abs(a/Math.sin(e/2))}else r=2*a;const o=(new S).subVectors(this.camera.position,this.target).normalize();this.target.copy(i),this.camera.position.copy(i).add(o.multiplyScalar(r)),this._updateSphericalFromCamera();{const e=(new B).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}return!0}update(){if(!this.enabled)return!1;const e=new S;e.copy(this.camera.position).sub(this.target),this._spherical.setFromVector3(e),this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi,this._spherical.radius*=this._zoomScale,this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.theta>Math.PI&&(this._spherical.theta-=2*Math.PI),this._spherical.theta<-Math.PI&&(this._spherical.theta+=2*Math.PI),this._spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this._spherical.radius)),this.target.add(this._panOffset);const t=(new S).setFromSpherical(this._spherical).add(this.target);this.camera.position.copy(t);{const e=(new B).lookAt(this.camera.position,this.target,this.camera.up);this.camera.quaternion.setFromRotationMatrix(e),this.camera.updateMatrixWorld()}if(this.enableDamping){this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor),Math.abs(this._sphericalDelta.theta)<1e-6&&(this._sphericalDelta.theta=0),Math.abs(this._sphericalDelta.phi)<1e-6&&(this._sphericalDelta.phi=0),this._panOffset.lengthSq()<1e-10&&this._panOffset.set(0,0,0);const e=Math.pow(1-this.dampingFactor,2);this._zoomScale=1+(this._zoomScale-1)*e,Math.abs(this._zoomScale-1)<1e-4&&(this._zoomScale=1)}else this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0),this._zoomScale=1;return!0}dispose(){this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.removeEventListener("mousedown",this._onMouseDown),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("mousemove",this._onPointerMovePassive),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp)}_onContextMenu(e){e.preventDefault()}_onKeyDown(e){("Alt"===e.key||e.altKey)&&(this._isAltDown=!0),("Shift"===e.key||e.shiftKey)&&(this._isShiftDown=!0),("Control"===e.key||e.ctrlKey)&&(this._isCtrlDown=!0)}_onKeyUp(e){e.altKey||(this._isAltDown=!1),e.shiftKey||(this._isShiftDown=!1),e.ctrlKey||(this._isCtrlDown=!1)}_onMouseDown(e){this.enabled&&1===e.button&&(e.preventDefault(),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),this._pointerPrev.set(e.clientX,e.clientY),this._state=this._isAltDown?"rotate":"pan")}_onMouseMove(e){if(!this.enabled||"none"===this._state)return;e.preventDefault(),this._pointer.set(e.clientX,e.clientY),this._lastPointerForPick.set(e.clientX,e.clientY);const t=this._pointer.x-this._pointerPrev.x,s=this._pointer.y-this._pointerPrev.y;this._pointerPrev.copy(this._pointer),"rotate"===this._state?this._handleRotate(t,s):"pan"===this._state&&this._handlePan(t,s)}_onMouseUp(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._state="none"}_onWheel(e){if(!this.enabled)return;e.preventDefault();const t=e.deltaY,s=Math.pow(.95,this.zoomSpeed);t<0?this._dollyIn(s):t>0&&this._dollyOut(s)}_updateSphericalFromCamera(){const e=(new S).copy(this.camera.position).sub(this.target);this._spherical.setFromVector3(e)}_handleRotate(e,t){const{clientWidth:s,clientHeight:i}=this.domElement,n=2*Math.PI*e/Math.max(1,s)*this.rotateSpeed,a=2*Math.PI*t/Math.max(1,i)*this.rotateSpeed;this._sphericalDelta.theta-=n,this._sphericalDelta.phi-=a}_handlePan(e,t){const s=this.domElement;if(this._isShiftDown&&(t=0),this._isCtrlDown&&(e=0),this.camera.isPerspectiveCamera){const i=(new S).copy(this.camera.position).sub(this.target).length(),n=(this.camera.fov||75)*Math.PI/180,a=i*Math.tan(n/2),r=a*(s.clientWidth/Math.max(1,s.clientHeight)),o=e*this.panSpeed*(2*r)/Math.max(1,s.clientWidth),l=t*this.panSpeed*(2*a)/Math.max(1,s.clientHeight);this._panLeft(o),this._panUp(l)}else if(this.camera.isOrthographicCamera){const i=(this.camera.right-this.camera.left)/Math.max(1,s.clientWidth),n=(this.camera.top-this.camera.bottom)/Math.max(1,s.clientHeight);this._panLeft(e*this.panSpeed*i),this._panUp(t*this.panSpeed*n)}else{const s=.002*e*this.panSpeed,i=.002*t*this.panSpeed;this._panLeft(s),this._panUp(i)}}_panLeft(e){const t=new S;t.setFromMatrixColumn(this.camera.matrix,0),t.multiplyScalar(-e),this._panOffset.add(t)}_panUp(e){const t=new S;t.setFromMatrixColumn(this.camera.matrix,1),t.multiplyScalar(e),this._panOffset.add(t)}_dollyIn(e){this._zoomScale*=Math.max(1e-6,e)}_dollyOut(e){this._zoomScale/=Math.max(1e-6,e)}}const wa={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class Ea{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const Ba=new $(-1,1,1,-1,0,1);const Sa=new class extends c{constructor(){super(),this.setAttribute("position",new Ve([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ve([0,2,0,0,2,0],2))}};class Qa{constructor(e){this._mesh=new q(Sa,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Ba)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ja extends Ea{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof nt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=at.clone(e.uniforms),this.material=new nt({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Qa(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Ma extends Ea{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),n=e.state;let a,r;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0),this.inverse?(a=0,r=1):(a=1,r=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,a,4294967295),n.buffers.stencil.setClear(r),n.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class Da extends Ea{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Ta{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const s=e.getSize(new E);this._width=s.width,this._height=s.height,(t=new rt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Le})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ja(wa),this.copyPass.material.blending=ot,this.clock=new lt}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,n=this.passes.length;i<n;i++){const t=this.passes[i];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),t.needsSwap){if(s){const t=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Ma&&(t instanceof Ma?s=!0:t instanceof Da&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new E);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Ra extends Ea{constructor(e,t,s=null,i=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new b}render(e,t,s){const i=e.autoClear;let n,a;e.autoClear=!1,null!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(n),null!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=i}}const ka={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:"\n\t\tprecision highp float;\n\n\t\tuniform mat4 modelViewMatrix;\n\t\tuniform mat4 projectionMatrix;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\t#include <tonemapping_pars_fragment>\n\t\t#include <colorspace_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// tone mapping\n\n\t\t\t#ifdef LINEAR_TONE_MAPPING\n\n\t\t\t\tgl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( REINHARD_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( CINEON_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( ACES_FILMIC_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( AGX_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );\n\n\t\t\t#elif defined( NEUTRAL_TONE_MAPPING )\n\n\t\t\t\tgl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );\n\n\t\t\t#endif\n\n\t\t\t// color space\n\n\t\t\t#ifdef SRGB_TRANSFER\n\n\t\t\t\tgl_FragColor = sRGBTransferOETF( gl_FragColor );\n\n\t\t\t#endif\n\n\t\t}"};class Oa extends Ea{constructor(){super();const e=ka;this.uniforms=at.clone(e.uniforms),this.material=new ct({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new Qa(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},ne.getTransfer(this._outputColorSpace)===At&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===dt?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ht?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===ut?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===pt?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===gt?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===mt&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),!0===this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const La={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new b(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat v = luminance( texel.xyz );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};class Fa extends Ea{constructor(e,t,s,i){super(),this.strength=void 0!==t?t:1,this.radius=s,this.threshold=i,this.resolution=void 0!==e?new E(e.x,e.y):new E(256,256),this.clearColor=new b(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new rt(n,a,{type:Le}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let c=0;c<this.nMips;c++){const e=new rt(n,a,{type:Le});e.texture.name="UnrealBloomPass.h"+c,e.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(e);const t=new rt(n,a,{type:Le});t.texture.name="UnrealBloomPass.v"+c,t.texture.generateMipmaps=!1,this.renderTargetsVertical.push(t),n=Math.round(n/2),a=Math.round(a/2)}const r=La;this.highPassUniforms=at.clone(r.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new nt({uniforms:this.highPassUniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),this.separableBlurMaterials=[];const o=[3,5,7,9,11];n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(o[c])),this.separableBlurMaterials[c].uniforms.invSize.value=new E(1/n,1/a),n=Math.round(n/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new S(1,1,1),new S(1,1,1),new S(1,1,1),new S(1,1,1),new S(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const l=wa;this.copyUniforms=at.clone(l.uniforms),this.blendMaterial=new nt({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:bt,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new b,this.oldClearAlpha=1,this.basic=new x,this.fsQuad=new Qa(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let s=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(s,i);for(let n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(s,i),this.renderTargetsVertical[n].setSize(s,i),this.separableBlurMaterials[n].uniforms.invSize.value=new E(1/s,1/i),s=Math.round(s/2),i=Math.round(i/2)}render(e,t,s,i,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=s.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let r=this.renderTargetBright;for(let o=0;o<this.nMips;o++)this.fsQuad.material=this.separableBlurMaterials[o],this.separableBlurMaterials[o].uniforms.colorTexture.value=r.texture,this.separableBlurMaterials[o].uniforms.direction.value=Fa.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[o]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[o].uniforms.colorTexture.value=this.renderTargetsHorizontal[o].texture,this.separableBlurMaterials[o].uniforms.direction.value=Fa.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[o]),e.clear(),this.fsQuad.render(e),r=this.renderTargetsVertical[o];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return new nt({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new E(.5,.5)},direction:{value:new E(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new nt({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}Fa.BlurDirectionX=new E(1,0),Fa.BlurDirectionY=new E(0,1);const Pa={name:"FilmShader",uniforms:{tDiffuse:{value:null},time:{value:0},intensity:{value:.5},grayscale:{value:!1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tuniform float intensity;\n\t\tuniform bool grayscale;\n\t\tuniform float time;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 base = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat noise = rand( fract( vUv + time ) );\n\n\t\t\tvec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );\n\n\t\t\tcolor = mix( base.rgb, color, intensity );\n\n\t\t\tif ( grayscale ) {\n\n\t\t\t\tcolor = vec3( luminance( color ) ); // assuming linear-srgb\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( color, base.a );\n\n\t\t}"};class Na extends Ea{constructor(e=.5,t=!1){super();const s=Pa;this.uniforms=at.clone(s.uniforms),this.material=new nt({name:s.name,uniforms:this.uniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),this.uniforms.intensity.value=e,this.uniforms.grayscale.value=t,this.fsQuad=new Qa(this.material)}render(e,t,s,i){this.uniforms.tDiffuse.value=s.texture,this.uniforms.time.value+=i,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const Ga={name:"DotScreenShader",uniforms:{tDiffuse:{value:null},tSize:{value:new E(256,256)},center:{value:new E(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform vec2 center;\n\t\tuniform float angle;\n\t\tuniform float scale;\n\t\tuniform vec2 tSize;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tfloat pattern() {\n\n\t\t\tfloat s = sin( angle ), c = cos( angle );\n\n\t\t\tvec2 tex = vUv * tSize - center;\n\t\t\tvec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;\n\n\t\t\treturn ( sin( point.x ) * sin( point.y ) ) * 4.0;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\n\t\t\tfloat average = ( color.r + color.g + color.b ) / 3.0;\n\n\t\t\tgl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );\n\n\t\t}"};class _a extends Ea{constructor(e,t,s){super();const i=Ga;this.uniforms=at.clone(i.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==s&&(this.uniforms.scale.value=s),this.material=new nt({name:i.name,uniforms:this.uniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader}),this.fsQuad=new Qa(this.material)}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.tSize.value.set(s.width,s.height),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const za={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\tuniform int byp; //should we apply the glitch ?\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDisp;\n\n\t\tuniform float amount;\n\t\tuniform float angle;\n\t\tuniform float seed;\n\t\tuniform float seed_x;\n\t\tuniform float seed_y;\n\t\tuniform float distortion_x;\n\t\tuniform float distortion_y;\n\t\tuniform float col_s;\n\n\t\tvarying vec2 vUv;\n\n\n\t\tfloat rand(vec2 co){\n\t\t\treturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif(byp<1) {\n\t\t\t\tvec2 p = vUv;\n\t\t\t\tfloat xs = floor(gl_FragCoord.x / 0.5);\n\t\t\t\tfloat ys = floor(gl_FragCoord.y / 0.5);\n\t\t\t\t//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch\n\t\t\t\tfloat disp = texture2D(tDisp, p*seed*seed).r;\n\t\t\t\tif(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {\n\t\t\t\t\tif(seed_x>0.){\n\t\t\t\t\t\tp.y = 1. - (p.y + distortion_y);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.y = distortion_y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {\n\t\t\t\t\tif(seed_y>0.){\n\t\t\t\t\t\tp.x=distortion_x;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp.x = 1. - (p.x + distortion_x);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.x+=disp*seed_x*(seed/5.);\n\t\t\t\tp.y+=disp*seed_y*(seed/5.);\n\t\t\t\t//base from RGB shift shader\n\t\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\t\tvec4 cr = texture2D(tDiffuse, p + offset);\n\t\t\t\tvec4 cga = texture2D(tDiffuse, p);\n\t\t\t\tvec4 cb = texture2D(tDiffuse, p - offset);\n\t\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\t\t\t\t//add noise\n\t\t\t\tvec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);\n\t\t\t\tgl_FragColor = gl_FragColor+ snow;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tgl_FragColor=texture2D (tDiffuse, vUv);\n\t\t\t}\n\t\t}"};class Ua extends Ea{constructor(e=64){super();const t=za;this.uniforms=at.clone(t.uniforms),this.heightMap=this.generateHeightmap(e),this.uniforms.tDisp.value=this.heightMap,this.material=new nt({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}),this.fsQuad=new Qa(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(e,t,s){this.uniforms.tDiffuse.value=s.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||1==this.goWild?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=Z.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=Z.randFloat(-1,1),this.uniforms.seed_y.value=Z.randFloat(-1,1),this.uniforms.distortion_x.value=Z.randFloat(0,1),this.uniforms.distortion_y.value=Z.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=Z.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=Z.randFloat(0,1),this.uniforms.distortion_y.value=Z.randFloat(0,1),this.uniforms.seed_x.value=Z.randFloat(-.3,.3),this.uniforms.seed_y.value=Z.randFloat(-.3,.3)):0==this.goWild&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}generateTrigger(){this.randX=Z.randInt(120,240)}generateHeightmap(e){const t=new Float32Array(e*e),s=e*e;for(let n=0;n<s;n++){const e=Z.randFloat(0,1);t[n]=e}const i=new Pe(t,e,e,ze,Fe);return i.needsUpdate=!0,i}dispose(){this.material.dispose(),this.heightMap.dispose(),this.fsQuad.dispose()}}class Ha extends Ea{constructor(e,t,s,i={}){super(),this.pixelSize=e,this.resolution=new E,this.renderResolution=new E,this.pixelatedMaterial=this.createPixelatedMaterial(),this.normalMaterial=new ft,this.fsQuad=new Qa(this.pixelatedMaterial),this.scene=t,this.camera=s,this.normalEdgeStrength=i.normalEdgeStrength||.3,this.depthEdgeStrength=i.depthEdgeStrength||.4,this.beautyRenderTarget=new rt,this.beautyRenderTarget.texture.minFilter=F,this.beautyRenderTarget.texture.magFilter=F,this.beautyRenderTarget.texture.type=Le,this.beautyRenderTarget.depthTexture=new vt,this.normalRenderTarget=new rt,this.normalRenderTarget.texture.minFilter=F,this.normalRenderTarget.texture.magFilter=F,this.normalRenderTarget.texture.type=Le}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.pixelatedMaterial.dispose(),this.normalMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.resolution.set(e,t),this.renderResolution.set(e/this.pixelSize|0,t/this.pixelSize|0);const{x:s,y:i}=this.renderResolution;this.beautyRenderTarget.setSize(s,i),this.normalRenderTarget.setSize(s,i),this.fsQuad.material.uniforms.resolution.value.set(s,i,1/s,1/i)}setPixelSize(e){this.pixelSize=e,this.setSize(this.resolution.x,this.resolution.y)}render(e,t){const s=this.fsQuad.material.uniforms;s.normalEdgeStrength.value=this.normalEdgeStrength,s.depthEdgeStrength.value=this.depthEdgeStrength,e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera);const i=this.scene.overrideMaterial;e.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,e.render(this.scene,this.camera),this.scene.overrideMaterial=i,s.tDiffuse.value=this.beautyRenderTarget.texture,s.tDepth.value=this.beautyRenderTarget.depthTexture,s.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear()),this.fsQuad.render(e)}createPixelatedMaterial(){return new nt({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new yt(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:"\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tuniform sampler2D tDiffuse;\n\t\t\t\tuniform sampler2D tDepth;\n\t\t\t\tuniform sampler2D tNormal;\n\t\t\t\tuniform vec4 resolution;\n\t\t\t\tuniform float normalEdgeStrength;\n\t\t\t\tuniform float depthEdgeStrength;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tfloat getDepth(int x, int y) {\n\n\t\t\t\t\treturn texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;\n\n\t\t\t\t}\n\n\t\t\t\tvec3 getNormal(int x, int y) {\n\n\t\t\t\t\treturn texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tfloat depthEdgeIndicator(float depth, vec3 normal) {\n\n\t\t\t\t\tfloat diff = 0.0;\n\t\t\t\t\tdiff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);\n\t\t\t\t\tdiff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);\n\t\t\t\t\treturn floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;\n\n\t\t\t\t}\n\n\t\t\t\tfloat neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {\n\n\t\t\t\t\tfloat depthDiff = getDepth(x, y) - depth;\n\t\t\t\t\tvec3 neighborNormal = getNormal(x, y);\n\n\t\t\t\t\t// Edge pixels should yield to faces who's normals are closer to the bias normal.\n\t\t\t\t\tvec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.\n\t\t\t\t\tfloat normalDiff = dot(normal - neighborNormal, normalEdgeBias);\n\t\t\t\t\tfloat normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);\n\n\t\t\t\t\t// Only the shallower pixel should detect the normal edge.\n\t\t\t\t\tfloat depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);\n\n\t\t\t\t\treturn (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;\n\n\t\t\t\t}\n\n\t\t\t\tfloat normalEdgeIndicator(float depth, vec3 normal) {\n\n\t\t\t\t\tfloat indicator = 0.0;\n\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(0, -1, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(0, 1, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);\n\t\t\t\t\tindicator += neighborNormalEdgeIndicator(1, 0, depth, normal);\n\n\t\t\t\t\treturn step(0.1, indicator);\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\t\t\tfloat depth = 0.0;\n\t\t\t\t\tvec3 normal = vec3(0.0);\n\n\t\t\t\t\tif (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {\n\n\t\t\t\t\t\tdepth = getDepth(0, 0);\n\t\t\t\t\t\tnormal = getNormal(0, 0);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat dei = 0.0;\n\t\t\t\t\tif (depthEdgeStrength > 0.0)\n\t\t\t\t\t\tdei = depthEdgeIndicator(depth, normal);\n\n\t\t\t\t\tfloat nei = 0.0;\n\t\t\t\t\tif (normalEdgeStrength > 0.0)\n\t\t\t\t\t\tnei = normalEdgeIndicator(depth, normal);\n\n\t\t\t\t\tfloat Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);\n\n\t\t\t\t\tgl_FragColor = texel * Strength;\n\n\t\t\t\t}\n\t\t\t"})}}const qa={name:"SMAAEdgesShader",defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new E(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\n\t\tvoid SMAAEdgeDetectionVS( vec2 texcoord ) {\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAAEdgeDetectionVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\n\t\tvec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n\t\t\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );\n\n\t\t\t// Calculate color deltas:\n\t\t\tvec4 delta;\n\t\t\tvec3 C = texture2D( colorTex, texcoord ).rgb;\n\n\t\t\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;\n\t\t\tvec3 t = abs( C - Cleft );\n\t\t\tdelta.x = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;\n\t\t\tt = abs( C - Ctop );\n\t\t\tdelta.y = max( max( t.r, t.g ), t.b );\n\n\t\t\t// We do the usual threshold:\n\t\t\tvec2 edges = step( threshold, delta.xy );\n\n\t\t\t// Then discard if there is no edge:\n\t\t\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )\n\t\t\t\tdiscard;\n\n\t\t\t// Calculate right and bottom deltas:\n\t\t\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;\n\t\t\tt = abs( C - Cright );\n\t\t\tdelta.z = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;\n\t\t\tt = abs( C - Cbottom );\n\t\t\tdelta.w = max( max( t.r, t.g ), t.b );\n\n\t\t\t// Calculate the maximum delta in the direct neighborhood:\n\t\t\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );\n\n\t\t\t// Calculate left-left and top-top deltas:\n\t\t\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;\n\t\t\tt = abs( C - Cleftleft );\n\t\t\tdelta.z = max( max( t.r, t.g ), t.b );\n\n\t\t\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;\n\t\t\tt = abs( C - Ctoptop );\n\t\t\tdelta.w = max( max( t.r, t.g ), t.b );\n\n\t\t\t// Calculate the final maximum delta:\n\t\t\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );\n\n\t\t\t// Local contrast adaptation in action:\n\t\t\tedges.xy *= step( 0.5 * maxDelta, delta.xy );\n\n\t\t\treturn vec4( edges, 0.0, 0.0 );\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );\n\n\t\t}"},Ka={name:"SMAAWeightsShader",defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new E(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 3 ];\n\t\tvarying vec2 vPixcoord;\n\n\t\tvoid SMAABlendingWeightCalculationVS( vec2 texcoord ) {\n\t\t\tvPixcoord = texcoord / resolution;\n\n\t\t\t// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components\n\n\t\t\t// And these for the searches, they indicate the ends of the loops:\n\t\t\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAABlendingWeightCalculationVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tArea;\n\t\tuniform sampler2D tSearch;\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[3];\n\t\tvarying vec2 vPixcoord;\n\n\t\t#if __VERSION__ == 100\n\t\tvec2 round( vec2 x ) {\n\t\t\treturn sign( x ) * floor( abs( x ) + 0.5 );\n\t\t}\n\t\t#endif\n\n\t\tfloat SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {\n\t\t\t// Not required if searchTex accesses are set to point:\n\t\t\t// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n\t\t\t// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n\t\t\t//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n\t\t\te.r = bias + e.r * scale;\n\t\t\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;\n\t\t}\n\n\t\tfloat SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\t/**\n\t\t\t\t* @PSEUDO_GATHER4\n\t\t\t\t* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to\n\t\t\t\t* sample between edge, thus fetching four edges in a row.\n\t\t\t\t* Sampling with different offsets in each direction allows to disambiguate\n\t\t\t\t* which edges are active from the four fetched ones.\n\t\t\t\t*/\n\t\t\tvec2 e = vec2( 0.0, 1.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;\n\t\t\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\t// We correct the previous (-0.25, -0.125) offset we applied:\n\t\t\ttexcoord.x += 0.25 * resolution.x;\n\n\t\t\t// The searches are bias by 1, so adjust the coords accordingly:\n\t\t\ttexcoord.x += resolution.x;\n\n\t\t\t// Disambiguate the length added by the last step:\n\t\t\ttexcoord.x += 2.0 * resolution.x; // Undo last step\n\t\t\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n\t\t\treturn texcoord.x;\n\t\t}\n\n\t\tfloat SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 0.0, 1.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;\n\t\t\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.x -= 0.25 * resolution.x;\n\t\t\ttexcoord.x -= resolution.x;\n\t\t\ttexcoord.x -= 2.0 * resolution.x;\n\t\t\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n\t\t\treturn texcoord.x;\n\t\t}\n\n\t\tfloat SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 1.0, 0.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign\n\t\t\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign\n\n\t\t\treturn texcoord.y;\n\t\t}\n\n\t\tfloat SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n\t\t\tvec2 e = vec2( 1.0, 0.0 );\n\n\t\t\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for\n\t\t\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;\n\t\t\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign\n\t\t\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;\n\t\t\t}\n\n\t\t\ttexcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign\n\t\t\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign\n\n\t\t\treturn texcoord.y;\n\t\t}\n\n\t\tvec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {\n\t\t\t// Rounding prevents precision errors of bilinear filtering:\n\t\t\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;\n\n\t\t\t// We do a scale and bias for mapping to texel space:\n\t\t\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );\n\n\t\t\t// Move to proper place, according to the subpixel offset:\n\t\t\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n\t\t\treturn texture2D( areaTex, texcoord, 0.0 ).rg;\n\t\t}\n\n\t\tvec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {\n\t\t\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tvec2 e = texture2D( edgesTex, texcoord ).rg;\n\n\t\t\tif ( e.g > 0.0 ) { // Edge at north\n\t\t\t\tvec2 d;\n\n\t\t\t\t// Find the distance to the left:\n\t\t\t\tvec2 coords;\n\t\t\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );\n\t\t\t\tcoords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)\n\t\t\t\td.x = coords.x;\n\n\t\t\t\t// Now fetch the left crossing edges, two at a time using bilinear\n\t\t\t\t// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n\t\t\t\t// discern what value each edge has:\n\t\t\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;\n\n\t\t\t\t// Find the distance to the right:\n\t\t\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );\n\t\t\t\td.y = coords.x;\n\n\t\t\t\t// We want the distances to be in pixel units (doing this here allow to\n\t\t\t\t// better interleave arithmetic and memory accesses):\n\t\t\t\td = d / resolution.x - pixcoord.x;\n\n\t\t\t\t// SMAAArea below needs a sqrt, as the areas texture is compressed\n\t\t\t\t// quadratically:\n\t\t\t\tvec2 sqrt_d = sqrt( abs( d ) );\n\n\t\t\t\t// Fetch the right crossing edges:\n\t\t\t\tcoords.y -= 1.0 * resolution.y; // WebGL port note: Added\n\t\t\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;\n\n\t\t\t\t// Ok, we know how this pattern looks like, now it is time for getting\n\t\t\t\t// the actual area:\n\t\t\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );\n\t\t\t}\n\n\t\t\tif ( e.r > 0.0 ) { // Edge at west\n\t\t\t\tvec2 d;\n\n\t\t\t\t// Find the distance to the top:\n\t\t\t\tvec2 coords;\n\n\t\t\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );\n\t\t\t\tcoords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;\n\t\t\t\td.x = coords.y;\n\n\t\t\t\t// Fetch the top crossing edges:\n\t\t\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;\n\n\t\t\t\t// Find the distance to the bottom:\n\t\t\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );\n\t\t\t\td.y = coords.y;\n\n\t\t\t\t// We want the distances to be in pixel units:\n\t\t\t\td = d / resolution.y - pixcoord.y;\n\n\t\t\t\t// SMAAArea below needs a sqrt, as the areas texture is compressed\n\t\t\t\t// quadratically:\n\t\t\t\tvec2 sqrt_d = sqrt( abs( d ) );\n\n\t\t\t\t// Fetch the bottom crossing edges:\n\t\t\t\tcoords.y -= 1.0 * resolution.y; // WebGL port note: Added\n\t\t\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;\n\n\t\t\t\t// Get the area for this direction:\n\t\t\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );\n\t\t\t}\n\n\t\t\treturn weights;\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );\n\n\t\t}"},Wa={name:"SMAABlendShader",uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new E(1/1024,1/512)}},vertexShader:"\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 2 ];\n\n\t\tvoid SMAANeighborhoodBlendingVS( vec2 texcoord ) {\n\t\t\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component\n\t\t\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tSMAANeighborhoodBlendingVS( vUv );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tColor;\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec4 vOffset[ 2 ];\n\n\t\tvec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {\n\t\t\t// Fetch the blending weights for current pixel:\n\t\t\tvec4 a;\n\t\t\ta.xz = texture2D( blendTex, texcoord ).xz;\n\t\t\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;\n\t\t\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;\n\n\t\t\t// Is there any blending weight with a value greater than 0.0?\n\t\t\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {\n\t\t\t\treturn texture2D( colorTex, texcoord, 0.0 );\n\t\t\t} else {\n\t\t\t\t// Up to 4 lines can be crossing a pixel (one through each edge). We\n\t\t\t\t// favor blending by choosing the line with the maximum weight for each\n\t\t\t\t// direction:\n\t\t\t\tvec2 offset;\n\t\t\t\toffset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n\t\t\t\toffset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n\t\t\t\t// Then we go in the direction that has the maximum weight:\n\t\t\t\tif ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical\n\t\t\t\t\toffset.y = 0.0;\n\t\t\t\t} else {\n\t\t\t\t\toffset.x = 0.0;\n\t\t\t\t}\n\n\t\t\t\t// Fetch the opposite color and lerp by hand:\n\t\t\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );\n\t\t\t\ttexcoord += sign( offset ) * resolution;\n\t\t\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );\n\t\t\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );\n\n\t\t\t\t// WebGL port note: Added gamma correction\n\t\t\t\tC.xyz = pow(C.xyz, vec3(2.2));\n\t\t\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));\n\t\t\t\tvec4 mixed = mix(C, Cop, s);\n\t\t\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n\t\t\t\treturn mixed;\n\t\t\t}\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );\n\n\t\t}"};class Va extends Ea{constructor(e,t){super(),this.edgesRT=new rt(e,t,{depthBuffer:!1,type:Le}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new rt(e,t,{depthBuffer:!1,type:Le}),this.weightsRT.texture.name="SMAAPass.weights";const s=this,i=new Image;i.src=this.getAreaTexture(),i.onload=function(){s.areaTexture.needsUpdate=!0},this.areaTexture=new pe,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=i,this.areaTexture.minFilter=k,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const n=new Image;n.src=this.getSearchTexture(),n.onload=function(){s.searchTexture.needsUpdate=!0},this.searchTexture=new pe,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=n,this.searchTexture.magFilter=F,this.searchTexture.minFilter=F,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=at.clone(qa.uniforms),this.uniformsEdges.resolution.value.set(1/e,1/t),this.materialEdges=new nt({defines:Object.assign({},qa.defines),uniforms:this.uniformsEdges,vertexShader:qa.vertexShader,fragmentShader:qa.fragmentShader}),this.uniformsWeights=at.clone(Ka.uniforms),this.uniformsWeights.resolution.value.set(1/e,1/t),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new nt({defines:Object.assign({},Ka.defines),uniforms:this.uniformsWeights,vertexShader:Ka.vertexShader,fragmentShader:Ka.fragmentShader}),this.uniformsBlend=at.clone(Wa.uniforms),this.uniformsBlend.resolution.value.set(1/e,1/t),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new nt({uniforms:this.uniformsBlend,vertexShader:Wa.vertexShader,fragmentShader:Wa.fragmentShader}),this.fsQuad=new Qa(null)}render(e,t,s){this.uniformsEdges.tDiffuse.value=s.texture,this.fsQuad.material=this.materialEdges,e.setRenderTarget(this.edgesRT),this.clear&&e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialWeights,e.setRenderTarget(this.weightsRT),this.clear&&e.clear(),this.fsQuad.render(e),this.uniformsBlend.tColor.value=s.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.fsQuad.render(e))}setSize(e,t){this.edgesRT.setSize(e,t),this.weightsRT.setSize(e,t),this.materialEdges.uniforms.resolution.value.set(1/e,1/t),this.materialWeights.uniforms.resolution.value.set(1/e,1/t),this.materialBlend.uniforms.resolution.value.set(1/e,1/t)}getAreaTexture(){return"data:image/png;base64,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"}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}dispose(){this.edgesRT.dispose(),this.weightsRT.dispose(),this.areaTexture.dispose(),this.searchTexture.dispose(),this.materialEdges.dispose(),this.materialWeights.dispose(),this.materialBlend.dispose(),this.fsQuad.dispose()}}class Ya{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,s){return e[0]*t+e[1]*s}dot3(e,t,s,i){return e[0]*t+e[1]*s+e[2]*i}dot4(e,t,s,i,n){return e[0]*t+e[1]*s+e[2]*i+e[3]*n}noise(e,t){let s,i,n;const a=(e+t)*(.5*(Math.sqrt(3)-1)),r=Math.floor(e+a),o=Math.floor(t+a),l=(3-Math.sqrt(3))/6,c=(r+o)*l,A=e-(r-c),d=t-(o-c);let h,u;A>d?(h=1,u=0):(h=0,u=1);const p=A-h+l,g=d-u+l,m=A-1+2*l,b=d-1+2*l,f=255&r,v=255&o,y=this.perm[f+this.perm[v]]%12,C=this.perm[f+h+this.perm[v+u]]%12,x=this.perm[f+1+this.perm[v+1]]%12;let I=.5-A*A-d*d;I<0?s=0:(I*=I,s=I*I*this.dot(this.grad3[y],A,d));let w=.5-p*p-g*g;w<0?i=0:(w*=w,i=w*w*this.dot(this.grad3[C],p,g));let E=.5-m*m-b*b;return E<0?n=0:(E*=E,n=E*E*this.dot(this.grad3[x],m,b)),70*(s+i+n)}noise3d(e,t,s){let i,n,a,r;const o=(e+t+s)*(1/3),l=Math.floor(e+o),c=Math.floor(t+o),A=Math.floor(s+o),d=1/6,h=(l+c+A)*d,u=e-(l-h),p=t-(c-h),g=s-(A-h);let m,b,f,v,y,C;u>=p?p>=g?(m=1,b=0,f=0,v=1,y=1,C=0):u>=g?(m=1,b=0,f=0,v=1,y=0,C=1):(m=0,b=0,f=1,v=1,y=0,C=1):p<g?(m=0,b=0,f=1,v=0,y=1,C=1):u<g?(m=0,b=1,f=0,v=0,y=1,C=1):(m=0,b=1,f=0,v=1,y=1,C=0);const x=u-m+d,I=p-b+d,w=g-f+d,E=u-v+2*d,B=p-y+2*d,S=g-C+2*d,Q=u-1+.5,j=p-1+.5,M=g-1+.5,D=255&l,T=255&c,R=255&A,k=this.perm[D+this.perm[T+this.perm[R]]]%12,O=this.perm[D+m+this.perm[T+b+this.perm[R+f]]]%12,L=this.perm[D+v+this.perm[T+y+this.perm[R+C]]]%12,F=this.perm[D+1+this.perm[T+1+this.perm[R+1]]]%12;let P=.6-u*u-p*p-g*g;P<0?i=0:(P*=P,i=P*P*this.dot3(this.grad3[k],u,p,g));let N=.6-x*x-I*I-w*w;N<0?n=0:(N*=N,n=N*N*this.dot3(this.grad3[O],x,I,w));let G=.6-E*E-B*B-S*S;G<0?a=0:(G*=G,a=G*G*this.dot3(this.grad3[L],E,B,S));let _=.6-Q*Q-j*j-M*M;return _<0?r=0:(_*=_,r=_*_*this.dot3(this.grad3[F],Q,j,M)),32*(i+n+a+r)}noise4d(e,t,s,i){const n=this.grad4,a=this.simplex,r=this.perm,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;let c,A,d,h,u;const p=(e+t+s+i)*o,g=Math.floor(e+p),m=Math.floor(t+p),b=Math.floor(s+p),f=Math.floor(i+p),v=(g+m+b+f)*l,y=e-(g-v),C=t-(m-v),x=s-(b-v),I=i-(f-v),w=(y>C?32:0)+(y>x?16:0)+(C>x?8:0)+(y>I?4:0)+(C>I?2:0)+(x>I?1:0),E=a[w][0]>=3?1:0,B=a[w][1]>=3?1:0,S=a[w][2]>=3?1:0,Q=a[w][3]>=3?1:0,j=a[w][0]>=2?1:0,M=a[w][1]>=2?1:0,D=a[w][2]>=2?1:0,T=a[w][3]>=2?1:0,R=a[w][0]>=1?1:0,k=a[w][1]>=1?1:0,O=a[w][2]>=1?1:0,L=a[w][3]>=1?1:0,F=y-E+l,P=C-B+l,N=x-S+l,G=I-Q+l,_=y-j+2*l,z=C-M+2*l,U=x-D+2*l,H=I-T+2*l,q=y-R+3*l,K=C-k+3*l,W=x-O+3*l,V=I-L+3*l,Y=y-1+4*l,J=C-1+4*l,X=x-1+4*l,Z=I-1+4*l,$=255&g,ee=255&m,te=255&b,se=255&f,ie=r[$+r[ee+r[te+r[se]]]]%32,ne=r[$+E+r[ee+B+r[te+S+r[se+Q]]]]%32,ae=r[$+j+r[ee+M+r[te+D+r[se+T]]]]%32,re=r[$+R+r[ee+k+r[te+O+r[se+L]]]]%32,oe=r[$+1+r[ee+1+r[te+1+r[se+1]]]]%32;let le=.6-y*y-C*C-x*x-I*I;le<0?c=0:(le*=le,c=le*le*this.dot4(n[ie],y,C,x,I));let ce=.6-F*F-P*P-N*N-G*G;ce<0?A=0:(ce*=ce,A=ce*ce*this.dot4(n[ne],F,P,N,G));let Ae=.6-_*_-z*z-U*U-H*H;Ae<0?d=0:(Ae*=Ae,d=Ae*Ae*this.dot4(n[ae],_,z,U,H));let de=.6-q*q-K*K-W*W-V*V;de<0?h=0:(de*=de,h=de*de*this.dot4(n[re],q,K,W,V));let he=.6-Y*Y-J*J-X*X-Z*Z;return he<0?u=0:(he*=he,u=he*he*this.dot4(n[oe],Y,J,X,Z)),27*(c+A+d+h+u)}}const Ja={name:"SSAOShader",defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new E},cameraProjectionMatrix:{value:new B},cameraInverseProjectionMatrix:{value:new B},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\tuniform highp sampler2D tNormal;\n\t\tuniform highp sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\n\t\t\tif ( depth == 1.0 ) {\n\n\t\t\t\tgl_FragColor = vec4( 1.0 ); // don't influence background\n\t\t\t\t\n\t\t\t} else {\n\n\t\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\t\tvec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );\n\n\t\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t\t\tfloat occlusion = 0.0;\n\n\t\t\t\tfor ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t\t}\n\n\t\t}"},Xa={name:"SSAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},Za={name:"SSAOBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new E}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"};class $a extends Ea{constructor(e,t,s,i,n=32){super(),this.width=void 0!==s?s:512,this.height=void 0!==i?i:512,this.clear=!0,this.needsSwap=!1,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(n),this.generateRandomKernelRotations();const a=new vt;a.format=Ct,a.type=xt,this.normalRenderTarget=new rt(this.width,this.height,{minFilter:F,magFilter:F,type:Le,depthTexture:a}),this.ssaoRenderTarget=new rt(this.width,this.height,{type:Le}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new nt({defines:Object.assign({},Ja.defines),uniforms:at.clone(Ja.uniforms),vertexShader:Ja.vertexShader,fragmentShader:Ja.fragmentShader,blending:ot}),this.ssaoMaterial.defines.KERNEL_SIZE=n,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ft,this.normalMaterial.blending=ot,this.blurMaterial=new nt({defines:Object.assign({},Za.defines),uniforms:at.clone(Za.uniforms),vertexShader:Za.vertexShader,fragmentShader:Za.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new nt({defines:Object.assign({},Xa.defines),uniforms:at.clone(Xa.uniforms),vertexShader:Xa.vertexShader,fragmentShader:Xa.fragmentShader,blending:ot}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new nt({uniforms:at.clone(wa.uniforms),vertexShader:wa.vertexShader,fragmentShader:wa.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:It,blendDst:wt,blendEquation:Et,blendSrcAlpha:Bt,blendDstAlpha:wt,blendEquationAlpha:Et}),this.fsQuad=new Qa(null),this.originalClearColor=new b}dispose(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t,s){switch(this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case $a.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=ot,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s);break;case $a.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=ot,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s);break;case $a.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:s);break;case $a.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=ot,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s);break;case $a.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=St,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:s)}}renderPass(e,t,s,i,n){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),r=e.autoClear;e.setRenderTarget(s),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=r,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,s,i,n){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),r=e.autoClear;e.setRenderTarget(s),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=r,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(e){const t=this.kernel;for(let s=0;s<e;s++){const i=new S;i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=Math.random(),i.normalize();let n=s/e;n=Z.lerp(.1,1,n*n),i.multiplyScalar(n),t.push(i)}}generateRandomKernelRotations(){const e=new Ya,t=new Float32Array(16);for(let s=0;s<16;s++){const i=2*Math.random()-1,n=2*Math.random()-1,a=0;t[s]=e.noise3d(i,n,a)}this.noiseTexture=new Pe(t,4,4,ze,Fe),this.noiseTexture.wrapS=L,this.noiseTexture.wrapT=L,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)})}restoreVisibility(){const e=this.scene,t=this._visibilityCache;e.traverse(function(e){const s=t.get(e);e.visible=s}),t.clear()}}$a.OUTPUT={Default:0,SSAO:1,Blur:2,Depth:3,Normal:4};const er={name:"ColorCorrectionShader",uniforms:{tDiffuse:{value:null},powRGB:{value:new S(2,2,2)},mulRGB:{value:new S(1,1,1)},addRGB:{value:new S(0,0,0)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 powRGB;\n\t\tuniform vec3 mulRGB;\n\t\tuniform vec3 addRGB;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );\n\n\t\t}"},tr={name:"VignetteShader",uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float offset;\n\t\tuniform float darkness;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t// Eskil's vignette\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tvec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n\t\t\tgl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n\n\t\t}"},sr={name:"SepiaShader",uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float amount;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\n\t\t\tvec3 c = color.rgb;\n\n\t\t\tcolor.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n\t\t\tcolor.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n\t\t\tcolor.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n\n\t\t\tgl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n\n\t\t}"},ir={name:"HueSaturationShader",uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float hue;\n\t\tuniform float saturation;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\t// hue\n\t\t\tfloat angle = hue * 3.14159265;\n\t\t\tfloat s = sin(angle), c = cos(angle);\n\t\t\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\t\t\tfloat len = length(gl_FragColor.rgb);\n\t\t\tgl_FragColor.rgb = vec3(\n\t\t\t\tdot(gl_FragColor.rgb, weights.xyz),\n\t\t\t\tdot(gl_FragColor.rgb, weights.zxy),\n\t\t\t\tdot(gl_FragColor.rgb, weights.yzx)\n\t\t\t);\n\n\t\t\t// saturation\n\t\t\tfloat average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;\n\t\t\tif (saturation > 0.0) {\n\t\t\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n\t\t\t} else {\n\t\t\t\tgl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);\n\t\t\t}\n\n\t\t}"},nr={name:"BrightnessContrastShader",uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float brightness;\n\t\tuniform float contrast;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\n\t\t\tgl_FragColor.rgb += brightness;\n\n\t\t\tif (contrast > 0.0) {\n\t\t\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n\t\t\t} else {\n\t\t\t\tgl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n\t\t\t}\n\n\t\t}"};class ar{constructor(e,t,s){this.scene=e,this.camera=t,this.renderer=s,this.composer=null,this.renderPass=null,this.outputPass=null,this.activeEffects=new Map,this.effectSettings={bloom:{enabled:!1,strength:1.5,radius:.4,threshold:.85},film:{enabled:!1,noiseIntensity:.5,scanlinesIntensity:.05,scanlinesCount:648,grayscale:!1},fxaa:{enabled:!1},ssao:{enabled:!1,kernelRadius:8,minDistance:.005,maxDistance:.1},toneMapping:{enabled:!0,mapping:"ACESFilmic",exposure:1},colorCorrection:{enabled:!1,powRGB:{x:2,y:2,z:2},mulRGB:{x:1,y:1,z:1},addRGB:{x:0,y:0,z:0}},vignette:{enabled:!1,offset:1,darkness:1},sepia:{enabled:!1,amount:1},hueSaturation:{enabled:!1,hue:0,saturation:0},brightnessContrast:{enabled:!1,brightness:0,contrast:0},glitch:{enabled:!1,factor:.1},pixelate:{enabled:!1,pixelSize:6},dotScreen:{enabled:!1,center:{x:.5,y:.5},angle:1.57,scale:1}},this.initializeComposer()}initializeComposer(){if(this.composer)try{for(const e of this.composer.passes||[])try{e.dispose&&e.dispose()}catch{}this.composer.dispose()}catch{}this.composer=new Ta(this.renderer),this.renderPass=new Ra(this.scene,this.camera),this.composer.addPass(this.renderPass),this.outputPass=new Oa,this.updateComposer()}setCamera(e){e&&(this.camera=e,this.renderPass&&(this.renderPass.camera=e),this.updateComposer())}updateComposer(){try{const e=(this.composer.passes||[]).filter(e=>e!==this.renderPass);for(const t of e)try{t.dispose&&t.dispose()}catch{}}catch{}this.composer.passes=[this.renderPass],this.activeEffects.clear(),this.addActiveEffects(),this.composer.addPass(this.outputPass)}addActiveEffects(){this.effectSettings.ssao.enabled&&this.addSSAOEffect(),this.effectSettings.bloom.enabled&&this.addBloomEffect(),this.effectSettings.colorCorrection.enabled&&this.addColorCorrectionEffect(),this.effectSettings.brightnessContrast.enabled&&this.addBrightnessContrastEffect(),this.effectSettings.hueSaturation.enabled&&this.addHueSaturationEffect(),this.effectSettings.sepia.enabled&&this.addSepiaEffect(),this.effectSettings.vignette.enabled&&this.addVignetteEffect(),this.effectSettings.pixelate.enabled&&this.addPixelateEffect(),this.effectSettings.dotScreen.enabled&&this.addDotScreenEffect(),this.effectSettings.glitch.enabled&&this.addGlitchEffect(),this.effectSettings.film.enabled&&this.addFilmEffect(),this.effectSettings.fxaa.enabled&&this.addFXAAEffect(),this.applyToneMapping()}addBloomEffect(){const e=this.effectSettings.bloom,t=new E(window.innerWidth,window.innerHeight),s=new Fa(t,e.strength,e.radius,e.threshold);this.composer.addPass(s),this.activeEffects.set("bloom",s)}addFilmEffect(){const e=this.effectSettings.film,t=new Na(e.noiseIntensity,e.scanlinesIntensity,e.scanlinesCount,e.grayscale);this.composer.addPass(t),this.activeEffects.set("film",t)}addFXAAEffect(){{const e=this.renderer.getPixelRatio(),t=new Va(Math.max(1,Math.floor(window.innerWidth*e)),Math.max(1,Math.floor(window.innerHeight*e)));return this.composer.addPass(t),void this.activeEffects.set("fxaa",t)}}addSSAOEffect(){var e,t;const s=this.effectSettings.ssao,i=Math.max(1,(null==(t=(e=this.renderer).getPixelRatio)?void 0:t.call(e))||window.devicePixelRatio||1),n=new $a(this.scene,this.camera,Math.max(1,Math.floor(window.innerWidth*i)),Math.max(1,Math.floor(window.innerHeight*i)));n.kernelRadius=s.kernelRadius,n.minDistance=s.minDistance,n.maxDistance=s.maxDistance,this.composer.addPass(n),this.activeEffects.set("ssao",n)}applyToneMapping(){const e=this.effectSettings.toneMapping||{enabled:!0,mapping:"ACESFilmic",exposure:1},t=this._resolveToneMappingConst(e.mapping);try{this.renderer.toneMapping=e.enabled?t:Qt,this.renderer.toneMappingExposure=e.exposure??1}catch{}}_resolveToneMappingConst(e){switch((e||"").toLowerCase()){case"none":return Qt;case"linear":return dt;case"reinhard":return ht;case"cineon":return ut;default:return pt}}addColorCorrectionEffect(){const e=this.effectSettings.colorCorrection,t=new ja(er);t.material.uniforms.powRGB.value=new S(e.powRGB.x,e.powRGB.y,e.powRGB.z),t.material.uniforms.mulRGB.value=new S(e.mulRGB.x,e.mulRGB.y,e.mulRGB.z),t.material.uniforms.addRGB.value=new S(e.addRGB.x,e.addRGB.y,e.addRGB.z),this.composer.addPass(t),this.activeEffects.set("colorCorrection",t)}addVignetteEffect(){const e=this.effectSettings.vignette,t=new ja(tr);t.material.uniforms.offset.value=e.offset,t.material.uniforms.darkness.value=e.darkness,this.composer.addPass(t),this.activeEffects.set("vignette",t)}addSepiaEffect(){const e=this.effectSettings.sepia,t=new ja(sr);t.material.uniforms.amount.value=e.amount,this.composer.addPass(t),this.activeEffects.set("sepia",t)}addHueSaturationEffect(){const e=this.effectSettings.hueSaturation,t=new ja(ir);t.material.uniforms.hue.value=e.hue,t.material.uniforms.saturation.value=e.saturation,this.composer.addPass(t),this.activeEffects.set("hueSaturation",t)}addBrightnessContrastEffect(){const e=this.effectSettings.brightnessContrast,t=new ja(nr);t.material.uniforms.brightness.value=e.brightness,t.material.uniforms.contrast.value=e.contrast,this.composer.addPass(t),this.activeEffects.set("brightnessContrast",t)}addGlitchEffect(){const e=new Ua;e.factor=this.effectSettings.glitch.factor,this.composer.addPass(e),this.activeEffects.set("glitch",e)}addPixelateEffect(){const e=this.effectSettings.pixelate,t=new Ha(e.pixelSize,this.scene,this.camera);this.composer.addPass(t),this.activeEffects.set("pixelate",t)}addDotScreenEffect(){const e=this.effectSettings.dotScreen,t=new _a(new E(e.center.x,e.center.y),e.angle,e.scale);this.composer.addPass(t),this.activeEffects.set("dotScreen",t)}setEffectEnabled(e,t){if(e in this.effectSettings&&(this.effectSettings[e].enabled=t,this.updateComposer(),"toneMapping"===e))try{s(()=>Promise.resolve().then(()=>wn),void 0).then(e=>{try{e.saveEnvironmentSettingsAsync({toneMapping:{...this.effectSettings.toneMapping}})}catch{}}).catch(()=>{})}catch{}}updateEffectSettings(e,t){if(this.effectSettings[e]&&(Object.assign(this.effectSettings[e],t),this.effectSettings[e].enabled&&this.updateComposer(),"toneMapping"===e))try{s(()=>Promise.resolve().then(()=>wn),void 0).then(e=>{try{e.saveEnvironmentSettingsAsync({toneMapping:{...this.effectSettings.toneMapping}})}catch{}}).catch(()=>{})}catch{}}render(){this.composer.render()}handleResize(e,t){var s,i,n,a;const r=Math.max(1,(null==(i=(s=this.renderer).getPixelRatio)?void 0:i.call(s))||window.devicePixelRatio||1);"function"==typeof this.composer.setPixelRatio&&this.composer.setPixelRatio(r),this.composer.setSize(e,t);const o=this.activeEffects.get("fxaa");if(o){const s=this.renderer.getPixelRatio();"function"==typeof o.setSize?o.setSize(Math.max(1,Math.floor(e*s)),Math.max(1,Math.floor(t*s))):(null==(a=null==(n=o.material)?void 0:n.uniforms)?void 0:a.resolution)&&(o.material.uniforms.resolution.value.x=1/(e*s),o.material.uniforms.resolution.value.y=1/(t*s))}}setOutlineSelectedObjects(){}setOutlineActiveObjects(){}getSettings(){return JSON.parse(JSON.stringify(this.effectSettings))}loadSettings(e){Object.assign(this.effectSettings,e),this.updateComposer()}applyPreset(e="default"){const t=String(e||"default").toLowerCase(),i={...this.effectSettings};switch(i.fxaa.enabled=!0,i.ssao.enabled=!1,i.bloom.enabled=!1,t){case"high":i.ssao.enabled=!0,i.bloom.enabled=!0,i.bloom.strength=i.bloom.strength??1.5,i.bloom.radius=i.bloom.radius??.4,i.bloom.threshold=i.bloom.threshold??.85,i.ssao.kernelRadius=i.ssao.kernelRadius??12;break;case"medium":i.ssao.enabled=!0,i.ssao.kernelRadius=i.ssao.kernelRadius??8}this.effectSettings=i,this.updateComposer();try{s(()=>Promise.resolve().then(()=>wn),void 0).then(t=>{try{t.saveEnvironmentSettingsAsync({postProcessing:{preset:e}})}catch{}}).catch(()=>{})}catch{}}dispose(){try{for(const e of this.activeEffects.values())try{e.dispose&&e.dispose()}catch{}if(this.activeEffects.clear(),this.composer){for(const e of this.composer.passes||[])try{e.dispose&&e.dispose()}catch{}this.composer.dispose()}}catch{}this.composer=null,this.renderPass=null,this.outputPass=null}}const rr={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class or{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(e){return new _r(e)}),this.register(function(e){return new zr(e)}),this.register(function(e){return new Kr(e)}),this.register(function(e){return new Wr(e)}),this.register(function(e){return new Vr(e)}),this.register(function(e){return new Yr(e)}),this.register(function(e){return new Ur(e)}),this.register(function(e){return new Hr(e)}),this.register(function(e){return new qr(e)}),this.register(function(e){return new Jr(e)}),this.register(function(e){return new Xr(e)}),this.register(function(e){return new Zr(e)}),this.register(function(e){return new $r(e)}),this.register(function(e){return new eo(e)})}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,s,i){const n=new Gr,a=[];for(let r=0,o=this.pluginCallbacks.length;r<o;r++)a.push(this.pluginCallbacks[r](n));n.setPlugins(a),n.setTextureUtils(this.textureUtils),n.writeAsync(e,t,i).catch(s)}parseAsync(e,t){const s=this;return new Promise(function(i,n){s.parse(e,i,n,t)})}}const lr=0,cr=1,Ar=2,dr=3,hr=4,ur=5120,pr=5121,gr=5122,mr=5123,br=5124,fr=5125,vr=5126,yr=34962,Cr=34963,xr=9728,Ir=9729,wr=9984,Er=9985,Br=9986,Sr=9987,Qr=33071,jr=33648,Mr=10497,Dr="KHR_mesh_quantization",Tr={};Tr[F]=xr,Tr[re]=wr,Tr[le]=Br,Tr[k]=Ir,Tr[oe]=Er,Tr[O]=Sr,Tr[ce]=Qr,Tr[L]=Mr,Tr[Ae]=jr;const Rr={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},kr=new b;function Or(e,t){return e.length===t.length&&e.every(function(e,s){return e===t[s]})}function Lr(e){return 4*Math.ceil(e/4)}function Fr(e,t=0){const s=Lr(e.byteLength);if(s!==e.byteLength){const i=new Uint8Array(s);if(i.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<s;n++)i[n]=t;return i.buffer}return e}function Pr(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Nr(e,t){if(void 0!==e.toBlob)return new Promise(s=>e.toBlob(s,t));let s;return"image/jpeg"===t?s=.92:"image/webp"===t&&(s=.8),e.convertToBlob({type:t,quality:s})}class Gr{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+jt}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);const i=this,n=i.buffers,a=i.json;s=i.options;const r=i.extensionsUsed,o=i.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),c=Object.keys(r),A=Object.keys(o);if(c.length>0&&(a.extensionsUsed=c),A.length>0&&(a.extensionsRequired=A),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===s.binary){const e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){const s=Fr(e.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,s.byteLength,!0),i.setUint32(4,5130562,!0);const n=Fr((r=JSON.stringify(a),(new TextEncoder).encode(r).buffer),32);var r;const o=new DataView(new ArrayBuffer(8));o.setUint32(0,n.byteLength,!0),o.setUint32(4,1313821514,!0);const l=new ArrayBuffer(12),c=new DataView(l);c.setUint32(0,1179937895,!0),c.setUint32(4,2,!0);const A=12+o.byteLength+n.byteLength+i.byteLength+s.byteLength;c.setUint32(8,A,!0);const d=new Blob([l,o,n,i,s],{type:"application/octet-stream"}),h=new FileReader;h.readAsArrayBuffer(d),h.onloadend=function(){t(h.result)}}}else if(a.buffers&&a.buffers.length>0){const e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){const s=e.result;a.buffers[0].uri=s,t(a)}}else t(a)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;const s=this.options,i=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(const e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],i[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(n){}}getUID(e,t=!1){if(!1===this.uids.has(e)){const t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new S;for(let s=0,i=e.count;s<i;s++)if(Math.abs(t.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),i=new S;for(let n=0,a=s.count;n<a;n++)i.fromBufferAttribute(s,n),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),s.setXYZ(n,i.x,i.y,i.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),s=!0),0!==t.rotation&&(i.rotation=t.rotation,s=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,t){if(e===t)return e;function s(e){return e.colorSpace===I?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof Ie&&(e=await this.decompressTextureAsync(e)),t instanceof Ie&&(t=await this.decompressTextureAsync(t));const i=e?e.image:null,n=t?t.image:null,a=Math.max(i?i.width:0,n?n.width:0),r=Math.max(i?i.height:0,n?n.height:0),o=Pr();o.width=a,o.height=r;const l=o.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,a,r);const c=l.getImageData(0,0,a,r);if(i){l.drawImage(i,0,0,a,r);const t=s(e),n=l.getImageData(0,0,a,r).data;for(let e=2;e<n.length;e+=4)c.data[e]=256*t(n[e]/256)}if(n){l.drawImage(n,0,0,a,r);const e=s(t),i=l.getImageData(0,0,a,r).data;for(let t=1;t<i.length;t+=4)c.data[t]=256*e(i[t]/256)}l.putImageData(c,0,0);const A=(e||t).clone();return A.source=new Mt(o),A.colorSpace=Ge,A.channel=(e||t).channel,e&&t&&(e.channel,t.channel),A}async decompressTextureAsync(e,t=1/0){if(null===this.textureUtils)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,i,n){const a=this.json;let r;switch(a.bufferViews||(a.bufferViews=[]),t){case ur:case pr:r=1;break;case gr:case mr:r=2;break;default:r=4}let o=e.itemSize*r;n===yr&&(o=4*Math.ceil(o/4));const l=Lr(i*o),c=new DataView(new ArrayBuffer(l));let A=0;for(let h=s;h<s+i;h++){for(let s=0;s<e.itemSize;s++){let i;e.itemSize>4?i=e.array[h*e.itemSize+s]:(0===s?i=e.getX(h):1===s?i=e.getY(h):2===s?i=e.getZ(h):3===s&&(i=e.getW(h)),!0===e.normalized&&(i=Z.normalize(i,e.array))),t===vr?c.setFloat32(A,i,!0):t===br?c.setInt32(A,i,!0):t===fr?c.setUint32(A,i,!0):t===gr?c.setInt16(A,i,!0):t===mr?c.setUint16(A,i,!0):t===ur?c.setInt8(A,i):t===pr&&c.setUint8(A,i),A+=r}A%o!==0&&(A+=o-A%o)}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};void 0!==n&&(d.target=n),n===yr&&(d.byteStride=o),this.byteOffset+=l,a.bufferViews.push(d);return{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(i){const n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){const e=Fr(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(s.bufferViews.push(a)-1)}})}processAccessor(e,t,s,i){const n=this.json;let a;if(e.array.constructor===Float32Array)a=vr;else if(e.array.constructor===Int32Array)a=br;else if(e.array.constructor===Uint32Array)a=fr;else if(e.array.constructor===Int16Array)a=gr;else if(e.array.constructor===Uint16Array)a=mr;else if(e.array.constructor===Int8Array)a=ur;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);a=pr}if(void 0===s&&(s=0),void 0!==i&&i!==1/0||(i=e.count),0===i)return null;const r=function(e,t,s){const i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+s;n++)for(let t=0;t<e.itemSize;t++){let s;e.itemSize>4?s=e.array[n*e.itemSize+t]:(0===t?s=e.getX(n):1===t?s=e.getY(n):2===t?s=e.getZ(n):3===t&&(s=e.getW(n)),!0===e.normalized&&(s=Z.normalize(s,e.array))),i.min[t]=Math.min(i.min[t],s),i.max[t]=Math.max(i.max[t],s)}return i}(e,s,i);let o;void 0!==t&&(o=e===t.index?Cr:yr);const l=this.processBufferView(e,a,s,i,o),c={bufferView:l.id,byteOffset:l.byteOffset,componentType:a,count:i,max:r.max,min:r.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(c)-1}processImage(e,t,s,i="image/png"){if(null!==e){const t=this,n=t.cache,a=t.json,r=t.options,o=t.pending;n.images.has(e)||n.images.set(e,{});const l=n.images.get(e),c=i+":flipY/"+s.toString();if(void 0!==l[c])return l[c];a.images||(a.images=[]);const A={mimeType:i},d=Pr();d.width=Math.min(e.width,r.maxTextureSize),d.height=Math.min(e.height,r.maxTextureSize);const h=d.getContext("2d",{willReadFrequently:!0});if(!0===s&&(h.translate(0,d.height),h.scale(1,-1)),void 0!==e.data){e.width>r.maxTextureSize||(e.height,r.maxTextureSize);const t=new Uint8ClampedArray(e.height*e.width*4);for(let s=0;s<t.length;s+=4)t[s+0]=e.data[s+0],t[s+1]=e.data[s+1],t[s+2]=e.data[s+2],t[s+3]=e.data[s+3];h.putImageData(new ImageData(t,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");h.drawImage(e,0,0,d.width,d.height)}!0===r.binary?o.push(Nr(d,i).then(e=>t.processBufferViewImage(e)).then(e=>{A.bufferView=e})):void 0!==d.toDataURL?A.uri=d.toDataURL(i):o.push(Nr(d,i).then(e=>(new FileReader).readAsDataURL(e)).then(e=>{A.uri=e}));const u=a.images.push(A)-1;return l[c]=u,u}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:Tr[e.magFilter],minFilter:Tr[e.minFilter],wrapS:Tr[e.wrapS],wrapT:Tr[e.wrapT]};return t.samplers.push(s)-1}async processTextureAsync(e){const t=this.options,s=this.cache,i=this.json;if(s.textures.has(e))return s.textures.get(e);i.textures||(i.textures=[]),e instanceof Ie&&(e=await this.decompressTextureAsync(e,t.maxTextureSize));let n=e.userData.mimeType;"image/webp"===n&&(n="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(a.name=e.name),await this._invokeAllAsync(async function(t){t.writeTexture&&await t.writeTexture(e,a)});const r=i.textures.push(a)-1;return s.textures.set(e,r),r}async processMaterialAsync(e){const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return null;s.materials||(s.materials=[]);const i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&e.isMeshBasicMaterial;const n=e.color.toArray().concat([e.opacity]);if(Or(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){const t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),s={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(s,t),i.pbrMetallicRoughness.metallicRoughnessTexture=s}if(e.map){const t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){const t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){const t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){const t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===z&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),await this._invokeAllAsync(async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,i)});const a=s.materials.push(i)-1;return t.materials.set(e,a),a}async processMeshAsync(e){const t=this.cache,s=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let A=0,y=e.material.length;A<y;A++)i.push(e.material[A].uuid);else i.push(e.material.uuid);const n=i.join(":");if(t.meshes.has(n))return t.meshes.get(n);const a=e.geometry;let r;r=e.isLineSegments?cr:e.isLineLoop?Ar:e.isLine?dr:e.isPoints?lr:e.material.wireframe?cr:hr;const o={},l={},c=[],d=[],h={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},u=a.getAttribute("normal");void 0===u||this.isNormalizedNormalAttribute(u)||a.setAttribute("normal",this.createNormalizedNormalAttribute(u));let p=null;for(let y in a.attributes){if("morph"===y.slice(0,5))continue;const e=a.attributes[y];y=h[y]||y.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(e))){l[y]=t.attributes.get(this.getUID(e));continue}p=null;const s=e.array;"JOINTS_0"!==y||s instanceof Uint16Array||s instanceof Uint8Array?(s instanceof Uint32Array||s instanceof Int32Array)&&!y.startsWith("_")&&(p=or.Utils.toFloat32BufferAttribute(e)):p=new A(new Uint16Array(s),e.itemSize,e.normalized);const i=this.processAccessor(p||e,a);null!==i&&(y.startsWith("_")||this.detectMeshQuantization(y,e),l[y]=i,t.attributes.set(this.getUID(e),i))}if(void 0!==u&&a.setAttribute("normal",u),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){const s=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(const t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){const o={};let l=!1;for(const e in a.morphAttributes){if("position"!==e&&"normal"!==e){l||(l=!0);continue}const s=a.morphAttributes[e][r],i=e.toUpperCase(),n=a.attributes[e];if(t.attributes.has(this.getUID(s,!0))){o[i]=t.attributes.get(this.getUID(s,!0));continue}const c=s.clone();if(!a.morphTargetsRelative)for(let e=0,t=s.count;e<t;e++)for(let i=0;i<s.itemSize;i++)0===i&&c.setX(e,s.getX(e)-n.getX(e)),1===i&&c.setY(e,s.getY(e)-n.getY(e)),2===i&&c.setZ(e,s.getZ(e)-n.getZ(e)),3===i&&c.setW(e,s.getW(e)-n.getW(e));o[i]=this.processAccessor(c,a),t.attributes.set(this.getUID(n,!0),o[i])}d.push(o),s.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&i.push(n[r])}o.weights=s,i.length>0&&(o.extras={},o.extras.targetNames=i)}const g=Array.isArray(e.material);if(g&&0===a.groups.length)return null;let m=!1;if(g&&null===a.index){const e=[];for(let t=0,s=a.attributes.position.count;t<s;t++)e[t]=t;a.setIndex(e),m=!0}const b=g?e.material:[e.material],f=g?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let A=0,y=f.length;A<y;A++){const e={mode:r,attributes:l};if(this.serializeUserData(a,e),d.length>0&&(e.targets=d),null!==a.index){let s=this.getUID(a.index);void 0===f[A].start&&void 0===f[A].count||(s+=":"+f[A].start+":"+f[A].count),t.attributes.has(s)?e.indices=t.attributes.get(s):(e.indices=this.processAccessor(a.index,a,f[A].start,f[A].count),t.attributes.set(s,e.indices)),null===e.indices&&delete e.indices}const s=await this.processMaterialAsync(b[f[A].materialIndex]);null!==s&&(e.material=s),c.push(e)}!0===m&&a.setIndex(null),o.primitives=c,s.meshes||(s.meshes=[]),await this._invokeAllAsync(function(t){t.writeMesh&&t.writeMesh(e,o)});const v=s.meshes.push(o)-1;return t.meshes.set(n,v),v}detectMeshQuantization(e,t){if(this.extensionsUsed[Dr])return;let s;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");const i=e.split("_",1)[0];rr[i]&&rr[i].includes(s)&&(this.extensionsUsed[Dr]=!0,this.extensionsRequired[Dr]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,i={type:s?"orthographic":"perspective"};return s?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Z.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const s=this.json,i=this.nodeMap;s.animations||(s.animations=[]);const n=(e=or.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],r=[];for(let o=0;o<n.length;++o){const e=n[o],s=U.parseTrackName(e.name);let l=U.findNode(t,s.nodeName);const c=Rr[s.propertyName];if("bones"===s.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(s.objectIndex):void 0),!l||!c)continue;const d=1;let h,u=e.values.length/e.times.length;c===Rr.morphTargetInfluences&&(u/=l.morphTargetInfluences.length),!0===e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(h="CUBICSPLINE",u/=3):h=e.getInterpolation()===de?"STEP":"LINEAR",r.push({input:this.processAccessor(new A(e.times,d)),output:this.processAccessor(new A(e.values,u)),interpolation:h}),a.push({sampler:r.length-1,target:{node:i.get(l),path:c}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:r,channels:a}),s.animations.length-1}processSkin(e){const t=this.json,s=this.nodeMap,i=t.nodes[s.get(e)],n=e.skeleton;if(void 0===n)return null;const a=e.skeleton.bones[0];if(void 0===a)return null;const r=[],o=new Float32Array(16*n.bones.length),l=new B;for(let c=0;c<n.bones.length;++c)r.push(s.get(n.bones[c])),l.copy(n.boneInverses[c]),l.multiply(e.bindMatrix).toArray(o,16*c);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new A(o,16)),joints:r,skeleton:s.get(a)});return i.skin=t.skins.length-1}async processNodeAsync(e){const t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const n={};if(s.trs){const t=e.quaternion.toArray(),s=e.position.toArray(),i=e.scale.toArray();Or(t,[0,0,0,1])||(n.rotation=t),Or(s,[0,0,0])||(n.translation=s),Or(i,[1,1,1])||(n.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Or(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){const t=await this.processMeshAsync(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const t=[];for(let i=0,n=e.children.length;i<n;i++){const n=e.children[i];if(n.visible||!1===s.onlyVisible){const e=await this.processNodeAsync(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}await this._invokeAllAsync(function(t){t.writeNode&&t.writeNode(e,n)});const a=t.nodes.push(n)-1;return i.set(e,a),a}async processSceneAsync(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);const n=[];for(let a=0,r=e.children.length;a<r;a++){const t=e.children[a];if(t.visible||!1===s.onlyVisible){const e=await this.processNodeAsync(t);null!==e&&n.push(e)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}async processObjectsAsync(e){const t=new Dt;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);await this.processSceneAsync(t)}async processInputAsync(e){const t=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync(function(t){t.beforeParse&&t.beforeParse(e)});const s=[];for(let i=0;i<e.length;i++)e[i]instanceof Dt?await this.processSceneAsync(e[i]):s.push(e[i]);s.length>0&&await this.processObjectsAsync(s);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);await this._invokeAllAsync(function(t){t.afterParse&&t.afterParse(e)})}async _invokeAllAsync(e){for(let t=0,s=this.plugins.length;t<s;t++)await e(this.plugins[t])}}class _r{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return;const s=this.writer,i=s.json,n=s.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&e.decay,e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||e.target.position.z),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);const r=i.extensions[this.name].lights;r.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:r.length-1}}}class zr{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Ur{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){const t={index:await s.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const t={index:await s.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){const t={index:await s.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Hr{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;const s=this.writer.extensionsUsed,i={};i.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class qr{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){const t={index:await s.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const t={index:await s.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Kr{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){const t={index:await s.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Wr{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;const s=this.writer,i=s.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){const t={index:await s.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}e.attenuationDistance!==1/0&&(n.attenuationDistance=e.attenuationDistance),n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Vr{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;const s=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class Yr{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(kr)&&!e.specularIntensityMap&&!e.specularColorMap)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.specularIntensityMap){const t={index:await s.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){const t={index:await s.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Jr{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.sheenRoughnessMap){const t={index:await s.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){const t={index:await s.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Xr{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.anisotropyMap){const t={index:await s.processTextureAsync(e.anisotropyMap)};s.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class Zr{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;const s=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,s[this.name]=!0}}class $r{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;const s=this.writer,i=s.extensionsUsed,n={};if(e.bumpMap){const t={index:await s.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}}class eo{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;const s=this.writer,i=e,n=new Float32Array(3*i.count),a=new Float32Array(4*i.count),r=new Float32Array(3*i.count),o=new B,l=new S,c=new ae,d=new S;for(let A=0;A<i.count;A++)i.getMatrixAt(A,o),o.decompose(l,c,d),l.toArray(n,3*A),c.toArray(a,4*A),d.toArray(r,3*A);const h={TRANSLATION:s.processAccessor(new A(n,3)),ROTATION:s.processAccessor(new A(a,4)),SCALE:s.processAccessor(new A(r,3))};i.instanceColor&&(h._COLOR_0=s.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:h},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}}or.Utils={insertKeyframe:function(e,t){const s=.001,i=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+i),r=e.createInterpolant(new e.ValueBufferType(i));let o;if(0===e.times.length){n[0]=t;for(let e=0;e<i;e++)a[e]=0;o=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<s)return 0;n[0]=t,n.set(e.times,1),a.set(r.evaluate(t),0),a.set(e.values,i),o=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<s)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(r.evaluate(t),e.values.length),o=n.length-1}else for(let l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<s)return l;if(e.times[l]<t&&e.times[l+1]>t){n.set(e.times.slice(0,l+1),0),n[l+1]=t,n.set(e.times.slice(l+1),l+2),a.set(e.values.slice(0,(l+1)*i),0),a.set(r.evaluate(t),(l+1)*i),a.set(e.values.slice((l+1)*i),(l+2)*i),o=l+1;break}}return e.times=n,e.values=a,o},mergeMorphTargetTracks:function(e,t){const s=[],i={},n=e.tracks;for(let a=0;a<n.length;++a){let e=n[a];const r=U.parseTrackName(e.name),o=U.findNode(t,r.nodeName);if("morphTargetInfluences"!==r.propertyName||void 0===r.propertyIndex){s.push(e);continue}if(e.createInterpolant!==e.InterpolantFactoryMethodDiscrete&&e.createInterpolant!==e.InterpolantFactoryMethodLinear){if(e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");e=e.clone(),e.setInterpolation(ie)}const l=o.morphTargetInfluences.length,c=o.morphTargetDictionary[r.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+r.propertyIndex);let A;if(void 0===i[o.uuid]){A=e.clone();const t=new A.ValueBufferType(l*A.times.length);for(let e=0;e<A.times.length;e++)t[e*l+c]=A.values[e];A.name=(r.nodeName||"")+".morphTargetInfluences",A.values=t,i[o.uuid]=A,s.push(A);continue}const d=e.createInterpolant(new e.ValueBufferType(1));A=i[o.uuid];for(let t=0;t<A.times.length;t++)A.values[t*l+c]=d.evaluate(A.times[t]);for(let t=0;t<e.times.length;t++){const s=this.insertKeyframe(A,e.times[t]);A.values[s*l+c]=e.values[t]}}return e.tracks=s,e},toFloat32BufferAttribute:function(e){const t=new A(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return t.array.set(e.array),t;for(let s=0,i=e.count;s<i;s++)for(let n=0;n<e.itemSize;n++)t.setComponent(s,n,e.getComponent(s,n));return t}};class to{constructor(){this.loader=ki(),this.exporter=new or,this.thumbnailRenderer=null,this.initThumbnailRenderer(),(async()=>{try{const e=localStorage.getItem("customMeshes");if(!e)return!1;const t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return localStorage.removeItem("customMeshes"),!1;for(const s of t)await Bn(s);return localStorage.removeItem("customMeshes"),!0}catch(e){return!1}})()}_hasRenderableMesh(e){var t;let s=!1;return!!e&&(null==(t=e.traverse)||t.call(e,e=>{s||(null==e?void 0:e.isMesh)&&e.geometry&&e.geometry.isBufferGeometry&&e.geometry.getAttribute("position")&&(s=!0)}),s)}async importGLBFile(e){if(!e)throw new Error("NO_FILE");const t=await e.arrayBuffer(),s=(e.name||"imported").replace(/\.(glb|gltf)$/i,"");return this.importGLBBuffer(t,s)}async importGLBBuffer(e,t="Imported Mesh"){try{const s=new Blob([e],{type:"model/gltf-binary"}),i=URL.createObjectURL(s);let n=null;try{n=await this.generateThumbnailFromURL(i)}finally{try{URL.revokeObjectURL(i)}catch{}}const a=Date.now(),r={id:`custom_${a}`,name:t||`custom_${a}`,thumbnail:n,type:"custom",glbData:e,createdAt:a};await this.saveCustomMesh(r);try{window.dispatchEvent(new CustomEvent("customMeshAdded"))}catch{}return r}catch(s){throw s}}downloadCustomMesh(e){if(e&&e.glbData)try{const t=new Blob([e.glbData],{type:"model/gltf-binary"}),s=URL.createObjectURL(t),i=document.createElement("a"),n=(e.name||e.id||"mesh").replace(/[^a-zA-Z0-9_-]/g,"_");i.href=s,i.download=`${n}.glb`,document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>{try{URL.revokeObjectURL(s)}catch{}},0)}catch(t){}}initThumbnailRenderer(){if(this.thumbnailRenderer&&this.thumbnailRenderer.renderer)try{this.thumbnailRenderer.renderer.dispose()}catch{}this.thumbnailRenderer={scene:new Dt,camera:new X(75,1,.1,1e3),renderer:new Tt({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,powerPreference:"low-power"})};const{scene:e,camera:t,renderer:s}=this.thumbnailRenderer;s.setSize(128,128),s.setClearColor(2763306,1),this.setupLighting(e);try{Ri(s)}catch{}}setupLighting(e){const t=new Rt(4210752,.6);e.add(t);const s=new C(16777215,.8);s.position.set(1,1,1),e.add(s);const i=new C(16777215,.4);i.position.set(-1,-1,-1),e.add(i)}safeRotationCopy(e,t){if(e&&t)try{void 0!==e.order?t.copy(e):t.set(e.x||0,e.y||0,e.z||0,"XYZ")}catch(s){t.set(0,0,0,"XYZ")}}createSafeClone(e){try{if(!e||"object"!=typeof e)return new M;if("Group"===e.type||e.isGroup){const t=new J;return t.name=e.name||"",Array.isArray(e.children)&&e.children.forEach(e=>{try{const s=this.createSafeClone(e);t.add(s)}catch(s){}}),e.position&&t.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,t.rotation),e.scale&&t.scale.copy(e.scale),t}if(e.isMesh){const t=e.geometry?e.geometry.clone():null,s=e.material?this.cloneMaterial(e.material):null,i=new q(t,s);return i.name=e.name||"",e.position&&i.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,i.rotation),e.scale&&i.scale.copy(e.scale),i}const t=new M;return t.name=e.name||"",Array.isArray(e.children)&&e.children.forEach(e=>{try{const s=this.createSafeClone(e);t.add(s)}catch(s){}}),e.position&&t.position.copy(e.position),e.rotation&&this.safeRotationCopy(e.rotation,t.rotation),e.scale&&t.scale.copy(e.scale),t}catch(t){const s=new M;return s.name=e&&e.name||"fallback_object",s}}cloneMaterial(e){return Array.isArray(e)?e.map(e=>e.clone?e.clone():e):e.clone?e.clone():e}async loadLibraryMeshes(){const e=void 0!==import.meta&&{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"true"==={}.VITE_ENABLE_LIBRARY_MANIFEST,t="undefined"!=typeof window&&!0===window.__ENABLE_LIBRARY_MANIFEST;if(!e&&!t)return[];try{const e="/library/mesh/manifest.json",t=await fetch(e,{method:"GET",cache:"no-store"});if(!t.ok)return[];const s=await t.json();return Array.isArray(s)?s.map(e=>({id:`library_${String(e.filename||"").replace(/\.glb$/i,"")}`,name:e.name||e.filename,type:"library",geometry:"LibraryMesh",glbUrl:`/library/mesh/${e.filename}`,filename:e.filename,thumbnail:null,isLoadingThumbnail:!0})):[]}catch(s){return[]}}async generateThumbnailFromURL(e){return new Promise((t,s)=>{this.loader.load(e,e=>{try{const{scene:s,camera:i,renderer:n}=this.thumbnailRenderer,a=[];s.traverse(e=>{e.isMesh&&a.push(e)}),a.forEach(e=>s.remove(e));const r=e.scene;s.add(r);const o=(new fe).setFromObject(r),l=(o.getCenter(new S),o.getSize(new S)),c=Math.max(l.x,l.y,l.z),A=i.fov*(Math.PI/180);let d=Math.abs(c/2/Math.tan(A/2));d*=1.5,i.position.set(.7*d,.5*d,d),i.lookAt(0,0,0),n.render(s,i);const h=n.domElement.toDataURL("image/png");s.remove(r),t(h)}catch(i){s(i)}},e=>{},e=>{s(e)})})}generateThumbnailFromObject(e,t=128){const{scene:s,camera:i,renderer:n}=this.thumbnailRenderer;for(n.setSize(t,t),n.setClearColor(2763306,1);s.children.length;)s.remove(s.children[0]);let a;this.setupLighting(s);try{a="function"==typeof e.clone?e.clone():this.createSafeClone(e)}catch(h){a=this.createSafeClone(e)}s.add(a);const r=(new fe).setFromObject(a);r.getCenter(new S);const o=r.getSize(new S),l=Math.max(o.x,o.y,o.z),c=i.fov*(Math.PI/180);let A=Math.abs(l/2/Math.tan(c/2));A*=1.5,i.position.set(.7*A,.5*A,A),i.lookAt(0,0,0),n.render(s,i);const d=n.domElement.toDataURL("image/png");return s.clear(),d}_buildSingleMesh(e,{preserveTransform:t=!0}={}){try{if(!e)return null;const t="function"==typeof e.clone?e.clone(!0):this.createSafeClone(e);t.updateMatrixWorld(!0);const s=new B;s.copy(t.matrixWorld).invert();const i=[],n=[],a=e=>{if(e.isSkinnedMesh||e.isInstancedMesh)return!1;if(Array.isArray(e.material))return!1;const t=e.geometry;if(!t||!t.isBufferGeometry)return!1;const a=t.clone(),r=new B;r.copy(e.matrixWorld),r.premultiply(s),a.applyMatrix4(r);try{a.clearGroups()}catch{}return i.push(a),n.push(e.material),!0};let r=!0;if(t.traverse(e=>{if(!r)return;const t=e.userData||{},s=!!(t.isSystemObject||t.isRayHelper||t.isLightHelper||t.isLightTarget||t.isLightTargetHandle||t.isHelper);e.isMesh&&!s&&(r=a(e))}),!r||0===i.length)return null;const o=function(e,t=!1){const s=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),a={},r={},o=e[0].morphTargetsRelative,l=new c;let A=0;for(let c=0;c<e.length;++c){const d=e[c];let h=0;if(s!==(null!==d.index))return null;for(const e in d.attributes){if(!i.has(e))return null;void 0===a[e]&&(a[e]=[]),a[e].push(d.attributes[e]),h++}if(h!==i.size)return null;if(o!==d.morphTargetsRelative)return null;for(const e in d.morphAttributes){if(!n.has(e))return null;void 0===r[e]&&(r[e]=[]),r[e].push(d.morphAttributes[e])}if(t){let e;if(s)e=d.index.count;else{if(void 0===d.attributes.position)return null;e=d.attributes.position.count}l.addGroup(A,e,c),A+=e}}if(s){let t=0;const s=[];for(let i=0;i<e.length;++i){const n=e[i].index;for(let e=0;e<n.count;++e)s.push(n.getX(e)+t);t+=e[i].attributes.position.count}l.setIndex(s)}for(const c in a){const e=Wt(a[c]);if(!e)return null;l.setAttribute(c,e)}for(const c in r){const e=r[c][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[c]=[];for(let t=0;t<e;++t){const e=[];for(let i=0;i<r[c].length;++i)e.push(r[c][i][t]);const s=Wt(e);if(!s)return null;l.morphAttributes[c].push(s)}}return l}(i,!0);if(!o||!o.groups||o.groups.length!==n.length)return null;const l=new q(o,n);return l.name=e.name||"MergedMesh",l.position.set(0,0,0),l.rotation.set(0,0,0),l.scale.set(1,1,1),l}catch(s){return null}}async exportObjectToGLB(e,t={}){const{preserveTransform:s=!1}=t;return new Promise((t,i)=>{var n,a,r,o,l,c;let A;try{A="function"==typeof e.clone?e.clone():this.createSafeClone(e)}catch(d){A=this.createSafeClone(e)}if(A&&"object"==typeof A){if(s){try{null==(n=A.updateMatrixWorld)||n.call(A,!0);const e=(new B).copy(A.matrixWorld).invert();null==(a=A.traverse)||a.call(A,t=>{if(!(t&&t.isMesh&&t.geometry&&t.geometry.isBufferGeometry))return;const s=(new B).copy(t.matrixWorld).premultiply(e);try{const e=t.geometry.clone();e.applyMatrix4(s),t.geometry=e}catch{}}),null==(r=A.traverse)||r.call(A,e=>{var t,s;try{e.position&&"function"==typeof e.position.set&&e.position.set(0,0,0),e.rotation&&"function"==typeof e.rotation.set&&e.rotation.set(0,0,0,"XYZ"),e.scale&&"function"==typeof e.scale.set&&e.scale.set(1,1,1),null==(t=e.updateMatrix)||t.call(e),null==(s=e.updateMatrixWorld)||s.call(e,!1)}catch{}})}catch{}try{null==(o=A.position)||o.set(0,0,0),null==(l=A.rotation)||l.set(0,0,0,"XYZ"),null==(c=A.scale)||c.set(1,1,1)}catch{}}else try{A.position&&"function"==typeof A.position.set&&A.position.set(0,0,0),A.rotation&&"function"==typeof A.rotation.set&&A.rotation.set(0,0,0,"XYZ"),A.scale&&"function"==typeof A.scale.set&&A.scale.set(1,1,1)}catch(h){}this.exporter.parse(A,e=>{t(e)},e=>{i(e)},{binary:!0,includeCustomExtensions:!0,embedImages:!0,maxTextureSize:1024,forcePowerOfTwoTextures:!1,truncateDrawRange:!1})}else i(new Error("객체 복제에 실패했습니다."))})}async addCustomMesh(e,t,s={}){const{preserveTransform:i=!0,compressToSingleMesh:n=!0}=s;try{let s=e;if(n){const t=this._buildSingleMesh(e,{preserveTransform:i});t&&(s=t)}if(!this._hasRenderableMesh(s))throw new Error("NO_MESH_FOUND");const a=await this.exportObjectToGLB(s,{preserveTransform:i}),r=this.generateThumbnailFromObject(e),o=Date.now(),l={id:`custom_${o}`,name:t||"커스텀 메쉬",fileName:`custom_${o}.glb`,thumbnail:r,type:"custom",glbData:a,createdAt:o,transform:e&&e.position&&e.rotation&&e.scale?{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z},scale:{x:e.scale.x,y:e.scale.y,z:e.scale.z}}:void 0};return await this.saveCustomMesh(l),l}catch(a){throw new Error("ADD_CUSTOM_MESH_FAILED")}}async saveCustomMesh(e){try{await Bn(e)}catch(t){throw new Error("IDB_SAVE_FAILED")}}async getCustomMeshes(){return(await En()).map(e=>{const t={...e};if(t.type||(t.type="custom"),e&&e.thumbnail&&"object"==typeof e.thumbnail&&"size"in e.thumbnail)try{t.thumbnail=URL.createObjectURL(e.thumbnail)}catch{}return t})}async deleteCustomMesh(e){try{await Sn(e)}catch(t){throw new Error("IDB_DELETE_FAILED")}return await En()}createBlobURL(e){try{let t;if(e instanceof ArrayBuffer)t=e;else if(e instanceof Uint8Array)t=e.buffer;else if("object"==typeof e&&"Buffer"===e.type)t=new Uint8Array(e.data||e).buffer;else{if(!Array.isArray(e))throw new Error("GLB 데이터를 처리할 수 없습니다.");t=new Uint8Array(e).buffer}const s=new Blob([t],{type:"model/gltf-binary"});return URL.createObjectURL(s)}catch(t){throw t}}async loadGLBModel(e){return new Promise((t,s)=>{this.loader.load(e,e=>{t(e.scene)},e=>{},e=>{s(e)})})}dispose(){this.thumbnailRenderer&&(this.thumbnailRenderer.renderer.dispose(),this.thumbnailRenderer.scene.clear(),this.thumbnailRenderer=null)}}let so=null;const io=()=>(so||(so=new to),so);function no({onEditorControlsReady:e,onPostProcessingReady:t,onContextMenu:s}){const n=r.useRef(null),a=r.useRef(null),o=r.useRef(null),l=r.useRef(null),c=r.useRef(null),[A,d]=r.useState(!1),h=r.useRef(new Map),u=r.useRef(new Set),p=r.useRef({lastT:0,frames:0,fps:0,lastPush:0,vert:0,tri:0,obj:0}),g=r.useRef(null),m=r.useRef({animId:null,t:0,target:0,start:0,startTime:0,duration:220,easing:"easeInOutQuad",maxOpacity:.6}),{objects:f,walls:I,setScene:w,setSelectedObject:B}=Dn(),Q=r.useRef(Dn.getState().isPostProcessingEnabled);return r.useEffect(()=>{const e=Dn.subscribe((e,t)=>{e.isPostProcessingEnabled!==t.isPostProcessingEnabled&&(Q.current=e.isPostProcessingEnabled)});return()=>{try{null==e||e()}catch{}}},[]),r.useEffect(()=>{var i,r,A,u,f,I,j,M;if(!n.current)return;const D=new Dt,T=new Dt;D.background=new b(2763306);const R=new X(75,window.innerWidth/window.innerHeight,.1,1e3);R.position.set(15,20,15),R.lookAt(0,0,0);const k=(()=>{try{return Dn.getState().rendererAA||"msaa"}catch{return"msaa"}})(),O=new Tt({antialias:"msaa"===k,powerPreference:"high-performance"});try{const e=Dn.getState(),t=(null==(i=e.safeMode)?void 0:i.enabled)?e.safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);O.setPixelRatio(t)}catch{O.setPixelRatio(Math.min(2,window.devicePixelRatio||1))}O.setSize(window.innerWidth,window.innerHeight),O.shadowMap.enabled=!0,O.shadowMap.type=kt,O.sortObjects=!1,O.autoClear=!1,n.current.appendChild(O.domElement);try{Ri(O)}catch{}const L=e=>{e.preventDefault()},F=()=>{try{O.setSize(window.innerWidth,window.innerHeight),l.current&&(l.current.initializeComposer(),l.current.handleResize(window.innerWidth,window.innerHeight))}catch{}};O.domElement.addEventListener("webglcontextlost",L,!1),O.domElement.addEventListener("webglcontextrestored",F,!1);const P=e=>{s&&s(e)};O.domElement.addEventListener("contextmenu",P),c.current=D,w(D,R,O);const N=new xa(D,R,O,Dn,e=>{var t,s,i,n;w(D,e,O);try{null==(s=null==(t=l.current)?void 0:t.setCamera)||s.call(t,e)}catch{}try{null==(n=null==(i=o.current)?void 0:i.setCamera)||n.call(i,e)}catch{}});N.gizmoScene=T,a.current=N;try{window.__editorControls=N}catch{}window.runSmokeTest=()=>function(e,t){var s,i;try{if(!e||!t)return!1;const a=t.getState();try{null==(s=e.applyInitialViewState)||s.call(e)}catch(n){return null==n||n.message,!1}a.isWireframe,t.getState().toggleWireframe();try{null==(i=e.updateWireframe)||i.call(e)}catch{}t.getState().isWireframe;const r=new _,o=new He(1,1,1),l=new q(o,r);try{e.scene.add(l),l.material.wireframe}catch(n){return null==n||n.message,!1}finally{try{e.scene.remove(l),o.dispose(),r.dispose()}catch{}}return!0}catch(n){return null==n||n.message,!1}}(N,Dn);try{null==(r=N.applyInitialViewState)||r.call(N)}catch{}try{if(!!Dn.getState().useBlenderControls){const e=new Ia(N.camera,O.domElement);e.setScene(D);const t=Dn.getState();e.setSpeeds({rotate:.01*t.cameraOrbitSpeed,pan:.02*t.cameraPanSpeed,zoom:t.cameraZoomSpeed}),o.current=e;try{window.__blenderControls=e}catch{}try{const t=Dn.subscribe((t,s)=>{t.cameraPanSpeed===s.cameraPanSpeed&&t.cameraOrbitSpeed===s.cameraOrbitSpeed&&t.cameraZoomSpeed===s.cameraZoomSpeed||e.setSpeeds({rotate:.01*t.cameraOrbitSpeed,pan:.02*t.cameraPanSpeed,zoom:t.cameraZoomSpeed})}),s=null==(A=N.dispose)?void 0:A.bind(N);N.dispose=()=>{try{null==t||t()}catch{}null==s||s()}}catch{}}}catch{}const G=new ar(D,R,O);l.current=G;try{d(!0)}catch{}try{G.setCamera(R)}catch{}try{const e=null==loadEnvironmentSettings?void 0:loadEnvironmentSettings();e&&(e.toneMapping&&(G.updateEffectSettings("toneMapping",{...e.toneMapping}),G.setEffectEnabled("toneMapping",!1!==e.toneMapping.enabled)),(null==(u=e.postProcessing)?void 0:u.preset)&&(null==(f=G.applyPreset)||f.call(G,e.postProcessing.preset)))}catch{}try{N.setPostProcessingManager(G)}catch{}try{Dn.getState().setPostProcessingManager(G)}catch{}try{const e=Dn.getState(),t="fxaa"===e.rendererAA&&!(null==(I=e.safeMode)?void 0:I.enabled);G.setEffectEnabled("fxaa",!!t)}catch{}try{Dn.getState().estimateVRAMUsage()}catch{}e&&e(N),t&&t(G),null==(M=(j=N.objectSelector).setGizmoScene)||M.call(j,T);const U=new Rt(4210752,.6);U.userData.isSystemObject=!0,D.add(U);const H=new C(16777215,.8);H.position.set(50,50,50),H.castShadow=!0,H.shadow.mapSize.width=1024,H.shadow.mapSize.height=1024,H.userData.isSystemObject=!0,D.add(H);const K=new y(16755336,1,100);K.position.set(0,6,6),K.userData.isSystemObject=!0,D.add(K);const W=new He(2,2,2),V=new _({color:16711680}),Y=new q(W,V);Y.position.set(0,1,0),Y.castShadow=!0,Y.userData.name="Test Cube",Y.userData.id="test_cube",D.add(Y);const J=new We(.5,.5,3),Z=new _({color:9127187}),$=new q(J,Z);$.position.set(5,1.5,0),$.castShadow=!0,$.userData.name="Tree Trunk",$.userData.id="tree_trunk",D.add($);const ee=new Je(2),te=new _({color:2263842}),se=new q(ee,te);se.position.set(5,4,0),se.castShadow=!0,se.userData.name="Tree Leaves",se.userData.id="tree_leaves",D.add(se),h.current.set("test_cube",Y),h.current.set("tree_trunk",$),h.current.set("tree_leaves",se),N.addSelectableObject(Y),N.addSelectableObject($),N.addSelectableObject(se);let ie=!0;const ne=()=>{ie=!0};try{window.__requestRender=ne}catch{}const re=()=>{var e,t,s,i,n,r,c,A;const d=(()=>{try{return Dn.getState().renderMode||"continuous"}catch{return"continuous"}})();if(requestAnimationFrame(re),Y.rotation.y+=.005,a.current){a.current.updateSelectedOutlines();try{((null==(t=(e=a.current).getSelectedObjects)?void 0:t.call(e))||[]).forEach(e=>{var t,s,i,n,a;if((null==e?void 0:e.isLight)&&(null==(t=e.userData)?void 0:t.lightHelper)&&"function"==typeof e.userData.lightHelper.update)e.userData.lightHelper.update();else if((null==(s=null==e?void 0:e.userData)?void 0:s.isLightTarget)||(null==(i=null==e?void 0:e.userData)?void 0:i.ownerId))try{const t=e.userData.ownerId;let s=null;t&&(null==(n=h.current)?void 0:n.has(t))?s=h.current.get(t):D.traverse(t=>{!s&&(null==t?void 0:t.isLight)&&t.target===e&&(s=t)}),(null==(a=null==s?void 0:s.userData)?void 0:a.lightHelper)&&"function"==typeof s.userData.lightHelper.update&&s.userData.lightHelper.update()}catch{}})}catch{}}if(g.current){const e=g.current,t=m.current;if(t&&t.duration>0&&(t.t<1||e.material.opacity!==t.target)){const s=performance.now(),i=Math.min(1,(s-t.startTime)/t.duration);let n;switch(t.easing){case"linear":n=i;break;case"easeOutCubic":n=1-Math.pow(1-i,3);break;case"easeInCubic":n=Math.pow(i,3);break;default:n=i<.5?2*i*i:(4-2*i)*i-1}const a=t.start+(t.target-t.start)*n;e.material&&(e.material.opacity=Math.max(0,Math.min(1,a))),t.t=i,i>=1&&0===t.target&&e.visible&&(e.visible=!1)}}(()=>{var e,t;try{return null==(t=null==(e=o.current)?void 0:e.update)?void 0:t.call(e)}catch{return!1}})()&&(ie=!0);try{const e=performance.now(),t=p.current;t.lastT||(t.lastT=e),t.frames+=1;const s=e-t.lastT;if(s>=500&&(t.fps=Math.round(1e3*t.frames/s),t.frames=0,t.lastT=e),!t.lastPush||e-t.lastPush>=1e3){t.lastPush=e;let s=0,i=0,n=0;D.traverse(e=>{var t,a,r;if(e.visible&&!(null==(t=e.userData)?void 0:t.isSystemObject)&&!(null==(a=e.userData)?void 0:a.isSelectionOutline)&&(e.isGroup&&(s+=1),e.isMesh&&e.geometry)){s+=1;const t=e.geometry,a=null==(r=t.attributes)?void 0:r.position,o=t.index,l=a?a.count:0,c=o?Math.floor(o.count/3):a?Math.floor(a.count/3):0;i+=l,n+=c}}),t.obj=s,t.vert=i,t.tri=n;try{Dn.getState().setStats({fps:t.fps,objects:s,vertices:i,triangles:n})}catch{}}}catch{}if("on-demand"===d&&!ie)return;ie=!1,O.clear();const u=a.current?a.current.camera:R,b=Q.current&&!!l.current;try{D.traverse(e=>{var t,s,i;if((null==e?void 0:e.isLight)&&(null==(t=e.userData)?void 0:t.lightHelper)&&"function"==typeof e.userData.lightHelper.update){try{e.updateMatrixWorld(!0)}catch{}try{null==(i=null==(s=e.target)?void 0:s.updateMatrixWorld)||i.call(s,!0)}catch{}e.userData.lightHelper.update()}})}catch{}if(b){try{l.current.setCamera(u)}catch{}l.current.render()}else O.render(D,u);try{null==(n=null==(i=null==(s=a.current)?void 0:s.objectSelector)?void 0:i.forceHideGizmoLines)||n.call(i)}catch{}O.clearDepth(),O.render(T,u);try{null==(A=null==(c=null==(r=a.current)?void 0:r.objectSelector)?void 0:c.forceHideGizmoLines)||A.call(c)}catch{}};re();const oe=O.domElement,le=(e,t=220)=>{var s;const i=g.current;if(!i)return;const n=m.current;n.start=(null==(s=i.material)?void 0:s.opacity)??0;const{dropIndicator:a}=Dn.getState();n.target=Math.min(e,(null==a?void 0:a.maxOpacity)??.6),n.t=0,n.duration=t,n.easing=(null==a?void 0:a.easing)??"easeInOutQuad",n.maxOpacity=(null==a?void 0:a.maxOpacity)??.6,n.startTime=performance.now(),e>0&&(i.visible=!0)};oe.addEventListener("dragover",e=>{e.preventDefault();try{const t=oe.getBoundingClientRect(),s=new E;s.x=(e.clientX-t.left)/t.width*2-1,s.y=-(e.clientY-t.top)/t.height*2+1;const i=new qe,n=a.current?a.current.camera:R;i.setFromCamera(s,n);const r=[];D.traverse(e=>{e.isMesh&&e.visible&&r.push(e)});const o=i.intersectObjects(r,!0);if(o&&o.length>0){const e=o[0],t=e.point,s=e.face&&e.face.normal?e.face.normal.clone():new S(0,1,0);if(e.object&&e.object.isMesh&&e.object.normalMatrix&&s.applyMatrix3(e.object.normalMatrix).normalize(),g.current){const e=g.current;e.position.copy(t);const i=new S(0,1,0),n=(new ae).setFromUnitVectors(i,s.clone().normalize());e.quaternion.copy(n),e.visible=!0}else{const e=new Ot(.6,.75,48),i=new x({color:43775,transparent:!0,opacity:0,side:z}),n=new q(e,i);n.position.copy(t);const a=new S(0,1,0),r=(new ae).setFromUnitVectors(a,s.clone().normalize());n.quaternion.copy(r),n.userData.isSystemObject=!0,D.add(n),g.current=n}const i=n.position.distanceTo(t),a=Math.max(.5,Math.min(4,.06*i));g.current.scale.setScalar(a);const r=Dn.getState().dropIndicator;le((null==r?void 0:r.maxOpacity)??.6,(null==r?void 0:r.inMs)??200)}else{const e=new it(new S(0,1,0),0),t=new S;if(i.ray.intersectPlane(e,t)){if(g.current)g.current.position.copy(t),g.current.rotation.set(-Math.PI/2,0,0),g.current.visible=!0;else{const e=new Ot(.6,.75,48),s=new x({color:43775,transparent:!0,opacity:0,side:z}),i=new q(e,s);i.rotation.x=-Math.PI/2,i.position.copy(t),i.userData.isSystemObject=!0,D.add(i),g.current=i}const e=n.position.distanceTo(t),s=Math.max(.5,Math.min(4,.06*e));g.current.scale.setScalar(s);const i=Dn.getState().dropIndicator;le((null==i?void 0:i.maxOpacity)??.6,(null==i?void 0:i.inMs)??200)}}}catch{}}),oe.addEventListener("drop",e=>{var t,s;if(e.preventDefault(),g.current){const e=Dn.getState().dropIndicator;le(0,(null==e?void 0:e.outMs)??180)}try{const n=e.dataTransfer.getData("text/plain");if(n){const a=JSON.parse(n);if("start_position"===a.type||"directional_light"===a.type||"point_light"===a.type||"spot_light"===a.type||"ambient_light"===a.type||"audio_source"===a.type||"fog"===a.type||"skybox"===a.type||"post_process"===a.type||"camera_helper"===a.type||"grid_helper"===a.type||"axes_helper"===a.type){const i=oe.getBoundingClientRect(),n=new E;n.x=(e.clientX-i.left)/i.width*2-1,n.y=-(e.clientY-i.top)/i.height*2+1;const r=new qe;r.setFromCamera(n,R);const o=new it(new S(0,1,0),0),l=new S;let c;switch(r.ray.intersectPlane(o,l),a.type){case"start_position":c=null;break;case"directional_light":const e=new C(16777215,1);e.position.set(l.x+5,l.y+10,l.z+5),e.target.position.copy(l),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048;const t=new Nt(e,1);e.userData=e.userData||{},e.userData.lightHelper=t,D.add(t);try{t.update()}catch{}try{const t=new Je(.18,12,12),s=new x({color:6750156,transparent:!0,opacity:.95}),i=new q(t,s);i.name="DirectionalTargetHandle",i.userData.isSystemObject=!0,i.userData.isLightTargetHandle=!0,i.raycast=q.prototype.raycast,e.target.userData=e.target.userData||{},e.target.userData.isLightTarget=!0,e.target.add(i)}catch{}try{const t=new Je(.25,12,12),s=new x({color:16777062,transparent:!0,opacity:.9}),i=new q(t,s);i.name="DirectionalLightHandle",i.userData.isSystemObject=!0,i.userData.isLightHelper=!0,i.raycast=q.prototype.raycast,e.add(i)}catch{}c=e,D.add(e.target);try{N.addSelectableObject(e.target)}catch{}break;case"point_light":const s=new y(16777215,1,10,2);s.position.set(l.x,l.y+3,l.z),s.castShadow=!0;const i=new Pt(s,.5);s.userData=s.userData||{},s.userData.lightHelper=i,D.add(i);try{i.update()}catch{}try{const e=new Je(.2,12,12),t=new x({color:16777062,transparent:!0,opacity:.95}),i=new q(e,t);i.name="PointLightHandle",i.userData.isSystemObject=!0,i.userData.isLightHelper=!0,i.raycast=q.prototype.raycast,s.add(i)}catch{}c=s;break;case"spot_light":const n=new v(16777215,1,10,Math.PI/6,.1,2);n.position.set(l.x,l.y+5,l.z),n.target.position.copy(l),n.castShadow=!0;const a=new Ft(n);n.userData=n.userData||{},n.userData.lightHelper=a,D.add(a);try{a.update()}catch{}try{const e=new Je(.22,12,12),t=new x({color:16777062,transparent:!0,opacity:.9}),s=new q(e,t);s.name="SpotLightHandle",s.userData.isSystemObject=!0,s.userData.isLightHelper=!0,s.raycast=q.prototype.raycast,n.add(s)}catch{}c=n,D.add(n.target);try{const e=new Je(.18,12,12),t=new x({color:6750156,transparent:!0,opacity:.95}),s=new q(e,t);s.name="SpotTargetHandle",s.userData.isSystemObject=!0,s.userData.isLightTargetHandle=!0,s.raycast=q.prototype.raycast,n.target.userData=n.target.userData||{},n.target.userData.isLightTarget=!0,n.target.add(s)}catch{}try{N.addSelectableObject(n.target)}catch{}break;case"ambient_light":const r=new Rt(4210752,.3),o=new Je(.5,16,16),A=new x({color:4210752,wireframe:!0,transparent:!0,opacity:.5});c=new q(o,A),c.position.copy(l),D.add(r);break;case"audio_source":const d=new Je(.3,16,16),h=new _({color:16750848});c=new q(d,h),c.position.set(l.x,l.y+1,l.z);break;case"grid_helper":c=new st(10,10),c.position.copy(l);break;case"axes_helper":c=new Lt(2),c.position.copy(l);try{const e=new Je(.2,12,12),t=new x({color:6737151,transparent:!0,opacity:.9}),s=new q(e,t);s.name="AxesHelperHandle",s.userData.isSystemObject=!0,s.userData.isHelperHandle=!0,s.raycast=q.prototype.raycast,c.add(s)}catch{}break;default:const u=new He(.5,.5,.5),p=new _({color:8947848});c=new q(u,p),c.position.copy(l)}if(c){c.isMesh&&(c.castShadow=!0,c.receiveShadow=!0);const e=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;c.name=e,c.userData=Object.assign(c.userData||{},{id:e,name:a.name,type:a.type,originalData:a}),D.add(c),N.addSelectableObject(c),h.current.set(e,c);const i=Dn.getState().addObject,n=["directional_light","point_light","spot_light"].includes(a.type),r="directional_light"===a.type?"directional":"point_light"===a.type?"point":"spot_light"===a.type?"spot":void 0;i({id:e,name:a.name,type:n?"light":a.type,lightType:n?r:void 0,position:{x:c.position.x,y:c.position.y,z:c.position.z},rotation:{x:c.rotation.x,y:c.rotation.y,z:c.rotation.z},scale:{x:c.scale.x,y:c.scale.y,z:c.scale.z},visible:!0,userData:c.userData});try{if(c.isLight&&c.target&&c.target.isObject3D){c.target.userData=c.target.userData||{},c.target.userData.ownerId=e;const i=null==(s=null==(t=c.target.children)?void 0:t.find)?void 0:s.call(t,e=>{var t;return null==(t=e.userData)?void 0:t.isLightTargetHandle});i&&(i.userData.ownerId=e)}}catch{}B(e)}return}if("custom"===a.type||"library"===a.type){let t=function(){c.load(A,e=>{const t=e.scene;t.position.copy(l),t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});const s=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.name=s,t.userData={id:s,name:a.name,type:a.type,originalData:a,..."custom"===a.type?{customMeshId:a.id}:{}};try{t.traverse(e=>{e.userData=e.userData||{},e.userData.ownerId||(e.userData.ownerId=s)})}catch{}D.add(t),N.addSelectableObject(t),h.current.set(s,t);(0,Dn.getState().addObject)({id:s,name:a.name,type:"glb",..."custom"===a.type?{customMeshId:a.id}:{url:a.glbUrl},position:{x:l.x,y:l.y,z:l.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:t.userData}),B(s),"custom"===a.type&&URL.revokeObjectURL(A)},void 0,e=>{"custom"===a.type&&URL.revokeObjectURL(A)})};const s=oe.getBoundingClientRect(),n=new E;n.x=(e.clientX-s.left)/s.width*2-1,n.y=-(e.clientY-s.top)/s.height*2+1;const r=new qe;r.setFromCamera(n,R);const o=new it(new S(0,1,0),0),l=new S;r.ray.intersectPlane(o,l);const c=ki();let A,d=null;if("custom"===a.type)try{const e=io(),s=s=>{d=s,A=e.createBlobURL(d),t()},i=e=>{};return!a.glbData&&a.id?void e.getCustomMeshes().then(e=>{const t=e.find(e=>e.id===a.id);if(!t)throw new Error("NOT_FOUND");s(t.glbData)}).catch(i):void s(a.glbData)}catch(i){return}else if("library"===a.type)return A=a.glbUrl,void t();return}const r=oe.getBoundingClientRect(),o=new E;o.x=(e.clientX-r.left)/r.width*2-1,o.y=-(e.clientY-r.top)/r.height*2+1;const l=new qe;l.setFromCamera(o,R);const c=new it(new S(0,1,0),0),A=new S;l.ray.intersectPlane(c,A);const d=new _({color:5025616,roughness:.3,metalness:.1});let u,p;switch(a.geometry){case"BoxGeometry":u=new He(...a.params);break;case"SphereGeometry":u=new Je(...a.params);break;case"CylinderGeometry":u=new We(...a.params);break;case"ConeGeometry":u=new Gt(...a.params);break;case"PlaneGeometry":u=new Ze(...a.params);break;case"TorusGeometry":u=new Xe(...a.params);break;case"CustomGeometry":if(a.glbData)try{const e=io().createBlobURL(a.glbData);return void ki().load(e,t=>{const s=t.scene;s.position.copy(A);const i=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;s.name=i,s.userData={id:i,name:a.name,type:a.type||"custom",originalName:a.name},s.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),D.add(s),N.addSelectableObject(s),h.current.set(i,s);(0,Dn.getState().addObject)({id:i,name:a.name,type:"mesh",position:{x:A.x,y:A.y,z:A.z},rotation:{x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:s.userData}),B(i),URL.revokeObjectURL(e)},void 0,t=>{URL.revokeObjectURL(e)})}catch(i){return}else u=a.originalObject&&a.originalObject.geometry?a.originalObject.geometry.clone():new He(1,1,1);break;case"LibraryMesh":if(a.glbUrl){return void ki().load(a.glbUrl,e=>{const t=e.scene;t.position.copy(A);const s=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.name=s,t.userData={id:s,name:a.name,type:a.type||"library",originalName:a.name},t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),D.add(t),N.addSelectableObject(t),h.current.set(s,t);(0,Dn.getState().addObject)({id:s,name:a.name,type:"mesh",position:{x:A.x,y:A.y,z:A.z},rotation:{x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:t.userData}),B(s)},void 0,e=>{})}u=new He(1,1,1);break;default:u=new He(1,1,1)}p=new q(u,d),p.position.copy(A),"PlaneGeometry"===a.geometry&&(p.rotation.x=-Math.PI/2),p.castShadow=!0,p.receiveShadow=!0;const g=`${a.name}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;p.name=g,p.userData={id:g,name:a.name,type:a.type||"basic",originalName:a.name,geometry:a.geometry,params:a.params,ownerId:g},D.add(p),N.addSelectableObject(p),h.current.set(g,p);(0,Dn.getState().addObject)({id:g,name:a.name,type:"basic",geometry:a.geometry,params:a.params,position:{x:A.x,y:A.y,z:A.z},rotation:{x:p.rotation.x,y:p.rotation.y,z:p.rotation.z},scale:{x:1,y:1,z:1},visible:!0,userData:p.userData}),B(g)}}catch(i){}}),oe.addEventListener("dragleave",()=>{if(g.current){const e=Dn.getState().dropIndicator;le(0,(null==e?void 0:e.outMs)??220)}});const ce=["mousedown","mouseup","mousemove","wheel","keydown","keyup","resize"],Ae=()=>{var e;try{"on-demand"===(Dn.getState().renderMode||"continuous")&&(null==(e=window.__requestRender)||e.call(window))}catch{}};ce.forEach(e=>window.addEventListener(e,Ae,{passive:!0})),oe.addEventListener("dragover",Ae,{passive:!0}),oe.addEventListener("drop",Ae,{passive:!0});const de=()=>{var e;try{const t=Dn.getState(),s=(null==(e=t.safeMode)?void 0:e.enabled)?t.safeMode.pixelRatio||1:Math.min(2,window.devicePixelRatio||1);O.setPixelRatio(s)}catch{}a.current?a.current.onWindowResize():(R.aspect=window.innerWidth/window.innerHeight,R.updateProjectionMatrix(),O.setPixelRatio(Math.min(2,window.devicePixelRatio||1)),O.setSize(window.innerWidth,window.innerHeight)),l.current&&l.current.handleResize(window.innerWidth,window.innerHeight);try{Dn.getState().estimateVRAMUsage()}catch{}};return window.addEventListener("resize",de),()=>{try{ce.forEach(e=>window.removeEventListener(e,Ae))}catch{}try{oe.removeEventListener("dragover",Ae),oe.removeEventListener("drop",Ae)}catch{}if(window.removeEventListener("resize",de),O.domElement&&(O.domElement.removeEventListener("contextmenu",P),O.domElement.removeEventListener("webglcontextlost",L),O.domElement.removeEventListener("webglcontextrestored",F)),a.current&&a.current.dispose(),o.current)try{o.current.dispose()}catch{}l.current&&l.current.dispose(),n.current&&O.domElement&&n.current.removeChild(O.domElement),O.dispose()}},[w]),r.useEffect(()=>{var e;if(!A)return;if(!c.current||!a.current)return;const t=c.current,s=ki();f.forEach(e=>{var i,n,r,o,l,c,A,d,p,g,m,b,f;if(!h.current.has(e.id))if("glb"===e.type&&(e.file||e.url)){if(u.current.has(e.id)||h.current.has(e.id))return;u.current.add(e.id);const i=e.file||e.url;s.load(i,s=>{var i,n,r,o,l,c,A,d,p,g,m,b;if(h.current.has(e.id)){try{u.current.delete(e.id)}catch{}return}const f=s.scene,v=(new fe).setFromObject(f);v.getSize(new S),v.getCenter(new S),f.position.set(e.position.x,e.position.y,e.position.z),f.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),f.scale.set(e.scale.x,e.scale.y,e.scale.z),f.name=e.name,f.userData={...f.userData||{},id:e.id,type:e.type,customMeshId:e.customMeshId||(null==(i=e.userData)?void 0:i.customMeshId)||(null==(r=null==(n=e.userData)?void 0:n.originalData)?void 0:r.id),originalData:(null==(o=e.userData)?void 0:o.originalData)||(e.customMeshId?{id:e.customMeshId}:void 0)};try{f.traverse(t=>{t.userData||(t.userData={}),t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}f.visible=!1!==e.visible,f.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});try{const e=!!Dn.getState().isWireframe;f.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material.forEach(t=>t.wireframe=e):t.material.wireframe=e)})}catch{}t.add(f),a.current.addSelectableObject(f),h.current.set(e.id,f);try{u.current.delete(e.id)}catch{}B(e.id);try{null==(c=(l=a.current).updateWireframe)||c.call(l)}catch{}try{null==(d=(A=a.current).updateGridSnap)||d.call(A)}catch{}try{null==(g=(p=a.current).updateGizmoSpace)||g.call(p)}catch{}try{null==(b=null==(m=a.current.objectSelector)?void 0:m.updateGizmoSize)||b.call(m)}catch{}a.current.selectObject(f)},void 0,s=>{const i=new He(1,1,1),n=new _t({color:16739179,transparent:!0,opacity:.7}),r=new q(i,n);r.position.set(e.position.x,e.position.y,e.position.z),r.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),r.scale.set(e.scale.x,e.scale.y,e.scale.z),r.name=`${e.name} (로딩실패)`,r.userData={id:e.id,type:e.type,loadError:!0},r.castShadow=!0,r.receiveShadow=!0,r.visible=!1!==e.visible,t.add(r),a.current.addSelectableObject(r),h.current.set(e.id,r);try{u.current.delete(e.id)}catch{}B(e.id),a.current.selectObject(r)})}else if("glb"===e.type&&(e.customMeshId||(null==(i=e.userData)?void 0:i.customMeshId)||(null==(r=null==(n=e.userData)?void 0:n.originalData)?void 0:r.id)||e.glbData)){const i=io();if(u.current.has(e.id)||h.current.has(e.id))return;u.current.add(e.id);const n=e.customMeshId||(null==(o=e.userData)?void 0:o.customMeshId)||(null==(c=null==(l=e.userData)?void 0:l.originalData)?void 0:c.id),r=e=>!!e&&(e instanceof ArrayBuffer||(e instanceof Uint8Array||(!!Array.isArray(e)||!("object"!=typeof e||"Buffer"!==e.type||!Array.isArray(e.data))))),A=i=>{s.load(i,s=>{var n,r,o,l;if(h.current.has(e.id)){try{URL.revokeObjectURL(i)}catch{}try{u.current.delete(e.id)}catch{}return}const c=s.scene,A=(new fe).setFromObject(c);A.getSize(new S),A.getCenter(new S),c.position.set(e.position.x,e.position.y,e.position.z),c.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),c.scale.set(e.scale.x,e.scale.y,e.scale.z),c.name=e.name,c.userData={...c.userData||{},id:e.id,type:e.type,customMeshId:e.customMeshId||(null==(n=e.userData)?void 0:n.customMeshId)||(null==(o=null==(r=e.userData)?void 0:r.originalData)?void 0:o.id),originalData:(null==(l=e.userData)?void 0:l.originalData)||(e.customMeshId?{id:e.customMeshId}:void 0)};try{c.traverse(t=>{t.userData||(t.userData={}),t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}c.visible=!1!==e.visible,c.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),t.add(c),a.current.addSelectableObject(c),h.current.set(e.id,c),B(e.id),a.current.selectObject(c);try{URL.revokeObjectURL(i)}catch{}try{u.current.delete(e.id)}catch{}},void 0,()=>{try{URL.revokeObjectURL(i)}catch{}try{u.current.delete(e.id)}catch{}})};if(n)i.getCustomMeshes().then(e=>{const t=(e||[]).find(e=>e.id===n);if(!t||!t.glbData)throw new Error("CUSTOM_MESH_NOT_FOUND");const s=i.createBlobURL(t.glbData);A(s)}).catch(t=>{try{u.current.delete(e.id)}catch{}});else if(e.glbData&&r(e.glbData))try{const t=i.createBlobURL(e.glbData);A(t)}catch(I){try{u.current.delete(e.id)}catch{}}else try{u.current.delete(e.id)}catch{}}else if("light"===e.type||["directional_light","point_light","spot_light","ambient_light","grid_helper","axes_helper","audio_source"].includes(e.type)){let s=null;switch("light"===e.type?e.lightType:"directional_light"===e.type?"directional":"point_light"===e.type?"point":"spot_light"===e.type?"spot":e.type){case"directional":{const i=new C(16777215,e.intensity??1);i.position.set(e.position.x,e.position.y,e.position.z);const n=((null==(A=e.position)?void 0:A.y)??0)-1;i.target.position.set(e.position.x,n,e.position.z),i.castShadow=!!e.castShadow,t.add(i.target),s=i;try{a.current.addSelectableObject(i.target)}catch{}try{const e=new Nt(i,1);i.userData=i.userData||{},i.userData.lightHelper=e,t.add(e),null==(d=e.update)||d.call(e)}catch{}break}case"point":{const i=new y(16777215,e.intensity??1,e.distance??10,e.decay??2);i.position.set(e.position.x,e.position.y,e.position.z),i.castShadow=!!e.castShadow,s=i;try{const e=new Pt(i,.5);i.userData=i.userData||{},i.userData.lightHelper=e,t.add(e),null==(p=e.update)||p.call(e)}catch{}break}case"spot":{const i=new v(16777215,e.intensity??1,e.distance??10,e.angle??Math.PI/6,e.penumbra??.1,e.decay??2);i.position.set(e.position.x,e.position.y,e.position.z);const n=((null==(g=e.position)?void 0:g.y)??0)-1;i.target.position.set(e.position.x,n,e.position.z),i.castShadow=!!e.castShadow,t.add(i.target),s=i;try{a.current.addSelectableObject(i.target)}catch{}try{const e=new Ft(i);i.userData=i.userData||{},i.userData.lightHelper=e,t.add(e),null==(m=e.update)||m.call(e)}catch{}break}case"ambient_light":{const i=new Rt(e.color??4210752,e.intensity??.3);t.add(i);const n=new q(new Je(.5,16,16),new x({color:4210752,wireframe:!0,transparent:!0,opacity:.5}));n.position.set(e.position.x,e.position.y,e.position.z),s=n;break}case"grid_helper":{const t=new st(10,10);t.position.set(e.position.x,e.position.y,e.position.z),s=t;break}case"axes_helper":{const t=new Lt(2);t.position.set(e.position.x,e.position.y,e.position.z),s=t;break}case"audio_source":{const t=new q(new Je(.3,16,16),new _({color:16750848}));t.position.set(e.position.x,e.position.y,e.position.z),s=t;break}}if(s){s.name=e.name,s.userData={...s.userData||{},id:e.id,type:e.type};try{null==(b=s.traverse)||b.call(s,t=>{t.userData=t.userData||{},t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}s.visible=!1!==e.visible,t.add(s);try{a.current.addSelectableObject(s)}catch{}h.current.set(e.id,s),B(e.id);try{a.current.selectObject(s)}catch{}}}else if("cube"===e.type){const s=new He(e.size.x,e.size.y,e.size.z),i=new _t({color:e.material.color}),n=new q(s,i);n.position.set(e.position.x,e.position.y,e.position.z),n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),n.name=e.name,n.userData={id:e.id,type:e.type};try{null==(f=n.traverse)||f.call(n,t=>{t.userData=t.userData||{},t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}n.castShadow=!0,n.receiveShadow=!0,t.add(n),a.current.addSelectableObject(n),h.current.set(e.id,n),B(e.id),a.current.selectObject(n)}else if("basic"===e.type||e.geometry&&e.params){const s=new _({color:5025616,roughness:.3,metalness:.1});let i;switch(e.geometry){case"BoxGeometry":i=new He(...e.params);break;case"SphereGeometry":i=new Je(...e.params);break;case"CylinderGeometry":i=new We(...e.params);break;case"ConeGeometry":i=new Gt(...e.params);break;case"PlaneGeometry":i=new Ze(...e.params);break;case"TorusGeometry":i=new Xe(...e.params);break;default:i=new He(1,1,1)}const n=new q(i,s);n.position.set(e.position.x,e.position.y,e.position.z),n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),n.scale.set(e.scale.x,e.scale.y,e.scale.z),n.name=e.name,n.userData={id:e.id,type:e.type};try{n.traverse(t=>{t.userData=t.userData||{},t.userData.ownerId||(t.userData.ownerId=e.id)})}catch{}n.castShadow=!0,n.receiveShadow=!0,n.visible=!1!==e.visible,"PlaneGeometry"===e.geometry&&(n.rotation.x=-Math.PI/2),t.add(n),a.current.addSelectableObject(n),h.current.set(e.id,n),B(e.id),a.current.selectObject(n)}});const i=new Set(f.map(e=>e.id));for(const[n,r]of h.current)if(!i.has(n)){if(null==(e=r.userData)?void 0:e.isSystemObject)continue;t.remove(r),a.current.removeSelectableObject(r),h.current.delete(n)}try{const e=[],s=e=>{var s,n;let a=e;for(;a&&a!==t;){const e=null==(s=a.userData)?void 0:s.id,t=null==(n=a.userData)?void 0:n.ownerId;if(e&&i.has(e)||t&&i.has(t))return!0;a=a.parent}return!1};t.traverse(i=>{var n,a;if(!i||i===t)return;if(null==(n=i.userData)?void 0:n.isSystemObject)return;if(null==(a=i.userData)?void 0:a.isSelectionOutline)return;const r=(i.name||"").toLowerCase();r.includes("transformcontrols")||r.includes("gizmo")||r.includes("helper")||s(i)||e.push(i)}),e.forEach(e=>{var s,i;try{null==(i=null==(s=a.current)?void 0:s.removeSelectableObject)||i.call(s,e)}catch{}try{e.parent?e.parent.remove(e):t.remove(e)}catch{}})}catch{}},[f,B,A]),r.useEffect(()=>{c.current&&(f.forEach(e=>{const t=h.current.get(e.id);t&&(t.visible=!1!==e.visible)}),I.forEach(e=>{const t=h.current.get(e.id);t&&(t.visible=!1!==e.visible)}))},[f,I]),i.jsx("div",{ref:n,style:{width:"100%",height:"100vh",position:"relative"}})}function ao(e,t,s=!0){if(!e||!e.isObject3D)return!1;if(t&&!t.isObject3D)return!1;if(e===t)return!1;if(t&&function(e,t){if(!(e&&t&&e.isObject3D&&t.isObject3D))return!1;let s=t.parent;for(;s;){if(s===e)return!0;s=s.parent}return!1}(e,t))return!1;let i=null;if(s&&(e.updateMatrixWorld(!0),i=e.matrixWorld.clone()),e.parent)try{e.parent.remove(e)}catch{}if(t)try{t.add(e)}catch{}if(s&&i){const t=e.parent&&e.parent.matrixWorld?e.parent.matrixWorld:new B,s=(new B).copy(t).invert(),n=(new B).copy(s).multiply(i),a=new S,r=new ae,o=new S;n.decompose(a,r,o),e.position.copy(a),e.quaternion.copy(r),e.scale.copy(o),e.updateMatrix(),e.updateMatrixWorld(!0)}return!0}class ro{constructor(e){this.editorControls=e,this.selectedObject=null,this.threeObject=null,this.changeCallbacks=[]}onPropertyChange(e){this.changeCallbacks.push(e)}notifyPropertyChange(e,t,s){this.changeCallbacks.forEach(i=>{i({type:e,property:t,value:s,object:this.selectedObject})})}setSelectedObject(e){if(this.selectedObject=e,this.threeObject=null,e)if(e.isObject3D||e.isMesh||e.isLight||e.isCamera)this.threeObject=e;else if(this.editorControls){const t=e.id||e;this.threeObject=this.editorControls.findObjectById(t),!this.threeObject&&this.editorControls.selectedObjects&&this.editorControls.selectedObjects.length>0&&(this.threeObject=this.editorControls.selectedObjects[0])}}getObjectType(){return this.threeObject?this.threeObject.isLight?"light":this.threeObject.isCamera?"camera":this.threeObject.isHelper?"helper":this.threeObject.isMesh?"mesh":this.threeObject.isGroup?"group":"mesh":"unknown"}setTransformProperty(e,t,s){if(!this.threeObject)return!1;const i=parseFloat(s);if(isNaN(i))return!1;switch(e){case"position":this.threeObject.position[t]=i;break;case"rotation":this.threeObject.rotation[t]=i*Math.PI/180;break;case"scale":this.threeObject.scale[t]=i}return this.notifyPropertyChange("transform",e,{[t]:i}),!0}getTransformProperty(e,t){return this.threeObject?"rotation"===e?(180*this.threeObject[e][t]/Math.PI).toFixed(1):this.threeObject[e][t].toFixed(2):0}setLightProperty(e,t){if(!this.threeObject||!this.threeObject.isLight)return!1;switch(e){case"color":this.threeObject.color.setHex(t.replace("#","0x"));break;case"intensity":this.threeObject.intensity=parseFloat(t);break;case"distance":void 0!==this.threeObject.distance&&(this.threeObject.distance=parseFloat(t));break;case"angle":void 0!==this.threeObject.angle&&(this.threeObject.angle=parseFloat(t));break;case"penumbra":void 0!==this.threeObject.penumbra&&(this.threeObject.penumbra=parseFloat(t));break;case"decay":void 0!==this.threeObject.decay&&(this.threeObject.decay=parseFloat(t))}return this.notifyPropertyChange("light",e,t),!0}getLightProperty(e){if(!this.threeObject||!this.threeObject.isLight)return null;switch(e){case"type":return this.threeObject.type;case"color":return"#"+this.threeObject.color.getHexString();case"intensity":return this.threeObject.intensity;case"distance":return this.threeObject.distance||0;case"angle":return this.threeObject.angle||0;case"penumbra":return this.threeObject.penumbra||0;case"decay":return this.threeObject.decay||1;default:return null}}setCameraProperty(e,t){if(!this.threeObject||!this.threeObject.isCamera)return!1;switch(e){case"fov":this.threeObject.isPerspectiveCamera&&(this.threeObject.fov=parseFloat(t),this.threeObject.updateProjectionMatrix());break;case"near":this.threeObject.near=parseFloat(t),this.threeObject.updateProjectionMatrix();break;case"far":this.threeObject.far=parseFloat(t),this.threeObject.updateProjectionMatrix()}return this.notifyPropertyChange("camera",e,t),!0}getCameraProperty(e){if(!this.threeObject||!this.threeObject.isCamera)return null;switch(e){case"type":return this.threeObject.type;case"fov":return this.threeObject.fov||75;case"near":return this.threeObject.near||.1;case"far":return this.threeObject.far||1e3;default:return null}}setMaterialProperty(e,t){if(!this.threeObject||!this.threeObject.isMesh)return!1;const s=this.threeObject.material;if(!s)return!1;switch(e){case"color":s.color&&s.color.setHex(t.replace("#","0x"));break;case"metalness":void 0!==s.metalness&&(s.metalness=parseFloat(t));break;case"roughness":void 0!==s.roughness&&(s.roughness=parseFloat(t));break;case"emissive":s.emissive&&s.emissive.setHex(t.replace("#","0x"));break;case"emissiveIntensity":void 0!==s.emissiveIntensity&&(s.emissiveIntensity=parseFloat(t));break;case"opacity":s.opacity=parseFloat(t),s.transparent=s.opacity<1}return s.needsUpdate=!0,this.notifyPropertyChange("material",e,t),!0}getMaterialProperty(e){if(!this.threeObject||!this.threeObject.isMesh)return null;const t=this.threeObject.material;if(!t)return null;switch(e){case"color":return t.color?"#"+t.color.getHexString():"#ffffff";case"metalness":return t.metalness||0;case"roughness":return t.roughness||.8;case"emissive":return t.emissive?"#"+t.emissive.getHexString():"#000000";case"emissiveIntensity":return t.emissiveIntensity||0;case"opacity":return t.opacity||1;default:return null}}getObjectInfo(){var e;if(!this.threeObject)return null;return{name:this.threeObject.name||"Unnamed Object",type:this.getObjectType(),id:(null==(e=this.threeObject.userData)?void 0:e.id)||this.threeObject.id,position:{x:this.getTransformProperty("position","x"),y:this.getTransformProperty("position","y"),z:this.getTransformProperty("position","z")},rotation:{x:this.getTransformProperty("rotation","x"),y:this.getTransformProperty("rotation","y"),z:this.getTransformProperty("rotation","z")},scale:{x:this.getTransformProperty("scale","x"),y:this.getTransformProperty("scale","y"),z:this.getTransformProperty("scale","z")}}}dispose(){this.selectedObject=null,this.threeObject=null,this.editorControls=null,this.changeCallbacks=[]}}function oo({objects:e,selectedIds:t=[],selectedObjectId:s,dragUseSelectionForDnD:n=!1,onSelect:a,onReparent:o,onReorder:l,onBatchStart:c,onBatchEnd:A,onToggleVisibility:d,onToggleFreeze:h}){const u=r.useRef({draggingId:null}),[p,g]=r.useState(null),[m,b]=r.useState(null),[f,v]=r.useState(()=>new Set),y=r.useMemo(()=>new Map((e||[]).map(e=>[e.id,e])),[e]),C=r.useMemo(()=>{const t=new Map;(e||[]).forEach(e=>{const s=e.parentId??null;t.has(s)||t.set(s,[]),t.get(s).push(e)});for(const e of t.values())e.sort((e,t)=>(e.order??0)-(t.order??0));return t},[e]),x=C.get(null)||[],I=r.useMemo(()=>{try{const e=Array.isArray(t)?t.slice():[];return null!=s&&e.push(s),new Set(e.map(e=>String(e)))}catch{return new Set}},[t,s]),w=r.useCallback((e,t)=>{if(null==e||null==t)return!1;let s=y.get(t);const i=new Set;for(;s&&!i.has(s.id);){if(i.add(s.id),s.id===e)return!0;const t=s.parentId??null;s=null!=t?y.get(t):null}return!1},[y]),E=(e,t)=>{u.current.draggingId=t;const s=I,i=String(t);let a=(n||s.has(i))&&s.size>0?Array.from(s):[i];const r=new Set(a);a=a.filter(e=>!(e=>{let t=y.get(e);const s=new Set;for(;t&&!s.has(t.id);){s.add(t.id);const e=t.parentId??null;if(null==e)return!1;if(r.has(e))return!0;t=y.get(e)}return!1})(e));try{const t=JSON.stringify({ids:a});e.dataTransfer.setData("application/json",t),e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="move"}catch{}},B=(t,s)=>{t.preventDefault();let i=null;try{const e=t.dataTransfer.getData("application/json")||t.dataTransfer.getData("text/plain")||"";e&&(i=JSON.parse(e))}catch{}const n=Array.isArray(null==i?void 0:i.ids)&&i.ids.length?i.ids:u.current.draggingId?[u.current.draggingId]:[];if(g(null),b(null),!n.length)return;const r=y.get(s);if(!r)return;const d=m||"inside";if("inside"===d)n.length>1&&(null==c||c()),n.forEach(e=>{e!==s&&(w(e,s)||null==o||o(e,s))}),n.length>1&&(null==A||A());else{const t=r.parentId??null;n.length>1&&(null==c||c());const i=n.filter(e=>{if(e===s)return!1;return null==t||!w(e,t)});i.forEach(e=>null==o?void 0:o(e,t)),i.length&&((t,s,i,n)=>{const a=(e||[]).filter(e=>(e.parentId??null)===(t??null)),r=new Set(s),o=a.map(e=>e.id).filter(e=>!r.has(e)),c=o.indexOf(i),A="above"===n?Math.max(0,c):Math.min(o.length,c+1),d=[...o.slice(0,A),...s,...o.slice(A)];null==l||l(t??null,d)})(t,i,s,d),n.length>1&&(null==A||A())}const h=n[0];null!=h&&(null==a||a(h))},S=(e,t=0)=>{const s=I.has(String(e.id)),n=C.get(e.id)||[],r=f.has(e.id),l=p===e.id,c=l?m||"inside":null,A=12*Math.max(0,t),u=!1!==e.visible,y=!0===e.frozen,x="camera"===e.type?"📷":"light"===e.type?"💡":"🔶";return i.jsxs("div",{className:"tree-node "+(s?"selected":""),draggable:!0,onDragStart:t=>E(t,e.id),onDragOver:t=>((e,t)=>{e.preventDefault(),g(t??null);try{const t=e.currentTarget.getBoundingClientRect(),s=e.clientY-t.top,i=t.height||1;b(s<.25*i?"above":s>.75*i?"below":"inside")}catch{b("inside")}e.dataTransfer.dropEffect="move"})(t,e.id),onDragLeave:t=>{return s=e.id,g(e=>e===s?null:e),void b(e=>p===s?null:e);var s},onDrop:t=>B(t,e.id),onClick:()=>null==a?void 0:a(e.id),style:{margin:"2px 0",borderRadius:3,background:s?"#ff8c00":l&&"inside"===c?"#2d2d2d":"transparent",outline:s?"2px solid #ff6600":"none",borderLeft:s?"3px solid #ff6600":"3px solid transparent",borderTop:l&&"above"===c?"2px solid #00b894":void 0,borderBottom:l&&"below"===c?"2px solid #00b894":void 0,boxShadow:s?"0 0 8px rgba(255,140,0,0.6)":"none",paddingLeft:8+A,transition:"all .15s ease"},children:[i.jsxs("div",{className:"tree-row",style:{display:"flex",alignItems:"center",gap:6,padding:"4px 6px"},children:[i.jsx("button",{title:r?"펼치기":"접기",onClick:t=>{var s;t.stopPropagation(),s=e.id,v(e=>{const t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},style:{width:16,height:20,background:"none",border:"none",color:"#aaa",cursor:"pointer"},children:n.length>0?r?"▸":"▾":"·"}),i.jsx("span",{className:"tree-type",style:{opacity:.8},children:x}),i.jsx("span",{className:"tree-name",style:{color:s?"#fff":"#ccc",fontWeight:s?"bold":"normal",userSelect:"none",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),i.jsxs("div",{className:"tree-actions",style:{display:"flex",alignItems:"center",gap:4},children:[null!=e.parentId&&i.jsx("button",{className:"icon-btn unparent",title:"부모 해제 (루트로 이동)",onClick:t=>{t.stopPropagation(),null==o||o(e.id,null)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:"#ddd"},children:"⏏"}),i.jsx("button",{className:"icon-btn eye "+(u?"on":"off"),title:u?"숨기기":"보이기",onClick:t=>{t.stopPropagation(),null==d||d(e)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:u?"#ddd":"#666"},children:u?"👁":"🙈"}),i.jsx("button",{className:"icon-btn lock "+(y?"on":"off"),title:y?"잠금 해제":"잠금",onClick:t=>{t.stopPropagation(),null==h||h(e)},style:{width:22,height:20,background:"none",border:"none",cursor:"pointer",color:y?"#ddd":"#666"},children:y?"🔒":"🔓"})]})]}),n.length>0&&!r&&i.jsx("div",{className:"tree-children",children:n.map(e=>S(e,t+1))})]},e.id)};return i.jsxs("div",{className:"scene-hierarchy-panel",children:[i.jsx("div",{className:"panel-header",children:i.jsx("h3",{children:"계층"})}),i.jsx("div",{className:"panel-content",children:(x||[]).map(e=>S(e,0))})]})}const lo=r.memo(function({objects:e,walls:t,selectedIds:s,setSelectedIds:n,setParent:a,reorderSiblings:o,selectedObject:l,onObjectVisibilityToggle:c,onObjectFreezeToggle:A,onObjectSelect:d,onObjectRemove:h,onObjectFocus:u,onObjectRename:p,onContextMenu:g,editorControls:m,postProcessingManager:b,onObjectUpdate:f,onClose:v}){var y,C,x,I,w;const E=()=>{const e=Dn(e=>e.stats);return i.jsx("div",{style:{marginTop:10,padding:"10px 12px",background:"rgba(255,255,255,0.04)",borderRadius:6,fontSize:13,lineHeight:1.6},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"6px 12px"},children:[i.jsx("div",{children:"FPS"}),i.jsx("div",{children:(null==e?void 0:e.fps)??0}),i.jsx("div",{children:"오브젝트"}),i.jsx("div",{children:(null==e?void 0:e.objects)??0}),i.jsx("div",{children:"버텍스"}),i.jsx("div",{children:(null==e?void 0:e.vertices)??0}),i.jsx("div",{children:"폴리곤(트라이)"}),i.jsx("div",{children:(null==e?void 0:e.triangles)??0})]})})},B=Dn(e=>e.viewReady),S=Dn(e=>e.uiReady),Q=Dn(e=>e.envReady),[j,M]=r.useState({transform:!1,object:!1,material:!1,light:!1,camera:!1,part:!1}),[D,T]=r.useState(null),[R,k]=r.useState(0),O=r.useRef(null),L=r.useRef(0),F=r.useRef(0),P=r.useRef(!1);r.useEffect(()=>{const e=new ro(m);return e.onPropertyChange(e=>{try{f&&f(e)}catch{}const t=Date.now();t-(L.current||0)>=50&&(L.current=t,k(e=>e+1))}),T(e),()=>{e.dispose()}},[m,f]),r.useEffect(()=>{var e;if(!D)return;const t=l||((null==(e=null==m?void 0:m.selectedObjects)?void 0:e[0])??null);D.setSelectedObject(t),k(e=>e+1)},[D,l,m]),r.useEffect(()=>{var e,t,s,i,n;if(!l||!D||!m)return;const a=1e-4,r=()=>{const e=D.threeObject;return e?{p:[e.position.x,e.position.y,e.position.z],r:[e.rotation.x,e.rotation.y,e.rotation.z],s:[e.scale.x,e.scale.y,e.scale.z]}:null},o=()=>{try{F.current&&cancelAnimationFrame(F.current)}catch{}O.current=r(),k(e=>e+1);const e=()=>{if(!P.current)return void(F.current=0);const t=r(),s=Date.now();t&&((e,t)=>{if(!e||!t)return!0;for(let s=0;s<3;s++){if(Math.abs(e.p[s]-t.p[s])>a)return!0;if(Math.abs(e.r[s]-t.r[s])>a)return!0;if(Math.abs(e.s[s]-t.s[s])>a)return!0}return!1})(t,O.current)&&s-(L.current||0)>=80&&(O.current=t,L.current=s,k(e=>e+1)),F.current=requestAnimationFrame(e)};F.current=requestAnimationFrame(e)},c=null==(e=null==m?void 0:m.objectSelector)?void 0:e.transformControls,A=null==m?void 0:m._partTransformControls,d=e=>{P.current=!!(null==e?void 0:e.value),P.current?o():(F.current&&cancelAnimationFrame(F.current),F.current=0,k(e=>e+1))},h=()=>{P.current||(()=>{const e=Date.now();e-(L.current||0)>=100&&(L.current=e,k(e=>e+1))})()};return null==(t=null==c?void 0:c.addEventListener)||t.call(c,"dragging-changed",d),null==(s=null==c?void 0:c.addEventListener)||s.call(c,"objectChange",h),null==(i=null==A?void 0:A.addEventListener)||i.call(A,"dragging-changed",d),null==(n=null==A?void 0:A.addEventListener)||n.call(A,"objectChange",h),()=>{var e,t,s,i;try{null==(e=null==c?void 0:c.removeEventListener)||e.call(c,"dragging-changed",d)}catch{}try{null==(t=null==c?void 0:c.removeEventListener)||t.call(c,"objectChange",h)}catch{}try{null==(s=null==A?void 0:A.removeEventListener)||s.call(A,"dragging-changed",d)}catch{}try{null==(i=null==A?void 0:A.removeEventListener)||i.call(A,"objectChange",h)}catch{}F.current&&cancelAnimationFrame(F.current),F.current=0,P.current=!1}},[l,D,m]);const N=(null==D?void 0:D.getObjectType())||"unknown",G=null==D?void 0:D.getObjectInfo(),_=r.useRef(null);r.useEffect(()=>{var e,t;if(!D)return;const s=!(!(null==m?void 0:m._gizmoPointerDown)&&!(null==(t=null==(e=null==m?void 0:m.objectSelector)?void 0:e.transformControls)?void 0:t.dragging));if(D.getObjectInfo())_.current=D.threeObject||_.current;else if(s&&_.current){try{D.setSelectedObject(_.current)}catch{}k(e=>e+1)}},[D,m]);const z=(null==(y=null==m?void 0:m.getSelectedPartInfo)?void 0:y.call(m))||null,U=e=>M(t=>({...t,[e]:!t[e]}));return i.jsxs("div",{className:"inspector-panel",children:[i.jsxs("div",{className:"inspector-header",children:[i.jsx("h3",{children:"인스펙터"}),i.jsx("button",{className:"close-btn",onClick:v,children:"×"})]}),i.jsxs("div",{className:"inspector-content",children:[i.jsxs("div",{className:"hierarchy-section",children:[i.jsx("div",{className:"section-header",children:i.jsx("h4",{children:"씬 계층구조"})}),i.jsx("div",{className:"hierarchy-container",children:i.jsx(oo,{objects:e,selectedIds:s||[],selectedObjectId:(null==l?void 0:l.id)??l,dragUseSelectionForDnD:(()=>{try{return Dn.getState().dragUseSelectionForDnD}catch{return!1}})(),onBatchStart:()=>{var e,t;try{null==(t=(e=Dn.getState()).beginBatch)||t.call(e)}catch{}},onBatchEnd:()=>{var e,t;try{null==(t=(e=Dn.getState()).endBatch)||t.call(e)}catch{}},onSelect:t=>{var s,i;null==n||n([t]);const a=null==(s=null==m?void 0:m.findObjectById)?void 0:s.call(m,t);a&&(null==(i=null==m?void 0:m.selectObject)||i.call(m,a));try{const s=(e||[]).find(e=>e.id===t)||{id:t};null==d||d(s)}catch{}},onReparent:(e,t)=>{var s,i;null==a||a(e,t);try{const n=null==(s=null==m?void 0:m.findObjectById)?void 0:s.call(m,e);if(n)if(null==t)!function(e,t,s=!0){!(!e||!e.isObject3D)&&ao(e,t&&t.isScene?t:null,s)}(n,null==m?void 0:m.scene,!0);else{const e=null==(i=null==m?void 0:m.findObjectById)?void 0:i.call(m,t);e&&n!==e&&ao(n,e,!0)}}catch{}try{clearTimeout(window.__reparentOutlineT)}catch{}try{window.__reparentOutlineT=setTimeout(()=>{var e,t;null==(t=null==(e=null==m?void 0:m.objectSelector)?void 0:e.updateAllSelectionOutlines)||t.call(e),window.__reparentOutlineT=null},0)}catch{}},onReorder:(e,t)=>{null==o||o(e,t)},onToggleVisibility:e=>null==c?void 0:c(e),onToggleFreeze:e=>null==A?void 0:A(e)})})]}),i.jsxs("div",{className:"properties-section-wrapper",children:[i.jsxs("div",{className:"section-header",children:[i.jsx("h4",{children:"속성"}),i.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",marginLeft:"auto"},children:[i.jsxs("span",{title:"뷰 설정",style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:B?"rgba(40,167,69,0.15)":"rgba(255,193,7,0.12)",color:B?"#7CDA9B":"#FFD666",border:"1px solid "+(B?"rgba(40,167,69,0.45)":"rgba(255,193,7,0.35)")},children:["View ",B?"✓":"…"]}),i.jsxs("span",{title:"UI 설정",style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:S?"rgba(40,167,69,0.15)":"rgba(255,193,7,0.12)",color:S?"#7CDA9B":"#FFD666",border:"1px solid "+(S?"rgba(40,167,69,0.45)":"rgba(255,193,7,0.35)")},children:["UI ",S?"✓":"…"]}),i.jsxs("span",{title:"환경 설정",style:{padding:"2px 6px",borderRadius:4,fontSize:11,background:Q?"rgba(40,167,69,0.15)":"rgba(255,193,7,0.12)",color:Q?"#7CDA9B":"#FFD666",border:"1px solid "+(Q?"rgba(40,167,69,0.45)":"rgba(255,193,7,0.35)")},children:["Env ",Q?"✓":"…"]})]}),G&&i.jsxs("div",{className:"object-info",children:[i.jsx("span",{className:"object-name",children:G.name}),i.jsxs("span",{className:"object-type",children:["(",N,")"]}),((null==(x=null==(C=null==m?void 0:m.objectSelector)?void 0:C.transformControls)?void 0:x.dragging)||(null==m?void 0:m._gizmoPointerDown))&&i.jsx("span",{className:"editing-badge",title:"기즈모 편집 중 - 값만 실시간 갱신됩니다",children:"편집 중"})]})]}),i.jsxs("div",{className:"properties-container "+((null==(w=null==(I=null==m?void 0:m.objectSelector)?void 0:I.transformControls)?void 0:w.dragging)||(null==m?void 0:m._gizmoPointerDown)?"editing":""),children:[!l&&i.jsxs("div",{className:"no-selection",children:[i.jsx("div",{className:"no-selection-icon",children:"ℹ️"}),i.jsx("div",{className:"no-selection-text",children:"뷰 정보"}),i.jsx("div",{className:"no-selection-hint",children:"선택된 객체가 없을 때 현재 시스템 상태를 보여줍니다."}),i.jsx(E,{})]}),G&&i.jsxs("div",{className:"accordion",children:[i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>U("transform"),children:[i.jsx("span",{className:"chevron "+(j.transform?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Transform"})]}),!j.transform&&i.jsx("div",{className:"accordion-body transform-properties",children:G?i.jsxs("div",{className:"transform-properties",children:[i.jsxs("div",{className:"transform-row",children:[i.jsx("div",{className:"transform-label",children:"Position"}),i.jsxs("div",{className:"transform-inputs",children:[i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"X"}),i.jsx("input",{type:"number",step:"0.1",value:G.position.x,onChange:e=>null==D?void 0:D.setTransformProperty("position","x",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Y"}),i.jsx("input",{type:"number",step:"0.1",value:G.position.y,onChange:e=>null==D?void 0:D.setTransformProperty("position","y",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Z"}),i.jsx("input",{type:"number",step:"0.1",value:G.position.z,onChange:e=>null==D?void 0:D.setTransformProperty("position","z",e.target.value)})]})]})]}),i.jsxs("div",{className:"transform-row",children:[i.jsx("div",{className:"transform-label",children:"Rotation"}),i.jsxs("div",{className:"transform-inputs",children:[i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"X"}),i.jsx("input",{type:"number",step:"1",value:G.rotation.x,onChange:e=>null==D?void 0:D.setTransformProperty("rotation","x",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Y"}),i.jsx("input",{type:"number",step:"1",value:G.rotation.y,onChange:e=>null==D?void 0:D.setTransformProperty("rotation","y",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Z"}),i.jsx("input",{type:"number",step:"1",value:G.rotation.z,onChange:e=>null==D?void 0:D.setTransformProperty("rotation","z",e.target.value)})]})]})]}),i.jsxs("div",{className:"transform-row",children:[i.jsx("div",{className:"transform-label",children:"Scale"}),i.jsxs("div",{className:"transform-inputs",children:[i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"X"}),i.jsx("input",{type:"number",step:"0.1",min:"0.1",value:G.scale.x,onChange:e=>null==D?void 0:D.setTransformProperty("scale","x",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Y"}),i.jsx("input",{type:"number",step:"0.1",min:"0.1",value:G.scale.y,onChange:e=>null==D?void 0:D.setTransformProperty("scale","y",e.target.value)})]}),i.jsxs("div",{className:"transform-input-group",children:[i.jsx("span",{className:"input-label",children:"Z"}),i.jsx("input",{type:"number",step:"0.1",min:"0.1",value:G.scale.z,onChange:e=>null==D?void 0:D.setTransformProperty("scale","z",e.target.value)})]})]})]})]}):i.jsx("div",{style:{color:"red",padding:"20px"},children:"objectInfo가 없습니다"})})]}),i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>U("object"),children:[i.jsx("span",{className:"chevron "+(j.object?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Object"})]}),!j.object&&i.jsx("div",{className:"accordion-body object-properties",children:G?i.jsxs("div",{className:"object-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Name"}),i.jsx("input",{type:"text",value:G.name,onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.name=e.target.value,D.notifyPropertyChange("object","name",e.target.value))}})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Type"}),i.jsx("span",{className:"readonly-value",children:G.type})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"ID"}),i.jsx("span",{className:"readonly-value",children:G.id})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Visible"}),i.jsx("input",{type:"checkbox",checked:!1!==(null==(H=null==D?void 0:D.threeObject)?void 0:H.visible),onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.visible=e.target.checked,D.notifyPropertyChange("object","visible",e.target.checked))}})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Cast Shadow"}),i.jsx("input",{type:"checkbox",checked:(null==(q=null==D?void 0:D.threeObject)?void 0:q.castShadow)||!1,onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.castShadow=e.target.checked,D.notifyPropertyChange("object","castShadow",e.target.checked))}})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Receive Shadow"}),i.jsx("input",{type:"checkbox",checked:(null==(K=null==D?void 0:D.threeObject)?void 0:K.receiveShadow)||!1,onChange:e=>{(null==D?void 0:D.threeObject)&&(D.threeObject.receiveShadow=e.target.checked,D.notifyPropertyChange("object","receiveShadow",e.target.checked))}})]})]}):i.jsx("div",{style:{color:"red",padding:"20px"},children:"objectInfo가 없습니다"})})]}),"mesh"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>U("material"),children:[i.jsx("span",{className:"chevron "+(j.material?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Material"})]}),!j.material&&i.jsx("div",{className:"accordion-body material-properties",children:"mesh"!==N?i.jsx("div",{className:"not-available",children:"메시 객체가 아닙니다"}):i.jsxs("div",{className:"material-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Color"}),i.jsx("input",{type:"color",value:(null==D?void 0:D.getMaterialProperty("color"))||"#ffffff",onChange:e=>null==D?void 0:D.setMaterialProperty("color",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Metalness"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("metalness"))||0,onChange:e=>null==D?void 0:D.setMaterialProperty("metalness",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("metalness"))||0).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Roughness"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("roughness"))||.8,onChange:e=>null==D?void 0:D.setMaterialProperty("roughness",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("roughness"))||.8).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Emissive"}),i.jsx("input",{type:"color",value:(null==D?void 0:D.getMaterialProperty("emissive"))||"#000000",onChange:e=>null==D?void 0:D.setMaterialProperty("emissive",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Emissive Intensity"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("emissiveIntensity"))||0,onChange:e=>null==D?void 0:D.setMaterialProperty("emissiveIntensity",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("emissiveIntensity"))||0).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Opacity"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getMaterialProperty("opacity"))||1,onChange:e=>null==D?void 0:D.setMaterialProperty("opacity",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getMaterialProperty("opacity"))||1).toFixed(2)})]})]})]})})]}),"light"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>U("light"),children:[i.jsx("span",{className:"chevron "+(j.light?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Light"})]}),!j.light&&i.jsx("div",{className:"accordion-body light-properties",children:(()=>{if("light"!==N)return i.jsx("div",{className:"not-available",children:"라이트 객체가 아닙니다"});const e=null==D?void 0:D.getLightProperty("type");return i.jsxs("div",{className:"light-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Type"}),i.jsx("span",{className:"readonly-value",children:e})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Color"}),i.jsx("input",{type:"color",value:(null==D?void 0:D.getLightProperty("color"))||"#ffffff",onChange:e=>null==D?void 0:D.setLightProperty("color",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Intensity"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:(null==D?void 0:D.getLightProperty("intensity"))||1,onChange:e=>null==D?void 0:D.setLightProperty("intensity",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("intensity"))||1).toFixed(1)})]})]}),"SpotLight"===e&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Distance"}),i.jsx("input",{type:"number",min:"0",step:"1",value:(null==D?void 0:D.getLightProperty("distance"))||0,onChange:e=>null==D?void 0:D.setLightProperty("distance",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Angle"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1.57",step:"0.01",value:(null==D?void 0:D.getLightProperty("angle"))||0,onChange:e=>null==D?void 0:D.setLightProperty("angle",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("angle"))||0).toFixed(2)})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Penumbra"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==D?void 0:D.getLightProperty("penumbra"))||0,onChange:e=>null==D?void 0:D.setLightProperty("penumbra",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("penumbra"))||0).toFixed(2)})]})]})]}),("PointLight"===e||"SpotLight"===e)&&i.jsxs(i.Fragment,{children:["PointLight"===e&&i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Distance"}),i.jsx("input",{type:"number",min:"0",step:"1",value:(null==D?void 0:D.getLightProperty("distance"))||0,onChange:e=>null==D?void 0:D.setLightProperty("distance",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Decay"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:(null==D?void 0:D.getLightProperty("decay"))||1,onChange:e=>null==D?void 0:D.setLightProperty("decay",e.target.value)}),i.jsx("span",{children:((null==D?void 0:D.getLightProperty("decay"))||1).toFixed(1)})]})]})]})]})})()})]}),"camera"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>U("camera"),children:[i.jsx("span",{className:"chevron "+(j.camera?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Camera"})]}),!j.camera&&i.jsx("div",{className:"accordion-body camera-properties",children:"camera"!==N?i.jsx("div",{className:"not-available",children:"카메라 객체가 아닙니다"}):i.jsxs("div",{className:"camera-properties",children:[i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Type"}),i.jsx("span",{className:"readonly-value",children:null==D?void 0:D.getCameraProperty("type")})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"FOV"}),i.jsxs("div",{className:"range-input",children:[i.jsx("input",{type:"range",min:"10",max:"120",step:"1",value:(null==D?void 0:D.getCameraProperty("fov"))||75,onChange:e=>null==D?void 0:D.setCameraProperty("fov",e.target.value)}),i.jsxs("span",{children:[(null==D?void 0:D.getCameraProperty("fov"))||75,"°"]})]})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Near"}),i.jsx("input",{type:"number",min:"0.01",step:"0.01",value:(null==D?void 0:D.getCameraProperty("near"))||.1,onChange:e=>null==D?void 0:D.setCameraProperty("near",e.target.value)})]}),i.jsxs("div",{className:"property-group",children:[i.jsx("label",{children:"Far"}),i.jsx("input",{type:"number",min:"1",step:"1",value:(null==D?void 0:D.getCameraProperty("far"))||1e3,onChange:e=>null==D?void 0:D.setCameraProperty("far",e.target.value)})]})]})})]}),"mesh"===N&&i.jsxs("div",{className:"accordion-section",children:[i.jsxs("button",{className:"accordion-header",onClick:()=>U("part"),children:[i.jsx("span",{className:"chevron "+(j.part?"":"open"),children:"▾"}),i.jsx("span",{className:"title",children:"Part"})]}),!j.part&&i.jsx("div",{className:"accordion-body part-properties",children:(()=>{var e,t,s,n,a,r,o,l,c,A,d,h,u,p,g,f,v,y,C,x,I;if("mesh"!==N)return i.jsx("div",{className:"not-available",children:"메시 객체가 아닙니다"});const w=!!(null==(e=null==m?void 0:m.partInspector)?void 0:e.enabled),E=!!(null==(t=null==m?void 0:m.partInspector)?void 0:t.solo),B=!!(null==(s=null==m?void 0:m.partInspector)?void 0:s.clipping),S=!!(null==(n=null==m?void 0:m.partInspector)?void 0:n.gizmo),Q=z;return i.jsxs("div",{className:"part-properties",children:[i.jsxs("div",{className:"property-group",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[i.jsx("label",{children:"파트 인스펙션"}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:w,onChange:e=>{var t;return null==(t=null==m?void 0:m.enablePartInspect)?void 0:t.call(m,e.target.checked)}})," 사용"]}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:E,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartSolo)?void 0:t.call(m,e.target.checked)},disabled:!w})," 솔로 뷰"]}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:B,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartClipping)?void 0:t.call(m,e.target.checked)},disabled:!w})," 클리핑"]}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.clearPartSelection)?void 0:e.call(m)},disabled:!w,children:"파트 선택 해제"})]}),w&&i.jsxs("div",{className:"property-group",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[i.jsx("label",{children:"파트 기즈모"}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:S,onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGizmoEnabled)?void 0:t.call(m,e.target.checked)},disabled:!(null==(a=null==m?void 0:m.getSelectedPart)?void 0:a.call(m))})," 활성화"]}),i.jsxs("div",{style:{display:"inline-flex",gap:6},children:[i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"translate")},disabled:!S,children:"이동"}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"rotate")},disabled:!S,children:"회전"}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.setPartGizmoMode)?void 0:e.call(m,"scale")},disabled:!S,children:"스케일"})]})]}),i.jsxs("div",{className:"property-group",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"8px 12px"},children:[i.jsx("div",{style:{gridColumn:"1 / span 2",fontWeight:600},children:"포스트프로세싱"}),i.jsx("label",{children:"Bloom"}),i.jsx("input",{type:"checkbox",checked:!!(null==(o=null==(r=null==b?void 0:b.effectSettings)?void 0:r.bloom)?void 0:o.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"bloom",e.target.checked)}catch{}}}),i.jsx("label",{children:"AA (SMAA)"}),i.jsx("input",{type:"checkbox",checked:!!(null==(c=null==(l=null==b?void 0:b.effectSettings)?void 0:l.fxaa)?void 0:c.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"fxaa",e.target.checked)}catch{}}}),i.jsx("label",{children:"SSAO"}),i.jsx("input",{type:"checkbox",checked:!!(null==(d=null==(A=null==b?void 0:b.effectSettings)?void 0:A.ssao)?void 0:d.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"ssao",e.target.checked)}catch{}}}),i.jsx("label",{children:"Tone Mapping"}),i.jsx("input",{type:"checkbox",checked:!1!==(null==(u=null==(h=null==b?void 0:b.effectSettings)?void 0:h.toneMapping)?void 0:u.enabled),onChange:e=>{var t;try{null==(t=null==b?void 0:b.setEffectEnabled)||t.call(b,"toneMapping",e.target.checked)}catch{}}})]}),i.jsxs("div",{className:"property-group",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"8px 12px"},children:[i.jsx("div",{style:{gridColumn:"1 / span 2",fontWeight:600},children:"톤 매핑"}),i.jsx("label",{children:"모드"}),i.jsxs("select",{value:(null==(g=null==(p=null==b?void 0:b.effectSettings)?void 0:p.toneMapping)?void 0:g.mapping)||"ACESFilmic",onChange:e=>{var t;try{null==(t=null==b?void 0:b.updateEffectSettings)||t.call(b,"toneMapping",{mapping:e.target.value})}catch{}},children:[i.jsx("option",{value:"None",children:"None"}),i.jsx("option",{value:"Linear",children:"Linear"}),i.jsx("option",{value:"Reinhard",children:"Reinhard"}),i.jsx("option",{value:"Cineon",children:"Cineon"}),i.jsx("option",{value:"ACESFilmic",children:"ACESFilmic"})]}),i.jsx("label",{children:"노출"}),i.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.05",value:(null==(v=null==(f=null==b?void 0:b.effectSettings)?void 0:f.toneMapping)?void 0:v.exposure)??1,onChange:e=>{var t;const s=parseFloat(e.target.value);try{null==(t=null==b?void 0:b.updateEffectSettings)||t.call(b,"toneMapping",{exposure:s})}catch{}}})]}),w&&i.jsxs("div",{className:"property-group",children:[i.jsx("div",{style:{fontSize:12,color:"#aaa",marginBottom:6},children:"서브메시를 클릭해 선택하세요."}),Q?i.jsxs("div",{className:"mesh-info",style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:"6px 12px"},children:[i.jsx("div",{children:"이름"}),i.jsx("div",{children:Q.name}),i.jsx("div",{children:"UUID"}),i.jsx("div",{style:{wordBreak:"break-all"},children:Q.uuid}),i.jsx("div",{children:"지오메트리"}),i.jsxs("div",{children:[Q.geometry.type," ",Q.geometry.hasIndex?"(Indexed)":""]}),i.jsx("div",{children:"버텍스/트라이"}),i.jsxs("div",{children:[Q.geometry.vertices," / ",Q.geometry.triangles]}),i.jsx("div",{children:"속성"}),i.jsx("div",{children:Q.geometry.attributes.join(", ")}),i.jsx("div",{children:"월드 크기"}),i.jsx("div",{children:Q.geometry.world.size.map(e=>e.toFixed(3)).join(", ")}),i.jsx("div",{children:"월드 중심"}),i.jsx("div",{children:Q.geometry.world.center.map(e=>e.toFixed(3)).join(", ")}),i.jsx("div",{children:"UV"}),i.jsx("div",{children:Q.geometry.uv?`${Q.geometry.uv.count}x${Q.geometry.uv.itemSize}`:"없음"}),i.jsx("div",{children:"UV2"}),i.jsx("div",{children:Q.geometry.uv2?`${Q.geometry.uv2.count}x${Q.geometry.uv2.itemSize}`:"없음"}),Q.material&&i.jsxs(i.Fragment,{children:[i.jsx("div",{children:"머티리얼"}),i.jsxs("div",{children:[Q.material.type," ",Q.material.name?`(${Q.material.name})`:""]}),i.jsx("div",{children:"색상/불투명"}),i.jsxs("div",{children:[Q.material.color||"-"," / ",Q.material.opacity]}),i.jsx("div",{children:"Metal/Rough"}),i.jsxs("div",{children:[Q.material.metalness??"-"," / ",Q.material.roughness??"-"]}),i.jsx("div",{children:"맵들"}),i.jsx("div",{children:Object.entries(Q.material.maps).filter(([,e])=>e).map(([e])=>e).join(", ")||"없음"})]})]}):i.jsx("div",{style:{color:"#aaa"},children:"선택된 파트가 없습니다."}),i.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.selectAllChildParts)?void 0:e.call(m)},disabled:!(null==(y=null==m?void 0:m.getSelectedPart)?void 0:y.call(m)),children:"자식 파트 전체 선택"}),i.jsx("button",{onClick:()=>{var e;return null==(e=null==m?void 0:m.clearAllPartSelections)?void 0:e.call(m)},disabled:!(null==(C=null==m?void 0:m.getSelectedPart)?void 0:C.call(m)),children:"모든 파트 선택 해제"}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[i.jsx("input",{type:"checkbox",checked:!!(null==(x=null==m?void 0:m.isPartGroupGizmoEnabled)?void 0:x.call(m)),onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGroupGizmoEnabled)?void 0:t.call(m,e.target.checked)}})," 그룹 기즈모(일괄 변형)"]}),i.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:6},children:["피벗",i.jsxs("select",{value:(null==(I=null==m?void 0:m.getPartGroupPivot)?void 0:I.call(m))||"center",onChange:e=>{var t;return null==(t=null==m?void 0:m.setPartGroupPivot)?void 0:t.call(m,e.target.value)},children:[i.jsx("option",{value:"center",children:"선택 중심"}),i.jsx("option",{value:"first",children:"첫 파트"}),i.jsx("option",{value:"last",children:"마지막 파트"})]})]})]})]})]})})()})]})]})]})]})]})]});var H,q,K}),co=({onObjectDrop:e,onClose:t,forceRefresh:s=0})=>{const[n,a]=r.useState(!1),[l,c]=r.useState([]),[A,d]=r.useState([]),h=r.useRef(null),{customMeshes:u,loadCustomMeshes:p}=Dn(),g=r.useRef(io()),m=r.useRef(new Set),b=r.useRef(null),[f,v]=r.useState(!1),[y,C]=r.useState({open:!1,x:0,y:0,mesh:null}),x=r.useRef(null);r.useEffect(()=>{if(!y.open)return;const e=()=>C({open:!1,x:0,y:0,mesh:null}),t=t=>{"Escape"===t.key&&e()},s=t=>{try{const e=x.current;if(e&&e.contains(t.target))return}catch{}e()};return window.addEventListener("click",s),window.addEventListener("keydown",t),()=>{window.removeEventListener("click",s),window.removeEventListener("keydown",t)}},[y.open]);r.useEffect(()=>((async()=>{const e=await g.current.getCustomMeshes();p(e)})(),()=>{const e=m.current;for(const t of e)try{URL.revokeObjectURL(t)}catch{}e.clear()}),[p]),r.useEffect(()=>{const e=async()=>{const e=await g.current.getCustomMeshes();p(e)};return window.addEventListener("customMeshAdded",e),()=>{window.removeEventListener("customMeshAdded",e)}},[p]),r.useEffect(()=>{const e=m.current,t=new Set((u||[]).map(e=>"string"==typeof e.thumbnail&&e.thumbnail.startsWith("blob:")?e.thumbnail:null).filter(Boolean));for(const s of e)if(!t.has(s))try{URL.revokeObjectURL(s)}catch{}m.current=t},[u]),r.useEffect(()=>{(()=>{const e=JSON.parse(localStorage.getItem("customObjects")||"[]");c(e)})()},[s]),r.useEffect(()=>{(async()=>{try{const t=await g.current.loadLibraryMeshes();d(t);for(let s=0;s<t.length;s++){const i=t[s];try{const e=await g.current.generateThumbnailFromURL(i.glbUrl);d(t=>t.map(t=>t.id===i.id?{...t,thumbnail:e,isLoadingThumbnail:!1}:t))}catch(e){d(e=>e.map(e=>e.id===i.id?{...e,isLoadingThumbnail:!1}:e))}}}catch(e){}})()},[]);const I=(e,t)=>{a(!0),h.current=t;let s=t;"custom"===t.type&&(s={type:"custom",id:t.id,name:t.name});const i=document.createElement("canvas");i.width=50,i.height=50;const n=i.getContext("2d");n.fillStyle="rgba(100, 150, 255, 0.8)",n.fillRect(0,0,50,50),n.fillStyle="white",n.font="12px Arial",n.textAlign="center",n.fillText(t.name,25,30),e.dataTransfer.setDragImage(i,25,25),e.dataTransfer.setData("text/plain",JSON.stringify(s))},w=()=>{a(!1),h.current=null},E=t=>{e&&("custom"===t.type?e({type:"custom",id:t.id,name:t.name},{x:0,y:0,z:0}):(t.type,e(t,{x:0,y:0,z:0})))},B=async(e,t)=>{if(t.stopPropagation(),window.confirm(`"${e.name}"을(를) 라이브러리에서 삭제하시겠습니까?`))try{await g.current.deleteCustomMesh(e.id);const t=await g.current.getCustomMeshes();p(t),window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제되었습니다.",type:"success",duration:2e3}}))}catch(s){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"삭제에 실패했습니다 (IndexedDB).",type:"error",duration:3e3}}))}};return i.jsxs("div",{className:"library-panel",children:[i.jsxs("div",{className:"library-header",children:[i.jsx("h3",{children:"라이브러리"}),i.jsx("button",{className:"close-btn",onClick:t,children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]}),i.jsxs("div",{className:"library-content",children:[i.jsx("div",{className:"category-section",style:{marginTop:0},children:i.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[i.jsx("button",{className:"upload-btn",onClick:()=>{var e;null==(e=b.current)||e.click()},disabled:f,title:"GLB 파일 임포트",children:f?"임포트 중…":"GLB 임포트"}),i.jsx("input",{ref:b,type:"file",accept:".glb,model/gltf-binary",multiple:!0,style:{display:"none"},onChange:async e=>{const t=Array.from(e.target.files||[]);if(t.length){v(!0);try{for(const i of t)try{await g.current.importGLBFile(i)}catch(s){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:`${i.name} 임포트 실패`,type:"error",duration:3e3}}))}const e=await g.current.getCustomMeshes();p(e),window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"임포트 완료",type:"success",duration:2e3}}))}finally{v(!1),b.current&&(b.current.value="")}}}})]})}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"기본 도형"}),i.jsx("div",{className:"object-grid",children:[{id:"cube",name:"정육면체",type:"basic",geometry:"BoxGeometry",params:[1,1,1]},{id:"sphere",name:"구체",type:"basic",geometry:"SphereGeometry",params:[.5,32,16]},{id:"cylinder",name:"원기둥",type:"basic",geometry:"CylinderGeometry",params:[.5,.5,1,32]},{id:"cone",name:"원뿔",type:"basic",geometry:"ConeGeometry",params:[.5,1,32]},{id:"plane",name:"평면",type:"basic",geometry:"PlaneGeometry",params:[1,1]},{id:"torus",name:"도넛",type:"basic",geometry:"TorusGeometry",params:[.5,.2,16,100]}].map(e=>i.jsx("div",{className:"library-item",draggable:!0,onDragStart:t=>I(t,e),onDragEnd:w,onClick:()=>E(e),title:e.name,children:i.jsx("div",{className:"object-grid",children:i.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:["cube"===e.id&&i.jsx("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"}),"sphere"===e.id&&i.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}),"cylinder"===e.id&&i.jsx("path",{d:"M12,2C8.14,2 5,3.79 5,6V18C5,20.21 8.14,22 12,22C15.86,22 19,20.21 19,18V6C19,3.79 15.86,2 12,2M12,4C14.67,4 17,4.9 17,6C17,7.1 14.67,8 12,8C9.33,8 7,7.1 7,6C7,4.9 9.33,4 12,4M7,9.5C8.21,10.72 9.86,11.26 12,11.26C14.14,11.26 15.79,10.72 17,9.5V18C17,19.1 14.67,20 12,20C9.33,20 7,19.1 7,18V9.5Z"}),"cone"===e.id&&i.jsx("path",{d:"M12,2L1,21H23L12,2M12,6L19.53,19H4.47L12,6Z"}),"plane"===e.id&&i.jsx("path",{d:"M3,3V21H21V3H3M19,19H5V5H19V19Z"}),"torus"===e.id&&i.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"})]})})},e.id))})]}),A.length>0&&i.jsx("div",{className:"section-divider"}),A.length>0&&i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"라이브러리 메쉬"}),i.jsxs("div",{style:{display:"flex",gap:6,position:"absolute",top:6,right:6},children:[i.jsx("button",{className:"delete-btn",onClick:e=>B(mesh,e),title:"삭제",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})})}),i.jsx("button",{className:"delete-btn",onClick:e=>{e.stopPropagation(),g.current.downloadCustomMesh(mesh)},title:"내보내기",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M5,20H19V18H5M14,10V3H10V10H7L12,15L17,10H14Z"})})})]}),i.jsx("div",{className:"object-grid",children:A.map(e=>i.jsx("div",{className:"library-item library-mesh",draggable:!0,onDragStart:t=>I(t,e),onDragEnd:w,onClick:()=>E(e),title:`${e.name} (라이브러리)`,children:i.jsx("div",{className:"library-thumbnail",children:e.isLoadingThumbnail?i.jsx("div",{className:"thumbnail-loading",children:i.jsx("div",{className:"loading-spinner"})}):e.thumbnail?i.jsx("img",{src:e.thumbnail,alt:e.name,className:"thumbnail-image"}):i.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2L2,7L12,12L22,7L12,2M2,17L12,22L22,17L20.84,16.47L12,21.17L3.16,16.47L2,17Z"})})})},e.id))})]}),i.jsx("div",{className:"section-divider"}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"커스텀 메쉬"}),i.jsx("div",{className:"object-grid",children:u.length>0?u.map(e=>i.jsxs("div",{className:"library-item custom-mesh",draggable:!0,onDragStart:t=>I(t,e),onDragEnd:w,onClick:()=>E(e),onContextMenu:t=>((e,t)=>{e.preventDefault(),e.stopPropagation(),C({open:!0,x:e.clientX,y:e.clientY,mesh:t})})(t,e),title:e.name,children:[i.jsxs("div",{className:"library-thumbnail",children:[i.jsx("img",{src:e.thumbnail,alt:e.name,width:"40",height:"40",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}),i.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",style:{display:"none"},children:i.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})]}),i.jsx("button",{className:"delete-btn",onClick:t=>B(e,t),title:"삭제",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})})})]},e.id)):i.jsx("div",{className:"empty-library"})})]}),l.length>0&&i.jsx("div",{className:"section-divider"}),l.length>0&&i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"사용자 정의"}),i.jsx("div",{className:"object-grid",children:l.map(e=>i.jsxs("div",{className:"library-item custom-object",draggable:!0,onDragStart:t=>I(t,e),onDragEnd:w,onClick:()=>E(e),title:`${e.name} (사용자 정의)`,children:[i.jsx("div",{className:"library-thumbnail",children:e.thumbnail?i.jsx("img",{src:e.thumbnail,alt:e.name,style:{width:"24px",height:"24px",objectFit:"cover",borderRadius:"2px"}}):i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2L13.09,8.26L22,9L14.74,14.74L17.18,22L12,18.5L6.82,22L9.26,14.74L2,9L10.91,8.26L12,2Z"})})}),i.jsx("button",{className:"delete-btn",onClick:t=>((e,t)=>{if(t.stopPropagation(),window.confirm(`"${e.name}"을(를) 라이브러리에서 삭제하시겠습니까?`)){e.glbUrl&&URL.revokeObjectURL(e.glbUrl);const t=JSON.parse(localStorage.getItem("customObjects")||"[]").filter(t=>t.id!==e.id);localStorage.setItem("customObjects",JSON.stringify(t)),c(t)}})(e,t),title:"삭제",children:i.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]},e.id))})]})]}),y.open&&o.createPortal(i.jsx("div",{ref:x,className:"lib-context-menu",style:{left:y.x,top:y.y},children:i.jsx("button",{className:"ctx-item",onClick:async()=>{if(y.mesh)try{let e=y.mesh;if(!e.glbData&&e.id){const t=(await g.current.getCustomMeshes()).find(t=>t.id===e.id);t&&(e=t)}g.current.downloadCustomMesh(e);try{window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"다운로드 시작",type:"success",duration:1500}}))}catch{}}catch(e){window.dispatchEvent(new CustomEvent("appToast",{detail:{message:"내보내기 실패",type:"error",duration:2500}}))}finally{C({open:!1,x:0,y:0,mesh:null})}},children:"GLB 내보내기"})}),document.body)]})},Ao=({onAssetDrop:e,onClose:t})=>i.jsxs("div",{className:"assets-panel",children:[i.jsxs("div",{className:"assets-header",children:[i.jsx("h3",{children:"기본 에셋"}),i.jsx("button",{className:"close-btn",onClick:t,children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]}),i.jsx("div",{className:"assets-content",children:i.jsx("div",{className:"assets-grid",children:[{id:"point_light",name:"포인트 라이트",type:"point_light",description:"점 조명"},{id:"spot_light",name:"스포트 라이트",type:"spot_light",description:"스포트 조명"},{id:"axes_helper",name:"축 헬퍼",type:"axes_helper",description:"XYZ 축 표시"}].map(t=>i.jsx("div",{className:"asset-item",draggable:!0,onDragStart:e=>((e,t)=>{const s=document.createElement("canvas");s.width=50,s.height=50;const i=s.getContext("2d");i.fillStyle="rgba(255, 165, 0, 0.8)",i.fillRect(0,0,50,50),i.fillStyle="white",i.font="12px Arial",i.textAlign="center",i.fillText(t.name.substring(0,6),25,20),i.fillText("Asset",25,35),e.dataTransfer.setDragImage(s,25,25),e.dataTransfer.setData("text/plain",JSON.stringify(t))})(e,t),onClick:()=>(t=>{e&&e(t,{x:0,y:0,z:0})})(t),title:`${t.name}: ${t.description}`,children:i.jsx("div",{className:"asset-name",children:t.name})},t.id))})})]}),ho=({postProcessingManager:e,onClose:t})=>{const[s,n]=r.useState({}),[a,o]=r.useState("basic"),l=Dn(e=>e.isPostProcessingEnabled),c=Dn(e=>e.togglePostProcessingEnabled),A=Dn(e=>e.postProcessingPreset),d=Dn(e=>e.setPostProcessingPreset);r.useEffect(()=>{e&&n(e.getSettings())},[e]);const h=t=>{var i;if(!e)return;const a=!(null==(i=s[t])?void 0:i.enabled);e.setEffectEnabled(t,a),n(e=>({...e,[t]:{...e[t],enabled:a}}))},u=(t,s,i)=>{if(!e)return;const a={[s]:i};e.updateEffectSettings(t,a),n(e=>({...e,[t]:{...e[t],[s]:i}}))};return i.jsxs("div",{className:"post-processing-panel",children:[i.jsxs("div",{className:"panel-header",children:[i.jsx("h2",{children:"포스트프로세싱 효과"}),i.jsxs("label",{className:"checkbox-label",style:{marginLeft:"auto",marginRight:8},children:[i.jsx("input",{type:"checkbox",checked:l,onChange:c})," 전체 사용"]}),i.jsx("button",{className:"close-button",onClick:t,children:"×"})]}),!l&&i.jsx("div",{style:{background:"rgba(255, 194, 61, 0.12)",border:"1px solid rgba(255, 194, 61, 0.35)",color:"#b78200",padding:"8px 10px",borderRadius:6,margin:"8px 12px"},children:'포스트프로세싱이 꺼져 있어 효과가 화면에 보이지 않습니다. 상단의 "전체 사용"을 켜세요.'}),i.jsxs("div",{className:"panel-tabs",children:[i.jsx("button",{className:"tab-button "+("basic"===a?"active":""),onClick:()=>o("basic"),children:"기본"}),i.jsx("button",{className:"tab-button "+("color"===a?"active":""),onClick:()=>o("color"),children:"색상"}),i.jsx("button",{className:"tab-button "+("artistic"===a?"active":""),onClick:()=>o("artistic"),children:"아티스틱"})]}),i.jsxs("div",{className:"panel-content",children:["basic"===a&&i.jsxs("div",{className:"effect-group",children:[i.jsx("h3",{children:"기본 효과"}),i.jsx("div",{className:"effect-item",children:i.jsxs("div",{className:"effect-header",children:[i.jsx("label",{style:{color:"#ccc",fontSize:12,marginRight:8},children:"프리셋"}),i.jsxs("select",{value:A,onChange:t=>{var s;const i=t.target.value;d(i);try{null==(s=null==e?void 0:e.applyPreset)||s.call(e,i)}catch{}},children:[i.jsx("option",{value:"default",children:"Default"}),i.jsx("option",{value:"low",children:"Low"}),i.jsx("option",{value:"medium",children:"Medium"}),i.jsx("option",{value:"high",children:"High"})]})]})}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(p=s.bloom)?void 0:p.enabled)||!1,onChange:()=>h("bloom")}),"Bloom (발광)"]})}),(null==(g=s.bloom)?void 0:g.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"강도:"}),i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:(null==(m=s.bloom)?void 0:m.strength)||1.5,onChange:e=>u("bloom","strength",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(b=s.bloom)?void 0:b.strength)||1.5})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"반경:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(f=s.bloom)?void 0:f.radius)||.4,onChange:e=>u("bloom","radius",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(v=s.bloom)?void 0:v.radius)||.4})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"임계값:"}),i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(y=s.bloom)?void 0:y.threshold)||.85,onChange:e=>u("bloom","threshold",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(C=s.bloom)?void 0:C.threshold)||.85})]})]})]}),i.jsx("div",{className:"effect-item",children:i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(x=s.fxaa)?void 0:x.enabled)||!1,onChange:()=>h("fxaa")}),"FXAA (안티앨리어싱)"]})})}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(I=s.ssao)?void 0:I.enabled)||!1,onChange:()=>h("ssao")}),"SSAO (주변광 차폐)"]})}),(null==(w=s.ssao)?void 0:w.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"커널 반경:"}),i.jsx("input",{type:"range",min:"1",max:"32",step:"1",value:(null==(E=s.ssao)?void 0:E.kernelRadius)||8,onChange:e=>u("ssao","kernelRadius",parseInt(e.target.value))}),i.jsx("span",{children:(null==(B=s.ssao)?void 0:B.kernelRadius)||8})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(S=s.toneMapping)?void 0:S.enabled)??!0,onChange:()=>h("toneMapping")}),"Tone Mapping (톤 매핑)"]})}),!1!==(null==(Q=s.toneMapping)?void 0:Q.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"모드:"}),i.jsxs("select",{value:(null==(j=s.toneMapping)?void 0:j.mapping)||"ACESFilmic",onChange:e=>u("toneMapping","mapping",e.target.value),children:[i.jsx("option",{value:"None",children:"None"}),i.jsx("option",{value:"Linear",children:"Linear"}),i.jsx("option",{value:"Reinhard",children:"Reinhard"}),i.jsx("option",{value:"Cineon",children:"Cineon"}),i.jsx("option",{value:"ACESFilmic",children:"ACESFilmic"})]})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"노출:"}),i.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.05",value:(null==(M=s.toneMapping)?void 0:M.exposure)??1,onChange:e=>u("toneMapping","exposure",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(D=s.toneMapping)?void 0:D.exposure)??1})]})]})]})]}),"color"===a&&(()=>{var e,t,n,a,r,o,l,c,A,d,p,g,m,b,f,v,y,C,x,I,w,E,B,S,Q,j,M,D;return i.jsxs("div",{className:"effect-group",children:[i.jsx("h3",{children:"색상 효과"}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(e=s.colorCorrection)?void 0:e.enabled)||!1,onChange:()=>h("colorCorrection")}),"Color Correction (색상 보정)"]})}),(null==(t=s.colorCorrection)?void 0:t.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"Red Power:"}),i.jsx("input",{type:"range",min:"0.1",max:"4",step:"0.1",value:(null==(a=null==(n=s.colorCorrection)?void 0:n.powRGB)?void 0:a.x)||2,onChange:e=>u("colorCorrection","powRGB",{...s.colorCorrection.powRGB,x:parseFloat(e.target.value)})}),i.jsx("span",{children:(null==(o=null==(r=s.colorCorrection)?void 0:r.powRGB)?void 0:o.x)||2})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(l=s.brightnessContrast)?void 0:l.enabled)||!1,onChange:()=>h("brightnessContrast")}),"Brightness/Contrast (밝기/대비)"]})}),(null==(c=s.brightnessContrast)?void 0:c.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"밝기:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(A=s.brightnessContrast)?void 0:A.brightness)||0,onChange:e=>u("brightnessContrast","brightness",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(d=s.brightnessContrast)?void 0:d.brightness)||0})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"대비:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(p=s.brightnessContrast)?void 0:p.contrast)||0,onChange:e=>u("brightnessContrast","contrast",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(g=s.brightnessContrast)?void 0:g.contrast)||0})]})]})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(m=s.hueSaturation)?void 0:m.enabled)||!1,onChange:()=>h("hueSaturation")}),"Hue/Saturation (색조/채도)"]})}),(null==(b=s.hueSaturation)?void 0:b.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"색조:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(f=s.hueSaturation)?void 0:f.hue)||0,onChange:e=>u("hueSaturation","hue",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(v=s.hueSaturation)?void 0:v.hue)||0})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"채도:"}),i.jsx("input",{type:"range",min:"-1",max:"1",step:"0.01",value:(null==(y=s.hueSaturation)?void 0:y.saturation)||0,onChange:e=>u("hueSaturation","saturation",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(C=s.hueSaturation)?void 0:C.saturation)||0})]})]})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(x=s.sepia)?void 0:x.enabled)||!1,onChange:()=>h("sepia")}),"Sepia (세피아)"]})}),(null==(I=s.sepia)?void 0:I.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"강도:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(w=s.sepia)?void 0:w.amount)||1,onChange:e=>u("sepia","amount",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(E=s.sepia)?void 0:E.amount)||1})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(B=s.vignette)?void 0:B.enabled)||!1,onChange:()=>h("vignette")}),"Vignette (비네트)"]})}),(null==(S=s.vignette)?void 0:S.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"오프셋:"}),i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(Q=s.vignette)?void 0:Q.offset)||1,onChange:e=>u("vignette","offset",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(j=s.vignette)?void 0:j.offset)||1})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"어둠:"}),i.jsx("input",{type:"range",min:"0",max:"2",step:"0.01",value:(null==(M=s.vignette)?void 0:M.darkness)||1,onChange:e=>u("vignette","darkness",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(D=s.vignette)?void 0:D.darkness)||1})]})]})]})]})})(),"artistic"===a&&(()=>{var e,t,n,a,r,o,l,c,A,d,p,g,m,b,f,v,y,C,x;return i.jsxs("div",{className:"effect-group",children:[i.jsx("h3",{children:"아티스틱 효과"}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(e=s.film)?void 0:e.enabled)||!1,onChange:()=>h("film")}),"Film (필름 효과)"]})}),(null==(t=s.film)?void 0:t.enabled)&&i.jsxs("div",{className:"effect-controls",children:[i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"노이즈:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(n=s.film)?void 0:n.noiseIntensity)||.5,onChange:e=>u("film","noiseIntensity",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(a=s.film)?void 0:a.noiseIntensity)||.5})]}),i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"스캔라인:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(r=s.film)?void 0:r.scanlinesIntensity)||.05,onChange:e=>u("film","scanlinesIntensity",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(o=s.film)?void 0:o.scanlinesIntensity)||.05})]}),i.jsx("div",{className:"control-row",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(l=s.film)?void 0:l.grayscale)||!1,onChange:e=>u("film","grayscale",e.target.checked)}),"흑백"]})})]})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(c=s.pixelate)?void 0:c.enabled)||!1,onChange:()=>h("pixelate")}),"Pixelate (픽셀화)"]})}),(null==(A=s.pixelate)?void 0:A.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"픽셀 크기:"}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:(null==(d=s.pixelate)?void 0:d.pixelSize)||6,onChange:e=>u("pixelate","pixelSize",parseInt(e.target.value))}),i.jsx("span",{children:(null==(p=s.pixelate)?void 0:p.pixelSize)||6})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(g=s.dotScreen)?void 0:g.enabled)||!1,onChange:()=>h("dotScreen")}),"Dot Screen (도트 스크린)"]})}),(null==(m=s.dotScreen)?void 0:m.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"스케일:"}),i.jsx("input",{type:"range",min:"0.1",max:"2",step:"0.1",value:(null==(b=s.dotScreen)?void 0:b.scale)||1,onChange:e=>u("dotScreen","scale",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(f=s.dotScreen)?void 0:f.scale)||1})]})})]}),i.jsxs("div",{className:"effect-item",children:[i.jsx("div",{className:"effect-header",children:i.jsxs("label",{className:"checkbox-label",children:[i.jsx("input",{type:"checkbox",checked:(null==(v=s.glitch)?void 0:v.enabled)||!1,onChange:()=>h("glitch")}),"Glitch (글리치)"]})}),(null==(y=s.glitch)?void 0:y.enabled)&&i.jsx("div",{className:"effect-controls",children:i.jsxs("div",{className:"control-row",children:[i.jsx("label",{children:"강도:"}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:(null==(C=s.glitch)?void 0:C.factor)||.1,onChange:e=>u("glitch","factor",parseFloat(e.target.value))}),i.jsx("span",{children:(null==(x=s.glitch)?void 0:x.factor)||.1})]})})]})]})})()]})]});var p,g,m,b,f,v,y,C,x,I,w,E,B,S,Q,j,M,D};function uo({scene:e,onClose:t}){const s=Dn(e=>e.hdriSettings),n=Dn(e=>e.updateHDRISettings),a=Dn(e=>e.sunLightRef);Dn(e=>e.setSunLightRef);const o=Dn(e=>e.saveHDRISettings),l=Dn(e=>e.renderer),[c,A]=r.useState(!1),[d,h]=r.useState(null),u=r.useRef(null),{currentHDRI:p,hdriIntensity:g,hdriRotation:m,sunLightEnabled:f,sunIntensity:v,timeOfDay:y,sunAzimuth:C,sunElevation:x,sunColor:I}=s,w=(e,t="info")=>{h({message:e,type:t}),setTimeout(()=>h(null),3e3)},E=async(t,s)=>{var i,a,r,o,c,A;if(!e)throw new Error("씬이 초기화되지 않았습니다");const d=new Promise((e,t)=>{setTimeout(()=>t(new Error("로드 시간 초과")),3e4)});try{const o=await Promise.race([B(t),d]);o.mapping=Ut,o.magFilter=k,o.minFilter=k,o.generateMipmaps=!1,o.matrixAutoUpdate=!0,null==(a=null==(i=o.center)?void 0:i.set)||a.call(i,.5,.5),o.needsUpdate=!0;try{(null==(r=null==p?void 0:p.envRT)?void 0:r.dispose)&&p.envRT.dispose()}catch{}try{(null==p?void 0:p.texture)&&p.texture!==o&&p.texture.dispose()}catch{}e.background=o;let c=null;if(l){const t=new zt(l);t.compileEquirectangularShader(),c=t.fromEquirectangular(o),t.dispose(),e.environment=c.texture}else e.environment=o;void 0!==e.backgroundIntensity&&(e.backgroundIntensity=g),void 0!==e.environmentIntensity&&(e.environmentIntensity=g),n({currentHDRI:{name:s,type:"hdr",texture:o,envRT:c,url:t}})}catch(h){if(t.startsWith("blob:")&&URL.revokeObjectURL(t),h.message.includes("Bad File Format"))try{const i=await S(t);i.mapping=Ut,i.magFilter=k,i.minFilter=k,i.generateMipmaps=!1,i.matrixAutoUpdate=!0,null==(c=null==(o=i.center)?void 0:o.set)||c.call(o,.5,.5),i.needsUpdate=!0;try{(null==(A=null==p?void 0:p.envRT)?void 0:A.dispose)&&p.envRT.dispose()}catch{}try{(null==p?void 0:p.texture)&&p.texture.dispose()}catch{}e.background=i;let a=null;if(l){const t=new zt(l);t.compileEquirectangularShader(),a=t.fromEquirectangular(i),t.dispose(),e.environment=a.texture}else e.environment=i;return void n({currentHDRI:{name:s+" (폴백)",type:"hdr",texture:i,envRT:a,url:t}})}catch(u){}throw h}},B=async e=>{const t=new qt;return new Promise((s,i)=>{t.load(e,e=>{e&&e.image?s(e):i(new Error("텍스처 데이터가 유효하지 않습니다"))},void 0,e=>{i(e)})})},S=async e=>{const t=new D;return new Promise((s,i)=>{t.load(e,e=>{e&&e.image?s(e):i(new Error("폴백 텍스처 데이터가 유효하지 않습니다"))},void 0,e=>{i(e)})})},Q=(e,t,s)=>{const i=t*Math.PI/180,n=s*Math.PI/180,a=Math.sin(i)*Math.cos(n)*100,r=100*Math.sin(n),o=Math.cos(i)*Math.cos(n)*100;e.position.set(a,r,o),e.lookAt(0,0,0)},j=e=>{n({timeOfDay:e}),a&&(e=>{let t="#ffffff";t=e>=5&&e<7?"#ff6b47":e>=7&&e<10?"#ffaa80":e>=10&&e<16?"#ffffff":e>=16&&e<18?"#ffcc99":e>=18&&e<20?"#ff8c66":"#4a6fa5",n({sunColor:t}),a&&a.color.setHex(t.replace("#","0x"))})(e)};return r.useEffect(()=>()=>{},[e]),r.useEffect(()=>{e&&setTimeout(()=>o(),100)},[s,e,o]),r.useEffect(()=>{var t,s;if(e&&p&&p.type&&p.texture&&"none"!==p.type){void 0!==e.backgroundIntensity&&(e.backgroundIntensity=g),void 0!==e.environmentIntensity&&(e.environmentIntensity=g);try{null==(s=null==(t=p.texture.center)?void 0:t.set)||s.call(t,.5,.5)}catch{}if(p.texture.rotation=m*Math.PI/180,p.texture.needsUpdate=!0,l)try{if(!p.envRT){const t=new zt(l);t.compileEquirectangularShader();const s=t.fromEquirectangular(p.texture);t.dispose(),e.environment=s.texture,n({currentHDRI:{...p,envRT:s}})}}catch{}}},[e,p,g,m,l]),i.jsxs("div",{className:"hdri-panel",children:[i.jsxs("div",{className:"hdri-header",children:[i.jsx("h3",{children:"HDRI 환경"}),i.jsxs("div",{className:"header-controls",children:[i.jsx("span",{className:"auto-save-indicator",title:"설정이 자동으로 저장됩니다",children:"💾"}),i.jsx("button",{className:"close-btn",onClick:t,children:i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})})})]})]}),i.jsxs("div",{className:"hdri-content",children:[i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"현재 환경"}),i.jsx("div",{className:"current-hdri-display",children:p?i.jsx("span",{className:"hdri-name",children:p.name}):i.jsx("span",{className:"no-hdri",children:"환경 없음"})})]}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"환경맵 업로드"}),i.jsx("input",{type:"file",ref:u,onChange:async e=>{const t=e.target.files[0];if(!t)return;const s=[".hdr",".exr",".hdri"],i=[...s,".jpg",".jpeg",".png",".webp",".bmp"],n=t.name.toLowerCase().substring(t.name.lastIndexOf("."));if(!i.includes(n))return void w("지원하는 형식: HDRI(.hdr, .exr, .hdri) 또는 이미지(.jpg, .png, .webp)","error");if(t.size>209715200)return void w("파일 크기가 너무 큽니다 (최대 200MB)","error");if(t.size<100)return void w("파일이 너무 작습니다","error");const a=s.includes(n);if(a)try{const e=await t.slice(0,20).arrayBuffer(),s=new Uint8Array(e),i=String.fromCharCode(...s.slice(0,20));if(".hdr"===n){i.includes("#?RADIANCE")||i.includes("#?RGBE")||i.includes("RADIANCE")||35===s[0]||w("HDR 파일 형식이 표준과 다를 수 있습니다. 일반 이미지로 시도합니다.","info")}}catch(r){}else w("일반 이미지 파일을 환경맵으로 사용합니다","info");A(!0);try{const e=URL.createObjectURL(t);await E(e,t.name),w((a?"HDRI":"이미지")+" 환경이 로드되었습니다","success")}catch(o){let e="파일을 로드할 수 없습니다";o.message.includes("Bad File Format")?e="파일 형식을 읽을 수 없습니다. 다른 파일을 시도해보세요.":o.message.includes("network")?e="네트워크 오류로 파일을 로드할 수 없습니다":o.message.includes("로드 시간 초과")&&(e="파일 로드 시간이 초과되었습니다"),w(e,"error")}finally{A(!1),e.target.value=""}},accept:".hdr,.exr,.hdri,.jpg,.jpeg,.png,.webp,.bmp",style:{display:"none"}}),i.jsxs("button",{className:"hdri-upload-btn",onClick:()=>{var e;return null==(e=u.current)?void 0:e.click()},disabled:c,children:[i.jsx("div",{className:"upload-icon",children:i.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})}),i.jsx("span",{children:c?"로딩중...":"파일 선택"})]}),i.jsx("div",{className:"upload-hint",children:".hdr, .exr, .hdri 지원"})]}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"기본 환경"}),i.jsx("div",{className:"hdri-grid",children:[{name:"컨트리 로드",type:"preset",url:"/hdr/sunny_country_road_2k.hdr",description:"햇살 좋은 시골길"},{name:"기본 스카이박스",type:"gradient",description:"그라디언트 스카이박스"},{name:"기본 배경",type:"none",description:"회색 배경"}].map((t,s)=>i.jsxs("div",{className:"hdri-item "+((null==p?void 0:p.name)===t.name?"active":""),onClick:()=>(async(t,s=null)=>{var i,a;if(e)switch(t){case"preset":if(s&&s.url)try{A(!0),await E(s.url,s.name),w(`${s.name} 환경이 적용되었습니다`,"success")}catch(r){w("프리셋 환경을 로드할 수 없습니다","error")}finally{A(!1)}break;case"gradient":e.background&&e.background.isTexture&&e.background.dispose();try{(null==(i=null==p?void 0:p.envRT)?void 0:i.dispose)&&p.envRT.dispose()}catch{}e.background=new b(8900331),e.environment=null,n({currentHDRI:{name:"기본 스카이박스",type:"gradient"}});break;case"none":e.background&&e.background.isTexture&&e.background.dispose();try{(null==(a=null==p?void 0:p.envRT)?void 0:a.dispose)&&p.envRT.dispose()}catch{}e.background=new b(2763306),e.environment=null,n({currentHDRI:{name:"기본 배경",type:"none"}})}})(t.type,t),title:t.description,children:[i.jsx("div",{className:"hdri-thumbnail",children:i.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:["preset"===t.type&&i.jsx("path",{d:"M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V10.5L17.5,9L16,10.5L14.5,9L11.5,12L9,9.5L7.5,11L6,9.5L5,10.5V5H19Z"}),"gradient"===t.type&&i.jsx("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}),"none"===t.type&&i.jsx("path",{d:"M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"})]})}),i.jsx("div",{className:"hdri-label",children:t.name})]},s))})]}),p&&"none"!==p.type&&i.jsx("div",{className:"section-divider"}),p&&"none"!==p.type&&i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"환경 설정"}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"강도"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:g,onChange:t=>{return s=parseFloat(t.target.value),n({hdriIntensity:s}),void(e&&p&&p.texture&&"none"!==p.type&&(e.backgroundIntensity=s,e.environmentIntensity=s));var s},className:"hdri-slider"}),i.jsx("span",{className:"slider-value",children:g.toFixed(1)})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"회전"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:m,onChange:t=>(s=>{var i,a,r;if(n({hdriRotation:s}),e&&p&&p.texture&&"none"!==p.type){const o=s*Math.PI/180;try{null==(a=null==(i=p.texture.center)?void 0:i.set)||a.call(i,.5,.5)}catch{}if(p.texture.rotation=o,p.texture.needsUpdate=!0,l){try{(null==(r=p.envRT)?void 0:r.dispose)&&p.envRT.dispose()}catch{}try{const t=new zt(l);t.compileEquirectangularShader();const s=t.fromEquirectangular(p.texture);t.dispose(),e.environment=s.texture,n({currentHDRI:{...p,envRT:s}})}catch(t){e.environment=p.texture,n({currentHDRI:{...p,envRT:null}})}}else e.environment=p.texture}})(parseFloat(t.target.value)),className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[m,"°"]})]})]})]}),i.jsxs("div",{className:"category-section",children:[i.jsx("h4",{className:"category-title",children:"태양 조명"}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"활성화"}),i.jsx("input",{type:"checkbox",checked:f,onChange:e=>{return t=e.target.checked,void n({sunLightEnabled:t});var t},className:"setting-checkbox"})]}),f&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"시간"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"24",step:"0.5",value:y,onChange:e=>j(Number(e.target.value)),className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[y,"시"]})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"강도"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"20",step:"0.1",value:v,onChange:e=>{return t=Number(e.target.value),n({sunIntensity:t}),void(a&&(a.intensity=t));var t},className:"hdri-slider"}),i.jsx("span",{className:"slider-value",children:v})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"방위각"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"360",step:"1",value:C,onChange:e=>{return t=Number(e.target.value),n({sunAzimuth:t}),void(a&&Q(a,t,x));var t},className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[C,"°"]})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"고도각"}),i.jsxs("div",{className:"slider-container",children:[i.jsx("input",{type:"range",min:"0",max:"90",step:"1",value:x,onChange:e=>{return t=Number(e.target.value),n({sunElevation:t}),void(a&&Q(a,C,t));var t},className:"hdri-slider"}),i.jsxs("span",{className:"slider-value",children:[x,"°"]})]})]}),i.jsxs("div",{className:"setting-item",children:[i.jsx("label",{children:"색상"}),i.jsx("div",{className:"color-preview",style:{backgroundColor:I,padding:"4px 8px",borderRadius:"4px",fontSize:"12px",textAlign:"center"},children:y<6||y>20?"밤":y<10?"아침":y<16?"낮":"저녁"})]})]})]})]}),d&&i.jsx("div",{className:`hdri-toast hdri-toast-${d.type}`,children:d.message})]})}const po=({x:e,y:t,isVisible:s,onClose:n,selectedObject:a,onAddToLibrary:o})=>{const l=r.useRef(null);if(r.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&n()},t=e=>{"Escape"===e.key&&n()};if(s)return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[s,n]),!s)return null;const c=Math.min(e,window.innerWidth-200),A=Math.min(t,window.innerHeight-150);return i.jsxs("div",{ref:l,className:"context-menu",style:{left:c,top:A},children:[i.jsx("div",{className:"context-menu-header",children:i.jsx("span",{children:"메쉬 옵션"})}),i.jsxs("div",{className:"context-menu-items",children:[i.jsxs("button",{className:"context-menu-item",onClick:()=>{a&&o&&o(a),n()},children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})}),i.jsx("span",{children:"라이브러리에 추가"})]}),i.jsxs("button",{className:"context-menu-item disabled",disabled:!0,children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6M12,8A4,4 0 0,0 8,12A4,4 0 0,0 12,16A4,4 0 0,0 16,12A4,4 0 0,0 12,8Z"})}),i.jsx("span",{children:"복제 (곧 제공)"})]}),i.jsxs("button",{className:"context-menu-item disabled",disabled:!0,children:[i.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"})}),i.jsx("span",{children:"삭제 (곧 제공)"})]})]}),a&&i.jsx("div",{className:"context-menu-info",children:i.jsx("span",{className:"selected-object-name",children:a.name||"이름 없음"})})]})},go=({message:e,type:t="info",isVisible:s,onClose:n})=>{if(r.useEffect(()=>{if(s){const e=setTimeout(()=>{n()},3e3);return()=>clearTimeout(e)}},[s,n]),!s)return null;return i.jsxs("div",{className:`toast toast-${t} ${s?"toast-visible":""}`,children:[i.jsx("div",{className:"toast-icon",children:(()=>{switch(t){case"success":return"✓";case"error":return"✕";case"warning":return"⚠";default:return"ℹ"}})()}),i.jsx("div",{className:"toast-message",children:e}),i.jsx("button",{className:"toast-close",onClick:n,children:"×"})]})};function mo({editorControls:e,postProcessingManager:t,onAddToLibrary:s,showInspector:n,onToggleInspector:a}){const{selectedObject:o,transformMode:l,objects:c,walls:A,savedObjects:d,selectedIds:h,setSelectedIds:u,setParent:p,reorderSiblings:g,setTransformMode:m,addWall:b,addObject:f,removeObject:v,removeObjectById:y,addAsset:C,saveMap:x,loadMap:I,clearMap:w,toggleObjectVisibility:E,toggleObjectFreeze:B,renameObject:S,setSelectedObject:Q}=Dn();Dn(e=>e.viewReady),Dn(e=>e.uiReady),Dn(e=>e.envReady),r.useState(""),r.useState("");const j=Dn(e=>e.showLibrary),M=Dn(e=>e.showAssets),D=Dn(e=>e.showHDRI),T=Dn(e=>e.isPostProcessingPanelOpen),R=Dn(e=>e.setShowLibrary),k=Dn(e=>e.setShowAssets),O=Dn(e=>e.setShowHDRI),L=Dn(e=>e.setIsPostProcessingPanelOpen),[F,P]=r.useState({isVisible:!1,x:0,y:0}),[N,G]=r.useState(0);r.useState({message:"",type:"info",isVisible:!1});r.useEffect(()=>{const e=e=>{"f"!==e.key&&"F"!==e.key||(e.preventDefault(),(null==o?void 0:o.id)&&z(o))},t=e=>{(e=>{o&&(e.preventDefault(),P({isVisible:!0,x:e.clientX,y:e.clientY}))})(e.detail.originalEvent)};return window.addEventListener("keydown",e),window.addEventListener("editorContextMenu",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("editorContextMenu",t)}},[o]);const _=t=>{if(!t)return e&&e.deselectAllObjects(),void Q(null);if(e){const s=e.findObjectById(t.id);s&&e.selectObject(s)}Q((null==t?void 0:t.id)??t)},z=t=>{if(_(t),e){const s=e.findObjectById(t.id);s&&e.focusOnObject(s)}};return i.jsxs("div",{className:"editor-ui",children:[i.jsx("div",{className:"tool-panel",children:i.jsxs("div",{className:"tool-section",children:[i.jsx("button",{className:"tool-btn assets-btn "+(M?"active":""),onClick:()=>{const e=!M;k(e),e&&(j&&R(!1),T&&L(!1),D&&O(!1))},title:"기본 에셋",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,2L13.09,8.26L22,9L14.74,14.74L17.18,22L12,18.5L6.82,22L9.26,14.74L2,9L10.91,8.26L12,2Z"})})}),i.jsx("button",{className:"tool-btn library-btn "+(j?"active":""),onClick:()=>{const e=!j;R(e),e&&(M&&k(!1),T&&L(!1),D&&O(!1))},title:"라이브러리",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M4,6H20V8H4V6M4,11H20V13H4V11M4,16H20V18H4V16Z"})})}),i.jsx("button",{className:"tool-btn post-processing-btn "+(T?"active":""),onClick:()=>{const e=!T;L(e),e&&(j&&R(!1),M&&k(!1),D&&O(!1))},title:"포스트프로세싱 효과",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M9,12L11,14L15,10L20,15H4L9,12Z"})})}),i.jsx("button",{className:"tool-btn hdri-btn "+(D?"active":""),onClick:()=>{const e=!D;O(e),e&&(j&&R(!1),M&&k(!1),T&&L(!1))},title:"HDRI 환경",children:i.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,2L14.39,5.42C13.65,5.15 12.84,5 12,5C11.16,5 10.35,5.15 9.61,5.42L12,2M3.34,7L7.5,6.65C6.9,7.16 6.36,7.78 5.94,8.5C5.5,9.24 5.25,10 5.11,10.79L3.34,7M3.36,17L5.12,13.23C5.26,14 5.53,14.78 5.95,15.5C6.37,16.24 6.91,16.86 7.5,17.37L3.36,17M20.65,7L18.88,10.79C18.74,10 18.47,9.23 18.05,8.5C17.63,7.78 17.1,7.15 16.5,6.64L20.65,7M20.64,17L16.5,17.36C17.09,16.85 17.62,16.22 18.04,15.5C18.46,14.77 18.73,14 18.87,13.21L20.64,17Z"})})}),T&&i.jsx(ho,{postProcessingManager:t,onClose:()=>L(!1)})]})}),M&&i.jsx(Ao,{onAssetDrop:(e,t)=>{const s=e=>`${e||"obj"}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;let i;switch(e.type){case"start_position":i={id:s(e.name||e.type),type:"start_position",name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}};break;case"directional_light":i={id:s(e.name||e.type),type:"directional_light",name:e.name,position:t||{x:5,y:10,z:5},rotation:{x:-Math.PI/4,y:Math.PI/4,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,castShadow:!0};break;case"point_light":i={id:s(e.name||e.type),type:"point_light",name:e.name,position:t||{x:0,y:3,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,distance:10,decay:2};break;case"spot_light":i={id:s(e.name||e.type),type:"spot_light",name:e.name,position:t||{x:0,y:5,z:0},rotation:{x:-Math.PI/2,y:0,z:0},scale:{x:1,y:1,z:1},intensity:1,color:16777215,distance:10,angle:Math.PI/6,penumbra:.1};break;case"ambient_light":i={id:s(e.name||e.type),type:"ambient_light",name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},intensity:.3,color:4210752};break;case"audio_source":i={id:s(e.name||e.type),type:"audio_source",name:e.name,position:t||{x:0,y:1,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},volume:1,loop:!1,autoplay:!1};break;default:i={id:s(e.name||e.type),type:e.type,name:e.name,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}}f(i),setTimeout(()=>{Q(i.id)},100)},onClose:()=>k(!1)}),j&&i.jsx(co,{onObjectDrop:async(e,t)=>{const s=e=>`${e||"obj"}_${Date.now()}_${Math.random().toString(36).slice(2,9)}`;let i;i="library"===e.type?{id:s(e.name||e.id||"library"),type:"glb",url:e.glbUrl,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name}:"custom"===e.type?{id:s(e.name||e.id||"custom"),type:"glb",customMeshId:e.id,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name||"Custom Mesh"}:{id:s(e.name||e.type),type:e.type||"basic",geometry:e.geometry,params:e.params,position:t||{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:e.name},f(i),setTimeout(()=>{Q(i.id)},100)},onClose:()=>R(!1),forceRefresh:N}),D&&i.jsx(uo,{scene:null==e?void 0:e.scene,onClose:()=>O(!1)}),i.jsx(po,{x:F.x,y:F.y,isVisible:F.isVisible,onClose:()=>{P({isVisible:!1,x:0,y:0})},selectedObject:o,onAddToLibrary:s}),n&&i.jsx(lo,{objects:c,walls:A,selectedIds:h,setSelectedIds:u,setParent:p,reorderSiblings:g,selectedObject:o,onObjectVisibilityToggle:e=>{E(e)},onObjectFreezeToggle:e=>{B(e)},onObjectSelect:_,onObjectRemove:t=>{if(e&&e.objectSelector){if(e.objectSelector.transformControls)try{e.objectSelector.transformControls.detach()}catch(s){}try{const s=e.findObjectById(t.id);s&&e.objectSelector.removeSelectionOutline(s)}catch(s){}}if(o&&o.id===t.id){if(e)try{e.deselectAllObjects()}catch(s){}Q(null)}setTimeout(()=>{try{null==y||y(null==t?void 0:t.id)}catch(s){}},50)},onObjectFocus:z,onObjectRename:(e,t)=>{if(S(e.id,t),(null==o?void 0:o.id)===e.id){const e={...o,name:t};Q(e)}},onContextMenu:(e,t)=>{e.preventDefault(),_(t),P({isVisible:!0,x:e.clientX,y:e.clientY})},editorControls:e,postProcessingManager:t,onObjectUpdate:t=>{if(e&&t.id){const s=e.findObjectById(t.id);s&&(t.position&&s.position.set(t.position.x,t.position.y,t.position.z),t.rotation&&s.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),t.scale&&s.scale.set(t.scale.x,t.scale.y,t.scale.z),t.name&&(s.name=t.name))}(null==o?void 0:o.id)===t.id&&Q(t)},onClose:()=>a(!1)})]})}const bo=({onMenuAction:e})=>{const[t,s]=r.useState(null),n=e=>{e.target.closest(".menu-bar")||s(null)};return l.useEffect(()=>(document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}),[]),i.jsx("div",{className:"menu-bar",children:i.jsx("div",{className:"menu-items",children:[{title:"파일",items:[{label:"새 맵",action:"new-map",shortcut:"Ctrl+N"},{label:"불러오기",action:"load-map",shortcut:"Ctrl+O"},{label:"저장하기",action:"save-map",shortcut:"Ctrl+S"},{type:"separator"},{label:"임포트",action:"import"},{label:"익스포트",action:"export"},{type:"separator"},{label:"나가기",action:"exit",shortcut:"Alt+F4"}]},{title:"에디터",items:[{label:"실행 취소",action:"undo",shortcut:"Ctrl+Z"},{label:"다시 실행",action:"redo",shortcut:"Ctrl+Y"},{type:"separator"},{label:"복사",action:"copy",shortcut:"Ctrl+C"},{label:"붙여넣기",action:"paste",shortcut:"Ctrl+V"},{label:"삭제",action:"delete",shortcut:"Delete"},{type:"separator"},{label:"전체 선택",action:"select-all",shortcut:"Ctrl+A"},{label:"선택 해제",action:"deselect-all",shortcut:"Ctrl+D"}]},{title:"윈도우",items:[{label:"뷰포트 리셋",action:"reset-viewport"},{label:"카메라 리셋",action:"reset-camera"},{type:"separator"},{label:"그리드 토글",action:"toggle-grid"},{label:"통계 표시",action:"toggle-stats"},{type:"separator"},{label:"인스펙터",action:"toggle-inspector",shortcut:"I"},{type:"separator"},{label:"전체화면",action:"fullscreen",shortcut:"F11"}]},{title:"정보",items:[{label:"단축키",action:"show-shortcuts"},{label:"도움말",action:"show-help",shortcut:"F1"},{type:"separator"},{label:"프로그램 정보",action:"about"}]}].map((n,a)=>i.jsxs("div",{className:"menu-item "+(t===a?"active":""),onClick:()=>{var e;s(t===(e=a)?null:e)},children:[i.jsx("span",{className:"menu-title",children:n.title}),t===a&&i.jsx("div",{className:"dropdown-menu",children:n.items.map((t,n)=>"separator"===t.type?i.jsx("div",{className:"menu-separator"},n):i.jsxs("div",{className:"dropdown-item",onClick:i=>{var n;i.stopPropagation(),n=t.action,s(null),e&&e(n)},children:[i.jsx("span",{className:"item-label",children:t.label}),t.shortcut&&i.jsx("span",{className:"item-shortcut",children:t.shortcut})]},n))})]},a))})})};function fo({editorControls:e}){const{isWireframe:t,isGridSnap:s,isGridVisible:n,gizmoSpace:a,gizmoSize:o,snapMove:l,snapRotateDeg:c,snapScale:A,cameraPanSpeed:d,cameraOrbitSpeed:h,cameraZoomSpeed:u,toggleWireframe:p,toggleGridSnap:g,toggleGridVisible:m,toggleGizmoSpace:b,setGizmoSize:f,setSnapMove:v,setSnapRotateDeg:y,setSnapScale:C,setCameraPanSpeed:x,setCameraOrbitSpeed:I,setCameraZoomSpeed:w}=Dn(),E=Dn(e=>e.isViewGizmoSettingsOpen),B=Dn(e=>e.setIsViewGizmoSettingsOpen),S=Dn(e=>e.isPostProcessingEnabled),Q=Dn(e=>e.togglePostProcessingEnabled),j=Dn(e=>e.safeMode),M=Dn(e=>e.toggleSafeMode),D=Dn(e=>e.setSafeModePixelRatio),T=(e,t=80)=>{let s;return(...i)=>{s&&clearTimeout(s),s=setTimeout(()=>e(...i),t)}},R=r.useMemo(()=>T(()=>{var t;try{null==(t=null==e?void 0:e.updateWireframe)||t.call(e)}catch{}},80),[e]),k=r.useMemo(()=>T(()=>{var t;try{null==(t=null==e?void 0:e.updateGridSnap)||t.call(e)}catch{}},80),[e]),O=r.useMemo(()=>T(()=>{var t,s;try{null==(s=null==(t=null==e?void 0:e.objectSelector)?void 0:t.updateGizmoSize)||s.call(t)}catch{}},80),[e]),L=E;return r.useEffect(()=>{O()},[O,o]),r.useEffect(()=>{k()},[k,l,c,A,s]),r.useEffect(()=>{var t,s,i,n,a;if(e){try{null==(t=e.updateWireframe)||t.call(e)}catch{}try{null==(s=e.updateGridSnap)||s.call(e)}catch{}try{null==(i=e.updateGizmoSpace)||i.call(e)}catch{}try{null==(a=null==(n=e.objectSelector)?void 0:n.updateGizmoSize)||a.call(n)}catch{}}},[e]),i.jsxs("div",{className:"viewport-controls",children:[i.jsx("button",{className:"viewport-control-btn "+(n?"active":""),onClick:()=>{var t;m();try{null==(t=null==e?void 0:e.toggleGrid)||t.call(e)}catch{}},title:"그리드 표시/숨기기",children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M3 3h18v18H3z"}),i.jsx("path",{d:"M8 3v18"}),i.jsx("path",{d:"M13 3v18"}),i.jsx("path",{d:"M18 3v18"}),i.jsx("path",{d:"M3 8h18"}),i.jsx("path",{d:"M3 13h18"}),i.jsx("path",{d:"M3 18h18"})]})}),i.jsx("button",{className:"viewport-control-btn "+("local"===a?"active":""),onClick:()=>{var t;b();try{null==(t=null==e?void 0:e.updateGizmoSpace)||t.call(e)}catch{}},title:`기즈모 좌표계 (${"world"===a?"월드":"로컬"})`,children:i.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:"world"===a?i.jsxs(i.Fragment,{children:[i.jsx("circle",{cx:"12",cy:"12",r:"9"}),i.jsx("path",{d:"M12 3v18"}),i.jsx("path",{d:"M3 12h18"}),i.jsx("path",{d:"M8 8l8 8"}),i.jsx("path",{d:"M16 8l-8 8"})]}):i.jsxs(i.Fragment,{children:[i.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"}),i.jsx("path",{d:"M12 4v16"}),i.jsx("path",{d:"M4 12h16"}),i.jsx("circle",{cx:"12",cy:"12",r:"2"})]})})}),i.jsx("button",{className:"viewport-control-btn "+(L?"active":""),onClick:()=>B(!E),title:"뷰/기즈모 설정",children:i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("path",{d:"M12 1v22"}),i.jsx("path",{d:"M5 5h14"}),i.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),L&&i.jsxs("div",{className:"viewport-settings-pop",children:[i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"포스트프로세싱"}),i.jsx("input",{type:"checkbox",checked:S,onChange:Q})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"안전모드"}),i.jsx("input",{type:"checkbox",checked:!!(null==j?void 0:j.enabled),onChange:()=>M()})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"픽셀 비율"}),i.jsx("input",{type:"number",min:"0.5",max:"2",step:"0.05",value:Number((null==j?void 0:j.pixelRatio)??1).toFixed(2),disabled:!(null==j?void 0:j.enabled),onChange:e=>D(parseFloat(e.target.value))})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"와이어프레임"}),i.jsx("input",{type:"checkbox",checked:t,onChange:()=>{p(),R()}})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"그리드 스냅"}),i.jsx("input",{type:"checkbox",checked:s,onChange:()=>{g(),k()}})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"기즈모 크기"}),i.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:o,onChange:e=>f(e.target.value)}),i.jsx("span",{children:Number(o).toFixed(1)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"이동 스냅"}),i.jsx("input",{type:"number",step:"0.1",value:l,onChange:e=>v(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"회전 스냅(도)"}),i.jsx("input",{type:"number",step:"1",value:c,onChange:e=>y(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{children:"크기 스냅"}),i.jsx("input",{type:"number",step:"0.01",value:A,onChange:e=>C(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{style:{opacity:.8},children:"카메라 Pan"}),i.jsx("input",{type:"number",step:"1",value:d,onChange:e=>x(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{style:{opacity:.8},children:"카메라 Orbit"}),i.jsx("input",{type:"number",step:"1",value:h,onChange:e=>I(e.target.value)})]}),i.jsxs("div",{className:"row",children:[i.jsx("label",{style:{opacity:.8},children:"카메라 Zoom"}),i.jsx("input",{type:"number",step:"0.05",value:u,onChange:e=>w(e.target.value)})]}),i.jsx("div",{className:"hint",children:"스냅은 그리드 스냅이 활성화되어야 적용됩니다."})]})]})}const vo="새 맵을 만들면 현재 작업이 사라집니다. 계속하시겠습니까?",yo="익스포트 기능은 준비 중입니다.",Co="에디터를 종료하시겠습니까?",xo="실행 취소 기능은 준비 중입니다.",Io="다시 실행 기능은 준비 중입니다.",wo="전체 선택 기능은 준비 중입니다.",Eo="선택 해제 기능은 준비 중입니다.",Bo="뷰포트 리셋 기능은 준비 중입니다.",So="카메라 리셋: 키패드 0번을 누르세요.",Qo="통계 표시 기능은 준비 중입니다.",jo="단축키 정보:\nW/E/R: 기즈모 모드\nF: 오브젝트 포커스\nESC: 선택 해제\n키패드 0: 카메라 리셋\n키패드 5: 카메라 모드 토글\n키패드 1/3/7/9: 뷰 변경",Mo="도움말:\n• 좌클릭: 오브젝트 선택\n• Shift+좌클릭: 다중 선택\n• 중간클릭: 팬 이동\n• Alt+중간클릭: 카메라 회전\n• 마우스 휠: 줌",Do="ThirdPersonTreeJS Editor\nVersion 1.0.0\n3D 에디터 프로그램";function To(){const e=Kt(),{clearMap:t,saveMap:s,loadMap:n,addObject:a,setSelectedObject:o,addCustomMesh:l,selectedObject:c,selectedIds:A,toggleGridVisible:d,scene:h,hdriSettings:u,sunLightRef:p,setSunLightRef:g,saveHDRISettings:m,objects:f,setSelectedIds:v,setParent:y,reorderSiblings:x,copyObject:I,pasteObject:w,deleteSelectedObject:E,hasClipboardData:Q}=Dn(),[j,M]=r.useState(null),[D,T]=r.useState(""),[R,k]=r.useState(null),[O,L]=r.useState(!0),F=r.useRef(null),[P,N]=r.useState(null),G=r.useRef(null),_=r.useRef(io()),z=r.useRef(new Set);r.useEffect(()=>{let e=!1;return(async()=>{try{const t=await _.current.getCustomMeshes();if(!e&&0===(Dn.getState().customMeshes||[]).length){const e=t.map(e=>"string"==typeof e.thumbnail&&e.thumbnail.startsWith("blob:")?e.thumbnail:null).filter(Boolean);z.current=new Set(e),Dn.getState().loadCustomMeshes(t)}}catch{}})(),()=>{e=!0;for(const e of z.current)try{URL.revokeObjectURL(e)}catch{}z.current.clear()}},[]),r.useEffect(()=>{const e=e=>{const{message:t,type:s="info",duration:i=3e3}=e.detail||{};t&&(k({message:t,type:s}),i>0&&setTimeout(()=>k(null),i))};return window.addEventListener("appToast",e),()=>window.removeEventListener("appToast",e)},[]),r.useEffect(()=>{h&&u.sunLightEnabled&&!p?U():h&&!u.sunLightEnabled&&p&&H()},[h,u.sunLightEnabled,p]),r.useEffect(()=>{if(!h||!p||!u.sunLightEnabled)return;if(!(()=>{let e=!1;return h.traverse(t=>{t===p&&(e=!0)}),e})())try{h.add(p)}catch{}},[h,p,u.sunLightEnabled]),r.useEffect(()=>{h&&u.currentHDRI&&"none"===u.currentHDRI.type&&(h.background=new b(2763306),h.environment=null)},[h,u.currentHDRI]),r.useEffect(()=>{const e=e=>{var t,s;if("i"!==e.key&&"I"!==e.key||e.ctrlKey||e.altKey||e.shiftKey||(e.preventDefault(),L(e=>!e)),e.ctrlKey&&("c"===e.key||"C"===e.key))if(e.preventDefault(),c){let e=null;if(F.current){const s=c.id||c;e=F.current.findObjectById(s),!e&&(null==(t=F.current.selectedObjects)?void 0:t.length)>0&&(e=F.current.selectedObjects[0])}e?(I(e),k({message:`"${e.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3)):(I(c),k({message:`"${c.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3))}else k({message:"복사할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>k(null),2e3);if(e.ctrlKey&&("v"===e.key||"V"===e.key))if(e.preventDefault(),Q()){const e=w();e?(k({message:`"${e.name}"이(가) 붙여넣기되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3)):(k({message:"붙여넣기에 실패했습니다",type:"error"}),setTimeout(()=>k(null),2e3))}else k({message:"붙여넣을 객체가 클립보드에 없습니다",type:"warning"}),setTimeout(()=>k(null),2e3);if("Delete"===e.key)if(e.preventDefault(),c){const e="object"==typeof c?c.id??(null==(s=c.userData)?void 0:s.ownerId):c,t=f.find(t=>t.id===e);if(t){const e=t.name;E(),k({message:`"${e}"이(가) 삭제되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3)}else k({message:"삭제할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>k(null),2e3)}else k({message:"삭제할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>k(null),2e3)};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[c,f,I,w,E,Q,k]);const U=()=>{if(!h)return;const e=new C(u.sunColor,u.sunIntensity),t=u.sunAzimuth*Math.PI/180,s=u.sunElevation*Math.PI/180,i=Math.sin(t)*Math.cos(s)*100,n=100*Math.sin(s),a=Math.cos(t)*Math.cos(s)*100;e.position.set(i,n,a),e.lookAt(0,0,0),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,e.name="sunLight",e.userData=e.userData||{},e.userData.isSystemObject=!0,g(e),h.add(e)},H=()=>{h&&p&&(h.remove(p),p.dispose&&p.dispose(),g(null))};r.useEffect(()=>{h&&setTimeout(()=>m(),100)},[u,h,m]);const q=()=>{var e,t;if("save"===j&&D.trim()){const e=(()=>{var e,t,s,i;const n={};try{const a=F.current,r=window.__blenderControls,o=(null==(e=null==a?void 0:a.getCamera)?void 0:e.call(a))||(null==r?void 0:r.camera);o&&(n.camera={position:o.position?o.position.toArray():null,target:r&&r.target?r.target.toArray():(null==(i=null==(s=null==(t=null==a?void 0:a.getCameraTarget)?void 0:t.call(a))?void 0:s.toArray)?void 0:i.call(s))||[0,0,0],up:o.up?o.up.toArray():null,fov:o.fov,near:o.near,far:o.far});const l=Dn.getState();n.viewOptions={isWireframe:l.isWireframe,isGridSnap:l.isGridSnap,isGridVisible:l.isGridVisible,gizmoSpace:l.gizmoSpace,gizmoSize:l.gizmoSize,snapMove:l.snapMove,snapRotateDeg:l.snapRotateDeg,snapScale:l.snapScale,cameraPanSpeed:l.cameraPanSpeed,cameraOrbitSpeed:l.cameraOrbitSpeed,cameraZoomSpeed:l.cameraZoomSpeed,isPostProcessingEnabled:l.isPostProcessingEnabled}}catch{}return n})();s(D.trim(),e),alert(`맵이 "${D.trim()}"으로 저장되었습니다.`)}else if("load"===j&&D.trim()){if(n(D.trim())){try{const s=null==(t=(e=Dn.getState()).getMapData)?void 0:t.call(e,D.trim());s&&s.viewState&&(e=>{var t,s,i,n,a;if(e&&"object"==typeof e)try{const r=F.current,o=window.__blenderControls;if(e.camera){const n=(null==(t=null==r?void 0:r.getCamera)?void 0:t.call(r))||(null==o?void 0:o.camera);n&&(Array.isArray(e.camera.position)&&n.position.fromArray(e.camera.position),Array.isArray(e.camera.up)&&n.up.fromArray(e.camera.up),"number"==typeof e.camera.fov&&(n.fov=e.camera.fov),"number"==typeof e.camera.near&&(n.near=e.camera.near),"number"==typeof e.camera.far&&(n.far=e.camera.far),null==(s=n.updateProjectionMatrix)||s.call(n),o&&Array.isArray(e.camera.target)?o.target.fromArray(e.camera.target):r&&Array.isArray(e.camera.target)&&(null==(i=r.setCameraTarget)||i.call(r,(new S).fromArray(e.camera.target))))}if(e.viewOptions){const t=Dn.getState();"boolean"==typeof e.viewOptions.isWireframe&&t.isWireframe!==e.viewOptions.isWireframe&&Dn.getState().toggleWireframe(),"boolean"==typeof e.viewOptions.isGridSnap&&t.isGridSnap!==e.viewOptions.isGridSnap&&Dn.getState().toggleGridSnap(),"boolean"==typeof e.viewOptions.isGridVisible&&t.isGridVisible!==e.viewOptions.isGridVisible&&Dn.getState().toggleGridVisible(),e.viewOptions.gizmoSpace&&t.gizmoSpace!==e.viewOptions.gizmoSpace&&Dn.getState().toggleGizmoSpace(),Number.isFinite(e.viewOptions.gizmoSize)&&Dn.getState().setGizmoSize(e.viewOptions.gizmoSize),Number.isFinite(e.viewOptions.snapMove)&&Dn.getState().setSnapMove(e.viewOptions.snapMove),Number.isFinite(e.viewOptions.snapRotateDeg)&&Dn.getState().setSnapRotateDeg(e.viewOptions.snapRotateDeg),Number.isFinite(e.viewOptions.snapScale)&&Dn.getState().setSnapScale(e.viewOptions.snapScale),Number.isFinite(e.viewOptions.cameraPanSpeed)&&Dn.getState().setCameraPanSpeed(e.viewOptions.cameraPanSpeed),Number.isFinite(e.viewOptions.cameraOrbitSpeed)&&Dn.getState().setCameraOrbitSpeed(e.viewOptions.cameraOrbitSpeed),Number.isFinite(e.viewOptions.cameraZoomSpeed)&&Dn.getState().setCameraZoomSpeed(e.viewOptions.cameraZoomSpeed),"boolean"==typeof e.viewOptions.isPostProcessingEnabled&&Dn.getState().isPostProcessingEnabled!==e.viewOptions.isPostProcessingEnabled&&Dn.getState().togglePostProcessingEnabled(),null==(n=null==r?void 0:r.applyInitialViewState)||n.call(r),o&&(null==(a=o.update)||a.call(o))}}catch{}})(s.viewState)}catch{}alert(`맵 "${D.trim()}"을 불러왔습니다.`)}else alert(`맵 "${D.trim()}"을 찾을 수 없습니다.`)}M(null),T("")},K=()=>{M(null),T("")};return i.jsxs("div",{className:"editor-page",children:[i.jsx(bo,{onMenuAction:s=>{var i,n,r,l;switch(s){case"new-map":if(confirm(vo)){t();try{null==(n=null==(i=F.current)?void 0:i.resetCamera)||n.call(i)}catch{}try{window.__blenderControls&&(window.__blenderControls.target.set(0,0,0),null==(l=(r=window.__blenderControls).update)||l.call(r))}catch{}}break;case"load-map":M("load");break;case"save-map":M("save");break;case"import":(()=>{const e=document.createElement("input");e.type="file",e.accept=".glb,.gltf",e.multiple=!1,e.onchange=e=>{const t=e.target.files[0];if(!t)return;const s=URL.createObjectURL(t),i=t.name.replace(/\.[^/.]+$/,""),n={id:Date.now(),type:"glb",file:s,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},name:i};a(n),setTimeout(()=>{o(n.id)},100)},e.click()})();break;case"export":alert(yo);break;case"exit":confirm(Co)&&e("/");break;case"undo":alert(xo);break;case"redo":alert(Io);break;case"copy":if(c){const e=f.find(e=>e.id===c);e?(I(e),k({message:`"${e.name}"이(가) 복사되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3)):(k({message:"복사할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>k(null),2e3))}else k({message:"복사할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>k(null),2e3);break;case"paste":if(Q()){const e=w();e?(k({message:`"${e.name}"이(가) 붙여넣기되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3)):(k({message:"붙여넣기에 실패했습니다",type:"error"}),setTimeout(()=>k(null),2e3))}else k({message:"붙여넣을 객체가 클립보드에 없습니다",type:"warning"}),setTimeout(()=>k(null),2e3);break;case"delete":if(c){const e=f.find(e=>e.id===c);if(e){const t=e.name;E(),k({message:`"${t}"이(가) 삭제되었습니다`,type:"success"}),setTimeout(()=>k(null),2e3)}else k({message:"삭제할 객체를 찾을 수 없습니다",type:"error"}),setTimeout(()=>k(null),2e3)}else k({message:"삭제할 객체를 먼저 선택해주세요",type:"warning"}),setTimeout(()=>k(null),2e3);break;case"select-all":alert(wo);break;case"deselect-all":alert(Eo);break;case"reset-viewport":alert(Bo);break;case"reset-camera":alert(So);break;case"toggle-grid":d();const s=Dn.getState().isGridVisible;F.current&&F.current.toggleGrid(),k({message:`그리드가 ${s?"표시":"숨김"} 되었습니다`,type:"info"}),setTimeout(()=>k(null),2e3);break;case"toggle-stats":alert(Qo);break;case"toggle-inspector":L(e=>!e),k({message:`인스펙터가 ${O?"숨김":"표시"} 되었습니다`,type:"info"}),setTimeout(()=>k(null),2e3);break;case"fullscreen":document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();break;case"show-shortcuts":alert(jo);break;case"show-help":alert(Mo);break;case"about":alert(Do)}}}),i.jsxs("div",{className:"editor-container",children:[i.jsx(no,{onEditorControlsReady:e=>{F.current=e,N(e)},onPostProcessingReady:e=>{G.current=e},onContextMenu:e=>{const t=new CustomEvent("editorContextMenu",{detail:{originalEvent:e}});window.dispatchEvent(t)}}),i.jsx(fo,{editorControls:P}),i.jsx(mo,{editorControls:P,postProcessingManager:G.current,onAddToLibrary:async e=>{var t,s,i;try{const n=prompt("메쉬 이름을 입력하세요:",e.name||"커스텀 메쉬");if(!n)return;const a=!0;k({message:"라이브러리에 추가 중...",type:"info"});const r=F.current;let o=null;const c=(null==r?void 0:r.selectedObjects)&&r.selectedObjects.length>0?[...r.selectedObjects]:[];if(c.length>1){const e=new J;e.name=n,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1),e.updateMatrixWorld(!0),c.forEach(t=>{try{t.updateMatrixWorld(!0);const s=t.clone(!0),i=(new B).copy(t.matrixWorld),n=new S,a=new ae,r=new S(1,1,1);i.decompose(n,a,r),s.position.copy(n),s.quaternion.copy(a),s.scale.copy(r),s.updateMatrix(),s.updateMatrixWorld(!0),e.add(s)}catch{}}),e.updateMatrixWorld(!0),o=e}else{const n=e&&"object"==typeof e?e.id??(null==(t=e.userData)?void 0:t.ownerId)??e:e;o=e&&"object"==typeof e&&e.isObject3D?e:r&&((null==(s=r.findObjectById)?void 0:s.call(r,n))||(null==(i=r.selectedObjects)?void 0:i[0]))||null}if(!o)return k({message:"내보낼 Three.js 객체를 찾지 못했습니다.",type:"error"}),void setTimeout(()=>k(null),4e3);const A=await _.current.addCustomMesh(o,n,{preserveTransform:a,compressToSingleMesh:!0});try{_.current.downloadCustomMesh(A)}catch{}if((Dn.getState().customMeshes||[]).some(e=>e.id===A.id)){if(!confirm("동일 ID의 커스텀 메쉬가 이미 있습니다.\n\n- 기존 항목을 덮어쓸까요?"))return k({message:"추가가 취소되었습니다(중복 ID).",type:"warning"}),void setTimeout(()=>k(null),2500);await Bn(A);const e=(Dn.getState().customMeshes||[]).map(e=>e.id===A.id?A:e);Dn.getState().loadCustomMeshes(e)}else await l(A);window.dispatchEvent(new CustomEvent("customMeshAdded",{detail:A})),k({message:`"${n}" GLB가 내보내지고 라이브러리에 추가되었습니다! (그룹 피벗 항등/자식 월드 변환 유지)`,type:"success"}),setTimeout(()=>k(null),5e3)}catch(n){const e=n&&"NO_MESH_FOUND"===n.message?"선택한 오브젝트에서 내보낼 메시를 찾지 못했습니다. (스키닝/인스턴스/비메시 제외)":"라이브러리 추가에 실패했습니다.";k({message:e,type:"error"}),setTimeout(()=>k(null),5e3)}},showInspector:O,onToggleInspector:L})]}),j&&i.jsx("div",{className:"dialog-overlay",children:i.jsxs("div",{className:"dialog",children:[i.jsx("h3",{children:"save"===j?"맵 저장":"맵 불러오기"}),i.jsx("input",{type:"text",value:D,onChange:e=>T(e.target.value),placeholder:"맵 이름을 입력하세요",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&q(),"Escape"===e.key&&K()}}),i.jsxs("div",{className:"dialog-buttons",children:[i.jsx("button",{onClick:q,children:"확인"}),i.jsx("button",{onClick:K,children:"취소"})]})]})}),R&&i.jsx(go,{message:R.message,type:R.type,onClose:()=>k(null)})]})}export{To as default};
